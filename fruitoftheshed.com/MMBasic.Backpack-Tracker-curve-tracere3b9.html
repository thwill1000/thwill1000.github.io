

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from fruitoftheshed.com/MMBasic.Backpack-Tracker-curve-tracer.ashx?HL=mmbasic,board,layout by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 13:02:34 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=8" /><title>
	Backpack Tracker curve tracer - Fruit Of The Shed
</title><meta name="keywords" content="MMBASIC, MX170, LCD, BACKPACK, TEST TOOL" /><meta name="description" content="In circuit test tool" /><script type="text/javascript" src="JS/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="JS/Scripts.js"></script>
<script type="text/javascript" src="JS/SearchHighlight.js"></script>
<link rel="stylesheet" media="print" href="Themes/Default/Print_Styles.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles%20-%20Copy.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles.css" type="text/css" />
<link rel="stylesheet" href="Themes/Editor.css" type="text/css" />
<link rel="search" href="searchf7b1.xml?OpenSearch=1" type="application/opensearchdescription+xml" title="Fruit Of The Shed - Search" /><script src="Themes/Default/Scripts.js" type="text/javascript"></script>
<link rel="shortcut icon" href="Themes/Default/Icon.ico" type="image/x-icon" />
</head>
<body>
    <form name="aspnetForm" method="post" action="http://fruitoftheshed.com/Default.aspx?Page=Backpack-Tracker-curve-tracer&amp;NS=MMBasic&amp;HL=mmbasic%2cboard%2clayout" id="aspnetForm">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUJMTQ3NjA4MDI2D2QWAmYPZBYCAgEPZBYCAgkPZBYEAhsPDxYCHg1BbnRoZW1WaXNpYmxlaGRkAicPDxYCHgdWaXNpYmxlaGQWAmYPFgIeC18hSXRlbUNvdW50ZmRkL9X+pH8J+jB1IIJZx71WjgOrjyw=" />
</div>

<script type="text/javascript">
//<![CDATA[
var Anthem_FormID = "aspnetForm";
//]]>
</script>
<script src="WebResource3c0c.axd?d=wu8PDPV1hmKciPrhUAi9NEjQUBbOefrIXCaRPwGH8Q5jrvPZFuGbKmycL3GXDKGD1_JZ083oQl1Kpd_P7rg1V93MtYOS3Vb-0Eztmu5VDCWQxc7l0&amp;t=636158881040000000" type="text/javascript"></script>
<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="CA0B0334" />
</div>
		<script type="text/javascript">
<!--
__BaseName = "ctl00_CphMaster_";
__ConfirmMessage = "Are you sure you want to proceed?";
// -->
</script>
		<script type="text/javascript">
		<!--
			function __GetServerElementById(id) {
				return document.getElementById(__BaseName + id);
			}
			function __RequestConfirm() {
				return confirm(__ConfirmMessage);
			}
		// -->
		</script>
    
        <div id="HeaderDiv">
            <div style="float: right;">Welcome <a href="MMBasic.Language.html" class="systemlink" title="Select your language">Guest</a>, you are in: <select class="namespacedropdown" onchange="javascript:var sel = this.value; document.location = (sel != '' ? (sel + '.') : '') + 'Default.aspx';"><option value="">&lt;root&gt;</option><option value="Circuit Ideas">Circuit Ideas</option><option value="Colour MaxiMite 2 (CMM2)">Colour MaxiMite 2 (CMM2)</option><option value="GCB">GCB</option><option value="MicroMite ArmMite and MMX Hardware">MicroMite ArmMite and MMX Hardware</option><option selected="selected" value="MMBasic">MMBasic</option><option value="PIC ASM">PIC ASM</option><option value="Platform Agnostic">Platform Agnostic</option></select> &bull; <a href="MMBasic.Loginecd6.html?Redirect=http%3a%2f%2ffruitoftheshed.com%2fDefault.aspx%3fPage%3dBackpack-Tracker-curve-tracer%26NS%3dMMBasic%26HL%3dmmbasic%2cboard%2clayout" class="systemlink" title="Login">Login</a></div><h1>Fruit Of The Shed</h1>
        </div>
                   
        <div id="ContainerDiv">
                 
            <div id="SidebarDiv">
                <div id="SidebarHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="SidebarContentDiv">
                    <div style="float: right;"> </div><h3 class="separator">Navigation (MMBasic)<a class="headeranchor" id="Navigation_NAMESPACE_0" href="#Navigation_NAMESPACE_0" title="Link to this Section">&#0182;</a></h3><ul><li><b><a class="pagelink" href="MMBasic.MainPage.html" title="_MMBasic Code Library">Main Page</a></b></li><li><a class="pagelink" href="MainPage.html" title="Home Page">Main Page (root)</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.EggDrop-part-of-the-original-MMBasic-libraryc674.html" title="Random Page">Random Page</a></li><li><a class="systemlink" href="MMBasic.AllPages.html" title="All Pages">All Pages</a><br /> </li><li><a class="systemlink" href="Logina75d.html" title="Create a new Page">Create a new Page</a><br /></li></ul><br /><ul><li><a class="systemlink" href="Logine894.html" title="Administration">Administration</a></li><li><a class="systemlink" href="MMBasic.Upload.html" title="File Management">File Management</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="My Account">My Account</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="Create Account">Create Account</a><br /></li></ul><br /><small><b>Search the wiki</b></small><br /><br /><script type="text/javascript"><!--
function _DoSearch_SBa925f7376d16452eba58fcd259b58efc() { document.location = 'MMBasic.Search.aspx?AllNamespaces=1&FilesAndAttachments=1&Query=' + encodeURI(document.getElementById('SBa925f7376d16452eba58fcd259b58efc').value); }
// -->
</script><input class="txtsearchbox" type="text" id="SBa925f7376d16452eba58fcd259b58efc" onkeydown="javascript:var keycode; if(window.event) keycode = event.keyCode; else keycode = event.which; if(keycode == 10 || keycode == 13) { _DoSearch_SBa925f7376d16452eba58fcd259b58efc(); return false; }" /> <big><a href="#" onclick="javascript:_DoSearch_SBa925f7376d16452eba58fcd259b58efc(); return false;">&raquo;</a></big><br /><br /><br />
                </div>
                <div id="SidebarFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>
            <div id="MainDiv">
                <div id="MainHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="PageInternalHeaderDiv"></div>
                

    <script type="text/javascript">
    <!--
        function __ShowAllTrail() {
            try {
                document.getElementById("BreadcrumbsDivMin").style["display"] = "none";
                document.getElementById("BreadcrumbsDivAll").style["display"] = "";
                __SetStatus("1");
            }
            catch(ex) { }
            return false;
        }
        function __HideTrail() {
            try {
                document.getElementById("BreadcrumbsDivMin").style["display"] = "";
                document.getElementById("BreadcrumbsDivAll").style["display"] = "none";
                __SetStatus("0");
            }
            catch(ex) { }
            return false;
        }
        
        function __SetStatus(open) {
            __CreateCookie("ScrewTurnWikiBCT", open, 365);
        }
        function __GetStatus() {
            var value = __ReadCookie("ScrewTurnWikiBCT");
            if(value) return value;
            else return "0";
        }

        function __InitBCT() {
        	if(__GetStatus() == "1") {
        		__ShowAllTrail();
        	}
        }

        var __attachmentsMenuJustShown = false;
        var __adminToolsMenuJustShown = false;
        var __ie7Mode = false;

        function __ToggleAttachmentsMenu(cx, cy) {
        	var element = document.getElementById("PageAttachmentsDiv");
        	if(element) {
        		if(element.style["display"] == "none") {
        			element.style["display"] = "";
        			var pos = __AbsolutePosition(element);
        			if(pos.left - cx > 0) {
        				__ie7Mode = true;
        				element.style["position"] = "absolute";
        				element.style["top"] = cy + "px";
        				element.style["left"] = (cx - pos.width) + "px";
        			}
        			else {
        				__RepositionDiv(document.getElementById("PageAttachmentsLink"), element);
        			}
        			__attachmentsMenuJustShown = true;
        		}
        	}
        	return false;
        }
        function __HideAttachmentsMenu() {
        	var element = document.getElementById("PageAttachmentsDiv");
        	if(element && !__attachmentsMenuJustShown) {
        		element.style["display"] = "none";
        		if (__ie7Mode) element.style["left"] = "10000px";
        	}
        	__attachmentsMenuJustShown = false;
        	return true; // Needed to enabled next clicks' action (file download)
        }

        function __ToggleAdminToolsMenu(cx, cy) {
        	var element = document.getElementById("AdminToolsDiv");
        	if(element) {
        		if(element.style["display"] == "none") {
        			element.style["display"] = "";
        			var pos = __AbsolutePosition(element);
        			if(pos.left - cx > 0) {
        				__ie7Mode = true;
        				element.style["position"] = "absolute";
        				element.style["top"] = cy + "px";
        				element.style["left"] = (cx - pos.width) + "px";
        			}
        			else {
        				__RepositionDiv(document.getElementById("AdminToolsLink"), element);
        			}
        			__adminToolsMenuJustShown = true;
        		}
        	}
        	return false;
        }
        function __HideAdminToolsMenu() {
        	var element = document.getElementById("AdminToolsDiv");
        	if(element && !__adminToolsMenuJustShown) {
        		element.style["display"] = "none";
        		if(__ie7Mode) element.style["left"] = "10000px";
        	}
        	__adminToolsMenuJustShown = false;
        	return true; // Needed to enable next clicks' action (admin tools)
        }

        function __HideAllMenus() {
        	__HideAttachmentsMenu();
        	__HideAdminToolsMenu();
        }

        document.body.onclick = __HideAllMenus;

        function __AbsolutePosition(obj) {
        	var pos = null;
        	if(obj != null) {
        		pos = new Object();
        		pos.top = obj.offsetTop;
        		pos.left = obj.offsetLeft;
        		pos.width = obj.offsetWidth;
        		pos.height = obj.offsetHeight;

        		obj = obj.offsetParent;
        		while(obj != null) {
        			pos.top += obj.offsetTop;
        			pos.left += obj.offsetLeft;
        			obj = obj.offsetParent;
        		}
        	}
        	return pos;
        }

        var __showTimer = null;
        var __hideTimer = null;

        function __ShowDropDown(e, divId, parent) {
           	// Set a timer
        	// On mouse out, cancel the timer and start a 2nd timer that hides the menu
        	// When the 1st timer elapses
        	//   show the drop-down
        	//   on menu mouseover, cancel the 2nd timer
        	//   on menu mouse out, hide the menu
        	__showTimer = setTimeout('__ShowDropDownForReal(' + e.clientX + ', ' + e.clientY + ', "' + divId + '", "' + parent.id + '");', 200);
        }

        function __ShowDropDownForReal(cx, cy, divId, parentId) {
        	var pos = __AbsolutePosition(document.getElementById(parentId));
        	var menu = document.getElementById(divId);

			// This is needed to trick IE7 which, for some reason,
			// does not position the drop-down correctly with the new Default theme
        	if(pos.left - cx > 30) {
        		menu.style["display"] = "";
        		menu.style["position"] = "absolute";
        		menu.style["top"] = cy + "px";
        		menu.style["left"] = (cx - 10) + "px";
        	}
        	else {
        		menu.style["display"] = "";
        		menu.style["position"] = "absolute";
        		menu.style["top"] = (pos.top + pos.height) + "px";
        		menu.style["left"] = pos.left + "px";
        	}
        	__showTimer = null;
        }

        function __HideDropDown(divId) {
        	if(__showTimer) clearTimeout(__showTimer);
        	__hideTimer = setTimeout('__HideDropDownForReal("' + divId + '");', 200);
        }

        function __HideDropDownForReal(divId) {
        	document.getElementById(divId).style["display"] = "none";
        	__hideTimer = null;
        }

        function __CancelHideTimer() {
        	if(__hideTimer) clearTimeout(__hideTimer);
        }
        
    // -->
    </script>

	<a id="PageTop"></a>
	
	<div id="PageHeaderDiv">
	
		<!-- Change this to PageToolbarDiv -->
		<div id="EditHistoryLinkDiv">
			<a id="DiscussLink" title="Discuss" href="MMBasic.Backpack-Tracker-curve-tracer266d.html?Discuss=1">Discuss (1)</a>
			
			
			<a id="HistoryLink" title="View Page edit history" href="MMBasic.Historya2fe.html?Page=MMBasic.Backpack-Tracker-curve-tracer">History</a>
			
			
			
			
			
		</div>
		
		<h1 class="pagetitle">
			
			Backpack Tracker curve tracer
			
		</h1>
		
		<div id="PrintLinkDiv">
			<a id="PrintLink" href="MMBasic.Printa2fe.html?Page=MMBasic.Backpack-Tracker-curve-tracer" title="Printer friendly version" target="_blank">Print</a>
		</div>
		
		<div id="RssLinkDiv">
			
		</div>
		
		<div id="EmailNotificationDiv">
			<span id="Anthem_ctl00_CphMaster_btnEmailNotification__"></span>
		</div>
		
		<div id="ctl00_CphMaster_pnlPageInfo">
	
			<div id="PageInfoDiv">
				<span id="ModificationSpan">
					Modified on 
					2020/10/01 15:34
				</span>
				<span id="AuthorSpan">
					 by 
					<a href="MMBasic.Userb2ec.html?Username=hendy">CaptainBoing</a>
				</span>
				<span id="NavPathsSpan">
					
				</span>
				<span id="CategoriesSpan">
					Categorized as 
					<a href="MMBasic.AllPages62d4.html?Cat=MMBasic.ARMMite" title="ARMMite">ARMMite</a>, <a href="MMBasic.AllPages5ce5.html?Cat=MMBasic.Electronics" title="Electronics">Electronics</a>, <a href="MMBasic.AllPages9386.html?Cat=MMBasic.Hardware" title="Hardware">Hardware</a>
				</span>
				
				<span id="PageDiscussionSpan">
					
					
				</span>
			</div>
		
</div>
		
		<div id="ff4798db7-71d5-4bbc-8ecf-8373985044b4" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('ff4798db7-71d5-4bbc-8ecf-8373985044b4');"></div><div id="fff11e723-c323-4405-813d-a9c0f7007dfa" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('fff11e723-c323-4405-813d-a9c0f7007dfa');"><a href="MMBasic.Sensible-Cartesian-Co-ordinate-graphics-pack.html" title="Sensible Cartesian Co-ordinate graphics pack">Sensible Cartesian Co-ordinate graphics pack</a></div><div id="f49e2004b-21fa-420d-931d-fb8260faa7ab" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('f49e2004b-21fa-420d-931d-fb8260faa7ab');"><a href="MMBasic.Sort-algorithms-A-comparison.html" title="Sort algorithms - A comparison">Sort algorithms - A comparison</a></div><div id="f0a6279cf-0959-40d5-ad0d-8496f7b10699" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('f0a6279cf-0959-40d5-ad0d-8496f7b10699');"></div><div id="f9178efd0-14bc-4395-9e09-3a4ac55b6796" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('f9178efd0-14bc-4395-9e09-3a4ac55b6796');"><a href="MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites.html" title="Ultra-Compact Logging with Flash Storage on small MicroMites">Ultra-Compact Logging with Flash Storage on small MicroMites</a></div><div id="sbfe95e22-f7a3-417d-b364-59ad20be7d80" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('sbfe95e22-f7a3-417d-b364-59ad20be7d80');"></div><div id="BreadcrumbsDiv"><div id="BreadcrumbsDivMin"><a href="#" onclick="javascript:return __ShowAllTrail();" title="Click here to view the complete Breadcrumbs Trail">(10)</a> &raquo; <a href="MMBasic.Hearts-and-Bones-v1-0-part-of-the-original-MMBasic-library.html" title="Hearts and Bones v1.0 (MMBasic)">Hearts and Bones v1.0 (MMBasic)</a> &raquo; <a href="MMBasic.Driving-a-Parallel-Printer-part-of-the-original-MMBasic-library.html" title="Driving a Parallel Printer (MMBasic)">Driving a Parallel Printer (MMBasic)</a> &raquo; <b><a href="MMBasic.Backpack-Tracker-curve-tracer.html" title="Backpack Tracker curve tracer (MMBasic)">Backpack Tracker curve tracer (MMBasic)</a></b> </div><div id="BreadcrumbsDivAll" style="display: none;"><a href="#" onclick="javascript:return __HideTrail();" title="Click here to hide the Breadcrumbs Trail">[X]</a> &raquo; <a href="MMBasic.MMBasic-code-pack-to-Read-and-Write-Winbond-Flash-Memories.html" title="MMBasic code-pack to Read and Write Winbond Flash Memories (MMBasic)" onmouseover="javascript:return __ShowDropDown(event, 'f9178efd0-14bc-4395-9e09-3a4ac55b6796', this);" id="lnkf9178efd0-14bc-4395-9e09-3a4ac55b6796" onmouseout="javascript:return __HideDropDown('f9178efd0-14bc-4395-9e09-3a4ac55b6796');">MMBasic code-pack to Read and Write Winbond Flash Memories (MMBasic)</a> &raquo; <a href="MMBasic.A-Simple-GUI-pack.html" title="A Simple GUI pack (MMBasic)">A Simple GUI pack (MMBasic)</a> &raquo; <a href="MMBasic.Battery-Management-for-12V-System-part-of-the-original-MMBasic-library.html" title="Battery Management for 12V System (MMBasic)">Battery Management for 12V System (MMBasic)</a> &raquo; <a href="MMBasic.Factus-Comb-Sort-for-strings.html" title="Comb Sort for strings (MMBasic)" onmouseover="javascript:return __ShowDropDown(event, 'f49e2004b-21fa-420d-931d-fb8260faa7ab', this);" id="lnkf49e2004b-21fa-420d-931d-fb8260faa7ab" onmouseout="javascript:return __HideDropDown('f49e2004b-21fa-420d-931d-fb8260faa7ab');">Comb Sort for strings (MMBasic)</a> &raquo; <a href="MMBasic.Shape-drawing-for-Complex-Lines-and-Polygons.html" title="Shape drawing for Complex Lines and Polygons (MMBasic)" onmouseover="javascript:return __ShowDropDown(event, 'fff11e723-c323-4405-813d-a9c0f7007dfa', this);" id="lnkfff11e723-c323-4405-813d-a9c0f7007dfa" onmouseout="javascript:return __HideDropDown('fff11e723-c323-4405-813d-a9c0f7007dfa');">Shape drawing for Complex Lines and Polygons (MMBasic)</a> &raquo; <a href="MMBasic.Magic-Switchboard-part-of-the-original-MMBasic-library.html" title="Magic Switchboard (MMBasic)">Magic Switchboard (MMBasic)</a> &raquo; <a href="MMBasic.Analog-Clock-part-of-the-original-MMBasic-library.html" title="Analog Clock (MMBasic)">Analog Clock (MMBasic)</a> &raquo; <a href="MMBasic.Hearts-and-Bones-v1-0-part-of-the-original-MMBasic-library.html" title="Hearts and Bones v1.0 (MMBasic)">Hearts and Bones v1.0 (MMBasic)</a> &raquo; <a href="MMBasic.Driving-a-Parallel-Printer-part-of-the-original-MMBasic-library.html" title="Driving a Parallel Printer (MMBasic)">Driving a Parallel Printer (MMBasic)</a> &raquo; <b><a href="MMBasic.Backpack-Tracker-curve-tracer.html" title="Backpack Tracker curve tracer (MMBasic)">Backpack Tracker curve tracer (MMBasic)</a></b> </div></div>
		
		
	
	</div>
	
	<div id="PageContentDiv">
		This article describes the design of a electronics debugging tool for electronic circuits.<br /><a class="unknownlink" href="MMBasic..html" title="MMBasic."></a><div class="imageright"><img class="image" src="../www.thebackshed.com/Forum/uploads/Volhout/2019-11-26_190124_20191125_194950.jpg" alt="Image" /></div><br />It's main purpose of the tool is to give a graphical representation of the impedance at a node of the circuit, similar to a commercial product, the Huntron Tracker.<br />The tool allows for very fast fault finding in electronic circuits, especially when a known good circuit is available, so graphs can be compared.<br />You can find the faults in a circuit without taking components out. That is a great benefit.<br /><br />Typically you have this tool on the test bench, and next to each other 2 boards, one known good, the other suspect of fault. The ground connection of the test tool is connected to the same pin on each board (typically the ground node). The test wire is used to alternatively probe the good board at node X, and the suspect board at the same node. When waveforms differ between boards, that points to the culprit. The tool has a memory button, so the waveform of the known good board can be checked more carefully.<br /><br />If there is no "known good" circuit is available, still comparison can be made to similar nodes in the same circuit, and differences will point to the culprit.<br />In example microprocessor pins are all similar, if one pin shows a different impedance, there is reason to doubt the microprocessor as being defect.<br /><br />Creating an impedance graph is based on a very simple principle: apply a voltage to that pin, and measure the current that flows in the pin. <br />By applying different voltage, the impedance at each voltage can be shown in a graph.<br />A good description of the circuit can be found here:<br /><a class="externallink" href="https://www.jammarcade.net/simple-component-tester-a-k-a-octopus-curve-tracer/" title="Octopus" target="_blank">Octopus</a><br />Typical test voltages are +/- 15V at currents of a few mA, to avoid damage to the circuit under test.<br /><br />As explained in the article, for resistors, Ohms law U=IxR will show a linear relation between voltage and current. A straight line.<br />For a diode, at positive voltages the impedance will be low, and negative voltage will be high. Result will be a line with a bend.<br />This kind of characteristics are visible on the screen of the Backpack Tracker.<br /><br />The name "Backpack" is from the core building block of this tool: the Micromite Backpack.<br />The Micromite Backpack is a design of Geoff Graham, and is based around a PIC32 processor that can be programmed in Basic. Information can be found here:<br /><a class="externallink" href="https://geoffg.net/MicromiteBackpack.html" title="Backpack" target="_blank">Backpack</a><br /><br />The Micromite Backpack is a 2 circuit board sandwich existing of a PIC32 board, and a commercial ILI9341 LCD touch color display 320x240 pixels.<br />In this design the LCD will display the impedance curves, and will act as a very simple control panel with only 2 (touch) buttons.<br />The PIC32 microcontroller will generate the voltage applied to the circuit under test, measure the current and convert the measurements to an impedance graph.<br />The software is written in MMBasic, the native language of the Micromite Backpack.<br /><br />Since the PIC32 processor can only output voltages in the range of 0V..3.3V, an additional amplifier is needed to achieve the +/- 15V.<br />This amplifier, and it's power supply, are located on a third printed circuit board.<br /><br />The amplifier schematics are shown here:<br /><a class="unknownlink" href="MMBasic..html" title="MMBasic."></a><a href="MMBasic.PageNotFounda9cc.html" title="Amplifier board"><img src="../www.thebackshed.com/forum/uploads/Volhout/2019-09-29_022350_Schermafbeelding%202019-09-28%20om%2018.20.52.png" alt="Image" /></a><br /><br />A short explanation of the circuit:<br />The PIC32 processor does not have a DAC output that can be used to generate different voltages, therefore a PWM output is used, running at a rather high frequency of 120kHz. This frequency is an optimum between resolution (the higher the frequency - the lower the resolution, the lower the frequency - the slower the voltages can be varied, the lower the screen update rate).<br />The PWM signal passes through a low pass filter, to convert it into an analog voltage, that can be amplified by a classical opamp circuit around an LM741.<br /><br />The LM741 is powered from +/- 16.5V that is generated from 5V in an MC34063 switch mode convertor.<br /><br />The circuitry fits on a small PCB, the size of the micromite backpack (could form a sandwich of 3).<br />The circuit board layout is shown here:<br /><a class="unknownlink" href="MMBasic..html" title="MMBasic."></a><a href="MMBasic.PageNotFound1729.html" title="Board layout"><img src="../www.thebackshed.com/forum/uploads/Volhout/2019-09-29_022543_Schermafbeelding%202019-09-28%20om%2018.20.06.png" alt="Image" /></a><br />J1 is the connector that plugs into the micromite backpack.<br /><br /><br /><a class="internallink" href="TrackerFoilSS93dd.png?File=%2fMMBasic%2fTrackerFoilSS.png" title="Download PCB foil (solder side view)">Download PCB foil (solder side view)</a><br /><a class="internallink" href="TrackerFoilCSeb1c.png?File=%2fMMBasic%2fTrackerFoilCS.png" title="Download PCB foil (component side view)">Download PCB foil (component side view)</a><br /><br />To understand how the circuit works it is necessary to know that the current measurement, required to determine the impedance of the circuit under test, is done through a trick: the ADC inside the PIC32 measures the output voltage of the LM741 after it passed through a resistor R16, and subtracts the measured value from the theoretical output voltage of the LM741. result is the voltage across that resistor, and thus the current through the resistor.<br />Since this  principle (subtract 2 large values to get a small value) is in essence inaccurate, the software performs a calibration at powerup.<br /><br />A picture of the displayed waveform is shown here:<br /><a class="unknownlink" href="MMBasic..html" title="MMBasic."></a><a href="MMBasic.PageNotFoundf625.html" title="Display waveform"><img src="../www.thebackshed.com/forum/uploads/Volhout/2019-09-27_071659_markers.jpg" alt="Image" /></a><br /><br />There are 2 buttons: <br />MEM: this button stores the current waveform, and displays it in red, as a reference. This would be the waveform of the "known good" circuit.<br />ZOOM: this button zooms in at the center, to allow more detail if low voltage circuits are probed.<br /><br />In the screen there is a waveform, characteristic for the impedance of the pin under test (yellow), and 2 markers (cyan).<br />The markers show the voltage at the waveform extremes, and can be used to detect smaller changes between very similar impedance's. Very handy to check zener diodes.<br /><br />When building the Backpack Tracker, some things are important to note.<br />The LM741 was chosen because of it's supply voltage range. To reach an output of +/-15V (actually +/-14V at the test pins) the opamp needs a supply voltage of +/- 16.5V or more. Most opamps are specified up to +/- 15V supply voltage. The LM741 to +/-18V. Alternatives to the LM741 are: MC34071 and TLE2141IP (+/- 22V). The MC34063 switch mode convertor can be replaced by a MC33063.<br />For the resistors preferably use 1% parts, since the gain and offset of the amplifier, and the centering of the ADC input at half 3.3V need to be fairly accurate.<br /><br />The tool is powered from 5V (a phone charger) of from the USB power of a PC.<br />Essential to it's performance is the calibration at powerup. It requires the test leads (J2/J3) to be disconnected from any object during powerup.<br /><br />The software will also work on a ArmmiteF4 (commercial ARM based platform with LCD module, ported to MMBasic by Peter Mather). However, the hardware is not optimal for the Armmite. The Armmite processor is much faster, so the update rate is faster. The PWM low pass filter cannot settle fast enough, resulting in a more "jagged" waveform display. And the connector pinning (J1) is different so some flying wires are needed.<br /><br /><br />Some explanation of the software:<br /><br />The voltage waveform is pre-calculated (a triangle waveform).<br /> <br />In a tight loop (main) the new voltage is sent to the PWM. While waiting for the settling of the PWM low pass filter the last line segment is erased (color=black), the memory line segment drawn(memcolor). Then the ADC is read, and the new value is drawn (yellow).<br />If the memory line must be displayed, memcolor = red, if not , memcolor is black (so it is drawn for nothing...but that avoids another IF statement).<br />This loop determines the screen update rate. With current settings (samples = 64) the screen updates every 110msec (8.5 frames/second).<br /><br />Once every second a timer fires, and the markers are updated, and the screen border is re-drawn. Redrawing the screen border is needed since MMBasic on the micromite backpack only has one grapical layer, and the border can be corrupted by the impedance lines.<br /><br />At powerup the system is calibrated at it's 10% and 90% points (the LM741 is used up to it's limits, and may become slightly non linear at 0% and 100% points).<br /><br />Zooming in is partly done in hardware: only half the voltage (+/- 7V) is applied to the test pin. This gives full resolution to the PWM in only +/- 7V. The ADC (12 bits) has sufficient accuracy, even if only used at half scale.<br /><br />Zoom and Memory are touch buttons. For robustness and ease of use, the touch location is set very wide.<br /><br /><br />The Basic code that runs the tracker:<br /><br /><pre>'+&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-+
'|                                                             |
'|                         BACKPACK TRACKER                    |
'|                                                             |
'| 10-2019                           Volhout @ TheBackShed.com |
'+&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-+
' Curve tracer type huntron tracker
' For ILI9341 LCD backpack on 28 pin MX170
' Uses pin 24 as analog input
' Uses pin 4 as pwm output
' Uses pin 9 and 10 to set amplifier gain
' all values scaled to 'resolution'
' there are 'samples' measurements per period
' V11 has support for ARMmiteF4


'&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;- Version History &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;
' V00       Proof of concept with 640 samples 100 resolution
' V01       Increase resolution to 1000, decrease samples to 200
' V02       Implemented touch for REF and ZOOM buttons, REF added
' V03       Optimized main loop from 400msec to 300msec
' V04       Implemented support for HW zoom
' V05       Zoom implemented in SW
' V06       Restructure code to support samples and resolution as constants
' V07       Tune performance on MX170 ( 8 frames / second )
' V08       Improved code for readability, remove obsolete DIM's
' V09       Screen resolution independent (untested), added header
' V10       Add dynamic measurement values
' V11       Support for ArmiteF4 (untested with hardware)


'&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; init &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;
Option explicit

init&#58;
  If MM.Device$ = "ARMmite F407" Then
    'STM32F407VET6 initialisation
    'OPTION LCDPANEL ILI9341_16, LANDSCAPE
    'TOUCH PB12, PC5
    Const ADC_PIN = 15             ' 15/PC0 for F4
    Const HI_GAIN_HI = 1          ' switch to high gain, PE2/pin1 for F4
    Const HI_GAIN_LO = 5          ' switch to high gain, PE6/pin5 for F4
    GUI interrupt Touch_Int
  Else
    'PIC32MX170 initialisation
    'OPTION LCDPANEL ILI9341, L, 2, 23, 6
    'OPTION TOUCH 7, 15
    CPU 48                          ' max speed - not needed in ARM F4
    Const ADC_PIN = 24              ' 24 for MX170
    Const HI_GAIN_HI = 10           ' switch to high gain, 10 for MX
    Const HI_GAIN_LO = 9            ' switch to high gain, 9 for MX
    ' enable touch
    SetPin 15, INTL, Touch_Int
  End If

  'start board
  SetPin ADC_PIN,ain              ' voltage input ADC1-ch10 (at pin 15)
  PWM 1,120000,50                 ' set PWM to 50% (0Vdc amplifier out)
                                  ' pin 31/PA6 on F4, pin 4 on MX170
  amp_high_gain                   ' set amplifier gain

  ' Define samples each scan
  Const samples = 64
  Const resolution = 1000

  ' external ADC divider (R15=47k into R10=12k//R11=15k)
  Const R10_R11 = 12000&#42;15000/(12000+15000)
  Const resistor_divider = (47000 + R10_R11)/R10_R11


  ' Declare variables &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-

  ' Declare defaults for scaling ADC to 'resolution', these values
  ' are fine tuned in calibration (at powerup)
  Dim integer lowgain=resolution/3.3, highgain=2&#42;lowgain
  Dim gain=lowgain
  Dim integer lowoffset=0, highoffset=-resolution/2
  Dim offset=lowoffset

  ' for user interface, xt/yt are touch coordinates
  Dim integer xt,yt

  ' generic i,j,h are counters, ADC is scaled adc value, adc10 and adc90
  ' are used in calibration
  Dim integer i,j,h,ADC
  Dim float adc10,adc90

  ' display waveform, x/y are measured waveform, xr/yr are memory reference
  Dim integer x0,y0,x(samples),y(samples),xr(samples),yr(samples)
  ' init coordinates with values that fit the screen
  For i=1 To samples
    xr(i)=MM.HRes-3&#58;yr(i)=MM.VRes/2&#58;x(i)=MM.HRes-3&#58;y(i)=MM.VRes/2
  Next i
  x0=MM.HRes-3&#58;y0=MM.VRes/2

  ' display numerics, xnl/ynl for left side, xnr/ynr for right side
  Dim integer xnr=100,xnl=100,ynr=100,ynl=100,yor=0,yol=0
  Dim float vr,ir,vl,il

  ' generate waveform, pw = pwm value, pc = pwm value scaled to 'resolution'
  Dim pw(samples), pc(samples)
  ' fill waveform with triange wave 0...100%
  For i=1 To samples / 2
    pw(i) = 100 - ( 200 / samples ) &#42; i
    pc(i) = resolution &#42; pw(i) / 100
    pw(i + samples / 2) = ( 200 / samples ) &#42; i
    pc(i + samples / 2) = resolution &#42; pw(i + samples / 2) / 100
  Next

  ' graphics scaling to resolution
  Dim float Vstep = MM.VRes / resolution, Hstep = MM.HRes / resolution
  Dim center = resolution / 2

  ' buttons and line colors
  Dim integer membuttoncolor = RGB(blue), zoombuttoncolor = RGB(blue)
  Dim integer memcolor = RGB(black), linecolor = RGB(yellow)

  'debug
  Memory

  ' initialize screen
  draw_window

  ' timed interrupts
  SetTick 1000, Time_Int, 1

  ' calibrate analog circuits
  calibrate



'&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; MAIN &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;

main&#58;
  ' all comments removed from main loop to speed it up
  ' cycle through all pwm values using pointers i (actual) and j (last)
  ' erase last segment
  ' allways draw memory line, but color decides if it is visible
  ' draw memory line first so actual overwrites memory
  ' measure input value
  ' recalculate new segment (huntron method)
  ' draw new segement

  Do
    Timer = 0

    For i = 1 To samples
      j = i - 1 &#58; If j = 0 Then j = samples
      PWM 1,120000,pw(i)
      Line x0,y0,x(i),y(i),1,0
      Line xr(j),yr(j),xr(i),yr(i),1,memcolor
      x0 = x(i) &#58; y0 = y(i)
      ADC=(Pin(ADC_PIN) &#42; gain) + offset
      y(i)=(ADC - pc(i) + center) &#42; Vstep
      x(i)= ADC &#42; Hstep
      Line x(j),y(j),x(i),y(i),1,linecolor
    Next i

    Print Timer
  Loop




'&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;- SUBS &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-

Sub Touch_Int
  xt = Touch(x) &#58; yt = Touch(y)

  'check for MEM button if we should display memory
  If xt &lt; ( MM.HRes / 4 ) And yt &lt; ( MM.VRes / 4 ) Then
    If memcolor = RGB(black) Then
      For h = 1 To samples          'copy live to REF line
        yr(h) = y(h)
        xr(h) = x(h)
      Next
      memcolor = RGB(red)
      membuttoncolor = RGB(red)
    Else
      memcolor = RGB(black)
      membuttoncolor = RGB(Blue)
    End If
    RBox 10,10,60,30,2,RGB(white),membuttoncolor
    Text 30,18,"MEM",,,,RGB(white),membuttoncolor
  End If

  'check for ZOOM button to see if we should zoom in
  If xt &gt; (3 &#42; MM.HRes / 4 ) And yt &gt; (3 &#42; MM.VRes / 4) Then
    If zoombuttoncolor = RGB(blue) Then
      zoombuttoncolor = RGB(red)
      adc_high_gain
      amp_low_gain
    Else
      zoombuttoncolor = RGB(Blue)
      adc_low_gain
      amp_high_gain
    End If
      RBox MM.HRes-70,MM.VRes-40,60,30,2,RGB(white),zoombuttoncolor
      Text MM.HRes-55,MM.VRes-32,"ZOOM",,,,RGB(white),zoombuttoncolor
  End If

  draw_frame

  Pause 300                 'prevent double touch
End Sub


Sub amp_high_gain
      SetPin HI_GAIN_LO,dout &#58; Pin(HI_GAIN_LO)=0
      SetPin HI_GAIN_HI,dout &#58; Pin(HI_GAIN_HI)=1
End Sub


Sub amp_low_gain
      SetPin HI_GAIN_LO,din
      SetPin HI_GAIN_HI,din
End Sub


Sub adc_high_gain
      gain = highgain
      offset = highoffset
End Sub


Sub adc_low_gain
      gain = lowgain
      offset = lowoffset
End Sub


Sub draw_window
  'clear screen
  CLS

  'draw outside lines
  draw_frame

  'draw buttons
  RBox 10,10,60,30,2,RGB(white),membuttoncolor
  Text 30,18,"MEM",,,,RGB(white),membuttoncolor
  RBox MM.HRes-70,MM.VRes-40,60,30,2,RGB(white),zoombuttoncolor
  Text MM.HRes-55,MM.VRes-32,"ZOOM",,,,RGB(white),zoombuttoncolor
End Sub


Sub calibrate
  'calibrate standard mode &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;
  amp_high_gain
  adc_low_gain

  'measure 10% and 90% points
  PWM 1,120000,10
  Pause 1
  adc10 = Pin(ADC_PIN)
  PWM 1,120000,90
  Pause 1
  adc90 = Pin(ADC_PIN)

  'calculate ADC low gain and offset
  lowgain = 80 &#42; resolution / (100 &#42; (adc90 - adc10))
  lowoffset = - lowgain &#42; (adc10 - ((adc90 - adc10)/8))
  Print lowgain , lowoffset

  'calibrate zoom mode &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;
  amp_low_gain
  adc_high_gain

  'measure 10% and 90% values
  PWM 1,120000,10
  Pause 1
  adc10 = Pin(ADC_PIN)
  PWM 1,120000,90
  Pause 1
  adc90 = Pin(ADC_PIN)

  'calculate ADC high gain and offset
  highgain = 80 &#42; resolution / (100 &#42; (adc90 - adc10))
  highoffset = - highgain &#42; (adc10 - ((adc90 - adc10)/8))
  Print highgain , highoffset

  'back to standard mode
  amp_high_gain
  adc_low_gain
End Sub


Sub draw_frame
  'draw outside lines
  Line 1,1,1,MM.VRes-2,2,RGB(white)
  Line 1,MM.VRes-2,MM.HRes-2,MM.VRes-2,2,RGB(white)
  Line MM.HRes-2,MM.VRes-2,MM.HRes-2,1,2,RGB(white)
  Line MM.HRes-2,1,1,1,2,RGB(white)
End Sub



Sub Time_Int

  'check if left marker needs update
  If ynl &lt;&gt; y(samples/2) Then

    'erase old text
    Text xnl+12,ynl+yol,"       ",l,,,0,0

    'write markers
    Box xnl-5,ynl-5,10,10,,0

    ' calculate voltage
    xnl = x(samples/2)&#58; ynl = y(samples/2)
    vl = resistor_divider &#42; ((xnl - MM.HRes / 2) / Hstep) / gain

    ' repair corrupted frame
    draw_frame

    'write markers
    Box xnl-5,ynl-5,10,10,,RGB(cyan)

    'get new coordinates for writing text, and write
    If ynl &gt; MM.VRes-30 Then yol=-20 Else yol=5
    Text xnl+12,ynl+yol,Str$(vl,0,2)+"V",l,,,RGB(white),0

  End If

  ' check if right marker needs an update
  If ynr &lt;&gt; y(samples) Then

    'erase old text
    Text xnr-12,ynr+yor,"       ",r,,,0,0

    'write markers
    Box xnr-5,ynr-5,10,10,,0

    ' calculate voltage
    xnr = x(samples)&#58; ynr = y(samples)
    vr = resistor_divider &#42; ((xnr - MM.HRes / 2) / Hstep) / gain

    ' repair corrupted frame
    draw_frame

    'write markers
    Box xnr-5,ynr-5,10,10,,RGB(cyan)

    'get new coordinates for writing text, and write
    If ynr &lt; 30 Then yor=5 Else yor=-20
    Text xnr-12,ynr+yor,Str$(vr,0,2)+"V",r,,,RGB(white),0

  End If

End Sub
</pre><br /> <br />
	</div>
	
	
	
	<div id="PageAttachmentsDiv" style="position: absolute; left: 10000px;">
		
    </div>
    
    <div id="AdminToolsDiv" style="position: absolute; left: 10000px;">
		
		
		
    </div>
    
    <script type="text/javascript">
    <!--
    	function __RepositionDiv(link, element) {
    		var absPos = __AbsolutePosition(link);
    		var elemAbsPos = __AbsolutePosition(element);

    		element.style["top"] = (absPos.top + absPos.height) + "px";
    		element.style["left"] = (absPos.left - (elemAbsPos.width - absPos.width)) + "px";
    		element.style["position"] = "absolute";
    	}

		// Hide attachments and admin tools divs
    	// This is needed because __RepositionDiv cannot calculate the width of the element when it's hidden
    	var __elem = document.getElementById("PageAttachmentsDiv");
    	if(document.getElementById("PageAttachmentsLink")) {
    		__RepositionDiv(document.getElementById("PageAttachmentsLink"), __elem);
    	}
    	__elem.style["display"] = "none";

    	__elem = document.getElementById("AdminToolsDiv");
    	if(document.getElementById("AdminToolsLink")) {
    		__RepositionDiv(document.getElementById("AdminToolsLink"), __elem);
    	}
    	__elem.style["display"] = "none";

    	__InitBCT();
    // -->
    </script>


                <div id="PageInternalFooterDiv"></div>
                <div id="MainFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>

        </div>
            
        <div id="FooterDiv">
             
        </div>

    </form>  
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.Backpack-Tracker-curve-tracer.ashx?HL=mmbasic,board,layout by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 13:02:34 GMT -->
</html>
