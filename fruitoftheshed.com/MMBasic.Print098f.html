

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" >

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Switch-de-bounce-uses-Ganssels-Algorithm-for-Zero-Delays by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:24:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><title>
	Switch de-bounce uses Ganssle&#39;s Algorithm for Zero Delays - Fruit Of The Shed
</title><link rel="stylesheet" type="text/css" href="Themes/Print.css" /></head>
<body>
    <form name="frmPrint" method="post" action="http://fruitoftheshed.com/Print.aspx?NS=MMBasic&amp;Page=MMBasic.Switch-de-bounce-uses-Ganssels-Algorithm-for-Zero-Delays" id="frmPrint">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTIwMDg4Njc4MjcPZBYCAgEPZBYCAgEPFgIeBFRleHQFiCw8aDEgY2xhc3M9InBhZ2V0aXRsZSI+U3dpdGNoIGRlLWJvdW5jZSB1c2VzIEdhbnNzbGUmIzM5O3MgQWxnb3JpdGhtIGZvciBaZXJvIERlbGF5czwvaDE+PHNtYWxsPk1vZGlmaWVkIG9uIDIwMTgvMTIvMDUgMTY6MzcgYnkgQ2FwdGFpbkJvaW5nICZtZGFzaDsgQ2F0ZWdvcml6ZWQgYXM6IENvbnRyb2wsIEVsZWN0cm9uaWNzLCBIYXJkd2FyZSwgU3RhdGUgTWFjaGluZTwvc21hbGw+PGJyIC8+PGJyIC8+RGVib3VuY2luZyBhIHN3aXRjaCBvbiBhIG1pY3JvY29udHJvbGxlciBpbnB1dCBpcyBhbHdheXMgYSBwcm9ibGVtLiBZb3UgY2FuIGRvIGl0IHVzaW5nIGhhcmR3YXJlIHdoaWNoIG9mdGVuIGludm9sdmVzIGEgQy1SIGNpcmN1aXQgaW50byBhIFNjaG1pdHQgdHJpZ2dlciBkZXZpY2UgYW5kL29yIGxhdGNoZXMgYW5kIGdpdmVzIGEgdmVyeSBwcmVjaXNlIHN3aXRjaCBidXQgYXQgdGhlIGNvc3Qgb2YgY29tcG9uZW50cyBvciB5b3UgY2FuIGRvIGl0IHVzaW5nIHNvZnR3YXJlIHRvIHRyeSBhbmQgc29ydCBvdXQgdGhlIGJvdW5jZXMuIFRoaXMgbGF0dGVyIG1ldGhvZCB1c3VhbGx5IGludm9sdmVzIGRlbGF5cyB0byBnZXQgeW91IHBhc3QgdGhlIHR3aXRjaGVzIGFzIHRoZSBzd2l0Y2ggY29udGFjdCBib3VuY2VzIGJhY2sgYW5kIGZvcnRoIGF0IGEgbWljcm8tdG8tbWlsbGkgc2Vjb25kIHNjYWxlLiA8YnIgLz48YnIgLz48YSBjbGFzcz0idW5rbm93bmxpbmsiIGhyZWY9Ik1NQmFzaWMuLmFzaHgiIHRpdGxlPSJNTUJhc2ljLiI+PC9hPjxpbWcgc3JjPSJHZXRGaWxlLmFzcHg/RmlsZT0vTU1CYXNpYy9zd2JvdW5jZS5wbmciIGFsdD0iSW1hZ2UiIC8+PGJyIC8+PGJyIC8+QXQgaXRzIHdvcnN0IGFuZCBwb29ybHkgdHJhcHBlZCwgY29udGFjdCBib3VuY2UgY2FuIGVhc2lseSBsZWFkIHRvIG11bHRpcGxlIGJ1dHRvbiBwcmVzc2VzIGFzIHlvdSByZWFkIGVhY2ggc3Bpa2UgYXMgYSBwcmVzcy4gQ29uc2lkZXIgdGhlIGFib3ZlIHRyYWNlIGFuZCBwZXJoYXBzIHlvdSBoYXZlIG9ubHkgd2FpdGVkIGhhbGYgYXMgbG9uZyBhcyB5b3Ugc2hvdWxkLiBDbGVhcmx5IHlvdSBjb3VsZCBmYWxsIGZvdWwgb2YgdGhvc2UgdHdvIHZlcnkgbGFyZ2Ugc3Bpa2VzIHRvd2FyZHMgdGhlIGVuZCBvZiB0aGUgcGVyaW9kLiBWZXJ5IG9mdGVuLCBkZWxheXMgYXJlIHVzZWQgdG8gZW5zdXJlIHRoZSBzd2l0Y2ggaGFzIHRydWx5IHNldHRsZWQgd2hpY2ggd2FzdGVzIENQVSBjeWNsZXMgYW5kIGxlYWRzIHRvIHNsdWdnaXNoIHJlc3BvbnNlIHRpbWVzLiBTdWNoIGEgcm91dGluZSBtaWdodCBiZSBhcyBmb2xsb3dzOjxiciAvPjxiciAvPjxwcmU+DQoNCglJZiBQaW4oRG9vclVwU1cpPTAgVGhlbiAnIGlmIHRoZSBkb29yIHN3aXRjaCBpcyBwcmVzc2VkIChhY3RpdmUgbG8pDQoJCVBhdXNlIDI1ICAgICAgICAnIHdhaXQgZm9yIHNvbWUgdGltZQ0KCQlJZiBQaW4oRG9vclVwU1cpPTAgVGhlbiAnIGFuZCBjaGVjayBhZ2FpbiAtIGlmIHN0aWxsIHByZXNzZWQgaXQgbXVzdCBiZSByZWFsIGFuZCBmaW5pc2hlZCBib3VuY2luZw0KCQkJLi4uIHJlc3Qgb2YgY29kZSBoZXJlDQoJCUVuZElmDQoJRW5kSWYNCjwvcHJlPjxiciAvPlRoaXMgY29kZSB3b3JrcyB3ZWxsIGVub3VnaCBidXQgaXQgaXMgaGFyZGx5IGVsZWdhbnQgYW5kIHdhc3RlcyBjb21wdXRlIGN5Y2xlcy4gSXQgaW52b2x2ZXMgdHdvIHRlc3RzLCBhIGxlbmd0aHkgZGVsYXkgYW5kIHR3byBjb250cm9sIHN0cnVjdHVyZXMuIFRoZXJlIGhhcyB0byBiZSBhIGJldHRlciB3YXkuPGJyIC8+PGJyIC8+SmFjayBHYW5zc2xlIHdyb3RlIGEgVW5pdmVyc2l0eSBwYXBlciAiQSBHdWlkZSB0byBEZWJvdW5jaW5nIiBpbiB3aGljaCBoZSBhcHByb2FjaGVkIHRoZSBwcm9ibGVtIG9mIGRlLWJvdW5jaW5nIGluIGEgdmFyaWV0eSBvZiB3YXlzLCBvbmUgb2Ygd2hpY2ggd2FzIGEgc29mdHdhcmUgc29sdXRpb24gZnJvbSB0aGUgcG9pbnQgb2YgYSBzdGF0ZSBtYWNoaW5lLiBUaGUgYWxnb3JpdGhtIHJ1bnMgY29udGludW91c2x5LCBzdWNjZXNzaXZlbHkgc2hpZnRpbmcgdGhlIGlucHV0IHBpbiAoYm91bmNlcyBhbmQtYWxsKSBpbnRvIGEgdmFyaWFibGUgYW5kIG9ubHkgd2hlbiAoaW4gdGhpcyBjYXNlIGFzIGFjdGl2ZSBsbykgeW91IGhhdmUgc2hpZnRlZCBpbiBlbm91Z2ggemVybyBiaXRzIGhhcyB0aGUgdGltZSBlbGFwc2VkIGZvciB0aGUgcmVhZGluZyB0byBiZSBzdGFibGUuIEFueSBib3VuY2UgZHVyaW5nIHRoZSBmcmVlLXJ1bm5pbmcgInNwb2lscyIgdGhlIHZhcmlhYmxlIGFuZCBhbnl0aGluZyBidXQgZnVsbCBzY2FsZSBvbmUgd2F5IG9yIHRoZSBvdGhlciBpbmRpY2F0ZXMgdGhlIHN0YXRlIG9mIHRoZSBzd2l0Y2ggY2Fubm90IGJlIHRydXN0ZWQuIEZ1bGx5IHplcm8gb3IgZnVsbHkgJkgxRiAoaW4gdGhpcyBleGFtcGxlKSB0ZWxscyB0aGUgc3RhdGUgb2YgdGhlIHN3aXRjaCAtIHByZXNzZWQgb3Igbm90IHByZXNzZWQgLSByZWxpYWJseSE8YnIgLz48YnIgLz5XaGF0IEkgcmVhbGx5IGxpa2UgYWJvdXQgdGhpcyBhcHByb2FjaCBpcyB0aGUgc3dpdGNoLXNhbXBsZSByb3V0aW5lIGlzIGxlZnQgcnVubmluZyBhbGwgdGhlIHRpbWUgYW5kIHRoZSB2ZXJ5IGxpZ2h0d2VpZ2h0IHBpZWNlIG9mIGNvZGUga2VlcHMgdHJhY2sgb2YgYW55IGNvbnRhY3QgYm91bmNpbmcuIFRoZSB3aG9sZSB0aW1lIHRoZSBtYWluIGxvb3AgaXMgcnVubmluZyAtIGl0J3Mgbm90IHN0dWNrLCBzcGlubmluZywgd2FzdGluZyB0aW1lIGluIHNvbWUgUGF1c2UvRGVsYXksIHRoZSBtaWNyby1jb250cm9sbGVyIGlzIGdldHRpbmcgb24gd2l0aCBvdGhlciBzdHVmZiBhbmQgaW1wb3J0YW50bHksIHlvdSBkb24ndCBuZWVkIHRvIGRvIHNvbWV0aGluZyBzcGVjaWZpYyB0byB0ZXN0IHRoZSBidXR0b24gYnkgYWN0aXZlbHkgcnVubmluZyBzb21lIGNvZGUgb3Igc2V0dGluZyBhIHRpbWVyIGV0Yy4gSWYsIDxpPmF0IGFueSBwb2ludDwvaT4sIHRoZSB2YXJpYWJsZSBpcyB6ZXJvICh0aGlzIGlzIHRoZSBidXR0b24ncyBzdGF0ZSBzdGltdWx1cykgeW91IGtub3cgdGhlIGJ1dHRvbiBpcyByZWxpYWJseSBwcmVzc2VkLiBUaGUgb25seSAidHVuaW5nIiB0byBiZSBkb25lIGlzIHRvIGRlY2lkZSBob3cgbWFueSBiaXRzIHlvdSBzaGlmdCBpbiAtIHRoaXMgaXMgZGlyZWN0bHkgZG93biB0byB0aGUgY3ljbGUgdGltZSBvZiB5b3VyIG1haW4gbG9vcC4gSWYgdGhlIGxvb3AgZXhlY3V0ZXMgcmFwaWRseSwgeW91IG5lZWQgdG8gYWxsb3cgbW9yZSBiaXRzIHRvIHNoaWZ0IGluIHRvIGVuc3VyZSBlbm91Z2ggdGltZSBoYXMgcGFzc2VkLiBBIHNsb3dlciBsb29wIGNhbiBoYXZlIGEgc21hbGxlciBjb3VudC4gPGJyIC8+PGJyIC8+VGhlIGZvbGxvd2luZyBpcyBzb21lIHdvcmtpbmcgY29kZSBiYXNlZCBvbiBHYW5zc2xlJ3MgYXBwcm9hY2ggLSBub3RpY2UgdGhlIHNpbXBsZSBlbGVnYW5jZSBvZiB0aGUgc2luZ2xlIGxpbmUgdGhhdCB0cmFja3MgdGhlIGJvdW5jaW5nIHBpbiBhbmQgdGhlIHNpbmdsZSB0ZXN0IG9mIGEgdmFyaWFibGUgdG8gc2VlIGlmIHRoZSBidXR0b24gaXMgcHJlc3NlZC48YnIgLz48YnIgLz48cHJlPg0KCUNvbnN0IERvb3JVcFNXPTENCgkNCglEaW0gSW50ZWdlciBidG5VUGN0ciAnIGNvdW50ZXIgdG8gaG9sZCB0aGUgc2hpZnRzDQoNCglTZXRQaW4gRG9vclVwU1csRElOLFBVTExVUA0KDQpNYWluTG9vcCYjNTg7DQoJRG8NCi4uLg0KCQlidG5VUGN0cj1idG5VUGN0ciZsdDsmbHQ7MSBYb3IgUGluKERvb3JVcFNXKSBBbmQgJmFtcDtoMWYgJyBzYW1wbGUgdGhlIGlucHV0IHBpbiBhbmQgc2hpZnQgdGhlIGJpdCBpbnRvIHRoZSBjb3VudGVyDQogIAkJJyBJZiB0aGlzIGxvb3AgaXMgZmFzdCwgaW5jcmVhc2UgdGhlICZhbXA7aDFmIHNvIHdlIHNhbXBsZSBtb3JlIGJpdHMuLi4gcmVkdWNlIGl0IGlmIHRoZSBtYWluIGxvb3AgaXMgc2xvd2VyIC0gdHVuZSBpdCBmb3IgeW91ciBwdXJwb3Nlcw0KCQknIElmIHdlIHNoaWZ0IGVub3VnaCB6ZXJvZXMgaW4sIHRoZSBidXR0b24gaGFzIGJlZW4gcHJlc3NlZC4gDQoJCScgQW55IGJvdW5jZSAoYmFjayB0byAxKSB3aWxsIHNoaWZ0IGEgb25lIGluIGFuZCAic3BvaWwiIG91ciBjb3VudGVyIGZvciB3aGljaCB3aWxsIHN0YXJ0IGFnYWluLg0KDQoJCVNlbGVjdCBDYXNlIGJ0blVQY3RyDQoJCQlDYXNlIDAgJiM1ODsJUHJpbnQiZG4iLHRpbWVyDQoJCQlDYXNlICZhbXA7aDFmICYjNTg7CVByaW50InVwIix0aW1lcg0KCQkJQ2FzZSBFbHNlICYjNTg7CVByaW50IiYjNDU7JiM0NTsiLHRpbWVyDQoJCUVuZCBTZWxlY3QNCg0KCUxvb3ANCjwvcHJlPjxiciAvPlRoZSBzaW1wbGUgb3V0cHV0IGZyb20gdGhpcyBsb29wIGNsZWFybHkgc2hvd3MgdGhlIGNoYW5nZSBvZiBzdGF0ZSBvZiB0aGUgc3dpdGNoIGZyb20gdXAgdG8gZG93biAtIHBhc3NpbmcgdGhyb3VnaCBhbiBpbmRldGVybWluYXRlIHN0YXRlIGFzIHdlIHNhbXBsZSB0aGUgaW5wdXQgcGluOjxiciAvPjxiciAvPjxkaXYgY2xhc3M9ImJveCI+PGJyIC8+dXAgICAgICAgMTUzNjM8YnIgLz51cCAgICAgICAxNTM3NTxiciAvPi0tICAgICAgIDE1Mzg2PGJyIC8+LS0gICAgICAgMTUzOTg8YnIgLz4tLSAgICAgICAxNTQwOTxiciAvPi0tICAgICAgIDE1NDIxPGJyIC8+ZG4gICAgICAgMTU0MzI8YnIgLz5kbiAgICAgICAxNTQ0NDxiciAvPmRuICAgICAgIDE1NDU1PGJyIC8+LS0gICAgICAgMTU0NjY8YnIgLz4tLSAgICAgICAxNTQ3ODxiciAvPi0tICAgICAgIDE1NDg5PGJyIC8+LS0gICAgICAgMTU1MDE8YnIgLz51cCAgICAgICAxNTUxMjxiciAvPnVwICAgICAgIDE1NTI0PGJyIC8+dXAgICAgICAgMTU1MzU8YnIgLz4tLSAgICAgICAxNTU0NjxiciAvPi0tICAgICAgIDE1NTU4PGJyIC8+LS0gICAgICAgMTU1Njk8YnIgLz4tLSAgICAgICAxNTU4MTxiciAvPmRuICAgICAgIDE1NTkyPGJyIC8+ZG4gICAgICAgMTU2MDQ8YnIgLz5kbiAgICAgICAxNTYxNTxiciAvPmRuICAgICAgIDE1NjI3PGJyIC8+LS0gICAgICAgMTU2Mzg8YnIgLz4tLSAgICAgICAxNTY0OTxiciAvPi0tICAgICAgIDE1NjYxICBkZWZpbml0ZSBib3VuY2luZyBoZXJlIGFzIHRoZSBzZXF1ZW5jZSBpczogZG93biAtIGluZGV0ZXJtaW5hdGUgLSBkb3duLCA8YnIgLz4tLSAgICAgICAxNTY3MiAgYnV0IHRoZSBzd2l0Y2ggc3RhdGUgaXMgdW4tYW1iaWd1b3VzLiBUcnVzdHdvcnRoeSBvciBub3QuPGJyIC8+LS0gICAgICAgMTU2ODQ8YnIgLz4tLSAgICAgICAxNTY5NTxiciAvPi0tICAgICAgIDE1NzA3PGJyIC8+LS0gICAgICAgMTU3MTg8YnIgLz5kbiAgICAgICAxNTczMDxiciAvPmRuICAgICAgIDE1NzQxPGJyIC8+ZG4gICAgICAgMTU3NTI8YnIgLz5kbiAgICAgICAxNTc2NDxiciAvPjxiciAvPjwvZGl2PjxiciAvPjxiPlJlZmVyZW5jZXM6PC9iPjxiciAvPjxhIGNsYXNzPSJleHRlcm5hbGxpbmsiIGhyZWY9Imh0dHA6Ly93d3cuZ2Fuc3NsZS5jb20vZGVib3VuY2luZy1wdDIuaHRtIiB0aXRsZT0iQSBHdWlkZSB0byBEZWJvdW5jaW5nIiB0YXJnZXQ9Il9ibGFuayI+QSBHdWlkZSB0byBEZWJvdW5jaW5nPC9hPiAtIEFuIEFsdGVybmF0aXZlLCB0b3dhcmRzIHRoZSBib3R0b20gb2YgdGhlIHBhZ2U8YnIgLz48YnIgLz48YnIgLz48YnIgLz5kZHArohdKSQm2aigS8SQu/9tt+5rm" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="03CF0AB7" />
</div>
        <h1 class="pagetitle">Switch de-bounce uses Ganssle&#39;s Algorithm for Zero Delays</h1><small>Modified on 2018/12/05 16:37 by CaptainBoing &mdash; Categorized as: Control, Electronics, Hardware, State Machine</small><br /><br />Debouncing a switch on a microcontroller input is always a problem. You can do it using hardware which often involves a C-R circuit into a Schmitt trigger device and/or latches and gives a very precise switch but at the cost of components or you can do it using software to try and sort out the bounces. This latter method usually involves delays to get you past the twitches as the switch contact bounces back and forth at a micro-to-milli second scale. <br /><br /><a class="unknownlink" href="MMBasic..html" title="MMBasic."></a><img src="swbounce8cc0.png?File=/MMBasic/swbounce.png" alt="Image" /><br /><br />At its worst and poorly trapped, contact bounce can easily lead to multiple button presses as you read each spike as a press. Consider the above trace and perhaps you have only waited half as long as you should. Clearly you could fall foul of those two very large spikes towards the end of the period. Very often, delays are used to ensure the switch has truly settled which wastes CPU cycles and leads to sluggish response times. Such a routine might be as follows:<br /><br /><pre>

	If Pin(DoorUpSW)=0 Then ' if the door switch is pressed (active lo)
		Pause 25        ' wait for some time
		If Pin(DoorUpSW)=0 Then ' and check again - if still pressed it must be real and finished bouncing
			... rest of code here
		EndIf
	EndIf
</pre><br />This code works well enough but it is hardly elegant and wastes compute cycles. It involves two tests, a lengthy delay and two control structures. There has to be a better way.<br /><br />Jack Ganssle wrote a University paper "A Guide to Debouncing" in which he approached the problem of de-bouncing in a variety of ways, one of which was a software solution from the point of a state machine. The algorithm runs continuously, successively shifting the input pin (bounces and-all) into a variable and only when (in this case as active lo) you have shifted in enough zero bits has the time elapsed for the reading to be stable. Any bounce during the free-running "spoils" the variable and anything but full scale one way or the other indicates the state of the switch cannot be trusted. Fully zero or fully &H1F (in this example) tells the state of the switch - pressed or not pressed - reliably!<br /><br />What I really like about this approach is the switch-sample routine is left running all the time and the very lightweight piece of code keeps track of any contact bouncing. The whole time the main loop is running - it's not stuck, spinning, wasting time in some Pause/Delay, the micro-controller is getting on with other stuff and importantly, you don't need to do something specific to test the button by actively running some code or setting a timer etc. If, <i>at any point</i>, the variable is zero (this is the button's state stimulus) you know the button is reliably pressed. The only "tuning" to be done is to decide how many bits you shift in - this is directly down to the cycle time of your main loop. If the loop executes rapidly, you need to allow more bits to shift in to ensure enough time has passed. A slower loop can have a smaller count. <br /><br />The following is some working code based on Ganssle's approach - notice the simple elegance of the single line that tracks the bouncing pin and the single test of a variable to see if the button is pressed.<br /><br /><pre>
	Const DoorUpSW=1
	
	Dim Integer btnUPctr ' counter to hold the shifts

	SetPin DoorUpSW,DIN,PULLUP

MainLoop&#58;
	Do
...
		btnUPctr=btnUPctr&lt;&lt;1 Xor Pin(DoorUpSW) And &amp;h1f ' sample the input pin and shift the bit into the counter
  		' If this loop is fast, increase the &amp;h1f so we sample more bits... reduce it if the main loop is slower - tune it for your purposes
		' If we shift enough zeroes in, the button has been pressed. 
		' Any bounce (back to 1) will shift a one in and "spoil" our counter for which will start again.

		Select Case btnUPctr
			Case 0 &#58;	Print"dn",timer
			Case &amp;h1f &#58;	Print"up",timer
			Case Else &#58;	Print"&#45;&#45;",timer
		End Select

	Loop
</pre><br />The simple output from this loop clearly shows the change of state of the switch from up to down - passing through an indeterminate state as we sample the input pin:<br /><br /><div class="box"><br />up       15363<br />up       15375<br />--       15386<br />--       15398<br />--       15409<br />--       15421<br />dn       15432<br />dn       15444<br />dn       15455<br />--       15466<br />--       15478<br />--       15489<br />--       15501<br />up       15512<br />up       15524<br />up       15535<br />--       15546<br />--       15558<br />--       15569<br />--       15581<br />dn       15592<br />dn       15604<br />dn       15615<br />dn       15627<br />--       15638<br />--       15649<br />--       15661  definite bouncing here as the sequence is: down - indeterminate - down, <br />--       15672  but the switch state is un-ambiguous. Trustworthy or not.<br />--       15684<br />--       15695<br />--       15707<br />--       15718<br />dn       15730<br />dn       15741<br />dn       15752<br />dn       15764<br /><br /></div><br /><b>References:</b><br /><a class="externallink" href="http://www.ganssle.com/debouncing-pt2.htm" title="A Guide to Debouncing" target="_blank">A Guide to Debouncing</a> - An Alternative, towards the bottom of the page<br /><br /><br /><br />
    </form>
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Switch-de-bounce-uses-Ganssels-Algorithm-for-Zero-Delays by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:24:50 GMT -->
</html>
