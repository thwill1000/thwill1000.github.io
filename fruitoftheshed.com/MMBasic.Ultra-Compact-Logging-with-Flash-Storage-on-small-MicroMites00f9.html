

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from fruitoftheshed.com/MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites.ashx?NoRedirect=1 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:54:33 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=8" /><title>
	Ultra-Compact Logging with Flash Storage on small MicroMites - Fruit Of The Shed
</title><meta name="keywords" content="log, logging, flash" /><script type="text/javascript" src="JS/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="JS/Scripts.js"></script>
<script type="text/javascript" src="JS/SearchHighlight.js"></script>
<link rel="stylesheet" media="print" href="Themes/Default/Print_Styles.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles%20-%20Copy.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles.css" type="text/css" />
<link rel="stylesheet" href="Themes/Editor.css" type="text/css" />
<link rel="search" href="searchf7b1.xml?OpenSearch=1" type="application/opensearchdescription+xml" title="Fruit Of The Shed - Search" /><script src="Themes/Default/Scripts.js" type="text/javascript"></script>
<link rel="shortcut icon" href="Themes/Default/Icon.ico" type="image/x-icon" />
</head>
<body>
    <form name="aspnetForm" method="post" action="http://fruitoftheshed.com/Default.aspx?Page=Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites&amp;NS=MMBasic&amp;NoRedirect=1" id="aspnetForm">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUJMTQ3NjA4MDI2D2QWAmYPZBYCAgEPZBYCAgkPZBYEAhsPDxYCHg1BbnRoZW1WaXNpYmxlaGRkAicPDxYCHgdWaXNpYmxlaGQWAmYPFgIeC18hSXRlbUNvdW50ZmRkL9X+pH8J+jB1IIJZx71WjgOrjyw=" />
</div>

<script type="text/javascript">
//<![CDATA[
var Anthem_FormID = "aspnetForm";
//]]>
</script>
<script src="WebResource3c0c.axd?d=wu8PDPV1hmKciPrhUAi9NEjQUBbOefrIXCaRPwGH8Q5jrvPZFuGbKmycL3GXDKGD1_JZ083oQl1Kpd_P7rg1V93MtYOS3Vb-0Eztmu5VDCWQxc7l0&amp;t=636158881040000000" type="text/javascript"></script>
<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="CA0B0334" />
</div>
		<script type="text/javascript">
<!--
__BaseName = "ctl00_CphMaster_";
__ConfirmMessage = "Are you sure you want to proceed?";
// -->
</script>
		<script type="text/javascript">
		<!--
			function __GetServerElementById(id) {
				return document.getElementById(__BaseName + id);
			}
			function __RequestConfirm() {
				return confirm(__ConfirmMessage);
			}
		// -->
		</script>
    
        <div id="HeaderDiv">
            <div style="float: right;">Welcome <a href="MMBasic.Language.html" class="systemlink" title="Select your language">Guest</a>, you are in: <select class="namespacedropdown" onchange="javascript:var sel = this.value; document.location = (sel != '' ? (sel + '.') : '') + 'Default.aspx';"><option value="">&lt;root&gt;</option><option value="Circuit Ideas">Circuit Ideas</option><option value="Colour MaxiMite 2 (CMM2)">Colour MaxiMite 2 (CMM2)</option><option value="GCB">GCB</option><option value="MicroMite ArmMite and MMX Hardware">MicroMite ArmMite and MMX Hardware</option><option selected="selected" value="MMBasic">MMBasic</option><option value="PIC ASM">PIC ASM</option><option value="Platform Agnostic">Platform Agnostic</option></select> &bull; <a href="MMBasic.Login98ee.html?Redirect=http%3a%2f%2ffruitoftheshed.com%2fDefault.aspx%3fPage%3dUltra-Compact-Logging-with-Flash-Storage-on-small-MicroMites%26NS%3dMMBasic%26NoRedirect%3d1" class="systemlink" title="Login">Login</a></div><h1>Fruit Of The Shed</h1>
        </div>
                   
        <div id="ContainerDiv">
                 
            <div id="SidebarDiv">
                <div id="SidebarHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="SidebarContentDiv">
                    <div style="float: right;"> </div><h3 class="separator">Navigation (MMBasic)<a class="headeranchor" id="Navigation_NAMESPACE_0" href="#Navigation_NAMESPACE_0" title="Link to this Section">&#0182;</a></h3><ul><li><b><a class="pagelink" href="MMBasic.MainPage.html" title="_MMBasic Code Library">Main Page</a></b></li><li><a class="pagelink" href="MainPage.html" title="Home Page">Main Page (root)</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.EggDrop-part-of-the-original-MMBasic-libraryc674.html" title="Random Page">Random Page</a></li><li><a class="systemlink" href="MMBasic.AllPages.html" title="All Pages">All Pages</a><br /> </li><li><a class="systemlink" href="Logina75d.html" title="Create a new Page">Create a new Page</a><br /></li></ul><br /><ul><li><a class="systemlink" href="Logine894.html" title="Administration">Administration</a></li><li><a class="systemlink" href="MMBasic.Upload.html" title="File Management">File Management</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="My Account">My Account</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="Create Account">Create Account</a><br /></li></ul><br /><small><b>Search the wiki</b></small><br /><br /><script type="text/javascript"><!--
function _DoSearch_SBf63524b4df3e46d58daced6fab3b588b() { document.location = 'MMBasic.Search.aspx?AllNamespaces=1&FilesAndAttachments=1&Query=' + encodeURI(document.getElementById('SBf63524b4df3e46d58daced6fab3b588b').value); }
// -->
</script><input class="txtsearchbox" type="text" id="SBf63524b4df3e46d58daced6fab3b588b" onkeydown="javascript:var keycode; if(window.event) keycode = event.keyCode; else keycode = event.which; if(keycode == 10 || keycode == 13) { _DoSearch_SBf63524b4df3e46d58daced6fab3b588b(); return false; }" /> <big><a href="#" onclick="javascript:_DoSearch_SBf63524b4df3e46d58daced6fab3b588b(); return false;">&raquo;</a></big><br /><br /><br />
                </div>
                <div id="SidebarFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>
            <div id="MainDiv">
                <div id="MainHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="PageInternalHeaderDiv"></div>
                

    <script type="text/javascript">
    <!--
        function __ShowAllTrail() {
            try {
                document.getElementById("BreadcrumbsDivMin").style["display"] = "none";
                document.getElementById("BreadcrumbsDivAll").style["display"] = "";
                __SetStatus("1");
            }
            catch(ex) { }
            return false;
        }
        function __HideTrail() {
            try {
                document.getElementById("BreadcrumbsDivMin").style["display"] = "";
                document.getElementById("BreadcrumbsDivAll").style["display"] = "none";
                __SetStatus("0");
            }
            catch(ex) { }
            return false;
        }
        
        function __SetStatus(open) {
            __CreateCookie("ScrewTurnWikiBCT", open, 365);
        }
        function __GetStatus() {
            var value = __ReadCookie("ScrewTurnWikiBCT");
            if(value) return value;
            else return "0";
        }

        function __InitBCT() {
        	if(__GetStatus() == "1") {
        		__ShowAllTrail();
        	}
        }

        var __attachmentsMenuJustShown = false;
        var __adminToolsMenuJustShown = false;
        var __ie7Mode = false;

        function __ToggleAttachmentsMenu(cx, cy) {
        	var element = document.getElementById("PageAttachmentsDiv");
        	if(element) {
        		if(element.style["display"] == "none") {
        			element.style["display"] = "";
        			var pos = __AbsolutePosition(element);
        			if(pos.left - cx > 0) {
        				__ie7Mode = true;
        				element.style["position"] = "absolute";
        				element.style["top"] = cy + "px";
        				element.style["left"] = (cx - pos.width) + "px";
        			}
        			else {
        				__RepositionDiv(document.getElementById("PageAttachmentsLink"), element);
        			}
        			__attachmentsMenuJustShown = true;
        		}
        	}
        	return false;
        }
        function __HideAttachmentsMenu() {
        	var element = document.getElementById("PageAttachmentsDiv");
        	if(element && !__attachmentsMenuJustShown) {
        		element.style["display"] = "none";
        		if (__ie7Mode) element.style["left"] = "10000px";
        	}
        	__attachmentsMenuJustShown = false;
        	return true; // Needed to enabled next clicks' action (file download)
        }

        function __ToggleAdminToolsMenu(cx, cy) {
        	var element = document.getElementById("AdminToolsDiv");
        	if(element) {
        		if(element.style["display"] == "none") {
        			element.style["display"] = "";
        			var pos = __AbsolutePosition(element);
        			if(pos.left - cx > 0) {
        				__ie7Mode = true;
        				element.style["position"] = "absolute";
        				element.style["top"] = cy + "px";
        				element.style["left"] = (cx - pos.width) + "px";
        			}
        			else {
        				__RepositionDiv(document.getElementById("AdminToolsLink"), element);
        			}
        			__adminToolsMenuJustShown = true;
        		}
        	}
        	return false;
        }
        function __HideAdminToolsMenu() {
        	var element = document.getElementById("AdminToolsDiv");
        	if(element && !__adminToolsMenuJustShown) {
        		element.style["display"] = "none";
        		if(__ie7Mode) element.style["left"] = "10000px";
        	}
        	__adminToolsMenuJustShown = false;
        	return true; // Needed to enable next clicks' action (admin tools)
        }

        function __HideAllMenus() {
        	__HideAttachmentsMenu();
        	__HideAdminToolsMenu();
        }

        document.body.onclick = __HideAllMenus;

        function __AbsolutePosition(obj) {
        	var pos = null;
        	if(obj != null) {
        		pos = new Object();
        		pos.top = obj.offsetTop;
        		pos.left = obj.offsetLeft;
        		pos.width = obj.offsetWidth;
        		pos.height = obj.offsetHeight;

        		obj = obj.offsetParent;
        		while(obj != null) {
        			pos.top += obj.offsetTop;
        			pos.left += obj.offsetLeft;
        			obj = obj.offsetParent;
        		}
        	}
        	return pos;
        }

        var __showTimer = null;
        var __hideTimer = null;

        function __ShowDropDown(e, divId, parent) {
           	// Set a timer
        	// On mouse out, cancel the timer and start a 2nd timer that hides the menu
        	// When the 1st timer elapses
        	//   show the drop-down
        	//   on menu mouseover, cancel the 2nd timer
        	//   on menu mouse out, hide the menu
        	__showTimer = setTimeout('__ShowDropDownForReal(' + e.clientX + ', ' + e.clientY + ', "' + divId + '", "' + parent.id + '");', 200);
        }

        function __ShowDropDownForReal(cx, cy, divId, parentId) {
        	var pos = __AbsolutePosition(document.getElementById(parentId));
        	var menu = document.getElementById(divId);

			// This is needed to trick IE7 which, for some reason,
			// does not position the drop-down correctly with the new Default theme
        	if(pos.left - cx > 30) {
        		menu.style["display"] = "";
        		menu.style["position"] = "absolute";
        		menu.style["top"] = cy + "px";
        		menu.style["left"] = (cx - 10) + "px";
        	}
        	else {
        		menu.style["display"] = "";
        		menu.style["position"] = "absolute";
        		menu.style["top"] = (pos.top + pos.height) + "px";
        		menu.style["left"] = pos.left + "px";
        	}
        	__showTimer = null;
        }

        function __HideDropDown(divId) {
        	if(__showTimer) clearTimeout(__showTimer);
        	__hideTimer = setTimeout('__HideDropDownForReal("' + divId + '");', 200);
        }

        function __HideDropDownForReal(divId) {
        	document.getElementById(divId).style["display"] = "none";
        	__hideTimer = null;
        }

        function __CancelHideTimer() {
        	if(__hideTimer) clearTimeout(__hideTimer);
        }
        
    // -->
    </script>

	<a id="PageTop"></a>
	
	<div id="PageHeaderDiv">
	
		<!-- Change this to PageToolbarDiv -->
		<div id="EditHistoryLinkDiv">
			<a id="DiscussLink" title="Discuss" href="MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites266d.html?Discuss=1">Discuss (0)</a>
			
			
			<a id="HistoryLink" title="View Page edit history" href="MMBasic.Historyc748.html?Page=MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites">History</a>
			
			
			
			
			
		</div>
		
		<h1 class="pagetitle">
			
			Ultra-Compact Logging with Flash Storage on small MicroMites
			
		</h1>
		
		<div id="PrintLinkDiv">
			<a id="PrintLink" href="MMBasic.Printc748.html?Page=MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites" title="Printer friendly version" target="_blank">Print</a>
		</div>
		
		<div id="RssLinkDiv">
			
		</div>
		
		<div id="EmailNotificationDiv">
			<span id="Anthem_ctl00_CphMaster_btnEmailNotification__"></span>
		</div>
		
		<div id="ctl00_CphMaster_pnlPageInfo">
	
			<div id="PageInfoDiv">
				<span id="ModificationSpan">
					Modified on 
					2021/11/26 16:55
				</span>
				<span id="AuthorSpan">
					 by 
					<a href="MMBasic.Userb2ec.html?Username=hendy">CaptainBoing</a>
				</span>
				<span id="NavPathsSpan">
					
				</span>
				<span id="CategoriesSpan">
					Categorized as 
					<a href="MMBasic.AllPagesb06f.html?Cat=MMBasic.Arrays" title="Arrays">Arrays</a>, <a href="MMBasic.AllPagesc4d5.html?Cat=MMBasic.Debug" title="Debug">Debug</a>, <a href="MMBasic.AllPages834c.html?Cat=MMBasic.Encode%20and%20Decode" title="Encode and Decode">Encode and Decode</a>, <a href="MMBasic.AllPagesbcca.html?Cat=MMBasic.Environment" title="Environment">Environment</a>, <a href="MMBasic.AllPages554c.html?Cat=MMBasic.Memory" title="Memory">Memory</a>, <a href="MMBasic.AllPagesff34.html?Cat=MMBasic.Strings" title="Strings">Strings</a>
				</span>
				
				<span id="PageDiscussionSpan">
					
					
				</span>
			</div>
		
</div>
		
		<div id="fdfd073f1-1932-495b-b7dd-aebca9607111" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('fdfd073f1-1932-495b-b7dd-aebca9607111');"><a href="MMBasic.MMBasic-code-pack-to-Read-and-Write-Winbond-Flash-Memories.html" title="MMBasic code-pack to Read and Write Winbond Flash Memories">MMBasic code-pack to Read and Write Winbond Flash Memories</a><a href="MMBasic.UnixTime-or-Epoch-Time.html" title="UnixTime or Epoch Time">UnixTime or Epoch Time</a><a href="MMBasic.HumanTime-Function-to-return-a-human-readable-date-and-time-from-a-unixtime-number.html" title="HumanTime() Function to return a human readable date and time from a unixtime number">HumanTime() Function to return a human readable date and time from a unixtime number</a><a href="MMBasic.Now-Function-VB-work-a-like.html" title="Now() Function (VB work-a-like) ">Now() Function (VB work-a-like) </a><a href="MMBasic.Sign-Extend-an-Integer.html" title="Sign Extend an Integer">Sign Extend an Integer</a></div><div id="fd878890c-c085-4bba-ab95-7df85b1794ac" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('fd878890c-c085-4bba-ab95-7df85b1794ac');"><a href="Circuit%20Ideas.Random-Bit-Generator-for-cryptographic-strength-random-numbers.html" title="Random Bit Generator for cryptographic strength random numbers">Random Bit Generator for cryptographic strength random numbers</a></div><div id="f4ded9df4-c933-4568-b152-f647b3062359" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('f4ded9df4-c933-4568-b152-f647b3062359');"><a href="MMBasic.Sign-Extend-an-Integer.html" title="Sign Extend an Integer">Sign Extend an Integer</a></div><div id="s0d5ade82-ba94-4ecf-9735-9b89882f3f5a" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('s0d5ade82-ba94-4ecf-9735-9b89882f3f5a');"><a href="MMBasic.MMBasic-code-pack-to-Read-and-Write-Winbond-Flash-Memories.html" title="MMBasic code-pack to Read and Write Winbond Flash Memories">MMBasic code-pack to Read and Write Winbond Flash Memories</a><a href="MMBasic.UnixTime-or-Epoch-Time.html" title="UnixTime or Epoch Time">UnixTime or Epoch Time</a><a href="MMBasic.HumanTime-Function-to-return-a-human-readable-date-and-time-from-a-unixtime-number.html" title="HumanTime() Function to return a human readable date and time from a unixtime number">HumanTime() Function to return a human readable date and time from a unixtime number</a><a href="MMBasic.Now-Function-VB-work-a-like.html" title="Now() Function (VB work-a-like) ">Now() Function (VB work-a-like) </a><a href="MMBasic.Sign-Extend-an-Integer.html" title="Sign Extend an Integer">Sign Extend an Integer</a></div><div id="BreadcrumbsDiv"><div id="BreadcrumbsDivMin"><a href="#" onclick="javascript:return __ShowAllTrail();" title="Click here to view the complete Breadcrumbs Trail">(10)</a> &raquo; <a href="MMBasic.UBOUND-Upper-boundary-of-an-Array.html" title="UBOUND Upper boundary of an Array. A work-around (MMBasic)">UBOUND Upper boundary of an Array. A work-around (MMBasic)</a> &raquo; <a href="MMBasic.uFormat-and-StrE-provide-flexible-formatting-of-numeric-values.html" title="uFormat$() and StrE$() provide flexible formatting of numeric values (MMBasic)">uFormat$() and StrE$() provide flexible formatting of numeric values (MMBasic)</a> &raquo; <b><a href="MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites.html" title="Ultra-Compact Logging with Flash Storage on small MicroMites (MMBasic)" onmouseover="javascript:return __ShowDropDown(event, 's0d5ade82-ba94-4ecf-9735-9b89882f3f5a', this);" id="lnks0d5ade82-ba94-4ecf-9735-9b89882f3f5a" onmouseout="javascript:return __HideDropDown('s0d5ade82-ba94-4ecf-9735-9b89882f3f5a');">Ultra-Compact Logging with Flash Storage on small MicroMites (MMBasic)</a></b> </div><div id="BreadcrumbsDivAll" style="display: none;"><a href="#" onclick="javascript:return __HideTrail();" title="Click here to hide the Breadcrumbs Trail">[X]</a> &raquo; <a href="MMBasic.Temperature-measurement-with-DS1621-with-i2c-bus-part-of-the-original-MMBasic-library.html" title="Temperature measurement with DS1621 with i2c bus (MMBasic)">Temperature measurement with DS1621 with i2c bus (MMBasic)</a> &raquo; <a href="MMBasic.Temperature-Measurement-with-DS3231-Realtime-Clock-RTC.html" title="Temperature Measurement with DS3231 Realtime Clock RTC (MMBasic)" onmouseover="javascript:return __ShowDropDown(event, 'f4ded9df4-c933-4568-b152-f647b3062359', this);" id="lnkf4ded9df4-c933-4568-b152-f647b3062359" onmouseout="javascript:return __HideDropDown('f4ded9df4-c933-4568-b152-f647b3062359');">Temperature Measurement with DS3231 Realtime Clock RTC (MMBasic)</a> &raquo; <a href="MMBasic.TEXTLOOK-BAS-part-of-the-original-MMBasic-library.html" title="TEXTLOOK.BAS (MMBasic)">TEXTLOOK.BAS (MMBasic)</a> &raquo; <a href="MMBasic.TIC-TAC-TOE-1-PLAYER-part-of-the-original-MMBasic-library.html" title="TIC-TAC-TOE 1 PLAYER (MMBasic)">TIC-TAC-TOE 1 PLAYER (MMBasic)</a> &raquo; <a href="MMBasic.TOWERS-of-HANOI-part-of-the-original-MMBasic-library.html" title="TOWERS of HANOI (MMBasic)">TOWERS of HANOI (MMBasic)</a> &raquo; <a href="MMBasic.True-Random-Generator-companion-code-for-circuit.html" title="True Random Generator (companion code for circuit) (MMBasic)" onmouseover="javascript:return __ShowDropDown(event, 'fd878890c-c085-4bba-ab95-7df85b1794ac', this);" id="lnkfd878890c-c085-4bba-ab95-7df85b1794ac" onmouseout="javascript:return __HideDropDown('fd878890c-c085-4bba-ab95-7df85b1794ac');">True Random Generator (companion code for circuit) (MMBasic)</a> &raquo; <a href="MMBasic.Twinkle-demonstrates-Maximite-control-of-individual-pixels-part-of-the-original-MMBasic-library.html" title="Twinkle demonstrates Maximite control of individual pixels (MMBasic)">Twinkle demonstrates Maximite control of individual pixels (MMBasic)</a> &raquo; <a href="MMBasic.UBOUND-Upper-boundary-of-an-Array.html" title="UBOUND Upper boundary of an Array. A work-around (MMBasic)">UBOUND Upper boundary of an Array. A work-around (MMBasic)</a> &raquo; <a href="MMBasic.uFormat-and-StrE-provide-flexible-formatting-of-numeric-values.html" title="uFormat$() and StrE$() provide flexible formatting of numeric values (MMBasic)">uFormat$() and StrE$() provide flexible formatting of numeric values (MMBasic)</a> &raquo; <b><a href="MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites.html" title="Ultra-Compact Logging with Flash Storage on small MicroMites (MMBasic)" onmouseover="javascript:return __ShowDropDown(event, 'fdfd073f1-1932-495b-b7dd-aebca9607111', this);" id="lnkfdfd073f1-1932-495b-b7dd-aebca9607111" onmouseout="javascript:return __HideDropDown('fdfd073f1-1932-495b-b7dd-aebca9607111');">Ultra-Compact Logging with Flash Storage on small MicroMites (MMBasic)</a></b> </div></div>
		
		
	
	</div>
	
	<div id="PageContentDiv">
		Making notes of activity and key information (logging) is an important feature for many systems. Embedded devices are often required to store data for later retrieval and it is vital this data is not lost through power failure etc.<br /><br />MMBasic provides such a powerful environment it is easy to forget you are working with a single-chip micro-controller, but truth is, there is often not much you can do about storing logs without adding SD Cards or other storage devices - and this can be an unwelcome extra because of program overheads and used pins/board space. Small chips like the three pin UNIO devices can go to about 2KB and WinBond (and others) <a class="pagelink" target="_blank" href="MMBasic.MMBasic-code-pack-to-Read-and-Write-Winbond-Flash-Memories.html" title="MMBasic code-pack to Read and Write Winbond Flash Memories">W25Q</a> chips can add upto 16MB (and higher). This latter is a serious alternative to SD Cards - no big overhead of a file-system or the hardware of card holder and pins used up on your MicroMite, but both options use up pins and may complicate a design - especially a retro-fit. <br /><br />This article is specifically aimed at logging without additional devices, using the 2KB of flash reserved for storing variables on a MicroMite. Later 'mites provide huge storage areas - the ARMMite gives 128K! <br /><br />Below is a series of code snippets that show how to use a highly compact, tokenised logging method that can store 270+ lines of log in a string array and save this to flash so it survives power cycles. Unfortunately, you lose the flexibility of free-form text strings; replacing human friendly messages with a single-character token (and in the case below, a two's-compliment single byte number which is enough for storing a simple event counter or temperature in the range of +/- 127 degrees). This does limit the number of messages to about 40 individual message types - you should manage to scrape through ;o)<br /><br />Firstly here is the Preamble - the bit of code to set everything up. This is all that is required in your start-up section of code. It establishes the limit of the log size (273 lines), dimensions the working array and retrieves any existing log data from flash. In this example, I have grabbed all the flash I can - if you need some for other things or simply don't want a log that big, adjust LogTop down accordingly - that's all.<br /><pre>
' Preamble
	Option Base 0			' Operational (live) log starts at element 0
	Const LogTop=272		' with length 6, we can squeeze 273 (0-272) into flash - if you are doing one entry per hour that is over 10 days 
					' but don't save to flash at that rate, a MicroMite would only last ~2 years! So balance it nicely

	Dim OpLog$(LogTop) Length 6     ' dimension the log array

	Var Restore			' pull any existing log into the operational array
</pre><br />The following code can be used anywhere in your code as often as you like to make an entry in the operational log.<br /><pre>
' anywhere in your code... example to log a temperature
	LogEvent LogEnc$("U",GetTemp())	' to make an entry in the log
</pre><br />One problem with the on-chip flash is it has a life-time of about 20,000 write cycles. Please read the "Micromite Special Features" section of the MicroMite Manual. Bearing this in mind, it is vital to avoid writing the log to flash when it isn't important. I tend to do it only at key points, when I have data I really don't want to lose. In one application, I save the log at dawn and dusk and on startups so 2 writes a day. The chip should last 20+ years. Remember that adding an event to the log doesn't save the log to flash - you have to save the log explicitly. You need to balance the risk of losing data that hasn't been saved versus the cost to your hardware.<br /><pre>
	Var Save OpLog$()		' save the array to flash - don't do this too often, try to save
					' the log only at key points so as not to wear out the flash
</pre><br />This code dumps out the contents of the log. The log is a FIFO list with new entries added to the end after everything else has been shuffled down one position. This ensures I always keep the latest data but older logs will be lost as space is consumed. Note that "" is used to determine an un-used log slot and each used entry is prefixed with "@" to indicate it is historical data.<br /><pre>
' To dump the log
	For x=0 to LogTop
		If OpLog$(x)&lt;&gt;"" Then Print "@"+LogDec$(OpLog$(x))
	Next
</pre><br />This gives stuff like this:<br /><code><br />@02-04-2018 00:00:00 Temp 9C<br />@02-04-2018 00:00:00 Sensor triggers in last hour=2<br />@02-04-2018 01:00:00 Temp 7C<br />@02-04-2018 02:00:00 Temp 7C<br />@02-04-2018 02:00:00 Sensor triggers in last hour=11<br />@02-04-2018 03:00:00 Temp 6C<br />@02-04-2018 03:00:00 Sensor triggers in last hour=1<br />@02-04-2018 04:00:00 Temp 6C<br />@02-04-2018 05:00:00 Temp 7C<br />@02-04-2018 05:31:00 Dawn. Temp 7C<br />@02-04-2018 06:00:00 Temp 8C<br />@02-04-2018 07:00:00 Temp 8C<br />@02-04-2018 08:00:00 Temp 9C<br />@02-04-2018 09:00:00 Temp 9C<br />@02-04-2018 10:00:00 Temp 10C<br />@02-04-2018 11:00:00 Temp 11C<br />@02-04-2018 12:00:00 Temp 12C<br /></code><br /><br />Finally, here are the Subs and Functions that encode and decode the log lines. Note that when encoding a log string, you supply your token e.g. "C". It is important the decode function knows what a token means to restore the "human readable" nature of the log entry.<br /><pre>
' The Subs &amp; Functions

' add an item to the event log - only manages and adds the log entry to the array, doesn't save to flash
	Sub LogEvent(x$)
		Local Integer n
		For n=1 To LogTop
			OpLog$(n-1)=OpLog$(n)
		Next
		OpLog$(LogTop)=x$
	End Sub

' encode a log string
	Function LogEnc$(t$,n As Integer)
		Local Integer m
		Local z$,a$
		a$=Hex$(UnixTime(Now()))
		For m=1 To 8 Step 2
			z$=z$+Chr$(Val("&amp;h"+Mid$(a$,m,2)))
		Next
		LogEnc$=z$+Chr$(n And 255)+Ucase$(t$)
	End Function

' decode a log string
	Function LogDec$(a$)
		Local l$,v$
		Local Integer m
		For m=1 to 4
			l$=l$+Hex$(Asc(Mid$(a$,m,1)),2)
		Next
		l$=HumanTime(Val("&amp;h"+l$))+" "
		v$=Str$(SgnX(7,Asc(Mid$(a$,5))))
		Select Case Mid$(a$,6,1)		' have whatever you want here in the case statements
			Case "O"
				LogDec$=l$+"System Started. Watchdog event="+v$
			Case "U"
				LogDec$=l$+"Dawn. Temp "+v$+"C"
			Case "D"
				LogDec$=l$+"Dusk. Temp "+v$+"C"
			Case "T"
				LogDec$=l$+"Temp "+v$+"C"
			Case "S"
				LogDec$=l$+"Sensor triggers in last hour="+v$
			Case Else
				LogDec$=l$+"Unknown"
		End Select
	End Function
</pre><br /><b>Dependencies</b><br /><a class="pagelink" target="_blank" href="MMBasic.UnixTime-or-Epoch-Time.html" title="UnixTime or Epoch Time">UnixTime()</a><br /><a class="pagelink" target="_blank" href="MMBasic.HumanTime-Function-to-return-a-human-readable-date-and-time-from-a-unixtime-number.html" title="HumanTime() Function to return a human readable date and time from a unixtime number">HumanTime()</a><br /><a class="pagelink" target="_blank" href="MMBasic.Now-Function-VB-work-a-like.html" title="Now() Function (VB work-a-like) ">Now()</a><br /><a class="pagelink" target="_blank" href="MMBasic.Sign-Extend-an-Integer.html" title="Sign Extend an Integer">SgnX()</a><br />... and their child dependencies.<br /><br />The above solution is taken from one highly specific requirement. Yours may vary and you can tweak the code to add more or bigger tokens or more values etc.<br /><b>See also</b><br /><a class="pagelink" href="MMBasic.MMBasic-code-pack-to-Read-and-Write-Winbond-Flash-Memories.html" title="MMBasic code-pack to Read and Write Winbond Flash Memories">MMBasic code-pack to Read and Write Winbond Flash Memories</a><br /><br />
	</div>
	
	
	
	<div id="PageAttachmentsDiv" style="position: absolute; left: 10000px;">
		
    </div>
    
    <div id="AdminToolsDiv" style="position: absolute; left: 10000px;">
		
		
		
    </div>
    
    <script type="text/javascript">
    <!--
    	function __RepositionDiv(link, element) {
    		var absPos = __AbsolutePosition(link);
    		var elemAbsPos = __AbsolutePosition(element);

    		element.style["top"] = (absPos.top + absPos.height) + "px";
    		element.style["left"] = (absPos.left - (elemAbsPos.width - absPos.width)) + "px";
    		element.style["position"] = "absolute";
    	}

		// Hide attachments and admin tools divs
    	// This is needed because __RepositionDiv cannot calculate the width of the element when it's hidden
    	var __elem = document.getElementById("PageAttachmentsDiv");
    	if(document.getElementById("PageAttachmentsLink")) {
    		__RepositionDiv(document.getElementById("PageAttachmentsLink"), __elem);
    	}
    	__elem.style["display"] = "none";

    	__elem = document.getElementById("AdminToolsDiv");
    	if(document.getElementById("AdminToolsLink")) {
    		__RepositionDiv(document.getElementById("AdminToolsLink"), __elem);
    	}
    	__elem.style["display"] = "none";

    	__InitBCT();
    // -->
    </script>


                <div id="PageInternalFooterDiv"></div>
                <div id="MainFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>

        </div>
            
        <div id="FooterDiv">
             
        </div>

    </form>  
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites.ashx?NoRedirect=1 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:54:34 GMT -->
</html>
