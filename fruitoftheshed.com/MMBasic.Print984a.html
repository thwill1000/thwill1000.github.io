

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" >

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Clock-frequency-trimming-om-Micromite-II-uses-precision-1MHz-output by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:14:27 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><title>
	Clock frequency trimming on Micromite II uses 1MHz output - Fruit Of The Shed
</title><link rel="stylesheet" type="text/css" href="Themes/Print.css" /></head>
<body>
    <form name="frmPrint" method="post" action="http://fruitoftheshed.com/Print.aspx?NS=MMBasic&amp;Page=MMBasic.Clock-frequency-trimming-om-Micromite-II-uses-precision-1MHz-output" id="frmPrint">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTIwMDg4Njc4MjcPZBYCAgEPZBYCAgEPFgIeBFRleHQFjBs8aDEgY2xhc3M9InBhZ2V0aXRsZSI+Q2xvY2sgZnJlcXVlbmN5IHRyaW1taW5nIG9uIE1pY3JvbWl0ZSBJSSB1c2VzIDFNSHogb3V0cHV0PC9oMT48c21hbGw+TW9kaWZpZWQgb24gMjAxNy8wOC8xMSAwOTozOCBieSBBZG1pbmlzdHJhdG9yICZtZGFzaDsgQ2F0ZWdvcml6ZWQgYXM6IENvbnRyb2wsIERhdGVzLCBUaW1lIGFuZCBDbG9ja3MsIERlYnVnLCBIYXJkd2FyZTwvc21hbGw+PGJyIC8+PGJyIC8+VGhlIGludGVybmFsIGNsb2NrIG9uIHRoZSBtaWNyb21pdGUgdXNpbmcgdGhlIFBJQzMyTVggc2VyaWVzIG9mIENQVXMgIGNhbiBiZSBpbmFjY3VyYXRlIGJlY2F1c2UgaXQgaXMgZGVyaXZlZCBmcm9tIGEgY2FwYWNpdG9yIG9zY2lsbGF0b3Igb24gdGhlIGRpZS4gQXMgYSBjb25zZXF1ZW5jZSwgdGhlIGludGVybmFsIERBVEUkIGFuZCBUSU1FJCBmdW5jdGlvbnMgZHJpZnQgb3ZlciB0aW1lIGFuZCB0ZW1wZXJhdHVyZS4gTU1CYXNpYyBkb2VzIHByb3ZpZGUgdGhlIENMT0NLVFJJTSBvcHRpb24gdG8gYWRqdXN0IHRoZSBjbG9jayAgdG8gYnJpbmcgaXQgbW9yZSBpbiBsaW5lLCBidXQgd2l0aG91dCBhIGdvb2QgcmVmZXJlbmNlIGl0IGlzIGEgbWF0dGVyIG9mIHRyaWFsIGFuZCBlcnJvci4gPGJyIC8+PGJyIC8+VGhlIGZvbGxvd2luZyBnZW5lcmF0ZXMgYSBub21pbmFsIDFNSHogc3F1YXJlIHdhdmUgb24gcGluIDxiPjQyPC9iPiBvZiB0aGUgNDQtcGluIG9yIHBpbiA8Yj4xNTwvYj4gb2YgdGhlIDI4LXBpbiBNWDE3MCBtaWNyb2NvbnRyb2xsZXIuIE1lYXN1cmluZyB0aGlzIHdpdGggYSBmcmVxdWVuY3kgbWV0ZXIgYWxsb3dzIHRoZSBpbmFjY3VyYWN5IHRvIGJlIHNlZW4gZWFzaWx5IGFuZCB0aGUgQ0xPQ0tUUklNIGFyZ3VtZW50IGlzIGxlc3Mgb2YgYSBsb25nLXRlcm0gZ3Vlc3MuIEFkanVzdGluZyB0aGUgdmFsdWUgYW5kIHJlLW1lYXN1cmluZyBhbGxvd3MgdGhlIHRyaW0gdG8gYmUgZGVyaXZlZCBpbiBhIHNob3J0IHRpbWUuIFRoZSByZXN1bHRhbnQgbnVtYmVyIGNhbiB0aGVuIGJlIHdyaXR0ZW4gb24gdGhlIGNoaXAgd2l0aCBhIGZpbmUtcG9pbnQgbWFya2VyIGZvciBmdXR1cmUgcmVmZXJlbmNlIGluIGFwcGxpY2F0aW9ucyB3aGVyZSA8aT5yZWFzb25hYmxlIDwvaT5hY2N1cmFjeSBpcyByZXF1aXJlZC4gQXMgaXQgaXMgcHJvY2VkdXJhbGx5IGdlbmVyYXRlZCwgaXQgaXMgdG8gYmUgZXhwZWN0ZWQgZm9yIHRoZSByZWFkaW5nIHRvIHdhbmRlciBhYm91dCwgYnV0IHNvIGxvbmcgYXMgeW91IHNldCB0aGUgdmFsdWUgc28gaXQgaXMgdGhlIG5lYXJlc3QgdG8gMU1IeiBtb3N0IG9mIHRoZSB0aW1lIHRoZSB2YWx1ZSB3aWxsIGJlIGdvb2QgZW5vdWdoLiBJbiB0ZXN0aW5nLCB0aGUgY2xvc2VzdCB2YWx1ZSB3YXMgc2VlbiB0byA8YSBjbGFzcz0iZXh0ZXJuYWxsaW5rIiBocmVmPSJodHRwczovL3lvdXR1LmJlL1JEdi14OFlvMFpjIiB0aXRsZT0idmFyeSBiZXR3ZWVuIGFib3V0IDk5OTk2OSB0byAxMDAwNTMiIHRhcmdldD0iX2JsYW5rIj52YXJ5IGJldHdlZW4gYWJvdXQgOTk5OTY5IHRvIDEwMDA1MzwvYT4gYnV0IHNwZW50IG1vc3Qgb2YgaXRzIHRpbWUganVzdCBhIGZldyBIeiBlaXRoZXIgc2lkZSBvZiAxTUh6OjxiciAvPjxiciAvPjxhIGNsYXNzPSJ1bmtub3dubGluayIgaHJlZj0iTU1CYXNpYy4uYXNoeCIgdGl0bGU9Ik1NQmFzaWMuIj48L2E+PGltZyBzcmM9IkdldEZpbGUuYXNweD9GaWxlPS9NTUJhc2ljLzFNSHpHb29kRW5vdWdoLmpwZyIgYWx0PSJJbWFnZSIgLz48YnIgLz48YnIgLz5PcmlnaW5hbGx5IHB1Ymxpc2hlZCBoZXJlOiA8YSBjbGFzcz0iZXh0ZXJuYWxsaW5rIiBocmVmPSJodHRwOi8vd3d3LnRoZWJhY2tzaGVkLmNvbS9mb3J1bS9mb3J1bV9wb3N0cy5hc3A/VElEPTc4MjIiIHRpdGxlPSJodHRwOi8vd3d3LnRoZWJhY2tzaGVkLmNvbS9mb3J1bS9mb3J1bV9wb3N0cy5hc3A/VElEPTc4MjIiIHRhcmdldD0iX2JsYW5rIj5odHRwOi8vd3d3LnRoZWJhY2tzaGVkLmNvbS9mb3J1bS9mb3J1bV9wb3N0cy5hc3A/VElEPTc4MjI8L2E+PGJyIC8+PGJyIC8+PGI+Q3JlZGl0PC9iPjogbWF0aGVycDxiciAvPjxiciAvPjxwcmU+DQoNCmNwdSA0MCANCm9wdGlvbiBjbG9ja3RyaW0gLTMgJ0FkanVzdCBmb3IgcmVhZGluZyBhcyBjbG9zZSBhcyBwb3NzaWJsZSB0byAxLDAwMCwwMDAgDQonIE9uY2UgYWRqdXN0bWVudCBpcyBlc3RhYmxpc2hlZCBmb3IgdGhlIGNoaXAsIHdyaXRlIHRoZSB0cmltIHZhbHVlIG9uIHRoZSBjaGlwIGZvciBmdXR1cmUgdXNlIA0KZGltIGklIA0KaSU9Y2xvY2tvbig0MCkgDQpJTlBVVCAiUHJlc3MgcmV0dXJuIHRvIHRlcm1pbmF0ZSI7aSUgDQppJT1jbG9ja29mZigpIA0KZW5kIA0KDQoNCiANCkNGdW5jdGlvbiBjbG9ja29uIA0KICAgICAwMDAwMDAwMCANCiAgICAgMjdiZGZmZTggYWZiZjAwMTQgYWZiMDAwMTAgMDA4MDgwMjEgM2MwMmJmODEgOGM0M2YyMjAgN2M2M2Q4MDAgM2MwMjA2NjEgIA0KICAgICAyNDQyMDA1MyAxMDYyMDAwOCAzYzAyOWQwMCAzYzAyYmY4MSA4YzQzZjIyMCA3YzYzZDgwMCAzYzAyMDY2MCAyNDQyMDA1MyAgDQogICAgIDE0NjIwMDA4IDNjMDI5ZDAwIDhjNDIwMDEwIDI0MDQwMDBmIDI0MDUwMDA4IDAwNDBmODA5IDAwMDAzMDIxIDEwMDAwMDA3ICANCiAgICAgM2MwMmJmODEgOGM0MjAwMTAgMjQwNDAwMmEgMjQwNTAwMDggMDA0MGY4MDkgMDAwMDMwMjEgM2MwMmJmODEgOGM0M2ZiNDQgIA0KICAgICAyNDA0MDAwNyA3YzgzMTgwNCBhYzQzZmI0NCAzYzAyYmY4MSA4YzQzZjAyMCA3YzAzN2JjNCBhYzQzZjAyMCA4YzQzZjAyMCAgDQogICAgIDdjODMxODA0IGFjNDNmMDIwIDk2MDQwMDAwIDhjNDNmMDIwIDdjODNmNDA0IGFjNDNmMDIwIDhjNDNmMDIwIDI0MDQwMDAxICANCiAgICAgN2M4MzdiYzQgYWM0M2YwMjAgOGM0M2YwMjAgN2M4MzYzMDQgYWM0M2YwMjAgOGZiZjAwMTQgOGZiMDAwMTAgMDNlMDAwMDggIA0KICAgICAyN2JkMDAxOCAgDQpFbmQgQ0Z1bmN0aW9uICAgJ01JUFMzMiBNNEsgDQoNCkNGdW5jdGlvbiBjbG9ja29mZiANCiAgICAgMDAwMDAwMDAgDQogICAgIDI3YmRmZmU4IGFmYmYwMDE0IDNjMDJiZjgxIDhjNDNmYjQ0IDdjMDMxODA0IGFjNDNmYjQ0IDNjMDJiZjgxIDhjNDNmMDIwICANCiAgICAgN2MwMzdiYzQgYWM0M2YwMjAgM2MwMmJmODEgOGM0M2YyMjAgN2M2M2Q4MDAgM2MwMjA2NjEgMjQ0MjAwNTMgMTA2MjAwMDcgIA0KICAgICAzYzAyYmY4MSA4YzQzZjIyMCA3YzYzZDgwMCAzYzAyMDY2MCAyNDQyMDA1MyAxNDYyMDAwOSAzYzAyOWQwMCAzYzAyOWQwMCAgDQogICAgIDhjNDIwMDEwIDI0MDQwMDBmIDAwMDAyODIxIDAwNDBmODA5IDAwMDAzMDIxIDEwMDAwMDA3IDhmYmYwMDE0IDhjNDIwMDEwICANCiAgICAgMjQwNDAwMmEgMDAwMDI4MjEgMDA0MGY4MDkgMDAwMDMwMjEgOGZiZjAwMTQgMDNlMDAwMDggMjdiZDAwMTggIA0KRW5kIENGdW5jdGlvbiAgICdNSVBTMzIgTTRLDQo8L3ByZT5kZJcs/JY56gNxikMmc0H04LkHr2my" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="03CF0AB7" />
</div>
        <h1 class="pagetitle">Clock frequency trimming on Micromite II uses 1MHz output</h1><small>Modified on 2017/08/11 09:38 by Administrator &mdash; Categorized as: Control, Dates, Time and Clocks, Debug, Hardware</small><br /><br />The internal clock on the micromite using the PIC32MX series of CPUs  can be inaccurate because it is derived from a capacitor oscillator on the die. As a consequence, the internal DATE$ and TIME$ functions drift over time and temperature. MMBasic does provide the CLOCKTRIM option to adjust the clock  to bring it more in line, but without a good reference it is a matter of trial and error. <br /><br />The following generates a nominal 1MHz square wave on pin <b>42</b> of the 44-pin or pin <b>15</b> of the 28-pin MX170 microcontroller. Measuring this with a frequency meter allows the inaccuracy to be seen easily and the CLOCKTRIM argument is less of a long-term guess. Adjusting the value and re-measuring allows the trim to be derived in a short time. The resultant number can then be written on the chip with a fine-point marker for future reference in applications where <i>reasonable </i>accuracy is required. As it is procedurally generated, it is to be expected for the reading to wander about, but so long as you set the value so it is the nearest to 1MHz most of the time the value will be good enough. In testing, the closest value was seen to <a class="externallink" href="https://youtu.be/RDv-x8Yo0Zc" title="vary between about 999969 to 100053" target="_blank">vary between about 999969 to 100053</a> but spent most of its time just a few Hz either side of 1MHz:<br /><br /><a class="unknownlink" href="MMBasic..html" title="MMBasic."></a><img src="1MHzGoodEnough4722.jpg?File=/MMBasic/1MHzGoodEnough.jpg" alt="Image" /><br /><br />Originally published here: <a class="externallink" href="http://www.thebackshed.com/forum/forum_posts.asp?TID=7822" title="http://www.thebackshed.com/forum/forum_posts.asp?TID=7822" target="_blank">http://www.thebackshed.com/forum/forum_posts.asp?TID=7822</a><br /><br /><b>Credit</b>: matherp<br /><br /><pre>

cpu 40 
option clocktrim -3 'Adjust for reading as close as possible to 1,000,000 
' Once adjustment is established for the chip, write the trim value on the chip for future use 
dim i% 
i%=clockon(40) 
INPUT "Press return to terminate";i% 
i%=clockoff() 
end 


 
CFunction clockon 
     00000000 
     27bdffe8 afbf0014 afb00010 00808021 3c02bf81 8c43f220 7c63d800 3c020661  
     24420053 10620008 3c029d00 3c02bf81 8c43f220 7c63d800 3c020660 24420053  
     14620008 3c029d00 8c420010 2404000f 24050008 0040f809 00003021 10000007  
     3c02bf81 8c420010 2404002a 24050008 0040f809 00003021 3c02bf81 8c43fb44  
     24040007 7c831804 ac43fb44 3c02bf81 8c43f020 7c037bc4 ac43f020 8c43f020  
     7c831804 ac43f020 96040000 8c43f020 7c83f404 ac43f020 8c43f020 24040001  
     7c837bc4 ac43f020 8c43f020 7c836304 ac43f020 8fbf0014 8fb00010 03e00008  
     27bd0018  
End CFunction   'MIPS32 M4K 

CFunction clockoff 
     00000000 
     27bdffe8 afbf0014 3c02bf81 8c43fb44 7c031804 ac43fb44 3c02bf81 8c43f020  
     7c037bc4 ac43f020 3c02bf81 8c43f220 7c63d800 3c020661 24420053 10620007  
     3c02bf81 8c43f220 7c63d800 3c020660 24420053 14620009 3c029d00 3c029d00  
     8c420010 2404000f 00002821 0040f809 00003021 10000007 8fbf0014 8c420010  
     2404002a 00002821 0040f809 00003021 8fbf0014 03e00008 27bd0018  
End CFunction   'MIPS32 M4K
</pre>
    </form>
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Clock-frequency-trimming-om-Micromite-II-uses-precision-1MHz-output by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:14:28 GMT -->
</html>
