

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" >

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:25:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><title>
	Ultra-Compact Logging with Flash Storage on small MicroMites - Fruit Of The Shed
</title><link rel="stylesheet" type="text/css" href="Themes/Print.css" /></head>
<body>
    <form name="frmPrint" method="post" action="http://fruitoftheshed.com/Print.aspx?NS=MMBasic&amp;Page=MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites" id="frmPrint">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTIwMDg4Njc4MjcPZBYCAgEPZBYCAgEPFgIeBFRleHQF+z48aDEgY2xhc3M9InBhZ2V0aXRsZSI+VWx0cmEtQ29tcGFjdCBMb2dnaW5nIHdpdGggRmxhc2ggU3RvcmFnZSBvbiBzbWFsbCBNaWNyb01pdGVzPC9oMT48c21hbGw+TW9kaWZpZWQgb24gMjAyMS8xMS8yNiAxNjo1NSBieSBDYXB0YWluQm9pbmcgJm1kYXNoOyBDYXRlZ29yaXplZCBhczogQXJyYXlzLCBEZWJ1ZywgRW5jb2RlIGFuZCBEZWNvZGUsIEVudmlyb25tZW50LCBNZW1vcnksIFN0cmluZ3M8L3NtYWxsPjxiciAvPjxiciAvPk1ha2luZyBub3RlcyBvZiBhY3Rpdml0eSBhbmQga2V5IGluZm9ybWF0aW9uIChsb2dnaW5nKSBpcyBhbiBpbXBvcnRhbnQgZmVhdHVyZSBmb3IgbWFueSBzeXN0ZW1zLiBFbWJlZGRlZCBkZXZpY2VzIGFyZSBvZnRlbiByZXF1aXJlZCB0byBzdG9yZSBkYXRhIGZvciBsYXRlciByZXRyaWV2YWwgYW5kIGl0IGlzIHZpdGFsIHRoaXMgZGF0YSBpcyBub3QgbG9zdCB0aHJvdWdoIHBvd2VyIGZhaWx1cmUgZXRjLjxiciAvPjxiciAvPk1NQmFzaWMgcHJvdmlkZXMgc3VjaCBhIHBvd2VyZnVsIGVudmlyb25tZW50IGl0IGlzIGVhc3kgdG8gZm9yZ2V0IHlvdSBhcmUgd29ya2luZyB3aXRoIGEgc2luZ2xlLWNoaXAgbWljcm8tY29udHJvbGxlciwgYnV0IHRydXRoIGlzLCB0aGVyZSBpcyBvZnRlbiBub3QgbXVjaCB5b3UgY2FuIGRvIGFib3V0IHN0b3JpbmcgbG9ncyB3aXRob3V0IGFkZGluZyBTRCBDYXJkcyBvciBvdGhlciBzdG9yYWdlIGRldmljZXMgLSBhbmQgdGhpcyBjYW4gYmUgYW4gdW53ZWxjb21lIGV4dHJhIGJlY2F1c2Ugb2YgcHJvZ3JhbSBvdmVyaGVhZHMgYW5kIHVzZWQgcGlucy9ib2FyZCBzcGFjZS4gU21hbGwgY2hpcHMgbGlrZSB0aGUgdGhyZWUgcGluIFVOSU8gZGV2aWNlcyBjYW4gZ28gdG8gYWJvdXQgMktCIGFuZCBXaW5Cb25kIChhbmQgb3RoZXJzKSA8YSBjbGFzcz0icGFnZWxpbmsiIHRhcmdldD0iX2JsYW5rIiBocmVmPSJNTUJhc2ljLk1NQmFzaWMtY29kZS1wYWNrLXRvLVJlYWQtYW5kLVdyaXRlLVdpbmJvbmQtRmxhc2gtTWVtb3JpZXMuYXNoeCIgdGl0bGU9Ik1NQmFzaWMgY29kZS1wYWNrIHRvIFJlYWQgYW5kIFdyaXRlIFdpbmJvbmQgRmxhc2ggTWVtb3JpZXMiPlcyNVE8L2E+IGNoaXBzIGNhbiBhZGQgdXB0byAxNk1CIChhbmQgaGlnaGVyKS4gVGhpcyBsYXR0ZXIgaXMgYSBzZXJpb3VzIGFsdGVybmF0aXZlIHRvIFNEIENhcmRzIC0gbm8gYmlnIG92ZXJoZWFkIG9mIGEgZmlsZS1zeXN0ZW0gb3IgdGhlIGhhcmR3YXJlIG9mIGNhcmQgaG9sZGVyIGFuZCBwaW5zIHVzZWQgdXAgb24geW91ciBNaWNyb01pdGUsIGJ1dCBib3RoIG9wdGlvbnMgdXNlIHVwIHBpbnMgYW5kIG1heSBjb21wbGljYXRlIGEgZGVzaWduIC0gZXNwZWNpYWxseSBhIHJldHJvLWZpdC4gPGJyIC8+PGJyIC8+VGhpcyBhcnRpY2xlIGlzIHNwZWNpZmljYWxseSBhaW1lZCBhdCBsb2dnaW5nIHdpdGhvdXQgYWRkaXRpb25hbCBkZXZpY2VzLCB1c2luZyB0aGUgMktCIG9mIGZsYXNoIHJlc2VydmVkIGZvciBzdG9yaW5nIHZhcmlhYmxlcyBvbiBhIE1pY3JvTWl0ZS4gTGF0ZXIgJ21pdGVzIHByb3ZpZGUgaHVnZSBzdG9yYWdlIGFyZWFzIC0gdGhlIEFSTU1pdGUgZ2l2ZXMgMTI4SyEgPGJyIC8+PGJyIC8+QmVsb3cgaXMgYSBzZXJpZXMgb2YgY29kZSBzbmlwcGV0cyB0aGF0IHNob3cgaG93IHRvIHVzZSBhIGhpZ2hseSBjb21wYWN0LCB0b2tlbmlzZWQgbG9nZ2luZyBtZXRob2QgdGhhdCBjYW4gc3RvcmUgMjcwKyBsaW5lcyBvZiBsb2cgaW4gYSBzdHJpbmcgYXJyYXkgYW5kIHNhdmUgdGhpcyB0byBmbGFzaCBzbyBpdCBzdXJ2aXZlcyBwb3dlciBjeWNsZXMuIFVuZm9ydHVuYXRlbHksIHlvdSBsb3NlIHRoZSBmbGV4aWJpbGl0eSBvZiBmcmVlLWZvcm0gdGV4dCBzdHJpbmdzOyByZXBsYWNpbmcgaHVtYW4gZnJpZW5kbHkgbWVzc2FnZXMgd2l0aCBhIHNpbmdsZS1jaGFyYWN0ZXIgdG9rZW4gKGFuZCBpbiB0aGUgY2FzZSBiZWxvdywgYSB0d28ncy1jb21wbGltZW50IHNpbmdsZSBieXRlIG51bWJlciB3aGljaCBpcyBlbm91Z2ggZm9yIHN0b3JpbmcgYSBzaW1wbGUgZXZlbnQgY291bnRlciBvciB0ZW1wZXJhdHVyZSBpbiB0aGUgcmFuZ2Ugb2YgKy8tIDEyNyBkZWdyZWVzKS4gVGhpcyBkb2VzIGxpbWl0IHRoZSBudW1iZXIgb2YgbWVzc2FnZXMgdG8gYWJvdXQgNDAgaW5kaXZpZHVhbCBtZXNzYWdlIHR5cGVzIC0geW91IHNob3VsZCBtYW5hZ2UgdG8gc2NyYXBlIHRocm91Z2ggO28pPGJyIC8+PGJyIC8+Rmlyc3RseSBoZXJlIGlzIHRoZSBQcmVhbWJsZSAtIHRoZSBiaXQgb2YgY29kZSB0byBzZXQgZXZlcnl0aGluZyB1cC4gVGhpcyBpcyBhbGwgdGhhdCBpcyByZXF1aXJlZCBpbiB5b3VyIHN0YXJ0LXVwIHNlY3Rpb24gb2YgY29kZS4gSXQgZXN0YWJsaXNoZXMgdGhlIGxpbWl0IG9mIHRoZSBsb2cgc2l6ZSAoMjczIGxpbmVzKSwgZGltZW5zaW9ucyB0aGUgd29ya2luZyBhcnJheSBhbmQgcmV0cmlldmVzIGFueSBleGlzdGluZyBsb2cgZGF0YSBmcm9tIGZsYXNoLiBJbiB0aGlzIGV4YW1wbGUsIEkgaGF2ZSBncmFiYmVkIGFsbCB0aGUgZmxhc2ggSSBjYW4gLSBpZiB5b3UgbmVlZCBzb21lIGZvciBvdGhlciB0aGluZ3Mgb3Igc2ltcGx5IGRvbid0IHdhbnQgYSBsb2cgdGhhdCBiaWcsIGFkanVzdCBMb2dUb3AgZG93biBhY2NvcmRpbmdseSAtIHRoYXQncyBhbGwuPGJyIC8+PHByZT4NCicgUHJlYW1ibGUNCglPcHRpb24gQmFzZSAwCQkJJyBPcGVyYXRpb25hbCAobGl2ZSkgbG9nIHN0YXJ0cyBhdCBlbGVtZW50IDANCglDb25zdCBMb2dUb3A9MjcyCQknIHdpdGggbGVuZ3RoIDYsIHdlIGNhbiBzcXVlZXplIDI3MyAoMC0yNzIpIGludG8gZmxhc2ggLSBpZiB5b3UgYXJlIGRvaW5nIG9uZSBlbnRyeSBwZXIgaG91ciB0aGF0IGlzIG92ZXIgMTAgZGF5cyANCgkJCQkJJyBidXQgZG9uJ3Qgc2F2ZSB0byBmbGFzaCBhdCB0aGF0IHJhdGUsIGEgTWljcm9NaXRlIHdvdWxkIG9ubHkgbGFzdCB+MiB5ZWFycyEgU28gYmFsYW5jZSBpdCBuaWNlbHkNCg0KCURpbSBPcExvZyQoTG9nVG9wKSBMZW5ndGggNiAgICAgJyBkaW1lbnNpb24gdGhlIGxvZyBhcnJheQ0KDQoJVmFyIFJlc3RvcmUJCQknIHB1bGwgYW55IGV4aXN0aW5nIGxvZyBpbnRvIHRoZSBvcGVyYXRpb25hbCBhcnJheQ0KPC9wcmU+PGJyIC8+VGhlIGZvbGxvd2luZyBjb2RlIGNhbiBiZSB1c2VkIGFueXdoZXJlIGluIHlvdXIgY29kZSBhcyBvZnRlbiBhcyB5b3UgbGlrZSB0byBtYWtlIGFuIGVudHJ5IGluIHRoZSBvcGVyYXRpb25hbCBsb2cuPGJyIC8+PHByZT4NCicgYW55d2hlcmUgaW4geW91ciBjb2RlLi4uIGV4YW1wbGUgdG8gbG9nIGEgdGVtcGVyYXR1cmUNCglMb2dFdmVudCBMb2dFbmMkKCJVIixHZXRUZW1wKCkpCScgdG8gbWFrZSBhbiBlbnRyeSBpbiB0aGUgbG9nDQo8L3ByZT48YnIgLz5PbmUgcHJvYmxlbSB3aXRoIHRoZSBvbi1jaGlwIGZsYXNoIGlzIGl0IGhhcyBhIGxpZmUtdGltZSBvZiBhYm91dCAyMCwwMDAgd3JpdGUgY3ljbGVzLiBQbGVhc2UgcmVhZCB0aGUgIk1pY3JvbWl0ZSBTcGVjaWFsIEZlYXR1cmVzIiBzZWN0aW9uIG9mIHRoZSBNaWNyb01pdGUgTWFudWFsLiBCZWFyaW5nIHRoaXMgaW4gbWluZCwgaXQgaXMgdml0YWwgdG8gYXZvaWQgd3JpdGluZyB0aGUgbG9nIHRvIGZsYXNoIHdoZW4gaXQgaXNuJ3QgaW1wb3J0YW50LiBJIHRlbmQgdG8gZG8gaXQgb25seSBhdCBrZXkgcG9pbnRzLCB3aGVuIEkgaGF2ZSBkYXRhIEkgcmVhbGx5IGRvbid0IHdhbnQgdG8gbG9zZS4gSW4gb25lIGFwcGxpY2F0aW9uLCBJIHNhdmUgdGhlIGxvZyBhdCBkYXduIGFuZCBkdXNrIGFuZCBvbiBzdGFydHVwcyBzbyAyIHdyaXRlcyBhIGRheS4gVGhlIGNoaXAgc2hvdWxkIGxhc3QgMjArIHllYXJzLiBSZW1lbWJlciB0aGF0IGFkZGluZyBhbiBldmVudCB0byB0aGUgbG9nIGRvZXNuJ3Qgc2F2ZSB0aGUgbG9nIHRvIGZsYXNoIC0geW91IGhhdmUgdG8gc2F2ZSB0aGUgbG9nIGV4cGxpY2l0bHkuIFlvdSBuZWVkIHRvIGJhbGFuY2UgdGhlIHJpc2sgb2YgbG9zaW5nIGRhdGEgdGhhdCBoYXNuJ3QgYmVlbiBzYXZlZCB2ZXJzdXMgdGhlIGNvc3QgdG8geW91ciBoYXJkd2FyZS48YnIgLz48cHJlPg0KCVZhciBTYXZlIE9wTG9nJCgpCQknIHNhdmUgdGhlIGFycmF5IHRvIGZsYXNoIC0gZG9uJ3QgZG8gdGhpcyB0b28gb2Z0ZW4sIHRyeSB0byBzYXZlDQoJCQkJCScgdGhlIGxvZyBvbmx5IGF0IGtleSBwb2ludHMgc28gYXMgbm90IHRvIHdlYXIgb3V0IHRoZSBmbGFzaA0KPC9wcmU+PGJyIC8+VGhpcyBjb2RlIGR1bXBzIG91dCB0aGUgY29udGVudHMgb2YgdGhlIGxvZy4gVGhlIGxvZyBpcyBhIEZJRk8gbGlzdCB3aXRoIG5ldyBlbnRyaWVzIGFkZGVkIHRvIHRoZSBlbmQgYWZ0ZXIgZXZlcnl0aGluZyBlbHNlIGhhcyBiZWVuIHNodWZmbGVkIGRvd24gb25lIHBvc2l0aW9uLiBUaGlzIGVuc3VyZXMgSSBhbHdheXMga2VlcCB0aGUgbGF0ZXN0IGRhdGEgYnV0IG9sZGVyIGxvZ3Mgd2lsbCBiZSBsb3N0IGFzIHNwYWNlIGlzIGNvbnN1bWVkLiBOb3RlIHRoYXQgIiIgaXMgdXNlZCB0byBkZXRlcm1pbmUgYW4gdW4tdXNlZCBsb2cgc2xvdCBhbmQgZWFjaCB1c2VkIGVudHJ5IGlzIHByZWZpeGVkIHdpdGggIkAiIHRvIGluZGljYXRlIGl0IGlzIGhpc3RvcmljYWwgZGF0YS48YnIgLz48cHJlPg0KJyBUbyBkdW1wIHRoZSBsb2cNCglGb3IgeD0wIHRvIExvZ1RvcA0KCQlJZiBPcExvZyQoeCkmbHQ7Jmd0OyIiIFRoZW4gUHJpbnQgIkAiK0xvZ0RlYyQoT3BMb2ckKHgpKQ0KCU5leHQNCjwvcHJlPjxiciAvPlRoaXMgZ2l2ZXMgc3R1ZmYgbGlrZSB0aGlzOjxiciAvPjxjb2RlPjxiciAvPkAwMi0wNC0yMDE4IDAwOjAwOjAwIFRlbXAgOUM8YnIgLz5AMDItMDQtMjAxOCAwMDowMDowMCBTZW5zb3IgdHJpZ2dlcnMgaW4gbGFzdCBob3VyPTI8YnIgLz5AMDItMDQtMjAxOCAwMTowMDowMCBUZW1wIDdDPGJyIC8+QDAyLTA0LTIwMTggMDI6MDA6MDAgVGVtcCA3QzxiciAvPkAwMi0wNC0yMDE4IDAyOjAwOjAwIFNlbnNvciB0cmlnZ2VycyBpbiBsYXN0IGhvdXI9MTE8YnIgLz5AMDItMDQtMjAxOCAwMzowMDowMCBUZW1wIDZDPGJyIC8+QDAyLTA0LTIwMTggMDM6MDA6MDAgU2Vuc29yIHRyaWdnZXJzIGluIGxhc3QgaG91cj0xPGJyIC8+QDAyLTA0LTIwMTggMDQ6MDA6MDAgVGVtcCA2QzxiciAvPkAwMi0wNC0yMDE4IDA1OjAwOjAwIFRlbXAgN0M8YnIgLz5AMDItMDQtMjAxOCAwNTozMTowMCBEYXduLiBUZW1wIDdDPGJyIC8+QDAyLTA0LTIwMTggMDY6MDA6MDAgVGVtcCA4QzxiciAvPkAwMi0wNC0yMDE4IDA3OjAwOjAwIFRlbXAgOEM8YnIgLz5AMDItMDQtMjAxOCAwODowMDowMCBUZW1wIDlDPGJyIC8+QDAyLTA0LTIwMTggMDk6MDA6MDAgVGVtcCA5QzxiciAvPkAwMi0wNC0yMDE4IDEwOjAwOjAwIFRlbXAgMTBDPGJyIC8+QDAyLTA0LTIwMTggMTE6MDA6MDAgVGVtcCAxMUM8YnIgLz5AMDItMDQtMjAxOCAxMjowMDowMCBUZW1wIDEyQzxiciAvPjwvY29kZT48YnIgLz48YnIgLz5GaW5hbGx5LCBoZXJlIGFyZSB0aGUgU3VicyBhbmQgRnVuY3Rpb25zIHRoYXQgZW5jb2RlIGFuZCBkZWNvZGUgdGhlIGxvZyBsaW5lcy4gTm90ZSB0aGF0IHdoZW4gZW5jb2RpbmcgYSBsb2cgc3RyaW5nLCB5b3Ugc3VwcGx5IHlvdXIgdG9rZW4gZS5nLiAiQyIuIEl0IGlzIGltcG9ydGFudCB0aGUgZGVjb2RlIGZ1bmN0aW9uIGtub3dzIHdoYXQgYSB0b2tlbiBtZWFucyB0byByZXN0b3JlIHRoZSAiaHVtYW4gcmVhZGFibGUiIG5hdHVyZSBvZiB0aGUgbG9nIGVudHJ5LjxiciAvPjxwcmU+DQonIFRoZSBTdWJzICZhbXA7IEZ1bmN0aW9ucw0KDQonIGFkZCBhbiBpdGVtIHRvIHRoZSBldmVudCBsb2cgLSBvbmx5IG1hbmFnZXMgYW5kIGFkZHMgdGhlIGxvZyBlbnRyeSB0byB0aGUgYXJyYXksIGRvZXNuJ3Qgc2F2ZSB0byBmbGFzaA0KCVN1YiBMb2dFdmVudCh4JCkNCgkJTG9jYWwgSW50ZWdlciBuDQoJCUZvciBuPTEgVG8gTG9nVG9wDQoJCQlPcExvZyQobi0xKT1PcExvZyQobikNCgkJTmV4dA0KCQlPcExvZyQoTG9nVG9wKT14JA0KCUVuZCBTdWINCg0KJyBlbmNvZGUgYSBsb2cgc3RyaW5nDQoJRnVuY3Rpb24gTG9nRW5jJCh0JCxuIEFzIEludGVnZXIpDQoJCUxvY2FsIEludGVnZXIgbQ0KCQlMb2NhbCB6JCxhJA0KCQlhJD1IZXgkKFVuaXhUaW1lKE5vdygpKSkNCgkJRm9yIG09MSBUbyA4IFN0ZXAgMg0KCQkJeiQ9eiQrQ2hyJChWYWwoIiZhbXA7aCIrTWlkJChhJCxtLDIpKSkNCgkJTmV4dA0KCQlMb2dFbmMkPXokK0NociQobiBBbmQgMjU1KStVY2FzZSQodCQpDQoJRW5kIEZ1bmN0aW9uDQoNCicgZGVjb2RlIGEgbG9nIHN0cmluZw0KCUZ1bmN0aW9uIExvZ0RlYyQoYSQpDQoJCUxvY2FsIGwkLHYkDQoJCUxvY2FsIEludGVnZXIgbQ0KCQlGb3IgbT0xIHRvIDQNCgkJCWwkPWwkK0hleCQoQXNjKE1pZCQoYSQsbSwxKSksMikNCgkJTmV4dA0KCQlsJD1IdW1hblRpbWUoVmFsKCImYW1wO2giK2wkKSkrIiAiDQoJCXYkPVN0ciQoU2duWCg3LEFzYyhNaWQkKGEkLDUpKSkpDQoJCVNlbGVjdCBDYXNlIE1pZCQoYSQsNiwxKQkJJyBoYXZlIHdoYXRldmVyIHlvdSB3YW50IGhlcmUgaW4gdGhlIGNhc2Ugc3RhdGVtZW50cw0KCQkJQ2FzZSAiTyINCgkJCQlMb2dEZWMkPWwkKyJTeXN0ZW0gU3RhcnRlZC4gV2F0Y2hkb2cgZXZlbnQ9Iit2JA0KCQkJQ2FzZSAiVSINCgkJCQlMb2dEZWMkPWwkKyJEYXduLiBUZW1wICIrdiQrIkMiDQoJCQlDYXNlICJEIg0KCQkJCUxvZ0RlYyQ9bCQrIkR1c2suIFRlbXAgIit2JCsiQyINCgkJCUNhc2UgIlQiDQoJCQkJTG9nRGVjJD1sJCsiVGVtcCAiK3YkKyJDIg0KCQkJQ2FzZSAiUyINCgkJCQlMb2dEZWMkPWwkKyJTZW5zb3IgdHJpZ2dlcnMgaW4gbGFzdCBob3VyPSIrdiQNCgkJCUNhc2UgRWxzZQ0KCQkJCUxvZ0RlYyQ9bCQrIlVua25vd24iDQoJCUVuZCBTZWxlY3QNCglFbmQgRnVuY3Rpb24NCjwvcHJlPjxiciAvPjxiPkRlcGVuZGVuY2llczwvYj48YnIgLz48YSBjbGFzcz0icGFnZWxpbmsiIHRhcmdldD0iX2JsYW5rIiBocmVmPSJNTUJhc2ljLlVuaXhUaW1lLW9yLUVwb2NoLVRpbWUuYXNoeCIgdGl0bGU9IlVuaXhUaW1lIG9yIEVwb2NoIFRpbWUiPlVuaXhUaW1lKCk8L2E+PGJyIC8+PGEgY2xhc3M9InBhZ2VsaW5rIiB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iTU1CYXNpYy5IdW1hblRpbWUtRnVuY3Rpb24tdG8tcmV0dXJuLWEtaHVtYW4tcmVhZGFibGUtZGF0ZS1hbmQtdGltZS1mcm9tLWEtdW5peHRpbWUtbnVtYmVyLmFzaHgiIHRpdGxlPSJIdW1hblRpbWUoKSBGdW5jdGlvbiB0byByZXR1cm4gYSBodW1hbiByZWFkYWJsZSBkYXRlIGFuZCB0aW1lIGZyb20gYSB1bml4dGltZSBudW1iZXIiPkh1bWFuVGltZSgpPC9hPjxiciAvPjxhIGNsYXNzPSJwYWdlbGluayIgdGFyZ2V0PSJfYmxhbmsiIGhyZWY9Ik1NQmFzaWMuTm93LUZ1bmN0aW9uLVZCLXdvcmstYS1saWtlLmFzaHgiIHRpdGxlPSJOb3coKSBGdW5jdGlvbiAoVkIgd29yay1hLWxpa2UpICI+Tm93KCk8L2E+PGJyIC8+PGEgY2xhc3M9InBhZ2VsaW5rIiB0YXJnZXQ9Il9ibGFuayIgaHJlZj0iTU1CYXNpYy5TaWduLUV4dGVuZC1hbi1JbnRlZ2VyLmFzaHgiIHRpdGxlPSJTaWduIEV4dGVuZCBhbiBJbnRlZ2VyIj5TZ25YKCk8L2E+PGJyIC8+Li4uIGFuZCB0aGVpciBjaGlsZCBkZXBlbmRlbmNpZXMuPGJyIC8+PGJyIC8+VGhlIGFib3ZlIHNvbHV0aW9uIGlzIHRha2VuIGZyb20gb25lIGhpZ2hseSBzcGVjaWZpYyByZXF1aXJlbWVudC4gWW91cnMgbWF5IHZhcnkgYW5kIHlvdSBjYW4gdHdlYWsgdGhlIGNvZGUgdG8gYWRkIG1vcmUgb3IgYmlnZ2VyIHRva2VucyBvciBtb3JlIHZhbHVlcyBldGMuPGJyIC8+PGI+U2VlIGFsc288L2I+PGJyIC8+PGEgY2xhc3M9InBhZ2VsaW5rIiBocmVmPSJNTUJhc2ljLk1NQmFzaWMtY29kZS1wYWNrLXRvLVJlYWQtYW5kLVdyaXRlLVdpbmJvbmQtRmxhc2gtTWVtb3JpZXMuYXNoeCIgdGl0bGU9Ik1NQmFzaWMgY29kZS1wYWNrIHRvIFJlYWQgYW5kIFdyaXRlIFdpbmJvbmQgRmxhc2ggTWVtb3JpZXMiPk1NQmFzaWMgY29kZS1wYWNrIHRvIFJlYWQgYW5kIFdyaXRlIFdpbmJvbmQgRmxhc2ggTWVtb3JpZXM8L2E+PGJyIC8+PGJyIC8+ZGQ9MC9V3Gc6lv8sSpgxRUGtEEwESg==" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="03CF0AB7" />
</div>
        <h1 class="pagetitle">Ultra-Compact Logging with Flash Storage on small MicroMites</h1><small>Modified on 2021/11/26 16:55 by CaptainBoing &mdash; Categorized as: Arrays, Debug, Encode and Decode, Environment, Memory, Strings</small><br /><br />Making notes of activity and key information (logging) is an important feature for many systems. Embedded devices are often required to store data for later retrieval and it is vital this data is not lost through power failure etc.<br /><br />MMBasic provides such a powerful environment it is easy to forget you are working with a single-chip micro-controller, but truth is, there is often not much you can do about storing logs without adding SD Cards or other storage devices - and this can be an unwelcome extra because of program overheads and used pins/board space. Small chips like the three pin UNIO devices can go to about 2KB and WinBond (and others) <a class="pagelink" target="_blank" href="MMBasic.MMBasic-code-pack-to-Read-and-Write-Winbond-Flash-Memories.html" title="MMBasic code-pack to Read and Write Winbond Flash Memories">W25Q</a> chips can add upto 16MB (and higher). This latter is a serious alternative to SD Cards - no big overhead of a file-system or the hardware of card holder and pins used up on your MicroMite, but both options use up pins and may complicate a design - especially a retro-fit. <br /><br />This article is specifically aimed at logging without additional devices, using the 2KB of flash reserved for storing variables on a MicroMite. Later 'mites provide huge storage areas - the ARMMite gives 128K! <br /><br />Below is a series of code snippets that show how to use a highly compact, tokenised logging method that can store 270+ lines of log in a string array and save this to flash so it survives power cycles. Unfortunately, you lose the flexibility of free-form text strings; replacing human friendly messages with a single-character token (and in the case below, a two's-compliment single byte number which is enough for storing a simple event counter or temperature in the range of +/- 127 degrees). This does limit the number of messages to about 40 individual message types - you should manage to scrape through ;o)<br /><br />Firstly here is the Preamble - the bit of code to set everything up. This is all that is required in your start-up section of code. It establishes the limit of the log size (273 lines), dimensions the working array and retrieves any existing log data from flash. In this example, I have grabbed all the flash I can - if you need some for other things or simply don't want a log that big, adjust LogTop down accordingly - that's all.<br /><pre>
' Preamble
	Option Base 0			' Operational (live) log starts at element 0
	Const LogTop=272		' with length 6, we can squeeze 273 (0-272) into flash - if you are doing one entry per hour that is over 10 days 
					' but don't save to flash at that rate, a MicroMite would only last ~2 years! So balance it nicely

	Dim OpLog$(LogTop) Length 6     ' dimension the log array

	Var Restore			' pull any existing log into the operational array
</pre><br />The following code can be used anywhere in your code as often as you like to make an entry in the operational log.<br /><pre>
' anywhere in your code... example to log a temperature
	LogEvent LogEnc$("U",GetTemp())	' to make an entry in the log
</pre><br />One problem with the on-chip flash is it has a life-time of about 20,000 write cycles. Please read the "Micromite Special Features" section of the MicroMite Manual. Bearing this in mind, it is vital to avoid writing the log to flash when it isn't important. I tend to do it only at key points, when I have data I really don't want to lose. In one application, I save the log at dawn and dusk and on startups so 2 writes a day. The chip should last 20+ years. Remember that adding an event to the log doesn't save the log to flash - you have to save the log explicitly. You need to balance the risk of losing data that hasn't been saved versus the cost to your hardware.<br /><pre>
	Var Save OpLog$()		' save the array to flash - don't do this too often, try to save
					' the log only at key points so as not to wear out the flash
</pre><br />This code dumps out the contents of the log. The log is a FIFO list with new entries added to the end after everything else has been shuffled down one position. This ensures I always keep the latest data but older logs will be lost as space is consumed. Note that "" is used to determine an un-used log slot and each used entry is prefixed with "@" to indicate it is historical data.<br /><pre>
' To dump the log
	For x=0 to LogTop
		If OpLog$(x)&lt;&gt;"" Then Print "@"+LogDec$(OpLog$(x))
	Next
</pre><br />This gives stuff like this:<br /><code><br />@02-04-2018 00:00:00 Temp 9C<br />@02-04-2018 00:00:00 Sensor triggers in last hour=2<br />@02-04-2018 01:00:00 Temp 7C<br />@02-04-2018 02:00:00 Temp 7C<br />@02-04-2018 02:00:00 Sensor triggers in last hour=11<br />@02-04-2018 03:00:00 Temp 6C<br />@02-04-2018 03:00:00 Sensor triggers in last hour=1<br />@02-04-2018 04:00:00 Temp 6C<br />@02-04-2018 05:00:00 Temp 7C<br />@02-04-2018 05:31:00 Dawn. Temp 7C<br />@02-04-2018 06:00:00 Temp 8C<br />@02-04-2018 07:00:00 Temp 8C<br />@02-04-2018 08:00:00 Temp 9C<br />@02-04-2018 09:00:00 Temp 9C<br />@02-04-2018 10:00:00 Temp 10C<br />@02-04-2018 11:00:00 Temp 11C<br />@02-04-2018 12:00:00 Temp 12C<br /></code><br /><br />Finally, here are the Subs and Functions that encode and decode the log lines. Note that when encoding a log string, you supply your token e.g. "C". It is important the decode function knows what a token means to restore the "human readable" nature of the log entry.<br /><pre>
' The Subs &amp; Functions

' add an item to the event log - only manages and adds the log entry to the array, doesn't save to flash
	Sub LogEvent(x$)
		Local Integer n
		For n=1 To LogTop
			OpLog$(n-1)=OpLog$(n)
		Next
		OpLog$(LogTop)=x$
	End Sub

' encode a log string
	Function LogEnc$(t$,n As Integer)
		Local Integer m
		Local z$,a$
		a$=Hex$(UnixTime(Now()))
		For m=1 To 8 Step 2
			z$=z$+Chr$(Val("&amp;h"+Mid$(a$,m,2)))
		Next
		LogEnc$=z$+Chr$(n And 255)+Ucase$(t$)
	End Function

' decode a log string
	Function LogDec$(a$)
		Local l$,v$
		Local Integer m
		For m=1 to 4
			l$=l$+Hex$(Asc(Mid$(a$,m,1)),2)
		Next
		l$=HumanTime(Val("&amp;h"+l$))+" "
		v$=Str$(SgnX(7,Asc(Mid$(a$,5))))
		Select Case Mid$(a$,6,1)		' have whatever you want here in the case statements
			Case "O"
				LogDec$=l$+"System Started. Watchdog event="+v$
			Case "U"
				LogDec$=l$+"Dawn. Temp "+v$+"C"
			Case "D"
				LogDec$=l$+"Dusk. Temp "+v$+"C"
			Case "T"
				LogDec$=l$+"Temp "+v$+"C"
			Case "S"
				LogDec$=l$+"Sensor triggers in last hour="+v$
			Case Else
				LogDec$=l$+"Unknown"
		End Select
	End Function
</pre><br /><b>Dependencies</b><br /><a class="pagelink" target="_blank" href="MMBasic.UnixTime-or-Epoch-Time.html" title="UnixTime or Epoch Time">UnixTime()</a><br /><a class="pagelink" target="_blank" href="MMBasic.HumanTime-Function-to-return-a-human-readable-date-and-time-from-a-unixtime-number.html" title="HumanTime() Function to return a human readable date and time from a unixtime number">HumanTime()</a><br /><a class="pagelink" target="_blank" href="MMBasic.Now-Function-VB-work-a-like.html" title="Now() Function (VB work-a-like) ">Now()</a><br /><a class="pagelink" target="_blank" href="MMBasic.Sign-Extend-an-Integer.html" title="Sign Extend an Integer">SgnX()</a><br />... and their child dependencies.<br /><br />The above solution is taken from one highly specific requirement. Yours may vary and you can tweak the code to add more or bigger tokens or more values etc.<br /><b>See also</b><br /><a class="pagelink" href="MMBasic.MMBasic-code-pack-to-Read-and-Write-Winbond-Flash-Memories.html" title="MMBasic code-pack to Read and Write Winbond Flash Memories">MMBasic code-pack to Read and Write Winbond Flash Memories</a><br /><br />
    </form>
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:25:22 GMT -->
</html>
