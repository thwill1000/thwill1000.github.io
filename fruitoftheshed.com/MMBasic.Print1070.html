

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" >

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Battery-Management-for-12V-System-part-of-the-original-MMBasic-library by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:13:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><title>
	Battery Management for 12V System - Fruit Of The Shed
</title><link rel="stylesheet" type="text/css" href="Themes/Print.css" /></head>
<body>
    <form name="frmPrint" method="post" action="http://fruitoftheshed.com/Print.aspx?NS=MMBasic&amp;Page=MMBasic.Battery-Management-for-12V-System-part-of-the-original-MMBasic-library" id="frmPrint">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTIwMDg4Njc4MjcPZBYCAgEPZBYCAgEPFgIeBFRleHQFvuYBPGgxIGNsYXNzPSJwYWdldGl0bGUiPkJhdHRlcnkgTWFuYWdlbWVudCBmb3IgMTJWIFN5c3RlbTwvaDE+PHNtYWxsPk1vZGlmaWVkIG9uIDIwMTYvMTIvMjMgMjM6MjAgYnkgQWRtaW5pc3RyYXRvciAmbWRhc2g7IENhdGVnb3JpemVkIGFzOiBDb250cm9sLCBFbnZpcm9ubWVudCwgX0xJQiBPcmlnaW5hbCBNTUJhc2ljPC9zbWFsbD48YnIgLz48YnIgLz48aDIgY2xhc3M9InNlcGFyYXRvciI+VGhpcyBtb2R1bGUgaXMgcGFydCBvZiB0aGUgb3JpZ2luYWwgTU1CYXNpYyBsaWJyYXJ5LiBJdCBpcyByZXByb2R1Y2VkIGhlcmUgd2l0aCBraW5kIHBlcm1pc3Npb24gb2YgSHVnaCBCdWNrbGUgYW5kIEdlb2ZmIEdyYWhhbS4gQmUgYXdhcmUgaXQgbWF5IHJlZmVyZW5jZSBmdW5jdGlvbmFsaXR5IHdoaWNoIGhhcyBjaGFuZ2VkIG9yIGlzIGRlcHJlY2F0ZWQgaW4gdGhlIGxhdGVzdCB2ZXJzaW9ucyBvZiBNTUJhc2ljLjxhIGNsYXNzPSJoZWFkZXJhbmNob3IiIGlkPSJUaGlzX21vZHVsZV9pc19wYXJ0X29mX3RoZV9vcmlnaW5hbF9NTUJhc2ljX2xpYnJhcnlfSXRfaXNfcmVwcm9kdWNlZF9oZXJlX3dpdGhfa2luZF9wZXJtaXNzaW9uX29mX0h1Z2hfQnVja2xlX2FuZF9HZW9mZl9HcmFoYW1fQmVfYXdhcmVfaXRfbWF5X3JlZmVyZW5jZV9mdW5jdGlvbmFsaXR5X3doaWNoX2hhc19jaGFuZ2VkX29yX2lzX2RlcHJlY2F0ZWRfaW5fdGhlX2xhdGVzdF92ZXJzaW9uc19vZl9NTUJhc2ljXzAiIGhyZWY9IiNUaGlzX21vZHVsZV9pc19wYXJ0X29mX3RoZV9vcmlnaW5hbF9NTUJhc2ljX2xpYnJhcnlfSXRfaXNfcmVwcm9kdWNlZF9oZXJlX3dpdGhfa2luZF9wZXJtaXNzaW9uX29mX0h1Z2hfQnVja2xlX2FuZF9HZW9mZl9HcmFoYW1fQmVfYXdhcmVfaXRfbWF5X3JlZmVyZW5jZV9mdW5jdGlvbmFsaXR5X3doaWNoX2hhc19jaGFuZ2VkX29yX2lzX2RlcHJlY2F0ZWRfaW5fdGhlX2xhdGVzdF92ZXJzaW9uc19vZl9NTUJhc2ljXzAiIHRpdGxlPSJMaW5rIHRvIHRoaXMgU2VjdGlvbiI+JiMwMTgyOzwvYT48L2gyPjxiPk5vdGU8L2I+OiBUaGUgcmVxdWlyZWQgZmlsZShzKSBhcmUgYXZhaWxhYmxlIGluIHRoZSBhdHRhY2htZW50cyB0YWIgKHRvcCByaWdodCkuPGJyIC8+PGJyIC8+JzxiciAvPicgQmF0dGVyeSBNYW5hZ2VtZW50IFByb2dyYW0gZm9yIENhcmF2YW4gMTJWIFN5c3RlbTxiciAvPicgQ29weXJpZ2h0IERvdWcgUGFua2h1cnN0IE1heSAyMDEzPGJyIC8+JyBXcml0dGVuIGZvciBNTUJhc2ljIFY0LjNhLCBjb3B5cmlnaHQgR2VvZmYgR3JhaGFtIDIwMTIgJzxiciAvPic8YnIgLz4nIEZpbGUgVmVyc2lvbjogMi4wNCBNYXkgMjAxMzxiciAvPic8YnIgLz48YnIgLz5UaGlzIGlzIGFuIHVwZGF0ZWQgKE1hcmsgSUkgOy0pICkgdmVyc2lvbiBvZiBhIHByb2dyYW0gZmlyc3Qgc3VibWl0dGVkIGluIE1heSAyMDEyLiBMb3RzIG9mIGNvbW1lbnRzIGFuZCBpdCBvbmx5IEpVU1QgZml0cyBpbnRvIGEgQ01NIHJ1bm5pbmcgaW4gOCBjb2xvdXIgbW9kZSAtIEkgaGF2ZSBpbnRlbnRpb25hbGx5IG1hZGUgaXQgdmVyYm9zZSBhbmQgbm90IG9wdGltaXNlZHRvIGFsbG93IGVhc3kgcmVhZGluZy48YnIgLz48YnIgLz5UaGlzIHByb2dyYW0gbW9uaXRvcnMgYSAxMlYgQmF0dGVyeSBTeXN0ZW0sIG1vbml0b3JpbmcgdGhlIGJhdHRlcnkgdm9sdGFnZSwgdGhlIHNvbGFyIHBhbmVsIHZvbHRhZ2UgYW5kIHRoZSBhbW91bnQgb2YgY2hhcmdlIHN1cHBsaWVkIGludG8gYW5kIG91dCBvZiB0aGUgYmF0dGVyeSB2aWEgY3VycmVudCBzaHVudCBJQ3MuIFRoZSBjaGFyZ2UvZGlzY2hhcmdlIHN0YXRlIG9mIHRoZSBiYXR0ZXJ5IGlzIGdpdmVuIGJ5IGNvbXBhcmluZyBjdXJyZW50IGluIHZlcnN1cyBjdXJyZW50IG91dC48YnIgLz48YnIgLz5JdCBhbHNvIGVzdGltYXRlcyB0aW1lIHRvIDMwJSBjYXBhY2l0eSBiYXNlZCBvbiBiYXR0ZXJ5IHZvbHRhZ2UgYW5kIGN1cnJlbnQgZGlzY2hhcmdlIHJhdGUgYW5kIHByb3ZpZGVzIGEgd2FybmluZy48YnIgLz48YnIgLz5SZWFsIHRpbWUgZGF0YSBpcyBkaXNwbGF5ZWQgb24gVkdBIGRpc3BsYXkgYXMgd2VsbCBhcyBoaXN0b3JpY2FsIGRhdGEgcmVjb3JkZWQgdG8gYSBsb2cgZmlsZSBvbiB0aGUgU0QgY2FyZCBmb3IgbGF0ZXIgYW5hbHlzaXMuPGJyIC8+PGJyIC8+SXQgdXRpbGlzZXMgYSByYW5nZSBvZiBzdWJyb3V0aW5lcyBhbmQgZGVmaW5lZCBmdW50aW9ucyBiYXNlZCBvbiBzb2Z0d2FyZSBhbmQgaWRlYXMgZnJvbSBEb3VnIFBhbmtodXJzdCwgR2VvZmYgR3JhaGFtLCBUb20gUGFua2h1cnN0LCBhbmQgYWxzbyBmcm9tIHByb2dyYW1zIHByb3ZpZGVkIGluIHRoZSBNTUJBU0lDIFNvZnR3YXJlIGxpYnJhcnksIGF1dGhvcnMgdW5rbm93bi4gVGhpcyBjb2RlIGlzIGZyZWUgZm9yIGFueW9uZSB0byB1c2Ugb3IgbW9kaWZ5IGFzIGxvbmcgYXMgdGhleSBhY2tub3dsZWRnZSBpdCdzIHNvdXJjZSBhbmQgY3JlZGl0IHRoZSBjb250cmlidXRvcnMgYWJvdmUuPGJyIC8+PGJyIC8+PGI+UGh5c2ljYWwgY29uZmlndXJhdGlvbjwvYj46PGJyIC8+VXNlcyBhIENHIENvbG91cm1heCAyIGFzIHRoZSBoYXJkd2FyZSBwbGF0Zm9ybSBhbmQgYW4gQXJkdWlubyBibGFuayBzaGllbGQgcG9wdWxhdGVkIHdpdGggdm9sdGFnZSBkaXZpZGVycyBmb3IgYmF0dGVyeSBhbmQgc29sYXIgdm9sdGFnZXMgYW5kIEFsbGVncm8gQUNTNzU4IGN1cnJlbnQgc2Vuc29ycyBmb3IgaW5wdXQgKGNoYXJnaW5nKSBjdXJyZW50IGFuZCBsb2FkIGN1cnJlbnQuIEJhdHRlcnkgY2hhcmdlL2Rpc2NoYXJnZSBjdXJyZW50IGlzIGNhbGN1bGF0ZWQgYnkgc3VidHJhY3RpbmcgbG9hZCBjdXJyZW50IGZyb20gY2hhcmdpbmcgY3VycmVudC48YnIgLz48YnIgLz5UaGUgMTEuOFYgdG8gMTQuNFYgZnJvbSB0aGUgY2FyYXZhbiBiYXR0ZXJ5IHN5c3RlbSAoZGVwZW5kaW5nIG9uIHdoZXRoZXIgY2hhcmdpbmcgb3IgZHJpdmluZyBsb2FkKSBpcyBmZWQgaW50byBhbiBMTTMxNyB2YXJpYWJsZSB2b2x0YWdlIHJlZ3VsYXRvciB0byBwcm92aWRlIHJlZ3VsYXRlZCA4LjVWIHRvIHRoZSBDR0NNTS48YnIgLz48YnIgLz5XQVJOSU5HOiBUaGUgQWxsZWdybyBjdXJyZW50IHNlbnNvcnMgaGF2ZSBWRVJZIGZyYWdpbGUgbGVhZHMgc28gdGhleSBuZWVkIHRvIGJlIHBoeXNpY2FsbHkgc3RhYmlsaXNlZC4gVGhlIHVuaXRzIEkgdXNlZCB3ZXJlIHVuaWRpcmVjdGlvbmFsIGFuZCBoYWQgYW4gb2Zmc2V0IGFyb3VuZCA2MDBtViBhbmQgYSA2MG1WL2FtcCBjYXBhY2l0eS48YnIgLz48YnIgLz48Yj5BIGdlbmVyYWwgc3lub3BzaXMgb2YgdGhlIHByb2dyYW08L2I+OjxiciAvPjx1bD48bGk+RGlzYWJsZSBpbnRlcnJ1cHRzOzwvbGk+PGxpPkRlZmluZSBhbmQgaW5pdGlhbGlzZSB2YXJpYWJsZXMgYW5kIGNvbnN0YW50czs8L2xpPjxsaT5Jbml0aWFsaXNlIGRpc3BsYXkgd2l0aCBzdGF0aWMgZGF0YTsgaW5pdGlhbGl6ZSAxIG1pbnV0ZSBhcnJheXMgdG8gYWxsb3cgYXZlcmFnaW5nOzwvbGk+PGxpPkVudGVyIG1haW4gbG9vcDsgd2FpdCBmb3IgaW50ZXJydXB0ICggd2hpY2ggc2V0cyBOZXdEYXRhIGZsYWcpIHRoZW4gaGFuZGxlIDIgc2Vjb25kLCAxIG1pbnV0ZSwgMSBob3VyIGFuZCBlbmQgb2YgZGF5ICg2QU0pIG9jY3VycmVuY2VzOzwvbGk+PGxpPlN0YXJ0IG1haW4gbG9vcCwgd2FpdGluZyBmb3IgKHNldCBieSBpbnRlcnJ1cHQgcm91dGluZSk7PC9saT48bGk+Q3ljbGUgdGhyb3VnaCAyIHNlY29uZCwgMSBtaW51dGUsIDEgaG91ciBhbmQgRW5kLW9mLURheSBwcm9jZXNzaW5nIHdpdGggaW5pdGlhbCBkYXRhIGFuZCBkaXNwbGF5IGluaXRpYWwgcmVhZGluZ3M8YnIgLz4tIDIgc2Vjb25kIHJvdXRpbmUgcHJvY2Vzc2VzIGFsbCBpbnN0YW50YW5lb3VzIHJlYWRpbmdzIGZyb20gaW50ZXJydXB0IHJvdXRpbmVzIC0gYmF0dGVyeSB2b2x0YWdlLCBzb2xhciBhcnJheSB2b2x0YWdlLCBpbnB1dCBjdXJyZW50IGZyb20gYm90aCBzb2xhciBjb250cm9sbGVyIGFuZC9vciAyNDBWQUMgYmF0dGVyeSBjaGFyZ2VyPGJyIC8+LSAxIG1pbnV0ZSByb3V0aW5lIGF2ZXJhZ2VzIDMwIHR3byBzZWNvbmQgcmVhZGluZ3MsIHRoZW4gcHVzaGVzIHRoZSBhdmVyYWdlcyBpbnRvIGFuIGFycmF5LCBhbHNvIHdyaXRlcyBvdXQgcnVubmluZyBncmFwaDxiciAvPi0gMSBob3VyIHJvdXRpbmUgdGFrZXMgYXJyYXkgZGF0YSBhbmQgd3JpdGVzIG91dCB0byBmaWxlcyBpbiAuQ1NWIGZvcm1hdDxiciAvPi0gRU9EICggYXQgNkFNICkgY2xvc2VzIGxvZyBmaWxlIGFuZCBjcmVhdGVzIGEgbmV3IGxvZyBmaWxlOzwvbGk+PGxpPkludGVycnVwdCBwcm92aWRlcyBiYXR0ZXJ5IHZvbHRzLCBzb2xhciB2b2x0cywgaW5wdXQgY3VycmVudCBhbmQgbG9hZCBjdXJyZW50LjxiciAvPjwvbGk+PC91bD48YnIgLz48Yj5HbG9iYWwgVmFyaWFibGVzPC9iPjogVGhlc2UgYXJlIGhlcmUganVzdCBmb3IgZXhwbGFuYXRvcnkgcHVycG9zZXMgLSB0aGV5IGFyZSBkZWZpbmVkIGluIHRoZSBwcm9ncmFtIHByb3Blci4gVGhlIGluaXRpYWxpc2VkIHZhbHVlcyBhcmUgdG8gc2ltcGxpZnkgYXZlcmFnaW5nIGFuZCBhbHNvIHJlcHJlc2VudCB0eXBpY2FsIHZhbHVlcy48YnIgLz48Y29kZT48YnIgLz5CVm9sdHMgOiBCYXR0ZXJ5IFZvbHRhZ2UgcmVhZCBmcm9tIFBpbiBBMC4gUmVhZCBhcyAxLzZ0aCBvZiByZWFsIHZvbHRhZ2UgdmlhIDY6MSByZXNpc3RpdmUgZGl2aWRlci48YnIgLz48YnIgLz5CVkFycmF5KDI5KSA6IEJhdHRlcnkgVm9sdHMgMzAgZWxlbWVudCBhcnJheSAtIDEgZWFjaCAyIHNlY3MuPGJyIC8+PGJyIC8+QmF0Q2hhcmdlIDogQmF0dGVyeSBzdGF0ZSBvZiBjaGFyZ2UgYXMgYSBwZXJjZW50YWdlIHdoZXJlIDEyLjc1ViBvciBoaWdoZXIgaXMgMTAwJSwgZG93biB0byAxMi4wNVYsIGJlaW5nIDM1JSAtIGRhbmdlciBsZXZlbC48YnIgLz48YnIgLz5BdmVyYWdlQlYgOiBBdmVyYWdlIGJhdHRlcnkgdm9sdGFnZSBvdmVyIGxhc3QgNjAgc2Vjb25kcy48YnIgLz48YnIgLz5CVkFBcnJheSg1OSkgOiAxIGhvdXJzIHdvcnRoIG9mIG1pbnV0ZSBhdmVyYWdlIGJhdHRlcnkgdm9sdHMuPGJyIC8+PGJyIC8+RGVsdGFCViA6IEJhdHRlcnkgdm9sdGFnZSB2YXJpYXRpb24gb3ZlciA2MCBzZWNvbmRzLiBUaGUgZGlmZmVyZW5jZSBiZXR3ZWVuIHRoZSBmaXJzdCBhbmQgdGhlIGxhc3QgdXNlZCB0byBjYWxjdWxhdGUgdGhlICJUaW1lIHRvIDMwJSBkaXNjaGFyZ2UgcG9pbnQiLjxiciAvPjxiciAvPlRpbWUyRGlzY2hhcmdlIDogVGltZSB0byAzMCUgZGlzY2hhcmdlLjxiciAvPjxiciAvPlNWb2x0cyA6IFNvbGFyIEFycmF5IHZvbHRhZ2UgZnJvbSBQaW4gQTEuIFJlYWQgYXMgMS8xMHRoIG9mIHJlYWwgdm9sdGFnZSBieSAxMDoxIHJlc2lzdGl2ZSBkaXZpZGVyLjxiciAvPjxiciAvPlNWQXJyYXkoMjkpIDogU29sYXIgVm9sdHMgMzAgZWxlbWVudCBhcnJheSAtIDEgZWFjaCAyIHNlY3MuPGJyIC8+PGJyIC8+QXZlcmFnZVNWIDogQXZlcmFnZSBTb2xhciBQYW5lbCB2b2x0cyBvdmVyIGxhc3QgNjAgc2Vjb25kcy48YnIgLz48YnIgLz5TVkFBcnJheSg1OSkgOiAxIGhvdXJzIHdvcnRoIG9mIG1pbnV0ZSBhdmVyYWdlIHNvbGFyIHZvbHRzLjxiciAvPjxiciAvPklucHV0Q3VycmVudCA6IENoYXJnaW5nIGN1cnJlbnQgaW50byBiYXR0ZXJ5L2xvYWQgcmVhZCBmcm9tIFBpbiBBMiAyLjVWIHJlYWRpbmcgPSA1MG1BIGFjcm9zcyB0aGUgc2h1bnQsIHdoaWNoID0gNTBBIHRocm91Z2ggc2h1bnQuIFRoaXMgY2FuIGJlIGJvdGggYmF0dGVyeSBjaGFyZ2luZyBjdXJyZW50IGFuZCBsb2FkIGN1cnJlbnQuPGJyIC8+PGJyIC8+SUNBcnJheSgyOSkgOiBJbnB1dCBDdXJyZW50IDMwIGVsZW1lbnQgYXJyYXkuPGJyIC8+PGJyIC8+QXZlcmFnZUlDIDogQXZlcmFnZSBpbnB1dCAoZ2VuZXJhdG9yKSBjdXJyZW50IG92ZXIgbGFzdCA2MCBzZWNvbmRzLjxiciAvPjxiciAvPklDQUFycmF5KDU5KSA6IGFycmF5IHdpdGggMSBob3VycyB3b3J0aCBvZiBtaW51dGUgYXZlcmFnZSBpbnB1dCBjdXJyZW50cy48YnIgLz48YnIgLz5Mb2FkQ3VycmVudCA6IExvYWQgY3VycmVudCBvZiBjYXJhdmFuIC0gY2FuIGJlIHN1cHBsaWVkIGZyb20gdGhlIGJhdHRlcmllcyBhbmQgdGhlIGNoYXJnaW5nIHN5c3RlbXMgKHNvbGFyLCBBQyBNYWlucyBvciBnZW5lcmF0b3IpLiBQaW4gQTMuPGJyIC8+PGJyIC8+TENBcnJheSgyOSkgOiBMb2FkIEN1cnJlbnQgNjAgZWxlbWVudCBhcnJheS48YnIgLz48YnIgLz5BdmVyYWdlTEMgOiBBdmVyYWdlIGxvYWQgY3VycmVudCBvdmVyIGxhc3QgNjAgc2Vjb25kcy48YnIgLz48YnIgLz5MQ0FBcnJheSg1OSkgOiBhcnJheSB0byBob2xkIDEgaG91cnMgd29ydGggb2YgYXZlcmFnZSBsb2FkIGN1cnJlbnRzLjxiciAvPjxiciAvPkJhdEN1cnJlbnQgOiBBIGNhbGN1bGF0ZWQgdmFsdWU7IGlmIHBvc2l0aXZlLCA9IGEgY2hhcmdpbmcgY3VycmVudCB0byB0aGUgYmF0dGVyeTsgaWYgbmVnYXRpdmUsID0gYSBkaXNjaGFyZ2UgY3VycmVudCBmcm9tIHRoZSBiYXR0ZXJ5LjxiciAvPjxiciAvPkF2ZXJhZ2VCQyA6IEF2ZXJhZ2UgY2hhcmdlL2Rpc2NoYXJnZSBjdXJyZW50IG92ZXIgbGFzdCBtaW4gY2FsY3VsYXRlZCBieSBBdmVyYWdlTEMtQXZlcmFnZUlDLjxiciAvPjxiciAvPklucHV0Q3VycmVudEFIIDogSW5wdXQgY3VycmVudCBhcyBhbiBhbXAgaG91ciBjYWxjdWxhdGVkIHZhbHVlIC0gdGhpcyBpcyBhbiBhY2N1bXVsYXRpbmcgdmFsdWUgb3ZlciAyNCBob3Vycy48YnIgLz48YnIgLz5QcmV2aW91c0lDQUggOiB5ZXN0ZXJkYXlzIElucHV0IEN1cnJlbnQgQUhzLjxiciAvPjxiciAvPkxvYWRDdXJyZW50QUggOiBMb2FkIGN1cnJlbnQgYXMgYW4gYW1wIGhvdXIgY2FsY3VsYXRlZCB2YWx1ZSAtIHRoaXMgaXMgYW4gYWNjdW11bGF0aW5nIHZhbHVlIG92ZXIgMjQgaG91cnMuPGJyIC8+PGJyIC8+UHJldmlvdXNMQ0FIIDogeWVzdGVyZGF5cyBMb2FkIEN1cnJlbnQgQUhzLjxiciAvPjxiciAvPkJhdEN1cnJlbnRBSCA6IEJhdCBjaGFyZ2UgKCt2YWx1ZSkgb3IgZGlzY2hhcmdlICgtdmFsdWUpIGFzIGFuIGFtcCBob3VyIGNhbGN1bGF0ZWQgdmFsdWUgLSBhY2N1bXVsYXRpbmcgdmFsdWUgb3ZlciAyNCBob3Vycy48YnIgLz48YnIgLz5QcmV2aW91c0JDQUggOiB5ZXN0ZXJkYXlzIEJhdCBDdXJyZW50IEFIcy48YnIgLz48YnIgLz5Mb2dBcnJheSQgOiBTdHJpbmcgdG8gdXNlIGZvciBwbHVnZ2luZyBpbnRvIGxvZyBhcnJheTxiciAvPjxiciAvPk5ld0RhdGFGbGFnIDogVHdvIHNlY29uZCBmbGFnIC0gc2V0IGV2ZXJ5IDIgc2Vjb25kcyBieSB0aGUgaW50ZXJydXB0IHJvdXRpbmUgd2hlbiBuZXcgdm9sdGFnZSBhbmQgY3VycmVudCB2YWx1ZXMgYXJlIGNvbGxlY3RlZC48YnIgLz48YnIgLz5NaW5GbGFnIDogTWludXRlIGZsYWcgLSBzZXQgb25jZSBldmVyeSBtaW4gYXQgMDAgc2Vjb25kcyBieSBzZWMgaW50ZXJydXB0IHByb2Nlc3MgYW5kIGNsZWFyZWQgYnkgbWluIHByb2Nlc3NpbmcgY29kZS48YnIgLz48YnIgLz5Ib3VyRmxhZyA6IEhvdXIgRmxhZyAtIHNldCBvbiB0aGUgaG91ciB0byBlbmFibGUgd3JpdGluZyB0aGUgNjAgYXZlcmFnZSByZWFkaW5ncyBpbiB0aGUgbG9nIGFycmF5IHRvIGJlIHdyaXR0ZW4gdG8gZmlsZTxiciAvPjxiciAvPkVPREZsYWcgOiBFbmQgb2YgRGF5IEZsYWcgLSBzZXQgYXQgNkFNIHRvIGVuYWJsZSBkYWlseSBsb2cgZmlsZSB0byBiZSBjbG9zZWQgYW5kIG5ldyBsb2cgZmlsZSBjcmVhdGVkIGJ5IExvZ0ZpbGVDcmVhdGUgc3Vicm91dGluZTxiciAvPjwvY29kZT48YnIgLz48YnIgLz48Yj5DVkJNMjA0LkJBUzwvYj46PGJyIC8+PHByZT4NCiYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5Ow0KJyBCYXR0ZXJ5IE1hbmFnZW1lbnQgUHJvZ3JhbSBmb3IgQ2FyYXZhbiAxMlYgU3lzdGVtICAgICAgICAnDQonIENvcHlyaWdodCBEb3VnIFBhbmtodXJzdCBNYXkgMjAxMiAgICAgICAgICAgICAgICAgICAgICAgICcNCicgV3JpdHRlbiBmb3IgTU1CYXNpYyBWNC4zYSwgY29weXJpZ2h0IEdlb2ZmIEdyYWhhbSAyMDEyICAgJw0KJiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7DQonIEZpbGUgVmVyc2lvbiYjNTg7ICAgIDIuMDQgTWF5IDIwMTMNCicNCicgRm9yIGEgZGV0YWlsZWQgZXhwbGFuYXRpb24gb2YgdGhlIHByb2dyYW0sIGl0J3MNCicgY29uc3RydWN0aW9uIGFuZCByYXRpb25hbGUsIHBsZWFzZSByZWFkIHRoZQ0KJyBDVkJNUkVBRC5UWFQgZmlsZS4NCg0KJyBNYWluIEVudHJ5IHRvIFByb2dyYW0NCg0KRW50cnlQb2ludCYjNTg7ICBTZXRUaWNrIDAsMCAgICAgJyBEaXNhYmxlIHRpbWVyIGludGVycnVwdA0KDQonIEdsb2JhbCBWYXJpYWJsZXMgLSBpbml0aWFsaXNlZCB0byBkZWZhdWx0IHZhbHVlcw0KQlZvbHRzID0gMTIuOCAgICAnICBCYXR0ZXJ5IFZvbHRhZ2UgcmVhZCBmcm9tIFBpbiBBMC4gUmVhZCBhcw0KJyAxLzZ0aCBvZiByZWFsIHZvbHRhZ2UgdmlhIDYmIzU4OzEgcmVzaXN0aXZlIGRpdmlkZXINCg0KRGltIEJWQXJyYXkoMjkpICAnIEJhdHRhcnkgVm9sdHMgMzAgZWxlbWVudCBhcnJheSAtIDEgZWFjaCAyIHNlY3MNCg0KQmF0Q2hhcmdlID0gMTAwICAnIEJhdHRlcnkgc3RhdGUgb2YgY2hhcmdlIGFzIGEgcGVyY2VudGFnZSB3aGVyZQ0KJyAxMi43NVYgb3IgaGlnaGVyIGlzIDEwMCUsIGRvd24gdG8gMTIuMDVWIGJlaW5nIDM1JSAtIGRhbmdlciBsZXZlbA0KDQpBdmVyYWdlQlY9MTIuOCAgICcgQXZlcmFnZSBiYXR0ZXJ5IHZvbHRhZ2Ugb3ZlciBsYXN0IDYwIHNlY29uZHMNCg0KRGltIEJWQUFycmF5KDU5KSAnIDEgaG91cnMgd29ydGggb2YgbWludXRlIGF2ZXJhZ2UgYmF0dGVyeSB2b2x0cw0KDQpEZWx0YUJWID0gMC4xICAgICcgQmF0dGVyeSB2b2x0YWdlIHZhcmlhdGlvbiBvdmVyIDYwIHNlY29uZHMuIFRoZQ0KJyBkaWZmZXJlbmNlIGJldHdlZW4gdGhlIGZpcnN0IGFuZCB0aGUgbGFzdCB1c2VkIHRvDQonIGNhbGN1bGF0ZSB0aGUgIlRpbWUgdG8gMzAlIGRpc2NoYXJnZSBwb2ludCINCg0KVGltZTJEaXNjaGFyZ2UgPSAyMCAnIFRpbWUgdG8gMzAlIGRpc2NoYXJnZQ0KDQpTVm9sdHMgPSAyMCAgICAgICcgU29sYXIgQXJyYXkgdm9sdGFnZSBmcm9tIFBpbiBBMS4gUmVhZCBhcyAxLzEwdGgNCicgb2YgcmVhbCB2b2x0YWdlIGJ5IDEwJiM1ODsxIHJlc2lzdGl2ZSBkaXZpZGVyDQoNCkRpbSBTVkFycmF5KDI5KSAgJyBTb2xhciBWb2x0cyAzMCBlbGVtZW50IGFycmF5IC0gMSBlYWNoIDIgc2Vjcw0KDQpBdmVyYWdlU1YgPSAyMSAgICcgQXZlcmFnZSBTb2xhciBQYW5lbCB2b2x0cyBvdmVyIGxhc3QgNjAgc2Vjb25kcw0KDQpEaW0gU1ZBQXJyYXkoNTkpICcgMSBob3VycyB3b3J0aCBvZiBtaW51dGUgYXZlcmFnZSBzb2xhciB2b2x0cw0KDQpJbnB1dEN1cnJlbnQgPSAxOCAgJyBDaGFyZ2luZyBjdXJyZW50IGludG8gYmF0dGVyeS9sb2FkIHJlYWQgZnJvbSBQaW4gQTINCicgMi41ViByZWFkaW5nID0gNTBtQSBhY3Jvc3MgdGhlIHNodW50LCB3aGljaCBlcXVhbHMgNTBBIHRocm91Z2ggdGhlIHNodW50Lg0KJyBUaGlzIGNhbiBiZSBib3RoIGJhdHRlcnkgY2hhcmdpbmcgY3VycmVudCBhbmQgbG9hZCBjdXJyZW50Lg0KDQpEaW0gSUNBcnJheSgyOSkgICcgSW5wdXQgQ3VycmVudCAzMCBlbGVtZW50IGFycmF5DQoNCkF2ZXJhZ2VJQyA9IDE4ICAgJyBBdmVyYWdlIGlucHV0IChnZW5lcmF0b3IpIGN1cnJlbnQgb3ZlciBsYXN0IDYwIHNlY29uZHMNCg0KRGltIElDQUFycmF5KDU5KSAnIGFycmF5IHdpdGggMSBob3VycyB3b3J0aCBvZiBtaW51dGUgYXZlcmFnZSBpbnB1dCBjdXJyZW50cw0KDQpMb2FkQ3VycmVudCA9IDEyICcgTG9hZCBjdXJyZW50IG9mIGNhcmF2YW4gLSBjYW4gYmUgc3VwcGxpZWQgZnJvbSB0aGUNCicgYmF0dGVyaWVzIGFuZCB0aGUgY2hhcmdpbmcgc3lzdGVtcyAoc29sYXIsIEFDIE1haW5zIG9yIGdlbmVyYXRvcikuIFBpbiBBMw0KDQpEaW0gTENBcnJheSgyOSkgICcgTG9hZCBDdXJyZW50IDYwIGVsZW1lbnQgYXJyYXkNCg0KQXZlcmFnZUxDID0gMTIgICAnIEF2ZXJhZ2UgbG9hZCBjdXJyZW50IG92ZXIgbGFzdCA2MCBzZWNvbmRzDQoNCkRpbSBMQ0FBcnJheSg1OSkgJyBhcnJheSB0byBob2xkIDEgaG91cnMgd29ydGggb2YgYXZlcmFnZSBsb2FkIGN1cnJlbnRzDQoNCkJhdEN1cnJlbnQgPSA2ICAgJyBBIGNhbGN1bGF0ZWQgdmFsdWU7IGlmIHBvc2l0aXZlLCA9IGEgY2hhcmdpbmcgY3VycmVudCB0bw0KJyB0aGUgYmF0dGVyeTsgaWYgbmVnYXRpdmUsIGVxdWFscyBhIGRpc2NoYXJnZSBjdXJyZW50IGZyb20gdGhlIGJhdHRlcnkuDQoNCkF2ZXJhZ2VCQyA9IDYgICAgJyBBdmVyYWdlIGNoYXJnZS9kaXNjaGFyZ2UgY3VycmVudCBvdmVyIGxhc3QgbWluDQonIGNhbGN1bGF0ZWQgYnkgQXZlcmFnZUxDLUF2ZXJhZ2VJQw0KDQpJbnB1dEN1cnJlbnRBSCA9IDAgJyBJbnB1dCBjdXJyZW50IGFzIGFuIGFtcCBob3VyIGNhbGN1bGF0ZWQgdmFsdWUgLQ0KJyB0aGlzIGlzIGFuIGFjY3VtdWxhdGluZyB2YWx1ZSBvdmVyIDI0IGhvdXJzDQoNClByZXZpb3VzSUNBSCA9IDAgICAnIHllc3RlcmRheXMgSW5wdXQgQ3VycmVudCBBSHMNCg0KTG9hZEN1cnJlbnRBSCA9IDAgICcgTG9hZCBjdXJyZW50IGFzIGFuIGFtcCBob3VyIGNhbGN1bGF0ZWQgdmFsdWUgLQ0KJyB0aGlzIGlzIGFuIGFjY3VtdWxhdGluZyB2YWx1ZSBvdmVyIDI0IGhvdXJzDQoNClByZXZpb3VzTENBSCA9IDAgICAnIHllc3RlcmRheXMgTG9hZCBDdXJyZW50IEFIcw0KDQpCYXRDdXJyZW50QUggPSAwICAgJyBCYXQgY2hhcmdlIChwb3MgdmFsdWUpIG9yIGRpc2NoYXJnZSAobmVnIHZhbHVlKQ0KJyBhcyBhbiBhbXAgaG91ciBjYWxjdWxhdGVkIHZhbHVlICAtIGFjY3VtdWxhdGluZyB2YWx1ZSBvdmVyIDI0IGhvdXJzDQoNClByZXZpb3VzQkNBSCA9IDUgICAnIHllc3RlcmRheXMgQmF0IEN1cnJlbnQgQUhzDQoNCkxvZ0FycmF5JCA9ICIiICAgICAnIFN0cmluZyB0byB1c2UgZm9yIHBsdWdnaW5nIGludG8gbG9nIGFycmF5DQoNCk5ld0RhdGFGbGFnID0gMCAgICAnIFR3byBzZWNvbmQgZmxhZyAtIHNldCBldmVyeSAyIHNlY29uZHMgYnkgdGhlDQonIGludGVycnVwdCByb3V0aW5lIHdoZW4gbmV3IHZvbHRhZ2UgYW5kIGN1cnJlbnQgdmFsdWVzIGFyZSBjb2xsZWN0ZWQuDQoNCk1pbkZsYWcgPSAwICAgICAgICAnIE1pbnV0ZSBmbGFnIC0gc2V0IG9uY2UgZXZlcnkgbWluIGF0IDAwIHNlY29uZHMNCicgYnkgc2VjIGludGVycnVwdCBwcm9jZXNzIGFuZCBjbGVhcmVkIGJ5IG1pbiBwcm9jZXNzaW5nIGNvZGUuDQoNCkhvdXJGbGFnID0gMCAgICAgICAnIEhvdXIgRmxhZyAtIHNldCBvbiB0aGUgaG91ciB0byBlbmFibGUNCicgd3JpdGluZyB0aGUgNjAgYXZlcmFnZSByZWFkaW5ncyBpbiB0aGUgbG9nIGFycmF5IHRvIGJlIHdyaXR0ZW50IHRvIGZpbGUNCg0KRU9ERmxhZyA9IDAgICAgICAgICcgRW5kIG9mIERheSBGbGFnIC0gc2V0IGF0IDZBTSB0byBlbmFibGUgZGFpbHkgbG9nIGZpbGUNCicgdG8gYmUgY2xvc2VkIGFuZCBuZXcgbG9nIGZpbGUgY3JlYXRlZCBieSBMb2dGaWxlQ3JlYXRlIHN1YnJvdXRpbmUNCg0KJiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5Ow0KJyBDYXJyeSBvdXQgaW5pdGlhbGlzYXRpb24gcm91dGluZXMgaGVyZSAtIGVuYWJsZSBpbnRlcnJ1cHQgbGFzdA0KDQpFbnRyeSYjNTg7DQpNb2RlIDMsNyAgICAgJyA4IGNvbG91ciBtb2RlIHdoaXRlIG9uIGJsYWNrDQpDb2xvdXIgV2hpdGUsQmxhY2sNCkNscw0KDQonIERpc3BsYXkgYWxsIHN0YXRpYyBkYXRhDQpPcHRpb24gVVNCIE9mZiAgICAnIG9ubHkgdG8gVkdBDQpEaXNwbGF5U3RhdGljDQpCYXJHcmFwaA0KJyBDcmVhdGUgTG9nIEZpbGUgb24gcHJvZ3JhbSBlbnRyeSBhbmQgdGhlbiBhdCBzdGFydCBvZiBuZXcgZGF5IC0gNkFNDQpDcmVhdGVMb2dGaWxlDQoNCicgU2V0IHVwIGFsbCBpbml0aWFsIHZhbHVlcyB0byBkZWZhdWx0IGZvciBvcmRlcmx5IGVudHJ5Lg0KUHJldmlvdXNJQ0FIID0gNTANClByZXZpb3VzTENBSCA9IDQ1DQpQcmV2aW91c0JDQUggPSA1DQpPbGRBQlYgPSAxMw0KTEZBUG9pbnRlciA9IDANCg0KJyBGaWxsIHRoZSBhcnJheXMNCkZvciBBeD0wIFRvIDI5DQogIEJWQXJyYXkoQXgpID0gMTIuOA0KICBTVkFycmF5KEF4KSA9IDE5DQogIElDQXJyYXkoQXgpID0gMTgNCiAgTENBcnJheShBeCkgPSAxMg0KTmV4dCBBeA0KDQonIFdhaXQgdW50aWwgMDAgc2Vjb25kcyB0byBzdGFydCBmb3IgY2xlYW4gZW50cnkuDQpEbyBXaGlsZSBWYWwoTWlkJChUaW1lJCw3LDIpKSAmbHQ7Jmd0OyA1OA0KTG9vcA0KDQonIEVuYWJsZSB0aW1lciB0aWNrIGludGVycnVwdHMgdG8gc3RhcnQgZGF0YSBjb2xsZWN0aW9uIGF0IDAwIHNlY29uZHMNClNldFRpY2sgMjAwMCxHZXREYXRhICAgJyBFdmVyeSBvdGhlciBzZWNvbmQsIGdldCBiYXR0ZXJ5IHZvbHRhZ2UgYW5kIGN1cnJlbnQNCicgZGF0YSB0aHJvdWdoIHRoZSBHZXREYXRhIGludGVycnVwdCByb3V0aW5lLg0KDQonIGVuZCBvZiBpbml0aWFsaXNhdGlvbiByb3V0aW5lcw0KJiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5Ow0KJyBNYWluIHByb2dyYW0gbG9vcA0KDQpNYWluJiM1ODsNCkRvIFdoaWxlIE5ld0RhdGFGbGFnID0gMCAgICcgd2FpdCB1bnRpbCBpbnRlcnJ1cHQgcHJvdmlkZXMgZnJlc2ggZGF0YQ0KTG9vcA0KDQomIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7DQonIDIgc2Vjb25kIHByb2Nlc3NpbmcgY29kZQ0KJyBXcml0ZSBvdXQgdGltZSBhbmQgZGF0ZSB0byBkaXNwbGF5DQpQcmludCBAKDEsMSlUaW1lJCArICIgICAiICsgRGF0ZSQNCg0KJyBQdXNoIG1vc3QgcmVjZW50IHZhbHVlcyBpbnRvIGFycmF5cyBmb3IgbWludXRlIGF2ZXJhZ2luZw0KRm9yIEF4ID0gMjkgVG8gMSBTdGVwIC0xDQogIEJWQXJyYXkoQXgpID0gQlZBcnJheShBeC0xKQ0KICBTVkFycmF5KEF4KSA9IFNWQXJyYXkoQXgtMSkNCiAgSUNBcnJheShBeCkgPSBJQ0FycmF5KEF4LTEpDQogIExDQXJyYXkoQXgpID0gTENBcnJheShBeC0xKQ0KTmV4dCBBeA0KQlZBcnJheSgwKSA9IEJWb2x0cw0KU1ZBcnJheSgwKSA9IFNWb2x0cw0KSUNBcnJheSgwKSA9IElucHV0Q3VycmVudA0KTENBcnJheSgwKSA9IExvYWRDdXJyZW50DQonIENoYXJnZS9EaXNjaGFyZ2UgQ3VycmVudCBpcyBJbnB1dEN1cnJlbnQtTG9hZEN1cnJlbnQgLSBpZiBwb3NpdGl2ZQ0KJyAgaXQgaXMgYSBjaGFyZ2luZyBjdXJyZW50IGludG8gYmF0dGVyeSwgaWYgbmVnYXRpdmUsIGl0IGlzIGENCicgIGRpc2NoYXJnaW5nIGN1cnJlbnQgb3V0IG9mIGJhdHRlcnkNCkJhdEN1cnJlbnQgPSBJbnB1dEN1cnJlbnQtTG9hZEN1cnJlbnQNCg0KJyBDb252ZXJ0IGJvdGggaW5wdXQsIG91dHB1dCAmYW1wOyBiYXR0ZXJ5IGluc3RhbnRhbmVvdXMgY3VycmVudHMgaW50byBBbXAgSG91cnMNCklucHV0Q3VycmVudEFIID0gSW5wdXRDdXJyZW50QUggKyAoSW5wdXRDdXJyZW50LzE4MDApICcgdXNlIDIgc2VjIGludGVycnVwdA0KTG9hZEN1cnJlbnRBSCA9IExvYWRDdXJyZW50QUggKyAoTG9hZEN1cnJlbnQvMTgwMCkgICAgJyByYXRlIGZvciBjYWxjdWxhdGlvbg0KQmF0Q3VycmVudEFIID0gSW5wdXRDdXJyZW50QUgtTG9hZEN1cnJlbnRBSA0KDQonIE5vdGUmIzU4OyBBbGwgQUggYWNjdW11bGF0aW5nIHRvdGFscyBhcmUgcGx1Z2dlZCBpbnRvIGxhc3QgZGF5IHZhbHVlcw0KJyB0aGVuIHJlc2V0IHRvIHplcm8gYXQgNkFNIC0gbm93IHVwZGF0ZSB0ZXJtaW5hbCBkaXNwbGF5IHdpdGggYWxsIHZhbHVlcw0KRm9udCAmIzM1OzINCkNvbG91ciAyDQpQcmludCBAKDM3MiwyNSlGb3JtYXQkKEJhdENoYXJnZSwiJTMuMGYiKSsiJSINCkZvbnQgJiMzNTsxDQpDb2xvdXIgNw0KUHJpbnQgQCgxMjMsNDUpRm9ybWF0JChCVm9sdHMsIiU1LjJmViIpDQpQcmludCBAKDEyMyw1NilGb3JtYXQkKFNWb2x0cywiJTUuMmZWIikNClByaW50IEAoMTIzLDY3KUZvcm1hdCQoSW5wdXRDdXJyZW50LCIlNS4yZkEiKQ0KUHJpbnQgQCgxMjMsNzgpRm9ybWF0JChMb2FkQ3VycmVudCwiJTUuMmZBIikNClByaW50IEAoMzEyLDQ1KUZvcm1hdCQoQXZlcmFnZUJWLCIlNS4yZlYiKQ0KUHJpbnQgQCgzMTIsNTYpRm9ybWF0JChBdmVyYWdlU1YsIiU1LjJmViIpDQpGb250ICYjMzU7Mg0KQ29sb3VyIDcNClByaW50IEAoNDIwLDE4NClGb3JtYXQkKEF2ZXJhZ2VCViwiJTQuMWYiKQ0KQ29sb3VyIDMNClByaW50IEAoNDIwLDIzMilGb3JtYXQkKEF2ZXJhZ2VTViwiJTQuMWYiKQ0KQ29sb3VyIDcNCkZvbnQgJiMzNTsxDQpQcmludCBAKDM3NiwxNDkpRm9ybWF0JChUaW1lMkRpc2NoYXJnZSwiJTQuMGYgbWluIikNClByaW50IEAoMzEyLDY3KUZvcm1hdCQoQXZlcmFnZUlDLCIlNS4xZkEiKQ0KUHJpbnQgQCgzMTIsNzgpRm9ybWF0JChBdmVyYWdlTEMsIiU1LjFmQSIpDQpDb2xvdXIgNg0KRm9udCAmIzM1OzINClByaW50IEAoNDIwLDI4NSlGb3JtYXQkKEF2ZXJhZ2VJQywiJTQuMWYiKQ0KQ29sb3VyIDUNClByaW50IEAoNDIwLDM0MClGb3JtYXQkKEF2ZXJhZ2VMQywiJTQuMWYiKQ0KQ29sb3VyIDcNCkZvbnQgJiMzNTsxDQpQcmludCBAKDExNywxMjcpRm9ybWF0JChJbnB1dEN1cnJlbnRBSCwiJTUuMWZhaHJzIikNClByaW50IEAoMTE3LDEzOClGb3JtYXQkKExvYWRDdXJyZW50QUgsIiU1LjFmYWhycyIpDQpJZiAoU2duKEJhdEN1cnJlbnRBSCkgPSArMSkgVGhlbg0KICBDb2xvdXIgMg0KICBQcmludCBAKDExNywxNDkpRm9ybWF0JChCYXRDdXJyZW50QUgsIiUrNS4xZmFocnMiKQ0KRWxzZQ0KICBDb2xvdXIgNA0KICBQcmludCBAKDExNywxNDkpRm9ybWF0JChCYXRDdXJyZW50QUgsIiUrNS4xZmFocnMiKQ0KRW5kSWYNCkNvbG91ciA3DQpQcmludCBAKDMxMiwxMjcpRm9ybWF0JChQcmV2aW91c0lDQUgsIiU1LjFmYWhycyIpDQpQcmludCBAKDMxMiwxMzgpRm9ybWF0JChQcmV2aW91c0xDQUgsIiU1LjFmYWhycyIpDQpJZiAoU2duKFByZXZpb3VzQkNBSCkgPSArMSkgVGhlbg0KICBDb2xvdXIgMg0KICBQcmludCBAKDMxMiwxNDkpRm9ybWF0JChQcmV2aW91c0JDQUgsIiUrNS4xZmFocnMiKQ0KRWxzZQ0KICBDb2xvdXIgNA0KICBQcmludCBAKDMxMiwxNDkpRm9ybWF0JChQcmV2aW91c0JDQUgsIiUrNS4xZmFocnMiKQ0KRW5kSWYNCkNvbG91ciA3DQpJZiAoU2duKEF2ZXJhZ2VCQykgPSArMSkgVGhlbg0KICBDb2xvdXIgMg0KICBQcmludCBAKDMxMiw4OSlGb3JtYXQkKEF2ZXJhZ2VCQywiJSs1LjFmQSIpDQogIEZvbnQgJiMzNTsyDQogIFByaW50IEAoNDE4LDQxMClGb3JtYXQkKEF2ZXJhZ2VCQywiJSs0LjFmIikNCiAgRm9udCAmIzM1OzENCkVsc2UNCiAgQ29sb3VyIDQNCiAgUHJpbnQgQCgzMTIsODkpRm9ybWF0JChBdmVyYWdlQkMsIiUrNS4xZkEiKQ0KICBGb250ICYjMzU7Mg0KICBQcmludCBAKDQxOCw0MTApRm9ybWF0JChBdmVyYWdlQkMsIiUrNC4xZiIpDQogIEZvbnQgJiMzNTsxDQpFbmRJZg0KSWYgKFNnbihCYXRDdXJyZW50KSA9ICsxKSBUaGVuDQogIENvbG91ciAyDQogIFByaW50IEAoMTIzLDg5KUZvcm1hdCQoQmF0Q3VycmVudCwiJSs1LjJmQSIpDQpFbHNlDQogIENvbG91ciA0DQogIFByaW50IEAoMTIzLDg5KUZvcm1hdCQoQmF0Q3VycmVudCwiJSs1LjJmQSIpDQpFbmRJZg0KQ29sb3VyIDcNCk5ld0RhdGFGbGFnID0gMCAgICAgICcgY2xlYXIgbmV3IGRhdGEgZmxhZyByZWFkeSBmb3IgbmV4dCBpbnRlcnJ1cHQNCicNCicgRW5kIG9mIHR3byBzZWNvbmQgcHJvY2Vzc2luZyBjb2RlLCBub3cgY2hlY2sgZm9yIG1pbnV0ZSwgaG91ciBvciBlbmQgb2YNCicgZGF5IGZsYWdzIGFuZCBwcm9jZXNzIGFjY29yZGluZ2x5DQomIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7DQonIENoZWNrIGZvciBtaW51dGUgZmxhZywgY2FsY3VsYXRlIHRoZSBhdmVyYWdlIG9mIHRoZSBsYXN0IDYwIHNlY29uZHMgb2YNCicgcmVhZGluZ3MsIHBsdWcgdGhlbSBpbnRvIHRoZSBsb2cgZmlsZSBhcnJheSBhdCB0aGUgbG9nIGZpbGUgYXJyYXkgcG9pbnRlcg0KSWYgTWluRmxhZyA9IDEgVGhlbg0KICAnIGNhbGN1bGF0ZSBhdmVyYWdlIGZvciBsYXN0IG1pbnV0ZQ0KICBPbGRBQlYgPSBBdmVyYWdlQlYNCiAgT2xkQVNWID0gQXZlcmFnZVNWDQogIEF2ZXJhZ2VCViA9IDANCiAgQXZlcmFnZVNWID0gMA0KICBBdmVyYWdlSUMgPSAwDQogIEF2ZXJhZ2VMQyA9IDANCiAgRm9yIEF4ID0gMCBUbyAyOSAgICdkb24ndCBmb3JnZXQgb25seSBzYW1wbGVkIGV2ZXJ5IDIgc2Vjcw0KICAgIEF2ZXJhZ2VCViA9IEF2ZXJhZ2VCViArIEJWQXJyYXkoQXgpDQogICAgQXZlcmFnZVNWID0gQXZlcmFnZVNWICsgU1ZBcnJheShBeCkNCiAgICBBdmVyYWdlSUMgPSBBdmVyYWdlSUMgKyBJQ0FycmF5KEF4KQ0KICAgIEF2ZXJhZ2VMQyA9IEF2ZXJhZ2VMQyArIExDQXJyYXkoQXgpDQogIE5leHQgQXgNCiAgQXZlcmFnZUJWID0gQXZlcmFnZUJWLzMwDQogIEF2ZXJhZ2VTViA9IEF2ZXJhZ2VTVi8zMA0KICBBdmVyYWdlSUMgPSBBdmVyYWdlSUMvMzANCiAgQXZlcmFnZUxDID0gQXZlcmFnZUxDLzMwDQogIEF2ZXJhZ2VCQyA9IEF2ZXJhZ2VJQyAtIEF2ZXJhZ2VMQw0KICAnIENhbGN1bGF0ZSBiYXR0ZXJ5IGNoYW5nZSBhcyBwZXJjZW50YWdlIGFuZCBmaWxsIGNoYXJnZSBzdGF0ZSBncmFwaA0KICAnIG5vdyBjYWxjdWxhdGUgY2hhcmdlIGFuZCBwYWludCBjYXBhY2l0eSBncmFwaA0KICAnIDEyLjFWIGVxdWF0ZXMgdG8gMzAlIGNoYXJnZQ0KICBCYXRDaGFyZ2UgPSBJbnQoKEF2ZXJhZ2VCViAtIDExLjc1KSAmIzQyOyAxMDApDQogIElmIEJhdENoYXJnZSAmbHQ7IDMwIFRoZW4gQmF0Q2hhcmdlID0gMzANCiAgSWYgQmF0Q2hhcmdlICZndDsgMTAwIFRoZW4gQmF0Q2hhcmdlID0gMTAwDQogIEZpbGxCYXJHcmFwaChCYXRDaGFyZ2UpDQoNCiAgJyBDYWxjdWxhdGUgdGltZSB0byAzMCUgZGlzY2hhcmdlIG9mIGJhdHRlcnkNCiAgRGVsdGFCViA9IE9sZEFCViAtIEF2ZXJhZ2VCVg0KICBJZiBTZ24oRGVsdGFCVikgPSArMSBUaGVuDQogICAgICAgRFZSYXRlID0gQlZBcnJheSgwKSAgICAgICAgICcgc2V0IGluaXRpYWwgdmFsdWVzIGZvciByYXRlIG9mDQogICAgVGltZTJEaXNjaGFyZ2UgPSAwICAgICAgICAgICAgICcgZGlzY2hhcmdlIGFuZCB0aW1lIHRvIGRpc2NoYXJnZQ0KICAgIERvIFdoaWxlIERWUmF0ZSAmZ3Q7IDEyLjEgICAgICAgICAnIDEyLjEgdm9sdHMgZXF1YXRlcyB0byAzMCUgZGlzY2hhcmdlDQogICAgICBEVlJhdGUgPSBEVlJhdGUgLSBEZWx0YUJWICAgICcgbG9vcCB0aHJvdWdoIGNhbGN1bGF0aW5nIHRoZSBhbW91bnQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyBvZiB0aW1lIHRvIGdldCB0aGUgY3VycmVudCB2b2x0YWdlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgZG93biB0byB0aGUgMzAlIGRpc2NoYXJnZSBwb2ludA0KICAgICAgVGltZTJEaXNjaGFyZ2UgPSBUaW1lMkRpc2NoYXJnZSArIDEgJyBpbmMgbWludXRlcyB0byBkaXNjaGFyZ2UgY291bnQNCiAgICBMb29wDQogIEVsc2UNCiAgICBQcmludCBAKDM3NiwxNDkpIkNoYXJnaW5nICIgICAnIGlmIGN1cnJlbnQgdm9sdGFnZSBpcyBncmVhdGVyIHRoYW4NCiAgRW5kSWYgICAgICAgICAgICAgICAgICAgICAgICAgICAgJyBwcmV2aW91cyBtaW51dGUNCiAgQlZBQXJyYXkoTEZBUG9pbnRlcikgPSBBdmVyYWdlQlYgICcgdXBkYXRlIGF2ZXJhZ2UgYXJyYXlzDQogIFNWQUFycmF5KExGQVBvaW50ZXIpID0gQXZlcmFnZVNWDQogIElDQUFycmF5KExGQVBvaW50ZXIpID0gQXZlcmFnZUlDDQogIExDQUFycmF5KExGQVBvaW50ZXIpID0gQXZlcmFnZUxDDQogIExGQVBvaW50ZXIgPSBMRkFQb2ludGVyICsgMSAgICAgICAgICAnIExGQSBwb2ludGVyIHJlc2V0IGJ5IGVvZCByb3V0aW5lDQoNCicgTm93IHBhaW50IG91dCBydW5uaW5nIGdyYXBoDQonIC0gZmlyc3Qgd29yayBvdXQgdGhlIGN1cnJlbnQgbWludXRlIGhvdXIgY29tYm8gaW4gbWludXRlcw0KICByZ19taW5zID0gPGRpdiBjbGFzcz0iYm94Ij5WYWwoTWlkJChUaW1lJCwxLDIpKSBNb2QgNikmIzQyOzYwKSkrKFZhbChNaWQkKFRpbWUkLDQsMjwvZGl2Pg0KICByZ19taW5zID0gcmdfbWlucyArIDMwICAgICAgICAgICAgICAgJyBvZmZzZXQgdG8gc3RhcnQgb2YgZ3JhcGgNCiAgcmdfYWJ2ID0gNDEyIC0gSW50KChBdmVyYWdlQlYtOCkgJiM0MjsgMTApDQogICAgSWYgcmdfYWJ2ICZndDsgNDEyIFRoZW4gcmdfYWJ2ID0gNDEyDQogIHJnX2FzdiA9IDQxMiAtIEludCgoQXZlcmFnZVNWLTgpICYjNDI7IDEwKQ0KICAgIElmIHJnX2FzdiAmZ3Q7IDQxMiBUaGVuIHJnX2FzdiA9IDQxMg0KICAgIElmIHJnX2FzdiAmbHQ7IDE2MyBUaGVuIHJnX2FzdiA9IDE2Mw0KICByZ19haWMgPSA0MTIgLSBJbnQoQXZlcmFnZUlDICYjNDI7IDUpDQogIHJnX2FsYyA9IDQxMiAtIEludChBdmVyYWdlTEMgJiM0MjsgNSkNCiAgSWYgKFNnbihBdmVyYWdlQkMpID0gKzEpIFRoZW4NCiAgICByZ19hYmMgPSA0MTIgLSBJbnQoQXZlcmFnZUJDICYjNDI7IDUpDQogIEVsc2UNCiAgICByZ19hYmMgPSA0MTIgKyBJbnQoQXZlcmFnZUJDICYjNDI7IDUpDQogIEVuZElmDQogIEZvciB5cmcgPSAxNjMgVG8gNDEyIFN0ZXAgMQ0KICAgIElmIHJnX2FiYyA9IHlyZyBUaGVuDQogICAgICBJZiAoU2duKEF2ZXJhZ2VCQykgPSArMSkgVGhlbg0KICAgICAgICBQaXhlbChyZ19taW5zLHlyZykgPSAyDQogICAgICBFbHNlDQogICAgICAgIFBpeGVsKHJnX21pbnMseXJnKSA9IDQNCiAgICAgIEVuZElmDQogICAgRWxzZQ0KICAgICAgUGl4ZWwocmdfbWlucyx5cmcpID0gMA0KICAgIEVuZElmDQogICAgSWYgcmdfYWJ2ID0geXJnIFRoZW4NCiAgICAgIFBpeGVsKHJnX21pbnMseXJnKSA9IDcNCiAgICBFbmRJZg0KICAgIElmIHJnX2FzdiA9IHlyZyBUaGVuDQogICAgICBQaXhlbChyZ19taW5zLHlyZykgPSAzDQogICAgRW5kSWYNCiAgICBJZiByZ19haWMgPSB5cmcgVGhlbg0KICAgICAgUGl4ZWwocmdfbWlucyx5cmcpID0gNg0KICAgIEVuZElmDQogICAgSWYgcmdfYWxjID0geXJnIFRoZW4NCiAgICAgIFBpeGVsKHJnX21pbnMseXJnKSA9IDUNCiAgICBFbmRJZg0KICAgIExpbmUocmdfbWlucysxLHlyZyktKHJnX21pbnMrMyx5cmcpLDANCiAgTmV4dCB5cmcNCg0KICBNaW5GbGFnID0gMCAgICcgcmVzZXQgdGhlIG1pbiBmbGFnDQpFbmRJZg0KJyBFbmQgb2YgbWludXRlIGNvZGUNCiYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsNCicgQ2hlY2sgZm9yIGhvdXIgZmxhZyAtIGlmIHRydWUgdGhlbiBhcHBlbmQgbG9nIGFycmF5IG91dCB0byBmaWxlDQonICh3ZSB3YW50IHRvIGxpbWl0IGxvZyBmaWxlIHdyaXRlcyB0byAyNCBwZXIgZGF5IHRvIGtlZXANCicgU0QgY2FyZCB3cml0ZXMgYXMgbG93IGFzIHBvc3NpYmxlKS4NCg0KSWYgSG91ckZsYWcgPSAxIFRoZW4gICAgICAgICcgc2V0IGVhY2ggaG91ciBpbiBpbnRlcnJ1cHQgcm91dGluZQ0KICBMb2dBcnJheSQgPSAiIg0KICBGb3IgeD0wIFRvIDU5IFN0ZXAgMSAgJyBnZXQgdGhlIGF2ZXJhZ2UgdmFsdWVzIGZyb20gZWFjaCBhdmVyYWdlIGFycmF5DQogICAgTG9nQXJyYXkkID0gTG9nQXJyYXkkK0Zvcm1hdCQoQlZBQXJyYXkoeCksIiUrNi4yZlYiKStDaHIkKDQ0KQ0KICAgIExvZ0FycmF5JCA9IExvZ0FycmF5JCtGb3JtYXQkKFNWQUFycmF5KHgpLCIlKzYuMmZWIikrQ2hyJCg0NCkNCiAgICBMb2dBcnJheSQgPSBMb2dBcnJheSQrRm9ybWF0JChJQ0FBcnJheSh4KSwiJSs1LjFmQSIpK0NociQoNDQpDQogICAgTG9nQXJyYXkkID0gTG9nQXJyYXkkK0Zvcm1hdCQoTENBQXJyYXkoeCksIiUrNS4xZkEiKQ0KICAgIFByaW50ICYjMzU7MSxMb2dBcnJheSQNCiAgICBMb2dBcnJheSQgPSAiIg0KICBOZXh0IHgNCiAgTEZBUG9pbnRlciA9IDAgICAnIHJlc2V0IGFycmF5IHBvaW50ZXINCiAgSG91ckZsYWcgPSAwICAgICAnIGNsZWFyIGhvdXIgZmxhZyB1bnRpbCBuZXh0IGhvdXINCkVuZElmDQonIEVuZCBvZiBob3VyIGNvZGUNCiYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5Ow0KJyBDaGVjayBmb3IgZW5kIG9mIGRheSAtIGlmIHRydWUgdGhlbiBjbG9zZSBsb2cgZmlsZSBhbmQgY3JlYXRlIG5ldyBmaWxlDQonIGZvciBuZXcgZGF5IHN0YXJ0aW5nIGF0IDZBTQ0KSWYgRU9ERmxhZyA9IDEgVGhlbg0KICBDbG9zZSAmIzM1OzEgICAgICAgJyBjbG9zZSBvdXQgbGFzdCBsb2cgZmlsZSwgc2F2ZSBhbXAgaG91ciBkYXRhDQogIFByZXZpb3VzSUNBSCA9IElucHV0Q3VycmVudEFIDQogIElucHV0Q3VycmVudEFIID0gMA0KICBQcmV2aW91c0xDQUggPSBMb2FkQ3VycmVudEFIDQogIExvYWRDdXJyZW50QUggPSAwDQogIFByZXZpb3VzQkNBSCA9IEJhdEN1cnJlbnRBSA0KICBCYXRDdXJyZW50QUggPSAwDQogIENyZWF0ZUxvZ0ZpbGUgICcgY3JlYXRlIG5ldyBsb2cgZmlsZSB3aXRoIHRvZGF5cyBkYXRlDQogIEVPREZsYWcgPSAwICAgICcgY2xlYXIgZW5kIG9mIGRheSBmbGFnIHVudGlsIG5leHQgNkFNDQpFbmRJZg0KJyBFbmQgb2YgZGF5IGNvZGUNCiYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsNCkdvVG8gTWFpbiAgICAgICAgJyBiYWNrIHRvIE1haW4gcmVhZHkgZm9yIG5leHQgaW50ZXJydXB0DQoNCicgRW5kIG9mIG1haW4gcHJvZ3JhbSBsb29wDQomIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7DQomIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7DQonIEludGVycnVwdCBSb3V0aW5lIEhhbmRsaW5nDQoNCkdldERhdGEmIzU4OyAgICAgICcgVGltZXIgSW50ZXJydXB0IGhhbmRsZXINCiAgICAgICAgICAgICAgJyBBcmR1aW5vIGFuYWxvZ3VlIGlucHV0IHBpbnMNCiAgU2V0UGluIGEwLDEgICcgcGluIDM1IC0gYmF0dGVyeSB2b2x0YWdlIC0gMCB0byAyLjVWID0gMCB0byAxNVYNCiAgU2V0UGluIGExLDEgICcgcGluIDM2IC0gc29sYXIgdm9sdHMgLSAwIHRvIDIuNVYgPSAwIHRvIDI1Vg0KICBTZXRQaW4gYTIsMSAgJyBwaW4gMzcgLSBpbnB1dCBjdXJyZW50IHNodW50IC0gMCB0byAyLjVWID0gMCB0byA1MEENCiAgU2V0UGluIGEzLDEgICcgcGluIDM4IC0gbG9hZCBjdXJyZW50IHNodW50IC0gMCB0byAyLjVWID0gMCB0byA1MEENCg0KJyBHZXQgdGhlIGJhdHRlcnkgdm9sdGFnZQ0KICBpYz0wDQogIEJWb2x0cyA9IDANCiAgR2V0UGluMzUgPSAwDQogIEZvciBpYyA9IDEgVG8gMjANCiAgICBHZXRQaW4zNSA9IFBpbihhMCkNCiAgICBCVm9sdHMgPSBCVm9sdHMgKyBHZXRQaW4zNQ0KICBOZXh0IGljDQogIEJWb2x0cyA9IEJWb2x0cy8yMCAgJyBBdmVyYWdlIG91dCBCYXR0ZXJ5IHZvbHRhZ2UNCiAgQlZvbHRzID0gQlZvbHRzJiM0Mjs2ICAgJyAxNSBiYXR0ZXJ5IHZvbHRzID0gMi41IE1NIHZvbHRzDQoNCicgR2V0IHRoZSBTb2xhciBBcnJheSB2b2x0YWdlDQogIGljPTANCiAgU1ZvbHRzPTANCiAgR2V0UGluMzYgPSAwDQogIEZvciBpYyA9IDEgVG8gMjANCiAgICBHZXRQaW4zNiA9IFBpbihhMSkNCiAgICBTVm9sdHMgPSBTVm9sdHMgKyBHZXRQaW4zNg0KICBOZXh0IGljDQogIFNWb2x0cyA9IFNWb2x0cy8yMCAgJyBzYW1lIGFzIGZvciBCVm9sdHMNCiAgU1ZvbHRzID0gU1ZvbHRzJiM0MjsxMCAgJyAyNSBzb2xhciB2b2x0cyA9IDIuNSBNTSB2b2x0cw0KDQonIEdldCB0aGUgaW5wdXQgY3VycmVudCBhcyBhIHZvbHRhZ2UNCiAgSW5wdXRDdXJyZW50ID0gMA0KICBHZXRQaW4zNyA9IDANCiAgRm9yIGljID0gMSBUbyAyMA0KICAgIEdldFBpbjM3ID0gUGluKGEyKSAtIDAuNTgxNw0KICAgIElucHV0Q3VycmVudCA9IElucHV0Q3VycmVudCArIEdldFBpbjM3DQogIE5leHQgaWMNCiAgSW5wdXRDdXJyZW50ID0gSW5wdXRDdXJyZW50LzIwICAgJyBBdmVyYWdlIG91dCBpbnB1dCBjdXJyZW50DQogIElucHV0Q3VycmVudCA9IEFicyhJbnB1dEN1cnJlbnQmIzQyOzE2LjY2NykgICAnIENvcnJlY3QgZm9yIG9wYW1wIGFtcGxpZmljYXRpb24NCicgY3VycmVudCBieSAxNi42Njcgbm93IGdpdmVzIGEgdmFsdWUgNTBtViA9IDFBDQoNCicgR2V0IHRoZSBsb2FkIGN1cnJlbnQgYXMgYSB2b2x0YWdlDQogIExvYWRDdXJyZW50ID0gMA0KICBHZXRQaW4zOCA9IDANCiAgRm9yIGljID0gMSBUbyAyMA0KICAgIEdldFBpbjM4ID0gUGluKGEzKSAtIDAuNTgwMw0KICAgIExvYWRDdXJyZW50ID0gTG9hZEN1cnJlbnQgKyBHZXRQaW4zOA0KICBOZXh0IGljDQogIExvYWRDdXJyZW50ID0gTG9hZEN1cnJlbnQvMjAgJyBBdmVyYWdlIG91dCBsb2FkIGN1cnJlbnQNCiAgTG9hZEN1cnJlbnQgPSBBYnMoTG9hZEN1cnJlbnQmIzQyOzE2LjY2NykgJyBDb3JyZWN0IGZvciBvcGFtcCBhbXBsaWZpY2F0aW9uDQonIGN1cnJlbnQgYnkgMTYuNjY3IG5vdyBnaXZlcyBhIHZhbHVlIDUwbVYgPSAxQQ0KDQonIEdldCB0aGUgY3VycmVudCB0aW1lLCBleHRyYWN0IHRoZSBtaW51dGVzIGNvbXBvbmVudA0KSWYgTWlkJChUaW1lJCw3LDIpID0gIjAwIiBUaGVuDQogIE1pbkZsYWcgPSAxDQpFbmRJZg0KDQonIEdldCB0aGUgY3VycmVudCB0aW1lLCB0ZXN0IGZvciBob3VyIEFORCBtaW51dGUgdHVub3Zlcg0KSWYgTWlkJChUaW1lJCw3LDIpID0gIjAwIiBBbmQgTWlkJChUaW1lJCw0LDIpID0gIjAwIiBUaGVuDQogIEhvdXJGbGFnID0gMQ0KRW5kSWYNCg0KJyBHZXQgdGhlIGN1cnJlbnQgdGltZSwgdGVzdCBmb3IgMDYwMCYjNTg7MDANCklmIE1pbkZsYWcgQW5kIEhvdXJGbGFnIEFuZCBNaWQkKFRpbWUkLDEsMik9IjA2IiBUaGVuDQogIEVPREZsYWcgPSAxDQpFbmRJZg0KDQpOZXdEYXRhRmxhZyA9IDEgJyBzZXQgdG8gaW5kaWNhdGUgZnJlc2ggZGF0YQ0KDQpJUmV0dXJuICAnIFJldHVybnMgd2l0aCB0aGUgZm9sbG93aW5nIHZhbHVlcyYjNTg7LQ0KJyBCVm9sdHMgPSAwIHRvIDE1IGVxdWFsbGluZyBiYXR0ZXJ5IHZvbHRzDQonIFNWb2x0cyA9IDAgdG8gMjUgZXF1YWxsaW5nIHNvbGFyIEFycmF5IHZvbHRzDQonIElucHV0Q3VycmVudD0wIHRvIDUwIGVxdWFsbGluZyAwIHRvIDUwQW1wcw0KJyBMb2FkQ3VycmVudD0wIHRvIDUwIGVxdWFsbGluZyAwIHRvIDUwQW1wcw0KJ0VuZCBvZiBJbnRlcnJ1cHQgY29kZQ0KJiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7DQonIERlZmluZWQgU3Vicm91dGluZXMNCiYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5Ow0KJyBTZXQgdXAgdGVybWluYWwgZGlzcGxheSB3aXRoIHN0YXRpYyBkYXRhIChmaWVsZCBuYW1lcyBldGMuKQ0KJyAtIHVzZXMgdGhlIFBSSU5UIEAgdG8gcHJpbnQgYXQgZGVmaW5lZCBwb3NpdGlvbnMNCg0KU3ViIERpc3BsYXlTdGF0aWMNCkxvY2FsIHhyZyx5cmcsdm9sdHMsYW1wcw0KICBDbHMNCiAgUHJpbnQgQCgxNTAsMSkiQ0FSQVZBTiBQT1dFUiBNT05JVE9SIFYyLjA0Ig0KICBMaW5lKDE1MCwxMSktKDMxMiwxMSkNCiAgUHJpbnQgQCgxLDI1KSJJbnN0YW50YW5lb3VzIFJlYWRpbmdzIg0KICBQcmludCBAKDE5OCwyNSkiTWludXRlIEF2ZXJhZ2UgUmVhZGluZ3MiDQogIExpbmUoMSwzNiktKDE1MiwzNikNCiAgTGluZSgxOTgsMzYpLSgzNDYsMzYpDQogIFByaW50IEAoMzc2LDEpIkJhdHRlcnkiDQogIFByaW50IEAoMSw0NSkiQmF0dGVyeSBWb2x0cyAgICAgPSINCiAgUHJpbnQgQCgxOTgsNDUpIkJhdHRlcnkgVm9sdHMgICAgID0iDQogIFByaW50IEAoMzc5LDEyKSJDaGFyZ2UiDQogIFByaW50IEAoMSw1NikiU29sYXIgQXJyYXkgVm9sdHMgPSINCiAgUHJpbnQgQCgxOTgsNTYpIlNvbGFyIEFycmF5IFZvbHRzID0iDQogIFByaW50IEAoMSw2NykiSW5wdXQgQ3VycmVudCAgICAgPSINCiAgUHJpbnQgQCgxOTgsNjcpIklucHV0IEN1cnJlbnQgICAgID0iDQogIFByaW50IEAoMSw3OCkiTG9hZCBDdXJyZW50ICAgICAgPSINCiAgUHJpbnQgQCgxOTgsNzgpIkxvYWQgQ3VycmVudCAgICAgID0iDQogIFByaW50IEAoMSw4OSkiQmF0IENoZy9EaXMgQ3VyciAgPSINCiAgUHJpbnQgQCgxOTgsODkpIkJhdCBDaGcvRGlzIEN1cnIgID0iDQogIFByaW50IEAoMSwxMDgpIkRhaWx5IEFjY3VtdWxhdGluZyBSZWFkaW5ncyINCiAgUHJpbnQgQCgxOTgsMTA4KSJQcmV2aW91cyBEYXlzIFRvdGFsIFJlYWRpbmdzIg0KICBMaW5lKDEsMTIwKS0oMTcwLDEyMCkNCiAgTGluZSgxOTgsMTIwKS0oMzYyLDEyMCkNCiAgUHJpbnQgQCgxLDEyNykiSW5wdXQgQ2hhcmdlICAgICAgPSINCiAgUHJpbnQgQCgxOTgsMTI3KSJJbnB1dCBDaGFyZ2UgICAgICA9Ig0KICBQcmludCBAKDM4NCwxMjcpIlRpbWUgdG8iDQogIFByaW50IEAoMSwxMzgpIkxvYWQgRGlzY2hhcmdlICAgID0iDQogIFByaW50IEAoMTk4LDEzOCkiTG9hZCBEaXNjaGFyZ2UgICAgPSINCiAgUHJpbnQgQCg0MDAsMTM4KSIzMCUiDQogIFByaW50IEAoMSwxNDkpIkJhdHRlcnkgQ2hnL0Rpc0NoZz0iDQogIFByaW50IEAoMTk4LDE0OSkiQmF0dGVyeSBDaGcvRGlzQ2hnPSINCiAgTGluZSgwLDE2MiktKDQ3OSw0MzEpLDEsQg0KICBDb2xvdXIgNywwDQogIFByaW50IEAoNDI0LDE2NCkiQmF0dGVyeSINCiAgUHJpbnQgQCg0MzAsMTc0KSJWb2x0cyINCiAgQ29sb3VyIDMsMA0KICBQcmludCBAKDQzMCwyMTApIlNvbGFyIg0KICBQcmludCBAKDQzMCwyMjApIlZvbHRzIg0KICBDb2xvdXIgNiwwDQogIFByaW50IEAoNDMwLDI2MCkiSW5wdXQiDQogIFByaW50IEAoNDMzLDI3MCkiQW1wcyINCiAgQ29sb3VyIDUsMA0KICBQcmludCBAKDQzMywzMTUpIkxvYWQiDQogIFByaW50IEAoNDMzLDMyNSkiQW1wcyINCiAgQ29sb3VyIDIsMA0KICBQcmludCBAKDQyNywzNzUpIkJhdHRlcnkiDQogIFByaW50IEAoNDM2LDM4NSkiQW1wcyINCiAgUHJpbnQgQCg0MzAsMzk1KSJJbi8iDQogIENvbG91ciA0LDANCiAgUHJpbnQgQCg0NDksMzk1KSJPdXQiDQogIENvbG91ciA3LDANCiAgdm9sdHM9MjINCiAgYW1wcyA9IDQ4DQogIEZvciB5cmcgPTE2NyBUbyAzODcgU3RlcCAxMA0KICAgIFByaW50IEAoMix5cmcpRm9ybWF0JCh2b2x0cywiJTIuMGZWIikNCiAgICBQcmludCBAKDQwMCx5cmcpRm9ybWF0JChhbXBzLCIlMi4wZkEiKQ0KICAgIGFtcHM9YW1wcy0yDQogICAgeXJnPXlyZysxMA0KICAgIFByaW50IEAoNDAwLHlyZylGb3JtYXQkKGFtcHMsIiUyLjBmQSIpDQogICAgdm9sdHM9dm9sdHMtMQ0KICAgIGFtcHM9YW1wcy0yDQogIE5leHQgeXJnDQogIExpbmUoMjksMTYzKS0oMjksNDEzKQ0KICBMaW5lKDM5MywxNjMpLSgzOTMsNDEzKQ0KICBGb3IgeXJnID0gMTYzIFRvIDQxMyBTdGVwIDEwICdtaW5vciB0aWNrcw0KICAgIFBpeGVsKDI4LHlyZyk9Nw0KICAgIFBpeGVsKDM5NCx5cmcpPTcNCiAgTmV4dCB5cmcNCiAgRm9yIHlyZyA9IDE3MyBUbyA0MTMgU3RlcCAyMCAgJ21ham9yIHRpY2tzDQogICAgUGl4ZWwoMjcseXJnKT03DQogICAgUGl4ZWwoMzk1LHlyZyk9Nw0KICBOZXh0IHlyZw0KICBMaW5lKDMwLDQxNCktKDM5MCw0MTQpICdub3cgZm9yIHRoZSBib3R0b20NCiAgRm9yIHhyZyA9IDMwIFRvIDM5MCBTdGVwIDUNCiAgICBQaXhlbCh4cmcsNDE1KT03DQogIE5leHQgeHJnDQogIEZvciB4cmcgPSAzMCBUbyAzOTAgU3RlcCAxNQ0KICAgIExpbmUoeHJnLDQxNSktKHhyZyw0MTYpLDcNCiAgTmV4dCB4cmcNCiAgRm9yIHhyZyA9IDMwIFRvIDM5MCBTdGVwIDMwDQogICAgTGluZSh4cmcsNDE1KS0oeHJnLDQxNyksNw0KICBOZXh0IHhyZw0KICBGb3IgeHJnID0gMzAgVG8gMzkwIFN0ZXAgNjANCiAgICBMaW5lKHhyZyw0MTUpLSh4cmcsNDE4KSw3DQogIE5leHQgeHJnDQogIFByaW50IEAoMTAwLDQxOSkiNiBIb3VyIEdyYXBoaW5nIHBlcmlvZCAtIHN0YXJ0cyA2QU0iDQpFbmQgU3ViDQomIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsnDQonIEJhciBHcmFwaCAtIERyYXcgU3RhdGljDQonIHRvcCBsZWZ0IHg9NDMyLCB5PTAsIGJvdHRvbSByaWdodCB4PTQ3OSwgeT0xNjINCicgVGhpcyBlcXVhdGVzIHRvIDIgc3RlcHMgcGVyIHBlcmNlbnRhZ2UgZm9yIHRoZSByYW5nZSBvZiAzNSUgdG8gMTAwJQ0KU3ViIEJhckdyYXBoDQogIExvY2FsIHh0bCx5dGwseGJyLHlicixwZXJjZW50LHhwb3MseXBvcyx5DQoNCiAgeHRsPTQzMiYjNTg7eXRsPTAmIzU4O3hicj14dGwrNDcmIzU4O3licj15dGwrMTYyDQonICBGaXJzdCBkcmF3IHRoZSBib3ggYW5kIHZhbHVlcw0KICBMaW5lKHh0bCx5dGwpLSh4YnIseWJyKSwxLEINCiAgcGVyY2VudD0xMDANCiAgUHJpbnQgQCh4dGwrMyx5dGwrMikiQmF0dGVyeSINCiAgUHJpbnQgQCh4dGwrMTMseXRsKzEzKTEwMA0KICBQcmludCBAKHh0bCs0MCx5dGwrMTMpIiUiDQogIHBlcmNlbnQ9cGVyY2VudC01DQogIEZvciB5PXl0bCsyMiBUbyAxNDIgU3RlcCAxMA0KICAgIFByaW50IEAoeHRsKzE5LHkpcGVyY2VudA0KICAgIFByaW50IEAoeHRsKzQwLHkpIiUiDQogICAgcGVyY2VudCA9IHBlcmNlbnQtNQ0KICBOZXh0IHkNCkVuZCBTdWINCiYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OycNClN1YiBDcmVhdGVMb2dGaWxlDQogIExvZ0ZpbGVOYW1lJD0iQiYjNTg7IitNaWQkKERhdGUkLDksMikrTWlkJChEYXRlJCw0LDIpK0xlZnQkKERhdGUkLDIpKyIuQ1NWIg0KICBPcGVuIExvZ0ZpbGVOYW1lJCBGb3IgT3V0cHV0IEFzICYjMzU7MQ0KICBQcmludCAmIzM1OzEsICJCYXR0ZXJ5IFZvbHRhZ2UiO0NociQoNDQpOw0KICBQcmludCAmIzM1OzEsICJTb2xhciBBcnJheSBWb2x0YWdlIjtDaHIkKDQ0KTsNCiAgUHJpbnQgJiMzNTsxLCAiSW5wdXQgQ3VycmVudCI7Q2hyJCg0NCk7DQogIFByaW50ICYjMzU7MSwgIkxvYWQgQ3VycmVudCINCkVuZCBTdWINCiYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OycNCicgQmFyIEdyYXBoIC0gRmlsbA0KJyB0b3AgbGVmdCB4PTQzMiwgeT0wLCBib3R0b20gcmlnaHQgeD00NzksIHk9MTYyDQonIFRvIGZpbGwsIHN0YXJ0IGF0IHg9NDM0IHRocnUgNDQzIGFuZCB5PTE1MCBiYWNrIHVwIHRvIHk9MTINCicgVGhpcyBnaXZlcyAxMzggc3RlcHMsIGVxdWF0ZXMgdG8gMS45NyBzdGVwcyBwZXIgJSBmb3IgMzAlIHRvIDEwMCUNCicgRW50ZXIgd2l0aCBhY3R1YWwgYmF0dGVyeSBjaGFyZ2UgYXMgYSBwZXJjZW50DQoNClN1YiBGaWxsQmFyR3JhcGgoQmF0Q2hhcmdlKQ0KTG9jYWwgeHRsLHl0bCxiYXRfY2hnLHhwb3MseXBvcyx5cGVyLHhyaWdodCx4bGVmdCx5Ym90LHl0b3ANCmJhdF9jaGc9QmF0Q2hhcmdlDQp4dGw9NDMyJiM1ODt5dGw9MCYjNTg7eGJyPXh0bCs0NyYjNTg7eWJyPXl0bCsxNjINCicgTm93IGZpbGwgdGhlIGJhciBncmFwaA0KSWYgYmF0X2NoZyAmbHQ7IDMxIFRoZW4NCiAgYmF0X2NoZz0zMA0KICBDb2xvdXIgNCw3DQogIFByaW50IEAoeHRsICsgNCx5dGwgKyAxNTEsMikiREFOR0VSIg0KRWxzZQ0KICBDb2xvdXIgMiw3DQogIFByaW50IEAoeHRsICsgNCx5dGwgKyAxNTEsMikiICBPSyAgIg0KRW5kSWYNCkNvbG91ciA3LDANCklmIGJhdF9jaGcgJmd0OyAxMDAgVGhlbiBiYXRfY2hnPTEwMA0KeXRvcD0xMg0KeXBlcj1JbnQoKCgxMDAgLSBiYXRfY2hnKSAmIzQyOyAxLjk3KSArIDEyKQ0KeWJvdD0xNTANCnhsZWZ0PTQzNw0KeHJpZ2h0PTQ0Ng0KRm9yIHlwb3M9eWJvdCBUbyB5dG9wIFN0ZXAgLTENCiAgSWYgeXBlciAmbHQ7IHlwb3MgVGhlbg0KICAgIEZvciB4cG9zPXhsZWZ0IFRvIHhyaWdodCBTdGVwIDENCiAgICAgIFBpeGVsKHhwb3MseXBvcyk9Mg0KICAgIE5leHQgeHBvcw0KICBFbHNlDQogICAgRm9yIHhwb3M9eGxlZnQgVG8geHJpZ2h0IFN0ZXAgMQ0KICAgICAgUGl4ZWwoeHBvcyx5cG9zKT0wDQogICAgTmV4dCB4cG9zDQogIEVuZElmDQpOZXh0IHlwb3MNCkVuZCBTdWINCicgRW5kIHByb2dyYW0uDQomIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsmIzM5OyYjMzk7JiMzOTsNCg0KPC9wcmU+PGJyIC8+ZGTR06lG0DLQcnG62Qsz6CUVsCbYaQ==" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="03CF0AB7" />
</div>
        <h1 class="pagetitle">Battery Management for 12V System</h1><small>Modified on 2016/12/23 23:20 by Administrator &mdash; Categorized as: Control, Environment, _LIB Original MMBasic</small><br /><br /><h2 class="separator">This module is part of the original MMBasic library. It is reproduced here with kind permission of Hugh Buckle and Geoff Graham. Be aware it may reference functionality which has changed or is deprecated in the latest versions of MMBasic.<a class="headeranchor" id="This_module_is_part_of_the_original_MMBasic_library_It_is_reproduced_here_with_kind_permission_of_Hugh_Buckle_and_Geoff_Graham_Be_aware_it_may_reference_functionality_which_has_changed_or_is_deprecated_in_the_latest_versions_of_MMBasic_0" href="#This_module_is_part_of_the_original_MMBasic_library_It_is_reproduced_here_with_kind_permission_of_Hugh_Buckle_and_Geoff_Graham_Be_aware_it_may_reference_functionality_which_has_changed_or_is_deprecated_in_the_latest_versions_of_MMBasic_0" title="Link to this Section">&#0182;</a></h2><b>Note</b>: The required file(s) are available in the attachments tab (top right).<br /><br />'<br />' Battery Management Program for Caravan 12V System<br />' Copyright Doug Pankhurst May 2013<br />' Written for MMBasic V4.3a, copyright Geoff Graham 2012 '<br />'<br />' File Version: 2.04 May 2013<br />'<br /><br />This is an updated (Mark II ;-) ) version of a program first submitted in May 2012. Lots of comments and it only JUST fits into a CMM running in 8 colour mode - I have intentionally made it verbose and not optimisedto allow easy reading.<br /><br />This program monitors a 12V Battery System, monitoring the battery voltage, the solar panel voltage and the amount of charge supplied into and out of the battery via current shunt ICs. The charge/discharge state of the battery is given by comparing current in versus current out.<br /><br />It also estimates time to 30% capacity based on battery voltage and current discharge rate and provides a warning.<br /><br />Real time data is displayed on VGA display as well as historical data recorded to a log file on the SD card for later analysis.<br /><br />It utilises a range of subroutines and defined funtions based on software and ideas from Doug Pankhurst, Geoff Graham, Tom Pankhurst, and also from programs provided in the MMBASIC Software library, authors unknown. This code is free for anyone to use or modify as long as they acknowledge it's source and credit the contributors above.<br /><br /><b>Physical configuration</b>:<br />Uses a CG Colourmax 2 as the hardware platform and an Arduino blank shield populated with voltage dividers for battery and solar voltages and Allegro ACS758 current sensors for input (charging) current and load current. Battery charge/discharge current is calculated by subtracting load current from charging current.<br /><br />The 11.8V to 14.4V from the caravan battery system (depending on whether charging or driving load) is fed into an LM317 variable voltage regulator to provide regulated 8.5V to the CGCMM.<br /><br />WARNING: The Allegro current sensors have VERY fragile leads so they need to be physically stabilised. The units I used were unidirectional and had an offset around 600mV and a 60mV/amp capacity.<br /><br /><b>A general synopsis of the program</b>:<br /><ul><li>Disable interrupts;</li><li>Define and initialise variables and constants;</li><li>Initialise display with static data; initialize 1 minute arrays to allow averaging;</li><li>Enter main loop; wait for interrupt ( which sets NewData flag) then handle 2 second, 1 minute, 1 hour and end of day (6AM) occurrences;</li><li>Start main loop, waiting for (set by interrupt routine);</li><li>Cycle through 2 second, 1 minute, 1 hour and End-of-Day processing with initial data and display initial readings<br />- 2 second routine processes all instantaneous readings from interrupt routines - battery voltage, solar array voltage, input current from both solar controller and/or 240VAC battery charger<br />- 1 minute routine averages 30 two second readings, then pushes the averages into an array, also writes out running graph<br />- 1 hour routine takes array data and writes out to files in .CSV format<br />- EOD ( at 6AM ) closes log file and creates a new log file;</li><li>Interrupt provides battery volts, solar volts, input current and load current.<br /></li></ul><br /><b>Global Variables</b>: These are here just for explanatory purposes - they are defined in the program proper. The initialised values are to simplify averaging and also represent typical values.<br /><code><br />BVolts : Battery Voltage read from Pin A0. Read as 1/6th of real voltage via 6:1 resistive divider.<br /><br />BVArray(29) : Battery Volts 30 element array - 1 each 2 secs.<br /><br />BatCharge : Battery state of charge as a percentage where 12.75V or higher is 100%, down to 12.05V, being 35% - danger level.<br /><br />AverageBV : Average battery voltage over last 60 seconds.<br /><br />BVAArray(59) : 1 hours worth of minute average battery volts.<br /><br />DeltaBV : Battery voltage variation over 60 seconds. The difference between the first and the last used to calculate the "Time to 30% discharge point".<br /><br />Time2Discharge : Time to 30% discharge.<br /><br />SVolts : Solar Array voltage from Pin A1. Read as 1/10th of real voltage by 10:1 resistive divider.<br /><br />SVArray(29) : Solar Volts 30 element array - 1 each 2 secs.<br /><br />AverageSV : Average Solar Panel volts over last 60 seconds.<br /><br />SVAArray(59) : 1 hours worth of minute average solar volts.<br /><br />InputCurrent : Charging current into battery/load read from Pin A2 2.5V reading = 50mA across the shunt, which = 50A through shunt. This can be both battery charging current and load current.<br /><br />ICArray(29) : Input Current 30 element array.<br /><br />AverageIC : Average input (generator) current over last 60 seconds.<br /><br />ICAArray(59) : array with 1 hours worth of minute average input currents.<br /><br />LoadCurrent : Load current of caravan - can be supplied from the batteries and the charging systems (solar, AC Mains or generator). Pin A3.<br /><br />LCArray(29) : Load Current 60 element array.<br /><br />AverageLC : Average load current over last 60 seconds.<br /><br />LCAArray(59) : array to hold 1 hours worth of average load currents.<br /><br />BatCurrent : A calculated value; if positive, = a charging current to the battery; if negative, = a discharge current from the battery.<br /><br />AverageBC : Average charge/discharge current over last min calculated by AverageLC-AverageIC.<br /><br />InputCurrentAH : Input current as an amp hour calculated value - this is an accumulating value over 24 hours.<br /><br />PreviousICAH : yesterdays Input Current AHs.<br /><br />LoadCurrentAH : Load current as an amp hour calculated value - this is an accumulating value over 24 hours.<br /><br />PreviousLCAH : yesterdays Load Current AHs.<br /><br />BatCurrentAH : Bat charge (+value) or discharge (-value) as an amp hour calculated value - accumulating value over 24 hours.<br /><br />PreviousBCAH : yesterdays Bat Current AHs.<br /><br />LogArray$ : String to use for plugging into log array<br /><br />NewDataFlag : Two second flag - set every 2 seconds by the interrupt routine when new voltage and current values are collected.<br /><br />MinFlag : Minute flag - set once every min at 00 seconds by sec interrupt process and cleared by min processing code.<br /><br />HourFlag : Hour Flag - set on the hour to enable writing the 60 average readings in the log array to be written to file<br /><br />EODFlag : End of Day Flag - set at 6AM to enable daily log file to be closed and new log file created by LogFileCreate subroutine<br /></code><br /><br /><b>CVBM204.BAS</b>:<br /><pre>
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
' Battery Management Program for Caravan 12V System        '
' Copyright Doug Pankhurst May 2012                        '
' Written for MMBasic V4.3a, copyright Geoff Graham 2012   '
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
' File Version&#58;    2.04 May 2013
'
' For a detailed explanation of the program, it's
' construction and rationale, please read the
' CVBMREAD.TXT file.

' Main Entry to Program

EntryPoint&#58;  SetTick 0,0     ' Disable timer interrupt

' Global Variables - initialised to default values
BVolts = 12.8    '  Battery Voltage read from Pin A0. Read as
' 1/6th of real voltage via 6&#58;1 resistive divider

Dim BVArray(29)  ' Battary Volts 30 element array - 1 each 2 secs

BatCharge = 100  ' Battery state of charge as a percentage where
' 12.75V or higher is 100%, down to 12.05V being 35% - danger level

AverageBV=12.8   ' Average battery voltage over last 60 seconds

Dim BVAArray(59) ' 1 hours worth of minute average battery volts

DeltaBV = 0.1    ' Battery voltage variation over 60 seconds. The
' difference between the first and the last used to
' calculate the "Time to 30% discharge point"

Time2Discharge = 20 ' Time to 30% discharge

SVolts = 20      ' Solar Array voltage from Pin A1. Read as 1/10th
' of real voltage by 10&#58;1 resistive divider

Dim SVArray(29)  ' Solar Volts 30 element array - 1 each 2 secs

AverageSV = 21   ' Average Solar Panel volts over last 60 seconds

Dim SVAArray(59) ' 1 hours worth of minute average solar volts

InputCurrent = 18  ' Charging current into battery/load read from Pin A2
' 2.5V reading = 50mA across the shunt, which equals 50A through the shunt.
' This can be both battery charging current and load current.

Dim ICArray(29)  ' Input Current 30 element array

AverageIC = 18   ' Average input (generator) current over last 60 seconds

Dim ICAArray(59) ' array with 1 hours worth of minute average input currents

LoadCurrent = 12 ' Load current of caravan - can be supplied from the
' batteries and the charging systems (solar, AC Mains or generator). Pin A3

Dim LCArray(29)  ' Load Current 60 element array

AverageLC = 12   ' Average load current over last 60 seconds

Dim LCAArray(59) ' array to hold 1 hours worth of average load currents

BatCurrent = 6   ' A calculated value; if positive, = a charging current to
' the battery; if negative, equals a discharge current from the battery.

AverageBC = 6    ' Average charge/discharge current over last min
' calculated by AverageLC-AverageIC

InputCurrentAH = 0 ' Input current as an amp hour calculated value -
' this is an accumulating value over 24 hours

PreviousICAH = 0   ' yesterdays Input Current AHs

LoadCurrentAH = 0  ' Load current as an amp hour calculated value -
' this is an accumulating value over 24 hours

PreviousLCAH = 0   ' yesterdays Load Current AHs

BatCurrentAH = 0   ' Bat charge (pos value) or discharge (neg value)
' as an amp hour calculated value  - accumulating value over 24 hours

PreviousBCAH = 5   ' yesterdays Bat Current AHs

LogArray$ = ""     ' String to use for plugging into log array

NewDataFlag = 0    ' Two second flag - set every 2 seconds by the
' interrupt routine when new voltage and current values are collected.

MinFlag = 0        ' Minute flag - set once every min at 00 seconds
' by sec interrupt process and cleared by min processing code.

HourFlag = 0       ' Hour Flag - set on the hour to enable
' writing the 60 average readings in the log array to be writtent to file

EODFlag = 0        ' End of Day Flag - set at 6AM to enable daily log file
' to be closed and new log file created by LogFileCreate subroutine

&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
' Carry out initialisation routines here - enable interrupt last

Entry&#58;
Mode 3,7     ' 8 colour mode white on black
Colour White,Black
Cls

' Display all static data
Option USB Off    ' only to VGA
DisplayStatic
BarGraph
' Create Log File on program entry and then at start of new day - 6AM
CreateLogFile

' Set up all initial values to default for orderly entry.
PreviousICAH = 50
PreviousLCAH = 45
PreviousBCAH = 5
OldABV = 13
LFAPointer = 0

' Fill the arrays
For Ax=0 To 29
  BVArray(Ax) = 12.8
  SVArray(Ax) = 19
  ICArray(Ax) = 18
  LCArray(Ax) = 12
Next Ax

' Wait until 00 seconds to start for clean entry.
Do While Val(Mid$(Time$,7,2)) &lt;&gt; 58
Loop

' Enable timer tick interrupts to start data collection at 00 seconds
SetTick 2000,GetData   ' Every other second, get battery voltage and current
' data through the GetData interrupt routine.

' end of initialisation routines
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
' Main program loop

Main&#58;
Do While NewDataFlag = 0   ' wait until interrupt provides fresh data
Loop

&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
' 2 second processing code
' Write out time and date to display
Print @(1,1)Time$ + "   " + Date$

' Push most recent values into arrays for minute averaging
For Ax = 29 To 1 Step -1
  BVArray(Ax) = BVArray(Ax-1)
  SVArray(Ax) = SVArray(Ax-1)
  ICArray(Ax) = ICArray(Ax-1)
  LCArray(Ax) = LCArray(Ax-1)
Next Ax
BVArray(0) = BVolts
SVArray(0) = SVolts
ICArray(0) = InputCurrent
LCArray(0) = LoadCurrent
' Charge/Discharge Current is InputCurrent-LoadCurrent - if positive
'  it is a charging current into battery, if negative, it is a
'  discharging current out of battery
BatCurrent = InputCurrent-LoadCurrent

' Convert both input, output &amp; battery instantaneous currents into Amp Hours
InputCurrentAH = InputCurrentAH + (InputCurrent/1800) ' use 2 sec interrupt
LoadCurrentAH = LoadCurrentAH + (LoadCurrent/1800)    ' rate for calculation
BatCurrentAH = InputCurrentAH-LoadCurrentAH

' Note&#58; All AH accumulating totals are plugged into last day values
' then reset to zero at 6AM - now update terminal display with all values
Font &#35;2
Colour 2
Print @(372,25)Format$(BatCharge,"%3.0f")+"%"
Font &#35;1
Colour 7
Print @(123,45)Format$(BVolts,"%5.2fV")
Print @(123,56)Format$(SVolts,"%5.2fV")
Print @(123,67)Format$(InputCurrent,"%5.2fA")
Print @(123,78)Format$(LoadCurrent,"%5.2fA")
Print @(312,45)Format$(AverageBV,"%5.2fV")
Print @(312,56)Format$(AverageSV,"%5.2fV")
Font &#35;2
Colour 7
Print @(420,184)Format$(AverageBV,"%4.1f")
Colour 3
Print @(420,232)Format$(AverageSV,"%4.1f")
Colour 7
Font &#35;1
Print @(376,149)Format$(Time2Discharge,"%4.0f min")
Print @(312,67)Format$(AverageIC,"%5.1fA")
Print @(312,78)Format$(AverageLC,"%5.1fA")
Colour 6
Font &#35;2
Print @(420,285)Format$(AverageIC,"%4.1f")
Colour 5
Print @(420,340)Format$(AverageLC,"%4.1f")
Colour 7
Font &#35;1
Print @(117,127)Format$(InputCurrentAH,"%5.1fahrs")
Print @(117,138)Format$(LoadCurrentAH,"%5.1fahrs")
If (Sgn(BatCurrentAH) = +1) Then
  Colour 2
  Print @(117,149)Format$(BatCurrentAH,"%+5.1fahrs")
Else
  Colour 4
  Print @(117,149)Format$(BatCurrentAH,"%+5.1fahrs")
EndIf
Colour 7
Print @(312,127)Format$(PreviousICAH,"%5.1fahrs")
Print @(312,138)Format$(PreviousLCAH,"%5.1fahrs")
If (Sgn(PreviousBCAH) = +1) Then
  Colour 2
  Print @(312,149)Format$(PreviousBCAH,"%+5.1fahrs")
Else
  Colour 4
  Print @(312,149)Format$(PreviousBCAH,"%+5.1fahrs")
EndIf
Colour 7
If (Sgn(AverageBC) = +1) Then
  Colour 2
  Print @(312,89)Format$(AverageBC,"%+5.1fA")
  Font &#35;2
  Print @(418,410)Format$(AverageBC,"%+4.1f")
  Font &#35;1
Else
  Colour 4
  Print @(312,89)Format$(AverageBC,"%+5.1fA")
  Font &#35;2
  Print @(418,410)Format$(AverageBC,"%+4.1f")
  Font &#35;1
EndIf
If (Sgn(BatCurrent) = +1) Then
  Colour 2
  Print @(123,89)Format$(BatCurrent,"%+5.2fA")
Else
  Colour 4
  Print @(123,89)Format$(BatCurrent,"%+5.2fA")
EndIf
Colour 7
NewDataFlag = 0      ' clear new data flag ready for next interrupt
'
' End of two second processing code, now check for minute, hour or end of
' day flags and process accordingly
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
' Check for minute flag, calculate the average of the last 60 seconds of
' readings, plug them into the log file array at the log file array pointer
If MinFlag = 1 Then
  ' calculate average for last minute
  OldABV = AverageBV
  OldASV = AverageSV
  AverageBV = 0
  AverageSV = 0
  AverageIC = 0
  AverageLC = 0
  For Ax = 0 To 29   'don't forget only sampled every 2 secs
    AverageBV = AverageBV + BVArray(Ax)
    AverageSV = AverageSV + SVArray(Ax)
    AverageIC = AverageIC + ICArray(Ax)
    AverageLC = AverageLC + LCArray(Ax)
  Next Ax
  AverageBV = AverageBV/30
  AverageSV = AverageSV/30
  AverageIC = AverageIC/30
  AverageLC = AverageLC/30
  AverageBC = AverageIC - AverageLC
  ' Calculate battery change as percentage and fill charge state graph
  ' now calculate charge and paint capacity graph
  ' 12.1V equates to 30% charge
  BatCharge = Int((AverageBV - 11.75) &#42; 100)
  If BatCharge &lt; 30 Then BatCharge = 30
  If BatCharge &gt; 100 Then BatCharge = 100
  FillBarGraph(BatCharge)

  ' Calculate time to 30% discharge of battery
  DeltaBV = OldABV - AverageBV
  If Sgn(DeltaBV) = +1 Then
       DVRate = BVArray(0)         ' set initial values for rate of
    Time2Discharge = 0             ' discharge and time to discharge
    Do While DVRate &gt; 12.1         ' 12.1 volts equates to 30% discharge
      DVRate = DVRate - DeltaBV    ' loop through calculating the amount
                                   ' of time to get the current voltage
                                   ' down to the 30% discharge point
      Time2Discharge = Time2Discharge + 1 ' inc minutes to discharge count
    Loop
  Else
    Print @(376,149)"Charging "   ' if current voltage is greater than
  EndIf                            ' previous minute
  BVAArray(LFAPointer) = AverageBV  ' update average arrays
  SVAArray(LFAPointer) = AverageSV
  ICAArray(LFAPointer) = AverageIC
  LCAArray(LFAPointer) = AverageLC
  LFAPointer = LFAPointer + 1          ' LFA pointer reset by eod routine

' Now paint out running graph
' - first work out the current minute hour combo in minutes
  rg_mins = <div class="box">Val(Mid$(Time$,1,2)) Mod 6)&#42;60))+(Val(Mid$(Time$,4,2</div>
  rg_mins = rg_mins + 30               ' offset to start of graph
  rg_abv = 412 - Int((AverageBV-8) &#42; 10)
    If rg_abv &gt; 412 Then rg_abv = 412
  rg_asv = 412 - Int((AverageSV-8) &#42; 10)
    If rg_asv &gt; 412 Then rg_asv = 412
    If rg_asv &lt; 163 Then rg_asv = 163
  rg_aic = 412 - Int(AverageIC &#42; 5)
  rg_alc = 412 - Int(AverageLC &#42; 5)
  If (Sgn(AverageBC) = +1) Then
    rg_abc = 412 - Int(AverageBC &#42; 5)
  Else
    rg_abc = 412 + Int(AverageBC &#42; 5)
  EndIf
  For yrg = 163 To 412 Step 1
    If rg_abc = yrg Then
      If (Sgn(AverageBC) = +1) Then
        Pixel(rg_mins,yrg) = 2
      Else
        Pixel(rg_mins,yrg) = 4
      EndIf
    Else
      Pixel(rg_mins,yrg) = 0
    EndIf
    If rg_abv = yrg Then
      Pixel(rg_mins,yrg) = 7
    EndIf
    If rg_asv = yrg Then
      Pixel(rg_mins,yrg) = 3
    EndIf
    If rg_aic = yrg Then
      Pixel(rg_mins,yrg) = 6
    EndIf
    If rg_alc = yrg Then
      Pixel(rg_mins,yrg) = 5
    EndIf
    Line(rg_mins+1,yrg)-(rg_mins+3,yrg),0
  Next yrg

  MinFlag = 0   ' reset the min flag
EndIf
' End of minute code
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
' Check for hour flag - if true then append log array out to file
' (we want to limit log file writes to 24 per day to keep
' SD card writes as low as possible).

If HourFlag = 1 Then        ' set each hour in interrupt routine
  LogArray$ = ""
  For x=0 To 59 Step 1  ' get the average values from each average array
    LogArray$ = LogArray$+Format$(BVAArray(x),"%+6.2fV")+Chr$(44)
    LogArray$ = LogArray$+Format$(SVAArray(x),"%+6.2fV")+Chr$(44)
    LogArray$ = LogArray$+Format$(ICAArray(x),"%+5.1fA")+Chr$(44)
    LogArray$ = LogArray$+Format$(LCAArray(x),"%+5.1fA")
    Print &#35;1,LogArray$
    LogArray$ = ""
  Next x
  LFAPointer = 0   ' reset array pointer
  HourFlag = 0     ' clear hour flag until next hour
EndIf
' End of hour code
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
' Check for end of day - if true then close log file and create new file
' for new day starting at 6AM
If EODFlag = 1 Then
  Close &#35;1       ' close out last log file, save amp hour data
  PreviousICAH = InputCurrentAH
  InputCurrentAH = 0
  PreviousLCAH = LoadCurrentAH
  LoadCurrentAH = 0
  PreviousBCAH = BatCurrentAH
  BatCurrentAH = 0
  CreateLogFile  ' create new log file with todays date
  EODFlag = 0    ' clear end of day flag until next 6AM
EndIf
' End of day code
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
GoTo Main        ' back to Main ready for next interrupt

' End of main program loop
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
' Interrupt Routine Handling

GetData&#58;      ' Timer Interrupt handler
              ' Arduino analogue input pins
  SetPin a0,1  ' pin 35 - battery voltage - 0 to 2.5V = 0 to 15V
  SetPin a1,1  ' pin 36 - solar volts - 0 to 2.5V = 0 to 25V
  SetPin a2,1  ' pin 37 - input current shunt - 0 to 2.5V = 0 to 50A
  SetPin a3,1  ' pin 38 - load current shunt - 0 to 2.5V = 0 to 50A

' Get the battery voltage
  ic=0
  BVolts = 0
  GetPin35 = 0
  For ic = 1 To 20
    GetPin35 = Pin(a0)
    BVolts = BVolts + GetPin35
  Next ic
  BVolts = BVolts/20  ' Average out Battery voltage
  BVolts = BVolts&#42;6   ' 15 battery volts = 2.5 MM volts

' Get the Solar Array voltage
  ic=0
  SVolts=0
  GetPin36 = 0
  For ic = 1 To 20
    GetPin36 = Pin(a1)
    SVolts = SVolts + GetPin36
  Next ic
  SVolts = SVolts/20  ' same as for BVolts
  SVolts = SVolts&#42;10  ' 25 solar volts = 2.5 MM volts

' Get the input current as a voltage
  InputCurrent = 0
  GetPin37 = 0
  For ic = 1 To 20
    GetPin37 = Pin(a2) - 0.5817
    InputCurrent = InputCurrent + GetPin37
  Next ic
  InputCurrent = InputCurrent/20   ' Average out input current
  InputCurrent = Abs(InputCurrent&#42;16.667)   ' Correct for opamp amplification
' current by 16.667 now gives a value 50mV = 1A

' Get the load current as a voltage
  LoadCurrent = 0
  GetPin38 = 0
  For ic = 1 To 20
    GetPin38 = Pin(a3) - 0.5803
    LoadCurrent = LoadCurrent + GetPin38
  Next ic
  LoadCurrent = LoadCurrent/20 ' Average out load current
  LoadCurrent = Abs(LoadCurrent&#42;16.667) ' Correct for opamp amplification
' current by 16.667 now gives a value 50mV = 1A

' Get the current time, extract the minutes component
If Mid$(Time$,7,2) = "00" Then
  MinFlag = 1
EndIf

' Get the current time, test for hour AND minute tunover
If Mid$(Time$,7,2) = "00" And Mid$(Time$,4,2) = "00" Then
  HourFlag = 1
EndIf

' Get the current time, test for 0600&#58;00
If MinFlag And HourFlag And Mid$(Time$,1,2)="06" Then
  EODFlag = 1
EndIf

NewDataFlag = 1 ' set to indicate fresh data

IReturn  ' Returns with the following values&#58;-
' BVolts = 0 to 15 equalling battery volts
' SVolts = 0 to 25 equalling solar Array volts
' InputCurrent=0 to 50 equalling 0 to 50Amps
' LoadCurrent=0 to 50 equalling 0 to 50Amps
'End of Interrupt code
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
' Defined Subroutines
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;
' Set up terminal display with static data (field names etc.)
' - uses the PRINT @ to print at defined positions

Sub DisplayStatic
Local xrg,yrg,volts,amps
  Cls
  Print @(150,1)"CARAVAN POWER MONITOR V2.04"
  Line(150,11)-(312,11)
  Print @(1,25)"Instantaneous Readings"
  Print @(198,25)"Minute Average Readings"
  Line(1,36)-(152,36)
  Line(198,36)-(346,36)
  Print @(376,1)"Battery"
  Print @(1,45)"Battery Volts     ="
  Print @(198,45)"Battery Volts     ="
  Print @(379,12)"Charge"
  Print @(1,56)"Solar Array Volts ="
  Print @(198,56)"Solar Array Volts ="
  Print @(1,67)"Input Current     ="
  Print @(198,67)"Input Current     ="
  Print @(1,78)"Load Current      ="
  Print @(198,78)"Load Current      ="
  Print @(1,89)"Bat Chg/Dis Curr  ="
  Print @(198,89)"Bat Chg/Dis Curr  ="
  Print @(1,108)"Daily Accumulating Readings"
  Print @(198,108)"Previous Days Total Readings"
  Line(1,120)-(170,120)
  Line(198,120)-(362,120)
  Print @(1,127)"Input Charge      ="
  Print @(198,127)"Input Charge      ="
  Print @(384,127)"Time to"
  Print @(1,138)"Load Discharge    ="
  Print @(198,138)"Load Discharge    ="
  Print @(400,138)"30%"
  Print @(1,149)"Battery Chg/DisChg="
  Print @(198,149)"Battery Chg/DisChg="
  Line(0,162)-(479,431),1,B
  Colour 7,0
  Print @(424,164)"Battery"
  Print @(430,174)"Volts"
  Colour 3,0
  Print @(430,210)"Solar"
  Print @(430,220)"Volts"
  Colour 6,0
  Print @(430,260)"Input"
  Print @(433,270)"Amps"
  Colour 5,0
  Print @(433,315)"Load"
  Print @(433,325)"Amps"
  Colour 2,0
  Print @(427,375)"Battery"
  Print @(436,385)"Amps"
  Print @(430,395)"In/"
  Colour 4,0
  Print @(449,395)"Out"
  Colour 7,0
  volts=22
  amps = 48
  For yrg =167 To 387 Step 10
    Print @(2,yrg)Format$(volts,"%2.0fV")
    Print @(400,yrg)Format$(amps,"%2.0fA")
    amps=amps-2
    yrg=yrg+10
    Print @(400,yrg)Format$(amps,"%2.0fA")
    volts=volts-1
    amps=amps-2
  Next yrg
  Line(29,163)-(29,413)
  Line(393,163)-(393,413)
  For yrg = 163 To 413 Step 10 'minor ticks
    Pixel(28,yrg)=7
    Pixel(394,yrg)=7
  Next yrg
  For yrg = 173 To 413 Step 20  'major ticks
    Pixel(27,yrg)=7
    Pixel(395,yrg)=7
  Next yrg
  Line(30,414)-(390,414) 'now for the bottom
  For xrg = 30 To 390 Step 5
    Pixel(xrg,415)=7
  Next xrg
  For xrg = 30 To 390 Step 15
    Line(xrg,415)-(xrg,416),7
  Next xrg
  For xrg = 30 To 390 Step 30
    Line(xrg,415)-(xrg,417),7
  Next xrg
  For xrg = 30 To 390 Step 60
    Line(xrg,415)-(xrg,418),7
  Next xrg
  Print @(100,419)"6 Hour Graphing period - starts 6AM"
End Sub
&#39;&#39;&#39;&#39;&#39;&#39;'
' Bar Graph - Draw Static
' top left x=432, y=0, bottom right x=479, y=162
' This equates to 2 steps per percentage for the range of 35% to 100%
Sub BarGraph
  Local xtl,ytl,xbr,ybr,percent,xpos,ypos,y

  xtl=432&#58;ytl=0&#58;xbr=xtl+47&#58;ybr=ytl+162
'  First draw the box and values
  Line(xtl,ytl)-(xbr,ybr),1,B
  percent=100
  Print @(xtl+3,ytl+2)"Battery"
  Print @(xtl+13,ytl+13)100
  Print @(xtl+40,ytl+13)"%"
  percent=percent-5
  For y=ytl+22 To 142 Step 10
    Print @(xtl+19,y)percent
    Print @(xtl+40,y)"%"
    percent = percent-5
  Next y
End Sub
&#39;&#39;&#39;&#39;&#39;&#39;'
Sub CreateLogFile
  LogFileName$="B&#58;"+Mid$(Date$,9,2)+Mid$(Date$,4,2)+Left$(Date$,2)+".CSV"
  Open LogFileName$ For Output As &#35;1
  Print &#35;1, "Battery Voltage";Chr$(44);
  Print &#35;1, "Solar Array Voltage";Chr$(44);
  Print &#35;1, "Input Current";Chr$(44);
  Print &#35;1, "Load Current"
End Sub
&#39;&#39;&#39;&#39;&#39;&#39;'
' Bar Graph - Fill
' top left x=432, y=0, bottom right x=479, y=162
' To fill, start at x=434 thru 443 and y=150 back up to y=12
' This gives 138 steps, equates to 1.97 steps per % for 30% to 100%
' Enter with actual battery charge as a percent

Sub FillBarGraph(BatCharge)
Local xtl,ytl,bat_chg,xpos,ypos,yper,xright,xleft,ybot,ytop
bat_chg=BatCharge
xtl=432&#58;ytl=0&#58;xbr=xtl+47&#58;ybr=ytl+162
' Now fill the bar graph
If bat_chg &lt; 31 Then
  bat_chg=30
  Colour 4,7
  Print @(xtl + 4,ytl + 151,2)"DANGER"
Else
  Colour 2,7
  Print @(xtl + 4,ytl + 151,2)"  OK  "
EndIf
Colour 7,0
If bat_chg &gt; 100 Then bat_chg=100
ytop=12
yper=Int(((100 - bat_chg) &#42; 1.97) + 12)
ybot=150
xleft=437
xright=446
For ypos=ybot To ytop Step -1
  If yper &lt; ypos Then
    For xpos=xleft To xright Step 1
      Pixel(xpos,ypos)=2
    Next xpos
  Else
    For xpos=xleft To xright Step 1
      Pixel(xpos,ypos)=0
    Next xpos
  EndIf
Next ypos
End Sub
' End program.
&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;&#39;

</pre><br />
    </form>
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Battery-Management-for-12V-System-part-of-the-original-MMBasic-library by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:13:42 GMT -->
</html>
