

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from fruitoftheshed.com/MMBasic.PWM-BAS-part-of-the-original-MMBasic-library.ashx?NoRedirect=1 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:52:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=8" /><title>
	PWM.BAS - Fruit Of The Shed
</title><script type="text/javascript" src="JS/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="JS/Scripts.js"></script>
<script type="text/javascript" src="JS/SearchHighlight.js"></script>
<link rel="stylesheet" media="print" href="Themes/Default/Print_Styles.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles%20-%20Copy.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles.css" type="text/css" />
<link rel="stylesheet" href="Themes/Editor.css" type="text/css" />
<link rel="search" href="searchf7b1.xml?OpenSearch=1" type="application/opensearchdescription+xml" title="Fruit Of The Shed - Search" /><script src="Themes/Default/Scripts.js" type="text/javascript"></script>
<link rel="shortcut icon" href="Themes/Default/Icon.ico" type="image/x-icon" />
</head>
<body>
    <form name="aspnetForm" method="post" action="http://fruitoftheshed.com/Default.aspx?Page=PWM-BAS-part-of-the-original-MMBasic-library&amp;NS=MMBasic&amp;NoRedirect=1" id="aspnetForm">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUJMTQ3NjA4MDI2D2QWAmYPZBYCAgEPZBYCAgkPZBYEAhsPDxYCHg1BbnRoZW1WaXNpYmxlaGRkAicPDxYCHgdWaXNpYmxlaGQWAmYPFgIeC18hSXRlbUNvdW50ZmRkL9X+pH8J+jB1IIJZx71WjgOrjyw=" />
</div>

<script type="text/javascript">
//<![CDATA[
var Anthem_FormID = "aspnetForm";
//]]>
</script>
<script src="WebResource3c0c.axd?d=wu8PDPV1hmKciPrhUAi9NEjQUBbOefrIXCaRPwGH8Q5jrvPZFuGbKmycL3GXDKGD1_JZ083oQl1Kpd_P7rg1V93MtYOS3Vb-0Eztmu5VDCWQxc7l0&amp;t=636158881040000000" type="text/javascript"></script>
<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="CA0B0334" />
</div>
		<script type="text/javascript">
<!--
__BaseName = "ctl00_CphMaster_";
__ConfirmMessage = "Are you sure you want to proceed?";
// -->
</script>
		<script type="text/javascript">
		<!--
			function __GetServerElementById(id) {
				return document.getElementById(__BaseName + id);
			}
			function __RequestConfirm() {
				return confirm(__ConfirmMessage);
			}
		// -->
		</script>
    
        <div id="HeaderDiv">
            <div style="float: right;">Welcome <a href="MMBasic.Language.html" class="systemlink" title="Select your language">Guest</a>, you are in: <select class="namespacedropdown" onchange="javascript:var sel = this.value; document.location = (sel != '' ? (sel + '.') : '') + 'Default.aspx';"><option value="">&lt;root&gt;</option><option value="Circuit Ideas">Circuit Ideas</option><option value="Colour MaxiMite 2 (CMM2)">Colour MaxiMite 2 (CMM2)</option><option value="GCB">GCB</option><option value="MicroMite ArmMite and MMX Hardware">MicroMite ArmMite and MMX Hardware</option><option selected="selected" value="MMBasic">MMBasic</option><option value="PIC ASM">PIC ASM</option><option value="Platform Agnostic">Platform Agnostic</option></select> &bull; <a href="MMBasic.Login8e67.html?Redirect=http%3a%2f%2ffruitoftheshed.com%2fDefault.aspx%3fPage%3dPWM-BAS-part-of-the-original-MMBasic-library%26NS%3dMMBasic%26NoRedirect%3d1" class="systemlink" title="Login">Login</a></div><h1>Fruit Of The Shed</h1>
        </div>
                   
        <div id="ContainerDiv">
                 
            <div id="SidebarDiv">
                <div id="SidebarHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="SidebarContentDiv">
                    <div style="float: right;"> </div><h3 class="separator">Navigation (MMBasic)<a class="headeranchor" id="Navigation_NAMESPACE_0" href="#Navigation_NAMESPACE_0" title="Link to this Section">&#0182;</a></h3><ul><li><b><a class="pagelink" href="MMBasic.MainPage.html" title="_MMBasic Code Library">Main Page</a></b></li><li><a class="pagelink" href="MainPage.html" title="Home Page">Main Page (root)</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.EggDrop-part-of-the-original-MMBasic-libraryc674.html" title="Random Page">Random Page</a></li><li><a class="systemlink" href="MMBasic.AllPages.html" title="All Pages">All Pages</a><br /> </li><li><a class="systemlink" href="Logina75d.html" title="Create a new Page">Create a new Page</a><br /></li></ul><br /><ul><li><a class="systemlink" href="Logine894.html" title="Administration">Administration</a></li><li><a class="systemlink" href="MMBasic.Upload.html" title="File Management">File Management</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="My Account">My Account</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="Create Account">Create Account</a><br /></li></ul><br /><small><b>Search the wiki</b></small><br /><br /><script type="text/javascript"><!--
function _DoSearch_SBf63524b4df3e46d58daced6fab3b588b() { document.location = 'MMBasic.Search.aspx?AllNamespaces=1&FilesAndAttachments=1&Query=' + encodeURI(document.getElementById('SBf63524b4df3e46d58daced6fab3b588b').value); }
// -->
</script><input class="txtsearchbox" type="text" id="SBf63524b4df3e46d58daced6fab3b588b" onkeydown="javascript:var keycode; if(window.event) keycode = event.keyCode; else keycode = event.which; if(keycode == 10 || keycode == 13) { _DoSearch_SBf63524b4df3e46d58daced6fab3b588b(); return false; }" /> <big><a href="#" onclick="javascript:_DoSearch_SBf63524b4df3e46d58daced6fab3b588b(); return false;">&raquo;</a></big><br /><br /><br />
                </div>
                <div id="SidebarFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>
            <div id="MainDiv">
                <div id="MainHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="PageInternalHeaderDiv"></div>
                

    <script type="text/javascript">
    <!--
        function __ShowAllTrail() {
            try {
                document.getElementById("BreadcrumbsDivMin").style["display"] = "none";
                document.getElementById("BreadcrumbsDivAll").style["display"] = "";
                __SetStatus("1");
            }
            catch(ex) { }
            return false;
        }
        function __HideTrail() {
            try {
                document.getElementById("BreadcrumbsDivMin").style["display"] = "";
                document.getElementById("BreadcrumbsDivAll").style["display"] = "none";
                __SetStatus("0");
            }
            catch(ex) { }
            return false;
        }
        
        function __SetStatus(open) {
            __CreateCookie("ScrewTurnWikiBCT", open, 365);
        }
        function __GetStatus() {
            var value = __ReadCookie("ScrewTurnWikiBCT");
            if(value) return value;
            else return "0";
        }

        function __InitBCT() {
        	if(__GetStatus() == "1") {
        		__ShowAllTrail();
        	}
        }

        var __attachmentsMenuJustShown = false;
        var __adminToolsMenuJustShown = false;
        var __ie7Mode = false;

        function __ToggleAttachmentsMenu(cx, cy) {
        	var element = document.getElementById("PageAttachmentsDiv");
        	if(element) {
        		if(element.style["display"] == "none") {
        			element.style["display"] = "";
        			var pos = __AbsolutePosition(element);
        			if(pos.left - cx > 0) {
        				__ie7Mode = true;
        				element.style["position"] = "absolute";
        				element.style["top"] = cy + "px";
        				element.style["left"] = (cx - pos.width) + "px";
        			}
        			else {
        				__RepositionDiv(document.getElementById("PageAttachmentsLink"), element);
        			}
        			__attachmentsMenuJustShown = true;
        		}
        	}
        	return false;
        }
        function __HideAttachmentsMenu() {
        	var element = document.getElementById("PageAttachmentsDiv");
        	if(element && !__attachmentsMenuJustShown) {
        		element.style["display"] = "none";
        		if (__ie7Mode) element.style["left"] = "10000px";
        	}
        	__attachmentsMenuJustShown = false;
        	return true; // Needed to enabled next clicks' action (file download)
        }

        function __ToggleAdminToolsMenu(cx, cy) {
        	var element = document.getElementById("AdminToolsDiv");
        	if(element) {
        		if(element.style["display"] == "none") {
        			element.style["display"] = "";
        			var pos = __AbsolutePosition(element);
        			if(pos.left - cx > 0) {
        				__ie7Mode = true;
        				element.style["position"] = "absolute";
        				element.style["top"] = cy + "px";
        				element.style["left"] = (cx - pos.width) + "px";
        			}
        			else {
        				__RepositionDiv(document.getElementById("AdminToolsLink"), element);
        			}
        			__adminToolsMenuJustShown = true;
        		}
        	}
        	return false;
        }
        function __HideAdminToolsMenu() {
        	var element = document.getElementById("AdminToolsDiv");
        	if(element && !__adminToolsMenuJustShown) {
        		element.style["display"] = "none";
        		if(__ie7Mode) element.style["left"] = "10000px";
        	}
        	__adminToolsMenuJustShown = false;
        	return true; // Needed to enable next clicks' action (admin tools)
        }

        function __HideAllMenus() {
        	__HideAttachmentsMenu();
        	__HideAdminToolsMenu();
        }

        document.body.onclick = __HideAllMenus;

        function __AbsolutePosition(obj) {
        	var pos = null;
        	if(obj != null) {
        		pos = new Object();
        		pos.top = obj.offsetTop;
        		pos.left = obj.offsetLeft;
        		pos.width = obj.offsetWidth;
        		pos.height = obj.offsetHeight;

        		obj = obj.offsetParent;
        		while(obj != null) {
        			pos.top += obj.offsetTop;
        			pos.left += obj.offsetLeft;
        			obj = obj.offsetParent;
        		}
        	}
        	return pos;
        }

        var __showTimer = null;
        var __hideTimer = null;

        function __ShowDropDown(e, divId, parent) {
           	// Set a timer
        	// On mouse out, cancel the timer and start a 2nd timer that hides the menu
        	// When the 1st timer elapses
        	//   show the drop-down
        	//   on menu mouseover, cancel the 2nd timer
        	//   on menu mouse out, hide the menu
        	__showTimer = setTimeout('__ShowDropDownForReal(' + e.clientX + ', ' + e.clientY + ', "' + divId + '", "' + parent.id + '");', 200);
        }

        function __ShowDropDownForReal(cx, cy, divId, parentId) {
        	var pos = __AbsolutePosition(document.getElementById(parentId));
        	var menu = document.getElementById(divId);

			// This is needed to trick IE7 which, for some reason,
			// does not position the drop-down correctly with the new Default theme
        	if(pos.left - cx > 30) {
        		menu.style["display"] = "";
        		menu.style["position"] = "absolute";
        		menu.style["top"] = cy + "px";
        		menu.style["left"] = (cx - 10) + "px";
        	}
        	else {
        		menu.style["display"] = "";
        		menu.style["position"] = "absolute";
        		menu.style["top"] = (pos.top + pos.height) + "px";
        		menu.style["left"] = pos.left + "px";
        	}
        	__showTimer = null;
        }

        function __HideDropDown(divId) {
        	if(__showTimer) clearTimeout(__showTimer);
        	__hideTimer = setTimeout('__HideDropDownForReal("' + divId + '");', 200);
        }

        function __HideDropDownForReal(divId) {
        	document.getElementById(divId).style["display"] = "none";
        	__hideTimer = null;
        }

        function __CancelHideTimer() {
        	if(__hideTimer) clearTimeout(__hideTimer);
        }
        
    // -->
    </script>

	<a id="PageTop"></a>
	
	<div id="PageHeaderDiv">
	
		<!-- Change this to PageToolbarDiv -->
		<div id="EditHistoryLinkDiv">
			<a id="DiscussLink" title="Discuss" href="MMBasic.PWM-BAS-part-of-the-original-MMBasic-library266d.html?Discuss=1">Discuss (0)</a>
			
			
			<a id="HistoryLink" title="View Page edit history" href="MMBasic.History5c69.html?Page=MMBasic.PWM-BAS-part-of-the-original-MMBasic-library">History</a>
			
			
			
			
			
		</div>
		
		<h1 class="pagetitle">
			
			PWM.BAS
			
		</h1>
		
		<div id="PrintLinkDiv">
			<a id="PrintLink" href="MMBasic.Print5c69.html?Page=MMBasic.PWM-BAS-part-of-the-original-MMBasic-library" title="Printer friendly version" target="_blank">Print</a>
		</div>
		
		<div id="RssLinkDiv">
			
		</div>
		
		<div id="EmailNotificationDiv">
			<span id="Anthem_ctl00_CphMaster_btnEmailNotification__"></span>
		</div>
		
		<div id="ctl00_CphMaster_pnlPageInfo">
	
			<div id="PageInfoDiv">
				<span id="ModificationSpan">
					Modified on 
					2016/12/23 23:38
				</span>
				<span id="AuthorSpan">
					 by 
					<a href="MMBasic.User6a4a.html?Username=admin">Administrator</a>
				</span>
				<span id="NavPathsSpan">
					
				</span>
				<span id="CategoriesSpan">
					Categorized as 
					<a href="MMBasic.AllPagese076.html?Cat=MMBasic.Control" title="Control">Control</a>, <a href="MMBasic.AllPages5ce5.html?Cat=MMBasic.Electronics" title="Electronics">Electronics</a>, <a href="MMBasic.AllPages0f85.html?Cat=MMBasic._LIB%20Original%20MMBasic" title="_LIB Original MMBasic">_LIB Original MMBasic</a>
				</span>
				
				<span id="PageDiscussionSpan">
					
					
				</span>
			</div>
		
</div>
		
		<div id="ff2682907-6ce1-4cd0-964b-42acb98e943c" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('ff2682907-6ce1-4cd0-964b-42acb98e943c');"></div><div id="BreadcrumbsDiv"><div id="BreadcrumbsDivMin"><a href="#" onclick="javascript:return __ShowAllTrail();" title="Click here to view the complete Breadcrumbs Trail">(10)</a> &raquo; <a href="MMBasic.PSYCTEST-BAS-part-of-the-original-MMBasic-library.html" title="PSYCTEST.BAS (MMBasic)">PSYCTEST.BAS (MMBasic)</a> &raquo; <a href="MMBasic.PWM-for-LED.html" title="PWM for LED (MMBasic)">PWM for LED (MMBasic)</a> &raquo; <b><a href="MMBasic.PWM-BAS-part-of-the-original-MMBasic-library.html" title="PWM.BAS (MMBasic)">PWM.BAS (MMBasic)</a></b> </div><div id="BreadcrumbsDivAll" style="display: none;"><a href="#" onclick="javascript:return __HideTrail();" title="Click here to hide the Breadcrumbs Trail">[X]</a> &raquo; <a href="MMBasic.Parsing-GPS-NMEA-strings-part-of-the-original-MMBasic-library.html" title="Parsing GPS NMEA strings (MMBasic)">Parsing GPS NMEA strings (MMBasic)</a> &raquo; <a href="MMBasic.PicoMite-MCP4922-DAC-on-SPI.html" title="PicoMite: MCP4922 DAC on SPI (MMBasic)">PicoMite: MCP4922 DAC on SPI (MMBasic)</a> &raquo; <a href="MMBasic.Polar-and-Rectangular-Co-ordinate-Conversion-Functions.html" title="Polar and Rectangular Co-ordinate Conversion Functions (MMBasic)">Polar and Rectangular Co-ordinate Conversion Functions (MMBasic)</a> &raquo; <a href="MMBasic.Potentiometer-test-part-of-the-original-MMBasic-library.html" title="Potentiometer test (MMBasic)">Potentiometer test (MMBasic)</a> &raquo; <a href="MMBasic.Program-Step-A-Fast-Flexible-Debugging-Aid.html" title="Program Step - A Fast, Flexible Debugging Aid (MMBasic)">Program Step - A Fast, Flexible Debugging Aid (MMBasic)</a> &raquo; <a href="MMBasic.pslist-simple-list-select-Sub-routine.html" title="pslist - simple list select Sub routine (MMBasic)">pslist - simple list select Sub routine (MMBasic)</a> &raquo; <a href="MMBasic.psmenu-simple-menu-to-select-a-menu-item.html" title="psmenu - simple menu to select a menu item (MMBasic)">psmenu - simple menu to select a menu item (MMBasic)</a> &raquo; <a href="MMBasic.PSYCTEST-BAS-part-of-the-original-MMBasic-library.html" title="PSYCTEST.BAS (MMBasic)">PSYCTEST.BAS (MMBasic)</a> &raquo; <a href="MMBasic.PWM-for-LED.html" title="PWM for LED (MMBasic)">PWM for LED (MMBasic)</a> &raquo; <b><a href="MMBasic.PWM-BAS-part-of-the-original-MMBasic-library.html" title="PWM.BAS (MMBasic)">PWM.BAS (MMBasic)</a></b> </div></div>
		
		
	
	</div>
	
	<div id="PageContentDiv">
		<h2 class="separator">This module is part of the original MMBasic library. It is reproduced here with kind permission of Hugh Buckle and Geoff Graham. Be aware it may reference functionality which has changed or is deprecated in the latest versions of MMBasic.<a class="headeranchor" id="This_module_is_part_of_the_original_MMBasic_library_It_is_reproduced_here_with_kind_permission_of_Hugh_Buckle_and_Geoff_Graham_Be_aware_it_may_reference_functionality_which_has_changed_or_is_deprecated_in_the_latest_versions_of_MMBasic_0" href="#This_module_is_part_of_the_original_MMBasic_library_It_is_reproduced_here_with_kind_permission_of_Hugh_Buckle_and_Geoff_Graham_Be_aware_it_may_reference_functionality_which_has_changed_or_is_deprecated_in_the_latest_versions_of_MMBasic_0" title="Link to this Section">&#0182;</a></h2><b>Note</b>: Any required file(s) are available in the attachments tab (top right).<br /><br /><pre>
5 TW=0&#58;TD=0&#58;TH=0&#58;TM=0&#58;TS=0&#58;TT=0&#58;Timer=0 ' Initialise the elapsed time variables
10 'initialise I/O pins
15 voltpin1 = 1 'set analog voltage input pin for main bus (can be 1 - 10)
20 voltpin2 = 2 'set analog voltage input pin for 9V rail (can be 1 - 10)
25 voltpin3 = 3 'set analog voltage input pin for 5V rail (can be 1 - 10)
30 pwmpin = 8 'set the pwm output pin (can be 7 - 10)
35 freqpin1 = 14 'set the frequency input pin (can be 11 - 14)
40 freq = 100 'set initial frequency to 100Hz (can be 1 - 5000)
45 duty = 50 'set initial duty cycle to 50% (can be 0 - 100 in increments of 1)
50 offset1 = 0 'use to adjust for any offset in analog input for main bus
55 offset2 = 0 'use to adjust for any offset in analog input for 9V rail
60 offset3 = 0 'use to adjust for any offset in analog input for 5V rail
65 coefficient1 = 20 'use to scale the analog input for main bus (range 0 - 66 (20 &#42; 3.3))
70 coefficient2 = 5 'use to scale the analog input for 9V rail (range 0 - 16.5 (5 &#42; 3.3))
75 coefficient3 = 3 'use to scale the analog input for 5V rail (range 0 - 9.9 (3 &#42; 3.3))
80 tick_avg = 100 'number of analog voltage samples to average each second
85 tick_flag = 0
90 tick_cnt = 0
95 Dim tick_array1(tick_avg)
100 Dim tick_array2(tick_avg)
105 Dim tick_array3(tick_avg)
110 SetPin voltpin3,1 'configure pin for analog input
115 SetPin voltpin2,1 'configure pin for analog input
120 SetPin voltpin1,1 'configure pin for analog input
125 SetPin freqpin1,3 'configure pin for frequency input
130 SetPin pwmpin,10,freq,duty 'initiate PWM output
135 SetTick Cint(1000/tick_avg),1100 'set tick interrupt for tick_avg per second
140 'initialise print locations
145 locMainBuss = 12
150 loc9VRail = 36
155 loc5VRail = 60
160 locRepFreq = 84
165 locRunFreq = 108
170 locRunDuty = 132
175 locElapsed = 156
180 locCmdString = 180
185 locCmdInput = locCmdString + 12
190 duty_str$ = "Enter duty cycle (0 - 100 for 0% - 100%), 'F' to change frequency or 'Q' to quit"
195 freq_str$ = "Enter frequency (1 - 5000 for 1 - 5kHz), 'D' to change duty cycle or 'Q' to quit"
200 Cls
205 volt1 = offset1 + (Pin(voltpin1) &#42; coefficient)
210 volt2 = offset2 + (Pin(voltpin2) &#42; coefficient)
215 volt3 = offset3 + (Pin(voltpin3) &#42; coefficient)
220 state = 1
225 Locate 0,locMainBuss &#58; ? "Main Buss A V+ =";
230 Locate 96,locMainBuss &#58; ? Format$(volt1,"% .3fV ");
235 Locate 0,loc9VRail &#58; ? "9 Volt Rail V+ =";
240 Locate 96,loc9VRail &#58; ? Format$(volt2,"% .3fV ");
245 Locate 0,loc5VRail &#58; ? "5 Volt Rail V+ =";
250 Locate 96,loc5VRail &#58; ? Format$(volt3,"% .3fV ");
255 Locate 0,locRepFreq &#58; ? "Reported frequency =";
260 Locate 120,locRepFreq &#58; ? Format$(Pin(freqpin1),"% .0fHz    ");
265 Locate 0,locRunFreq &#58; ? "Running frequency =";
270 Locate 114,locRunFreq &#58; ? freq; "Hz ";
275 Locate 0,locRunDuty &#58; ? "Mark space ratio =";
280 Locate 108,locRunDuty &#58; ? duty; "% ";
285 Locate 0,locElapsed&#58;GoSub 10000 ' This will print the elapsed time
290 Locate 0,locCmdString &#58; ? duty_str$
295 Do While state &gt; 0
300  GoSub 500
305  If state = 1 Then
310   If number &gt;= 0 And number &lt;= 100 Then
315    duty = number &#58; SetPin pwmpin,10,freq,duty
320   Else
325    GoSub 900 &#58; ? number; " - Invalid duty cycle!" &#58; Pause(1000) &#58; GoSub 900
330   EndIf
335  ElseIf state = 2 Then
340   If number &gt;= 1 And number &lt;= 5000 Then
345    freq = number &#58; SetPin pwmpin,10,freq,duty
350   Else
355    GoSub 900 &#58; ? number; " - Invalid frequency!" &#58; Pause(1000) &#58; GoSub 900
360   EndIf
365  EndIf
370  Locate 96,locMainBuss &#58; ? Format$(volt1,"% .3fV ");
375  Locate 96,loc9VRail &#58; ? Format$(volt2,"% .3fV ")
380  Locate 96,loc5VRail &#58; ? Format$(volt3,"% .3fV ")
385  Locate 120,locRepFreq &#58; ? Format$(Pin(freqpin1),"% .0fHz    ");
390  Locate 114,locRunFreq &#58; ? freq; "Hz ";
395  Locate 108,locRunDuty &#58; ? duty; "% ";
400  Locate 0,locElapsed&#58;GoSub 10000 ' This will print the elapsed time
405 Loop
410 SetPin voltpin3,0
415 SetPin voltpin2,0
420 SetPin voltpin1,0
425 SetPin freqpin1,0
430 SetPin pwmpin,0
435 GoSub 900
459 End
499 ' get number routine
500 GoSub 900
505 Do While 1
510  If tick_flag = 1 Then
515   tick_flag = 0
520   Locate 96,locMainBuss &#58; ? Format$(volt1,"% .3fV ");
525   Locate 96,loc9VRail &#58; ? Format$(volt2,"% .3fV ");
530   Locate 96,loc5VRail &#58; ? Format$(volt3,"% .3fV ");
535   Locate 120,locRepFreq &#58; ? Format$(Pin(freqpin1),"% .0fHz    ");
540   Locate 114,locRunFreq &#58; ? freq; "Hz ";
545   Locate 108,locRunDuty &#58; ? duty; "% ";
550   Locate 0,locElapsed&#58;GoSub 10000 ' This will print the elapsed time
555   Locate Len(numstr$) &#42; 6,locCmdInput
560  EndIf
565  inpkey$ = UCase$(Inkey$)
570  If inpkey$ = "" Then GoTo 510
575  If inpkey$ = "Q" Then state = -1 &#58; Exit
580  If inpkey$ = "D" Then
585   Locate 0,locCmdString
590   ? duty_str$
595   state = 1
600   GoSub 900
605   GoTo 510
610  EndIf
615  If inpkey$ = "F" Then
620   Locate 0,locCmdString
625   ? freq_str$
630   state = 2
635   GoSub 900
640   GoTo 510
645  EndIf
650  If inpkey$ &lt; "0" Or inpkey$ &gt; "9" Then
655   numlen = Len(numstr$)
660   If Asc(inpkey$) = 13 Then
665    If numlen = 0 Then number = -1 Else number = Val(numstr$)
670    Exit
675   ElseIf Asc(inpkey$) = 8 Then
680    If numlen &gt; 0 Then
685     If numlen &lt;&gt; 1 Then numstr$ = Left$(numstr$, numlen - 1) Else numstr$ = ""
690     csr = (numlen - 1) &#42; 6
695     Locate csr,locCmdInput &#58; ? " "; &#58; Locate csr,locCmdInput
700    EndIf
705   EndIf
710  Else
715   numstr$ = numstr$ + inpkey$
720   ? inpkey$;
725  EndIf
730 Loop
735 GoSub 900
799 Return
899 ' clear input
900 numstr$ = ""
910 Locate 0,locCmdInput
920 ? Space$(80)
930 Locate 0,locCmdInput
999 Return
1099 ' settick interrupt routine
1100 tick_cnt = tick_cnt + 1
1110 tick_array1(tick_cnt) = offset1 + (Pin(voltpin1) &#42; coefficient1)
1120 tick_array2(tick_cnt) = offset2 + (Pin(voltpin2) &#42; coefficient2)
1130 tick_array3(tick_cnt) = offset3 + (Pin(voltpin3) &#42; coefficient3)
1140 If tick_cnt &lt;&gt; tick_avg Then IReturn
1150 volt1 = 0
1160 volt2 = 0
1170 volt3 = 0
1180 For i = 1 To tick_avg
1190  volt1 = volt1 + tick_array1(i)
1200  volt2 = volt2 + tick_array2(i)
1210  volt3 = volt3 + tick_array3(i)
1220 Next i
1230 volt1 = volt1 / tick_avg
1240 volt2 = volt2 / tick_avg
1250 volt3 = volt3 / tick_avg
1260 tick_cnt = 0
1270 tick_flag = 1
1299 IReturn
9999 ' Elapsed time routine to update the elapsed time and print it
10000 TC=Timer&#58;Timer=0&#58;TT=TT+TC
10010 If TT&gt;=1000 Then TS=TS+(TT\1000)&#58;TT=TT Mod 1000
10020 If TS&gt;=60 Then TM=TM+(TS\60)&#58;TS=TS Mod 60
10030 If TM&gt;=60 Then TH=TH+(TM\60)&#58;TM=TM Mod 60
10040 If TH&gt;=24 Then TD=TD+(TH\24)&#58;TH=TH Mod 24
10050 If TD&gt;=7 Then TW=TW+(TD\7)&#58;TD=TD Mod 7
10060 pflag=0&#58;? "Elapsed time&#58;";
10070 If TW&gt;0 Then pflag=1&#58;? TW;" weeks,";
10080 If TD&gt;0 Or pflag=1 Then pflag=1&#58;? TD;" days,";
10090 If TH&gt;0 Or pflag=1 Then pflag=1&#58;? TH;" hours,";
10100 If TM&gt;0 Or pflag=1 Then ? TM;" minutes,";
10110 ? Format$(TS," %1.0f.");Format$(TT,"%03.0f seconds ");
10120 Return

</pre><br />
	</div>
	
	
	
	<div id="PageAttachmentsDiv" style="position: absolute; left: 10000px;">
		
    </div>
    
    <div id="AdminToolsDiv" style="position: absolute; left: 10000px;">
		
		
		
    </div>
    
    <script type="text/javascript">
    <!--
    	function __RepositionDiv(link, element) {
    		var absPos = __AbsolutePosition(link);
    		var elemAbsPos = __AbsolutePosition(element);

    		element.style["top"] = (absPos.top + absPos.height) + "px";
    		element.style["left"] = (absPos.left - (elemAbsPos.width - absPos.width)) + "px";
    		element.style["position"] = "absolute";
    	}

		// Hide attachments and admin tools divs
    	// This is needed because __RepositionDiv cannot calculate the width of the element when it's hidden
    	var __elem = document.getElementById("PageAttachmentsDiv");
    	if(document.getElementById("PageAttachmentsLink")) {
    		__RepositionDiv(document.getElementById("PageAttachmentsLink"), __elem);
    	}
    	__elem.style["display"] = "none";

    	__elem = document.getElementById("AdminToolsDiv");
    	if(document.getElementById("AdminToolsLink")) {
    		__RepositionDiv(document.getElementById("AdminToolsLink"), __elem);
    	}
    	__elem.style["display"] = "none";

    	__InitBCT();
    // -->
    </script>


                <div id="PageInternalFooterDiv"></div>
                <div id="MainFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>

        </div>
            
        <div id="FooterDiv">
             
        </div>

    </form>  
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.PWM-BAS-part-of-the-original-MMBasic-library.ashx?NoRedirect=1 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:52:29 GMT -->
</html>
