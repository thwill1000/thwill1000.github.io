

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" >

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Xmodem-CRC by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:25:49 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><title>
	Xmodem CRC - Fruit Of The Shed
</title><link rel="stylesheet" type="text/css" href="Themes/Print.css" /></head>
<body>
    <form name="frmPrint" method="post" action="http://fruitoftheshed.com/Print.aspx?NS=MMBasic&amp;Page=MMBasic.Xmodem-CRC" id="frmPrint">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTIwMDg4Njc4MjcPZBYCAgEPZBYCAgEPFgIeBFRleHQFyhI8aDEgY2xhc3M9InBhZ2V0aXRsZSI+WG1vZGVtIENSQzwvaDE+PHNtYWxsPk1vZGlmaWVkIG9uIDIwMjAvMTEvMjkgMjE6MjIgYnkgQ2FwdGFpbkJvaW5nICZtZGFzaDsgQ2F0ZWdvcml6ZWQgYXM6IENvbW11bmljYXRpb25zLCBTdHJpbmdzPC9zbWFsbD48YnIgLz48YnIgLz48Yj48YnIgLz5JbnRyb2R1Y3Rpb246PC9iPjxiciAvPlRoaXMgQ1JDIChDeWNsaWMgUmVkdW5kYW5jeSBDaGVjaykgaXMgZm9yIHRoZSBYbW9kZW0gdHJhbnNmZXIgcHJvdG9jb2wuIFRoZSAxNiBiaXQgQ1JDIGlzIGNhbGN1bGF0ZWQgYnkgcHJvY2Vzc2luZyB0aGUgZGF0YSBpbiBhIG1lc3NhZ2UgYml0IGJ5IGJpdC4gSXQgY2Fubm90IGNvcnJlY3QgYW55IGRhdGEgY29ycnVwdGlvbiBidXQgY2FuIGluZGljYXRlIGlmIGEgbWVzc2FnZSBoYXMgYmVlbiBjb3JydXB0ZWQgaW4gYW55IHdheS48YnIgLz48YnIgLz48Yj5QTEVBU0UgTk9URTo8L2I+PGJyIC8+QWx0aG91Z2ggdGhpcyBpcyBhbiBYbW9kZW0gQ1JDIGl0IGlzIGluIG5vIHdheSByZXN0cmljdGVkIHRvIHRoZSBYbW9kZW0gcHJvdG9jb2wuIExpa2UgdGhlIE1vZGJ1cyBDUkMgYW55IG1lc3NhZ2Ugc3RydWN0dXJlIG9mIGFueSBsZW5ndGggY29uc2lzdGluZyBvZiBhIHN0cmVhbSBvZiA4LWJpdCBkYXRhIGJ5dGVzIGNhbiB1dGlsaXNlIGl0IHRvIGltcHJvdmUgc2VjdXJpdHkuIEZvciBleGFtcGxlOjxiciAvPk1zZyQgPSDigJxUaGUgcXVpY2sgYnJvd24gZm94IGp1bXBzIG92ZXIgdGhlIGxhenkgZG9n4oCdPGJyIC8+PGJyIC8+VGhlIHN0cnVjdHVyZSBvZiBhbiBYbW9kZW0gbWVzc2FnZSBpczo8YnIgLz48cHJlPkJ5dGUgMQkJU09IDQpCeXRlIDIJCVBhY2tldCBudW1iZXIgKDAtMjU1KQ0KQnl0ZSAzCQlJbnZlcnNlIHBhY2tldCBudW1iZXIgKDI1NSAtIHBhY2tldCBudW1iZXIpDQpCeXRlIDQtMTMxCTEyOCBieXRlcyBvZiBkYXRhDQpCeXRlIDEzMi0xMzMJMTYgYml0IENSQzwvcHJlPjxiciAvPlRoZSByZWNlaXZlciByZXNwb25kcyB3aXRoIGFuIEFDSyBvciBOQUNLIGRlcGVuZGluZyB3aGV0aGVyIHRoZSBDUkMgaXMgZ29vZCBvciBiYWQuIEFuZCBkZXBlbmRpbmcgb24gdGhlIGFuc3dlciB0aGUgdHJhbnNtaXR0ZXIgd2lsbCB0cmFuc21pdCB0aGUgbmV4dCBibG9jayBvZiBkYXRhIG9yIHJlLXRyYW5zbWl0IHRoZSBiYWQgYmxvY2suIFdoZXJlIHRoZXJlIGFyZSBub3QgMTI4IGJ5dGVzIG9mIGRhdGEgdGhlIGJsb2NrIG9mIDEyOCBpcyBmaWxsZWQgd2l0aCBhIHBhY2tpbmcgY2hhcmFjdGVyLiBJZiB5b3Ugd2FudCB0byBmdWxseSBpbXBsZW1lbnQgdGhlIFhtb2RlbSBwcm90b2NvbCB0aGVyZSBpcyBwbGVudHkgb2YgaW5mb21hdGlvbiBvbiB0aGUgd2ViLjxiciAvPjxiciAvPkFkZCB0aGUgQ1JDIHRvIHRoZSBtZXNzYWdlIChlZzogUnhNc2ckKSBieTo8YnIgLz48YnIgLz48cHJlPlR4TXNnJCA9IFR4TXNnJCArIFhDUkMkKFR4TXNnKTwvcHJlPjxiciAvPmFuZCB0cmFuc21pdCBpdC48YnIgLz48YnIgLz5QZXJmb3JtaW5nIGEgQ1JDIGNoZWNrIG9uIGEgbWVzc2FnZSB0aGF0IGFscmVhZHkgaW5jbHVkZXMgYSB2YWxpZCBDUkMgd2lsbCBwcm9kdWNlIGEgJ0NSQycgb2YgJmgwMDAgc286PGJyIC8+VG8gdGVzdCBhIHJlY2lldmVkIG1lc3NhZ2UgKGVnOiBSeE1zZyQpIGZvciBhIGNvcnJlY3QgQ1JDIGFuZCB0aGF0IGl0IGlzIG5vdCBvdGhlcndpc2UgY29ycnVwdGVkIHVzZTo8YnIgLz48YnIgLz48cHJlPklGIFhDUkMkKFJ4TXNnJCkgPSBDSFIkKDApICsgQ0hSJCgwKSBUSEVOICcgQ1JDIGlzIE9LDQonIFByb2Nlc3MgdGhlIG1lc3NhZ2UNCkVMU0UNCicgSWdub3JlIHRoZSBtZXNzYWdlIG9yIHNlbmQgYSBOQUsNCkVORCBJRjwvcHJlPjxiciAvPkFzc3VtcHRpb25zOjxiciAvPk5vbmU8YnIgLz48YnIgLz5UaGUgRnVuY3Rpb246PGJyIC8+PHByZT5GVU5DVElPTiBYQ1JDJChhJCkNCiAgTE9DQUwgQ1JDJSA9ICZhbXA7SDAwMDAsIG4lLCBqJQ0KICBGT1IgbiUgPSAxIFRPIExFTihBJCkNCiAgICBDUkMlID0gKENSQyUgQU5EICZhbXA7SEZGRkYpIFhPUiAoQVNDKE1JRCQoYSQsIG4lLCAxKSkgJmx0OyZsdDsgOCkNCiAgICBGT1IgaiUgPSAxIFRPIDgNCiAgICAgIElGIChDUkMlIEFORCAmYW1wO0g4MDAwKSAmbHQ7Jmd0OyAwIFRIRU4NCiAgICAgICAgQ1JDJSA9IChDUkMlICZsdDsmbHQ7IDEpIFhPUiAmYW1wO0gxMDIxDQogICAgICBFTFNFIA0KICAgICAgICBDUkMlID0gQ1JDJSAmbHQ7Jmx0OyAxDQogICAgICBFTkQgSUYNCiAgICBORVhUIGolDQogIE5FWFQgbiUNCiAgWENSQyQgPSBDSFIkKENSQyUgJmd0OyZndDsgOCBBTkQgJmFtcDtIRkYpICsgQ0hSJChDUkMlIEFORCAmYW1wO0hGRikNCkVORCBGVU5DVElPTjwvcHJlPjxiciAvPmRknKJSc2jwNVVGgOEsjl3+C6r9gN4=" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="03CF0AB7" />
</div>
        <h1 class="pagetitle">Xmodem CRC</h1><small>Modified on 2020/11/29 21:22 by CaptainBoing &mdash; Categorized as: Communications, Strings</small><br /><br /><b><br />Introduction:</b><br />This CRC (Cyclic Redundancy Check) is for the Xmodem transfer protocol. The 16 bit CRC is calculated by processing the data in a message bit by bit. It cannot correct any data corruption but can indicate if a message has been corrupted in any way.<br /><br /><b>PLEASE NOTE:</b><br />Although this is an Xmodem CRC it is in no way restricted to the Xmodem protocol. Like the Modbus CRC any message structure of any length consisting of a stream of 8-bit data bytes can utilise it to improve security. For example:<br />Msg$ = “The quick brown fox jumps over the lazy dog”<br /><br />The structure of an Xmodem message is:<br /><pre>Byte 1		SOH
Byte 2		Packet number (0-255)
Byte 3		Inverse packet number (255 - packet number)
Byte 4-131	128 bytes of data
Byte 132-133	16 bit CRC</pre><br />The receiver responds with an ACK or NACK depending whether the CRC is good or bad. And depending on the answer the transmitter will transmit the next block of data or re-transmit the bad block. Where there are not 128 bytes of data the block of 128 is filled with a packing character. If you want to fully implement the Xmodem protocol there is plenty of infomation on the web.<br /><br />Add the CRC to the message (eg: RxMsg$) by:<br /><br /><pre>TxMsg$ = TxMsg$ + XCRC$(TxMsg)</pre><br />and transmit it.<br /><br />Performing a CRC check on a message that already includes a valid CRC will produce a 'CRC' of &h000 so:<br />To test a recieved message (eg: RxMsg$) for a correct CRC and that it is not otherwise corrupted use:<br /><br /><pre>IF XCRC$(RxMsg$) = CHR$(0) + CHR$(0) THEN ' CRC is OK
' Process the message
ELSE
' Ignore the message or send a NAK
END IF</pre><br />Assumptions:<br />None<br /><br />The Function:<br /><pre>FUNCTION XCRC$(a$)
  LOCAL CRC% = &amp;H0000, n%, j%
  FOR n% = 1 TO LEN(A$)
    CRC% = (CRC% AND &amp;HFFFF) XOR (ASC(MID$(a$, n%, 1)) &lt;&lt; 8)
    FOR j% = 1 TO 8
      IF (CRC% AND &amp;H8000) &lt;&gt; 0 THEN
        CRC% = (CRC% &lt;&lt; 1) XOR &amp;H1021
      ELSE 
        CRC% = CRC% &lt;&lt; 1
      END IF
    NEXT j%
  NEXT n%
  XCRC$ = CHR$(CRC% &gt;&gt; 8 AND &amp;HFF) + CHR$(CRC% AND &amp;HFF)
END FUNCTION</pre><br />
    </form>
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Xmodem-CRC by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:25:49 GMT -->
</html>
