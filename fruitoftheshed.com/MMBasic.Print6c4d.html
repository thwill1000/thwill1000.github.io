

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" >

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Clock-frequency-trimming-on-Micromite-II-uses-precision-32-768KHz-output-from-DS3231-Real-Time-Clock by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:14:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><title>
	Clock frequency trimming on Micromite II uses precision 32.768KHz output from DS3231 Real Time Clock - Fruit Of The Shed
</title><link rel="stylesheet" type="text/css" href="Themes/Print.css" /></head>
<body>
    <form name="frmPrint" method="post" action="http://fruitoftheshed.com/Print.aspx?NS=MMBasic&amp;Page=MMBasic.Clock-frequency-trimming-on-Micromite-II-uses-precision-32-768KHz-output-from-DS3231-Real-Time-Clock" id="frmPrint">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTIwMDg4Njc4MjcPZBYCAgEPZBYCAgEPFgIeBFRleHQFqw48aDEgY2xhc3M9InBhZ2V0aXRsZSI+Q2xvY2sgZnJlcXVlbmN5IHRyaW1taW5nIG9uIE1pY3JvbWl0ZSBJSSB1c2VzIHByZWNpc2lvbiAzMi43NjhLSHogb3V0cHV0IGZyb20gRFMzMjMxIFJlYWwgVGltZSBDbG9jazwvaDE+PHNtYWxsPk1vZGlmaWVkIG9uIDIwMTcvMDgvMTAgMTc6MDMgYnkgQWRtaW5pc3RyYXRvciAmbWRhc2g7IENhdGVnb3JpemVkIGFzOiBDb250cm9sLCBEYXRlcywgVGltZSBhbmQgQ2xvY2tzLCBFbGVjdHJvbmljcywgSGFyZHdhcmUsIE1hdGhzPC9zbWFsbD48YnIgLz48YnIgLz5UaGUgRFMzMjMxIFJUQyBoYXMgYSB2ZXJ5IHByZWNpc2UgMzIuNzY4S0h6IG91dHB1dCB1c3VhbGx5IG9uIHBpbiAxICh5bW12KS4gQnkgdGFraW5nIHRoaXMga25vd24gZnJlcXVlbmN5IGFuZCBtZWFzdXJpbmcgaXQgdXNpbmcgdGhlIENPVU5UIGZ1bmN0aW9uIGluIE1NQmFzaWMsIHRoZSBpbnRlcm5hbCBjbG9jayBmcmVxdWVuY3kgKHdoaWNoIGRldGVybWluZXMgdGhlIGdhdGUgcGVyaW9kIGZvciB0aGUgY291bnQpIGNhbiBiZSBhZGp1c3RlZCB1bnRpbCB0aGUgbWVhc3VyZWQgZnJlcXVlbmN5IGlzIGFzIG5lYXIgYXMgcG9zc2libGUgdG8gdGhlIGtub3cgZnJlcXVlbmN5IGZyb20gdGhlIFJUQy48YnIgLz48YnIgLz5UaGUgY2xldmVyIGNvZGUgYmVsb3cgbWVhc3VyZXMgdGhlIGZyZXF1ZW5jeSBhbmQgYXV0b21hdGljYWxseSBjYWxjdWxhdGVzIHRoZSBDTE9DS1RSSU0gYXJndW1lbnQuPGJyIC8+PGJyIC8+T3JpZ2luYWxseSBwb3N0ZWQgaGVyZTogPGEgY2xhc3M9ImV4dGVybmFsbGluayIgaHJlZj0iaHR0cDovL3d3dy50aGViYWNrc2hlZC5jb20vZm9ydW0vZm9ydW1fcG9zdHMuYXNwP1RJRD03OTcyIiB0aXRsZT0iaHR0cDovL3d3dy50aGViYWNrc2hlZC5jb20vZm9ydW0vZm9ydW1fcG9zdHMuYXNwP1RJRD03OTcyIiB0YXJnZXQ9Il9ibGFuayI+aHR0cDovL3d3dy50aGViYWNrc2hlZC5jb20vZm9ydW0vZm9ydW1fcG9zdHMuYXNwP1RJRD03OTcyPC9hPjxiciAvPjxiciAvPjxiPkNyZWRpdDwvYj46IHR3b2ZpbmdlcnM8YnIgLz48YnIgLz48YSBjbGFzcz0idW5rbm93bmxpbmsiIGhyZWY9Ik1NQmFzaWMuLmFzaHgiIHRpdGxlPSJNTUJhc2ljLiI+PC9hPjxpbWcgc3JjPSJHZXRGaWxlLmFzcHg/RmlsZT0vZHMzMjMxLXBpbm91dC5wbmciIGFsdD0iSW1hZ2UiIC8+PGJyIC8+PGJyIC8+PHByZT4NCg0KJyBDbG9ja3RyaW0gbGV2ZWwgZm9yIE1pY3JvbWl0ZTIvTU1CYXNpYyANCicgZGV0ZXJtaW5lcyB0aGUgdmFsdWUgZm9yIE9wdGlvbiBDbG9ja1RyaW0gbiANCicgdXNpbmcgdGhlIERTMzIzMSAzMjc2OGh6IHNpZ25hbCAoMzJrSHogVENYTykuIA0KJyBSZWxlYXNlZCBieSB0d29maW5nZXJzQFRCUyAxOC4wOS4yMDE1IA0KJyBQcm92aWRlZCBBUyBJUy4gTm8gd2FycmFudHkuIA0KJyANCicgWW91IG5lZWQgb25seSB0byBjb25uZWN0IGEgd2lyZSBmcm9tICANCicgRFMzMjMxLzMya0h6IFBpbiAxIHRvIGEgTU0yIChDT1VOVCkgcGluIChlLmcuIDE2KSANCg0KIA0KT3B0aW9uIEVYUExJQ0lUIA0KRGltIGludGVnZXIgZnJlcSxjdHJpbSANCg0KU2V0UGluIDE2LGZpbiANClBhdXNlIDIwMDAgDQpmcmVxPVBpbigxNikgDQoNCmN0cmltPUNpbnQoZnJlcS0zMjc2OCkvMTUgDQonUHJpbnQgZnJlcSwgY3RyaW0gDQpJZiBBYnMoY3RyaW0pICZsdDsgMTAgVGhlbiANCiAgIE9wdGlvbiBDbG9ja1RyaW0gY3RyaW0gDQogICBQcmludCAiQ2xvY2tUcmltIGlzIHNldCB0byAiY3RyaW0gDQpFbHNlIA0KICAgUHJpbnQgIkVycm9yISBQbGVhc2UgY2hlY2sgMzJraHogc2lnbmFsLiBGcmVxPSJmcmVxIA0KRW5kSWYNCjwvcHJlPmRkqeMdxiTCQi5EmoLTj+xjKS+bFDM=" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="03CF0AB7" />
</div>
        <h1 class="pagetitle">Clock frequency trimming on Micromite II uses precision 32.768KHz output from DS3231 Real Time Clock</h1><small>Modified on 2017/08/10 17:03 by Administrator &mdash; Categorized as: Control, Dates, Time and Clocks, Electronics, Hardware, Maths</small><br /><br />The DS3231 RTC has a very precise 32.768KHz output usually on pin 1 (ymmv). By taking this known frequency and measuring it using the COUNT function in MMBasic, the internal clock frequency (which determines the gate period for the count) can be adjusted until the measured frequency is as near as possible to the know frequency from the RTC.<br /><br />The clever code below measures the frequency and automatically calculates the CLOCKTRIM argument.<br /><br />Originally posted here: <a class="externallink" href="http://www.thebackshed.com/forum/forum_posts.asp?TID=7972" title="http://www.thebackshed.com/forum/forum_posts.asp?TID=7972" target="_blank">http://www.thebackshed.com/forum/forum_posts.asp?TID=7972</a><br /><br /><b>Credit</b>: twofingers<br /><br /><a class="unknownlink" href="MMBasic..html" title="MMBasic."></a><img src="ds3231-pinout7088.png?File=/ds3231-pinout.png" alt="Image" /><br /><br /><pre>

' Clocktrim level for Micromite2/MMBasic 
' determines the value for Option ClockTrim n 
' using the DS3231 32768hz signal (32kHz TCXO). 
' Released by twofingers@TBS 18.09.2015 
' Provided AS IS. No warranty. 
' 
' You need only to connect a wire from  
' DS3231/32kHz Pin 1 to a MM2 (COUNT) pin (e.g. 16) 

 
Option EXPLICIT 
Dim integer freq,ctrim 

SetPin 16,fin 
Pause 2000 
freq=Pin(16) 

ctrim=Cint(freq-32768)/15 
'Print freq, ctrim 
If Abs(ctrim) &lt; 10 Then 
   Option ClockTrim ctrim 
   Print "ClockTrim is set to "ctrim 
Else 
   Print "Error! Please check 32khz signal. Freq="freq 
EndIf
</pre>
    </form>
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Clock-frequency-trimming-on-Micromite-II-uses-precision-32-768KHz-output-from-DS3231-Real-Time-Clock by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:14:30 GMT -->
</html>
