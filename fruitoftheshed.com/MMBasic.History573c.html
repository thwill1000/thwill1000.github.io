

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from fruitoftheshed.com/MMBasic.History.aspx?Page=MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores&Revision=6 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:36:32 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=8" /><title>
	Page History - Fruit Of The Shed
</title><script type="text/javascript" src="JS/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="JS/Scripts.js"></script>
<script type="text/javascript" src="JS/SearchHighlight.js"></script>
<link rel="stylesheet" media="print" href="Themes/Default/Print_Styles.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles%20-%20Copy.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles.css" type="text/css" />
<link rel="stylesheet" href="Themes/Editor.css" type="text/css" />
<link rel="search" href="searchf7b1.xml?OpenSearch=1" type="application/opensearchdescription+xml" title="Fruit Of The Shed - Search" /><script src="Themes/Default/Scripts.js" type="text/javascript"></script>
<link rel="shortcut icon" href="Themes/Default/Icon.ico" type="image/x-icon" />
</head>
<body>
    <form name="aspnetForm" method="post" action="http://fruitoftheshed.com/History.aspx?NS=MMBasic&amp;Page=MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores&amp;Revision=6" id="aspnetForm">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTEzMjI3OTE2NTkPZBYCZg9kFgICAQ9kFgICCQ9kFggCAQ8WAh4EVGV4dAVWUGFnZSBIaXN0b3J5OiBBRlRFUiwgRVZFUlksIEFULCBSRU1BSU4gRmxleGlibGUgU3RhdGUgTWFjaGluZSBUaW1lcnMgdXNpbmcgU2VtYXBob3Jlcy5kAgUPEGQQFQcBNgE1ATQBMwEyATEBMBUHATYBNQE0ATMBMgExATAUKwMHZ2dnZ2dnZ2RkAgcPEGQQFQgHQ3VycmVudAE2ATUBNAEzATIBMQEwFQgHQ3VycmVudAE2ATUBNAEzATIBMQEwFCsDCGdnZ2dnZ2dnZGQCCw8WAh8ABctIPHRhYmxlIGNsYXNzPSJib3giIGNlbGxwYWRkaW5nPSIwIiBjZWxsc3BhY2luZz0iMCI+PHRyPjx0ZD48cCBzdHlsZT0idGV4dC1hbGlnbjogY2VudGVyOyI+PGI+PGEgaHJlZj0iTU1CYXNpYy5IaXN0b3J5LmFzcHg/UGFnZT1NTUJhc2ljLkFGVEVSLUVWRVJZLVJFTUFJTi1GbGV4aWJsZS1TdGF0ZS1NYWNoaW5lLVRpbWVycy11c2luZy1TZW1hcGhvcmVzJmFtcDtSZXZpc2lvbj0wMDAwNSI+JmxhcXVvOyBPbGRlciBSZXZpc2lvbjwvYT4gLSA8YSBocmVmPSJNTUJhc2ljLkhpc3RvcnkuYXNweD9QYWdlPU1NQmFzaWMuQUZURVItRVZFUlktUkVNQUlOLUZsZXhpYmxlLVN0YXRlLU1hY2hpbmUtVGltZXJzLXVzaW5nLVNlbWFwaG9yZXMiPkJhY2sgdG8gUGFnZSBIaXN0b3J5PC9hPiAtIDxhIGhyZWY9Ik1NQmFzaWMuQUZURVItRVZFUlktUkVNQUlOLUZsZXhpYmxlLVN0YXRlLU1hY2hpbmUtVGltZXJzLXVzaW5nLVNlbWFwaG9yZXMuYXNoeCI+Q3VycmVudCBSZXZpc2lvbjwvYT48L2I+PC9wPjwvdGQ+PC90cj48L3RhYmxlPjxiciAvPjxoMyBjbGFzcz0ic2VwYXJhdG9yIj5QYWdlIFJldmlzaW9uOiAyMDIwLzA0LzEyIDEwOjAyPC9oMz48YnIgLz5BIGNvbW1vbiByZXF1aXJlbWVudCBpcyBmb3Igc2VjdGlvbnMgb2YgY29kZSB0byBiZSBleGVjdXRlZCB0byBhIHNjaGVkdWxlIG9yIGFmdGVyIGEgcGVyaW9kIG9mIHRpbWUuIFRoZSBmb2xsb3dpbmcgdXNlcyBhbiBhcnJheSBvZiBmbGFncyBhbmQgY291bnRlcnMgdG8ga2VlcCB0cmFjayBvZiAoaW4gdGhpcyBjYXNlIGJ1dCBlYXNpbHkgdHdlYWstYWJsZSkgMTAgdGltZXJzLCB3aXRoIG9wdGlvbiBmb3IgdGhlbSB0byBiZSBzaW5nbGUtc2hvdCBvciByZXBlYXRpbmcuIFRoZSB0aW1lcnMgY2FuIGJlIHN0b3BwZWQgb3IgdGVtcG9yYXJpbHkgZGlzYWJsZWQuICBUbyBjaGVjayBpZiBhIHBlcmlvZCBoYXMgZWxhcHNlZCwgc2ltcGx5IGNoZWNrIHRoZSBmbGFnIGFuZCBwZXJmb3JtIHlvdXIgZGVzaXJlZCBhY3Rpb24gaWYgaXQgaXMgc2V0ICh5b3UgbmVlZCB0byByZXNldCBpdCBhcyBwYXJ0IG9mIHRoaXMpLiBUaGlzIGlzIGEga2V5IHJlcXVpcmVtZW50IGZvciA8YSBjbGFzcz0icGFnZWxpbmsiIHRhcmdldD0iX2JsYW5rIiBocmVmPSJQbGF0Zm9ybSUyMEFnbm9zdGljLkEtQnJpZWYtSW50cm9kdWN0aW9uLXRvLVN0YXRlLU1hY2hpbmUtTWV0aG9kb2xvZ3kuYXNoeCIgdGl0bGU9IkEgQnJpZWYgSW50cm9kdWN0aW9uIHRvIFN0YXRlIE1hY2hpbmUgTWV0aG9kb2xvZ3kuLi4iPlN0YXRlIE1hY2hpbmUgTWV0aG9kb2xvZ3kuPC9hPjxiciAvPjxiciAvPlRoZSBTdWJzL0Z1bmN0aW9ucyBhcmUgaW5zcGlyZWQgYnkgdGhlIExvY29tb3RpdmUgQmFzaWMgY29tbWFuZHMgb2YgdGhlIHNhbWUgbmFtZXMgYW5kIG1ha2UgZXhlY3V0aW5nIHNlY3Rpb25zIG9mIGNvZGUgYXN5bmNocm9ub3VzbHkgYSBicmVlemUuIE1NQmFzaWMgcHJvdmlkZXMgZm91ciB0aW1lcnMgYnV0IHRoZXkgZXhwZWN0IGEgc3ViIHByb2dyYW0gdG8gYmUgY2FsbGVkIGVhY2ggdGltZSBhbmQgdGhleSBoYXZlIHRvIGJlIGhhbmRsZWQgKGkuZS4gaWYgdGhleSBhcmUgb25lLXNob3QpIGJ5IHRoZSBjYWxsZWQgc3ViLiBUaGUgZm9sbG93aW5nIGNvZGUgdXNlcyBhIHNpbmdsZSBNTUJhc2ljIHRpbWVyIGJ1dCB0aGVuIGV4cGFuZHMgdGhpcyB0byBwcmFjdGljYWxseSB1bmxpbWl0ZWQgdGltZXJzIGFuZCByZWFsbHkgZWFzeSB0byBzZXQgb25lIHJ1bm5pbmcuIFRoZSBtYWluIGxvb3Agc2ltcGx5IGNoZWNrcyBmb3IgdGhlIHJlbGV2YW50IGZsYWcgYW5kIHRha2VzIGFjdGlvbiAoY2FsbHMgYSBTdWIsIGNoYW5nZXMgdGhlIHN0YXRlIG9mIGFuIG91dHB1dCBwaW4gZXRjLi4uKSBpZiBpdCBpcyBzZXQuPGJyIC8+PGJyIC8+PGJyIC8+PGI+QWZ0ZXI8L2I+ICBTZXQgYSBzZW1hcGhvcmUgYWZ0ZXIgYSBwZXJpb2Qgb2YgdGltZS4gRS5nLiBBZnRlciAzMCBzZWNvbmRzPGJyIC8+PGI+RXZlcnk8L2I+IFNldCBhIHNlbWFwaG9yZSBhdCB0aGUgc2FtZSBwZXJpb2QgcmVwZWF0ZWRseS4gRS5nLiBFdmVyeSAxMCBzZWNvbmRzPGJyIC8+PGI+QXQ8L2I+IFNldCBhIHNlbWFwaG9yZSBhdCBhIHNwZWNpZmljIERhdGVUaW1lLiBFLmcuIEF0IDA5LzA5LzIwMTkgMDU6MjU6MzA8YnIgLz48Yj5SZW1haW48L2I+IFJldHVybiB0aGUgcmVtYWluaW5nIHRpbWUgKGkuZS4gYmVmb3JlIGl0IHdhcyBkdWUgdG8gc2V0IHRoZSBzZW1hcGhvcmUpIGFuZCBvcHRpb25hbGx5IHN0b3AgdGhlIHRpbWVyLjxiciAvPjxiPkRJICYgRUk8L2I+IFRlbXBvcmFyaWx5IERpc2FibGUgb3IgRW5hYmxlIGFsbCB0aW1lcnMuPGJyIC8+PGJyIC8+PGJyIC8+PGI+UHJvczo8L2I+PGJyIC8+PHVsPjxsaT5FYXN5IHRvIGNvbmZpZ3VyZSBhIG9uZS1zaG90IHRpbWVyLjwvbGk+PGxpPkVhc3kgdG8gcmUtdXNlIHRpbWVycyBmb3IgZGlmZmVyZW50IHNlY3Rpb25zIG9mIGNvZGUuPC9saT48bGk+UmV0cmlldmUgdGhlIHJlbWFpbmluZyB0aW1lIG9uIGEgdGltZXIgYW5kIG9wdGlvbmFsbHkgc3RvcCBpdC48L2xpPjxsaT5ObyBuZWVkIHRvIHdvcnJ5IGFib3V0IGhhbmRsaW5nIFNFVFRJQ0sgLSBObyBkZWRpY2F0ZWQgU3ViIHRvIGhhbmRsZSBhbiBldmVudCAtIGp1c3QgZG8gaXQgaW5saW5lIHdoZW4gaXQgaXMgY29udmVuaWVudC48L2xpPjxsaT5HaXZlcyBtdWNoIGdyZWF0ZXIgc2NvcGUgZm9yIHRoZSBudW1iZXIgb2YgdGltZXJzLjwvbGk+PGxpPk11bHRpcGxlIHRpY2tzIGZyb20gdGhlIHNhbWUgY291bnRlciBnaXZlIG9ubHkgYSBzaW5nbGUgZXZlbnQgLSBObyBldmVudCAic3Rvcm1zIiBmb3Igc2xvdy1ydW5uaW5nIGNvZGUuPC9saT48bGk+TWFuYWdlYWJsZSBwcm9ncmFtIGludGVycnVwdGlvbiAtIEl0IGlzIHRvdGFsbHkgZG93biB0byB0aGUgcHJvZ3JhbSBmbG93IC0gbm90aGluZyBraWNraW5nIG9mZiAiYmVoaW5kIHlvdXIgYmFjayIuPC9saT48bGk+Tm8gaW1wbGljaXQgcHJpb3JpdHkgdG8gdGltZXJzLCBpdCBpcyBkb3duIHRvIGhvdyB0aGUgZmxhZ3MgZ2V0IGNoZWNrZWQuPGJyIC8+PC9saT48L3VsPjxiciAvPjxiPkNvbnM6PC9iPjxiciAvPjx1bD48bGk+VGltZXIgcmVzb2x1dGlvbiBpcyBub3QgYXMgZ29vZCBhcyBTRVRUSUNLIG9uIHNsb3cgc3lzdGVtcyAtIHZlcnkgc21hbGwgZGVsYXlzIGFyZSBsaWtlbHkgdG8gYmUgaW5hY2N1cmF0ZSwgZS5nLiB3YWl0aW5nIG9uZSBzZWNvbmQgd2hlbiB0aGUgc2VydmljZSBwZXJpb2QgaXMgMTAwMG1TLjxiciAvPjwvbGk+PC91bD48YnIgLz5UaGUgZm9sbG93aW5nIHByb3ZpZGVzIGEgY29yZSB0aW1lciBoYW5kbGVyIGFuZCB0aHJlZSBTdWJzIHRvIHNldCByZXBldGl0aXZlIG9yIG9uZS1zaG90IHRpbWVycyBhbmQgYSBtZXRob2QgdG8gc3RvcCBhIHRpbWVyIChhbmQgcmV0dXJuIHRoZSByZW1haW5pbmcgY291bnQgYmVmb3JlIGl0IHdhcyBzdG9wcGVkKS48YnIgLz48YnIgLz48Yj5EZXBlbmRlbmNpZXM6PC9iPjxiciAvPjx1bD48bGk+PGEgY2xhc3M9InBhZ2VsaW5rIiBocmVmPSJNTUJhc2ljLkJpdC1NYW5pcHVsYXRpb24tRnVuY3Rpb25zLmFzaHgiIHRpdGxlPSJCaXQgTWFuaXB1bGF0aW9uIEZ1bmN0aW9ucyI+Qml0IE1hbmlwdWxhdGlvbiBGdW5jdGlvbnM8L2E+ICBCaXRzIDAgLSA5IGluIHRoZSBGbGFncyBmaWVsZCBjb3JyZXNwb25kIHRvIHRpbWVycyAwLTkuLi4gdHdlYWsgYXMgbmVjZXNzYXJ5LiBCaXQgMTAgaXMgdGhlIGdsb2JhbCB0aW1lciBkaXNhYmxlIGJpdCAoPTEpLiBJbiB0aGUgZGlzYWJsZWQgc3RhdGUsIHRpbWVycyBhcmUgbm90IGRlY3JlbWVudGVkIGFuZCBhbnkgdGltZSBzcGVudCBkaXNhYmxlZCB3aWxsIGJlIGVmZmVjdGl2ZWx5IGFkZGVkIHRvIHJ1bm5pbmcgdGltZXJzLiBFLmcuIGlmIGEgdGltZXIgaXMgZHVlIHRvIGV4cGlyZSBhZnRlciAxMCBzZWNvbmRzIGJ1dCBzcGVuZHMgZml2ZSBzZWNvbmRzIGRpc2FibGVkLCB0aGUgdG90YWwgZGVsYXkgd2lsbCBiZSAxNSBzZWNvbmRzLiBESS9FSSBzaG91bGQgYmUgdXNlZCB0byBzdG9wIHRoZSB0aW1lcnMgd2hlbiBzb21lIGNyaXRpY2FsIHByb2Nlc3MgaXMgdGFraW5nIHBsYWNlIHRvIHByZXZlbnQgc3RhdGUgY2hhbmdlcy48L2xpPjxsaT5UaHJlZSBnbG9iYWwgdmFyaWFibGVzIGFyZSByZXF1aXJlZCwgdHdvIGludGVnZXIgYXJyYXlzIGFuZCBhIHNpbXBsZSBpbnRlZ2VyIHRvIGhvbGQgdGhlIGZsYWdzLjwvbGk+PGxpPjxhIGNsYXNzPSJwYWdlbGluayIgaHJlZj0iTU1CYXNpYy5Vbml4VGltZS1vci1FcG9jaC1UaW1lLmFzaHgiIHRpdGxlPSJVbml4VGltZSBvciBFcG9jaCBUaW1lIj5Vbml4VGltZTwvYT4gcmVxdWlyZWQgaWYgeW91IGludGVuZCB0byB1c2UgdGhlIEF0IGZ1bmN0aW9uYWxpdHk8YnIgLz48L2xpPjwvdWw+PGJyIC8+PGI+VmFyaWFibGUgRGVzY3JpcHRpb25zOjwvYj48YnIgLz5UTVJjdHIoKSBtYWludGFpbnMgdGhlIGNvdW50IGZvciBhIGdpdmVuIHRpbWVyPGJyIC8+VE1SaW5pKClob2xkcyB0aGUgdGltZXIgdHlwZSBhbmQgaXRzIGluaXRpYWxpemF0aW9uIHZhbHVlLjxiciAvPjxjb2RlPiAgICAtIGJpdHMgMC02MSBzdG9yZSB0aGUgaW5pdGlhbCB2YWx1ZSB2YWx1ZTxiciAvPiAgICAtIGJpdHMgNjMmNjIgc3RvcmUgdGhlIGZvcm1hdCBvZiB0aGUgY291bnRlcjo8YnIgLz4gICAgICAgIDA9ZGlzYWJsZWQ8YnIgLz4gICAgICAgIDE9KGFjdHVhbGx5IDB4NDAwMDAwMDAwMDAwMDAwMCkgaW5kaWNhdGVzIGEgb25lIHNob3QgIkFGVEVSIHgiIHR5cGUgY291bnRlcjxiciAvPiAgICAgICAgMj0oYWN0dWFsbHkgMHg4MDAwMDAwMDAwMDAwMDAwKSBpbmRpY2F0ZXMgYSByZXBldGl0aXZlICJFVkVSWSB4IiB0eXBlIGNvdW50ZXI8YnIgLz48L2NvZGU+PGJyIC8+QXMgd3JpdHRlbiBiZWxvdywgaXQgcHJvdmlkZXMgMTAgdGltZXJzIHdoaWNoIHNob3VsZCBiZSBsb2FkcyBmb3IganVzdCBhYm91dCBhbnkgdXNlLCBidXQgdGhpcyBjYW4gYmUgdHdlYWtlZCBhcyB5b3Ugc2VlIGZpdC48YnIgLz48YnIgLz5UaGUgQ29yZVRNUiBuZWVkcyB0byBiZSBzZXQgcnVubmluZyB3aXRoIHRoZSBTRVRUSUNLIGNvbW1hbmQgLSB0aW1lciBjb3VudGVyIHZhbHVlcyBhcmUgYSBtdWx0aXBsZSBvZiB0aGUgaW50ZXJ2YWwgdXNlZCBoZXJlLiBUcnkgbm90IHRvIGJlIHRvbyBhZ2dyZXNzaXZlIHdpdGggc21hbGwvZmFzdCBpbnRlcnZhbHMgYnV0IHRoZSBsYXJnZXIgdGhlIGludGVydmFsIHRoZSBncmVhdGVyIHRoZSBsb3NzIG9mIHJlc29sdXRpb24uIEZpbmQgc29tZXRoaW5nIHRoYXQgd29ya3MgZm9yIHlvdSBidXQgcmVtZW1iZXIgdG8gYWRqdXN0IHlvdXIgdGltZXIgdmFsdWVzIGFjY29yZGluZ2x5IGUuZy4gaWYgeW91IHdhbnQgdGlja3MgMTAgdGltZXMgYSBzZWNvbmQsIHRoZSBzZXRpdGljayBtdXN0IGJlIHNldCB0byAxMDAgLSBhbmQgdGhlIHZhbHVlcyB1c2VkIGluIEFGVEVSICYgRVZFUlkgd291bGQgbmVlZCB0byByZWZsZWN0IHRoZSBpbmNyZWFzZSBpbiByZXNvbHV0aW9uIC1pbiB0aGUgYWJvdmUgZXhhbXBsZSAxIHNlY29uZCBiZWNvbWVzIDEwIGNvdW50cyBldGMuPGJyIC8+PGJyIC8+PGI+RXhhbXBsZTo8L2I+PGJyIC8+PHByZT4NClByZWFtYmxlJiM1ODsNCglPcHRpb24gQmFzZSAwDQoNCglEaW0gSW50ZWdlciBUTVJjdHIoOSksVE1SaW5pKDkpDQoNCglGbGFncz0wDQoJDQoJU0VUVElDSyAxMDAwLENvcmVUTVIsNCcgc2VydmljZSB0aW1lcnMgZXZlcnkgc2Vjb25kDQoNCg0KDQoNCg0KTWFpbiYjNTg7DQonIGV4YW1wbGUgdXNhZ2UgZm9yIHRoZSBtYWluIGxvb3ANCicgZ2l2ZXMgdGhlIHVzZXIgMTAgc2Vjb25kcyB0byBoaXQgYSBrZXkgKHVzaW5nIHRpbWVyIDEpDQoJUHJpbnQgIlF1aWNrIFByZXNzIGEga2V5ISINCgkNCglBZnRlciAxMCwxICcgMTAgc2Vjb25kcyB1c2luZyB0aW1lciAxDQoJRXZlcnkgMSAsMiAnIGNvdW50IDEgc2Vjb25kIGludGVydmFscyB1c2luZyB0aW1lciAyDQoJRXZlcnkgMiAsMyAnIGNvdW50IDIgc2Vjb25kIGludGVydmFscyB1c2luZyB0aW1lciAzDQoJQXQgIjAxLzAxLzIwMjAgMDAmIzU4OzAwJiM1ODswMCIsNCAndHJpZ2dlciBmbGFnIDQgYXQgdGhpcyBzcGVjaWZpYyBkYXRlICZhbXA7IHRpbWUNCg0KCURvDQoJCWEkPUlua2V5JA0KCQlJZiBGbGFnVGVzdCgyKSBUaGVuIEZsYWdSZXMgMiYjNTg7UHJpbnQgIngiJyBvdXRwdXQgYW4geCB3aGlsZSB3ZSB3YWl0DQoJCUlmIEZsYWdUZXN0KDMpIFRoZW4gRmxhZ1JlcyAzJiM1ODtQcmludCAieSInIG91dHB1dCBhIHkgIHdoaWxlIHdlIHdhaXQNCgkJSWYgRmxhZ1Rlc3QoNCkgVGhlbiBGbGFnUmVzIDQmIzU4O1ByaW50ICJIYXBweSBOZXcgWWVhciEiDQoJTG9vcCBVbnRpbCBGbGFnVGVzdCgxKSBvciBhJCZsdDsmZ3Q7IiINCg0KCXg9UmVtYWluKDEpJyBzdG9wIHRoZSB0aW1lciBhbmQgZ2V0IHRoZSByZW1haW5pbmcgdGltZQ0KDQoJSWYgRmxhZ1Rlc3QoMSkgVGhlbiAnIHRoZSB0aW1lciBleHBpcmVkPw0KCQlQcmludCAiVG9vIGxhdGUhIg0KDQoJRWxzZSAnIG90aGVyd2lzZSBzb21lb25lIHByZXNzZWQgYSBrZXkNCgkJUHJpbnQgInRoYXQgd2FzIGNsb3NlLiBUaGVyZSB3YXMgb25seSAiO3g7IiBzZWNvbmRzIGxlZnQhIg0KDQoJRW5kSWYNCg0KCURJDQoJRm9yIG49MSBUbyAzJiM1ODsgeD1SZW1haW4obikmIzU4OyBOZXh0DQoJRUkNCgkNCglFbmQNCg0KDQoNCg0KJyBUaGUgc3Vicw0KCVNVQiBDb3JlVE1SICcgbmVlZHMgdG8gcnVuIG9uIGEgdGlja2VyIGF0IHdoYXRldmVyIGludGVydmFsIGlzIHJlcXVpcmVkIC0gdGhpcyBpcyBhbHNvIHRoZSBtdWx0aXBsZSBvZiB0aW1lciBjb3VudHMNCgkJSWYgRmxhZ1Rlc3QoMTApIFRoZW4gRXhpdCBTdWINCgkJTG9jYWwgSW50ZWdlciBuLGYsdg0KCQlGb3Igbj0wIFRvIDkNCgkJCWY9VE1SaW5pKG4pIEFuZCAmYW1wO2hDMDAwMDAwMDAwMDAwMDAwICcgZXh0cmFjdCB0aGUgdG9wIDIgYml0cw0KCQkJU2VsZWN0IENhc2UgZg0KCQkJCUNhc2UgMCwmYW1wO2hDMDAwMDAwMDAwMDAwMDAwICdkaXNhYmxlZCBvciBpbnZhbGlkDQoJCQkJCUZsYWdSZXMobikNCgkJCQlDYXNlICZhbXA7aDQwMDAwMDAwMDAwMDAwMDAnIEFGVEVSDQoJCQkJCUlmIFRNUmN0cihuKSZndDswIHRoZW4NCgkJCQkJCVRNUmN0cihuKT1UTVJjdHIobiktMQ0KCQkJCQkJSWYgVE1SY3RyKG4pPTAgVGhlbiBGbGFnU2V0KG4pICcgaW5kaWNhdGUgdGhlIHRpbWVyIGhhcyBleHBpcmVkDQoJCQkJCUVuZElmDQoJCQkJQ2FzZSAmYW1wO2g4MDAwMDAwMDAwMDAwMDAwJyBFVkVSWQ0KCQkJCQlJZiBUTVJjdHIobikmZ3Q7MCB0aGVuDQoJCQkJCQlUTVJjdHIobik9VE1SY3RyKG4pLTENCgkJCQkJCUlmIFRNUmN0cihuKT0wIFRoZW4NCgkJCQkJCQlGbGFnU2V0KG4pICcgaW5kaWNhdGUgdGhlIHRpbWVyIGhhcyBleHBpcmVkDQoJCQkJCQkJVE1SY3RyKG4pPVRNUmluaShuKSBBbmQgJmFtcDtoM0ZGRkZGRkZGRkZGRkZGRiAnIHJlc2V0IHRoZSB0aW1lcg0KCQkJCQkJRW5kSWYNCgkJCQkJRW5kSWYNCgkJCUVuZCBTZWxlY3QNCg0KCQlOZXh0DQoJRU5EIFNVQg0KDQoNCglTdWIgQWZ0ZXIoSW50ZXJ2YWwgQXMgSW50ZWdlcixUbXIgQXMgSW50ZWdlciknIHN0YXJ0cyBhIG9uZS1zaG90IHRpbWVyDQoJCVRNUmluaShUbXIpPUludGVydmFsIE9SICZhbXA7aDQwMDAwMDAwMDAwMDAwMDAmIzU4O1RNUmN0cihUbXIpPUludGVydmFsIEFuZCAmYW1wO2gzRkZGRkZGRkZGRkZGRkZGJiM1ODtGbGFnUmVzKFRtcikNCglFbmQgU3ViDQoNCglTdWIgRXZlcnkoSW50ZXJ2YWwgQXMgSW50ZWdlcixUbXIgQXMgSW50ZWdlciknIHN0YXJ0cyBhIHJlcGV0aXRpdmUgdGltZXINCgkJVE1SaW5pKFRtcik9SW50ZXJ2YWwgT1IgJmFtcDtoODAwMDAwMDAwMDAwMDAwMCYjNTg7VE1SY3RyKFRtcik9SW50ZXJ2YWwgQW5kICZhbXA7aDNGRkZGRkZGRkZGRkZGRkYmIzU4O0ZsYWdSZXMoVG1yKQ0KCUVuZCBTdWINCg0KCVN1YiBBdChkdCQsVG1yIEFzIEludGVnZXIpJyB0cmlnZ2VyIGF0IGEgc3BlY2lmaWMgZGF0ZS90aW1lIC0gYXNzdW1lcyB0aGUgY29yZSB0aW1lciBpcyBydW5uaW5nIGluIHNlY29uZHMNCgkJJ2R0JCBtdXN0IGJlIGEgZGF0ZXRpbWUgZm9ybWF0dGVkIGFzICBkZC9tbS95eXl5IGhoJiM1ODttbSYjNTg7c3MNCgkJTG9jYWwgSW50ZWdlciB4DQoJCXg9VW5peFRpbWUoTm93KCkpLVVuaXhUaW1lKGR0JCkNCgkJSWYgeCZsdDsyIHRoZW4NCgkJCUZsYWdTZXQgVG1yJyBpZiBoZSBkaWZmZXJlbmNlIGlzIGxlc3MgdGhhbiAyIHNlY29uZHMsIHRyaWdnZXIgdGhlIGFsYXJtIGltbWVkaWF0ZWx5DQoJCUVsc2UNCgkJCUFmdGVyIHgsVG1yJyBvdGhlcndpc2Ugc2V0IGEgb25lLXNob3QgZm9yIHRoZSBkaWZmZXJlbmNlDQoJCUVuZElmDQoJRW5kIFN1Yg0KDQoJRnVuY3Rpb24gUmVtYWluKFRtciBBcyBJbnRlZ2VyLCBvcHQgQXMgSW50ZWdlcikgQXMgSW50ZWdlcicgcmV0dXJucyB0aGUgcmVtYWluaW5nIHdob2xlIGNvdW50cyBpbiB0aGUgY291bnRlci4gDQoJCSdpZiBvcHQ9MCAob3Igbm90IHNwZWNpZmllZCkgdGhlIHRpbWVyIHdpbGwgYmUgc3RvcHBlZCB3aXRob3V0IHRyaWdnZXJpbmcgdGhlIHNlbWFwaG9yZQ0KCQknaWYgb3B0PTEgdGhlbiB0aGUgdGltZXIgaXMgbGVmdCBydW5uaW5nLiBUaGlzIGFsbG93cyB0aGUgcmVtYWluaW5nIHRpbWUgdG8gYmUgcXVlcmllZCB3aXRob3V0IHN0b3BwaW5nIHRoZSB0aW1lcg0KCQlSZW1haW49VE1SY3RyKFRtcikNCgkJSWYgb3B0PTAgVGhlbiBUTVJpbmkoVG1yKT1UTVJpbmkoVG1yKSBBbmQgJmFtcDtoM0ZGRkZGRkZGRkZGRkZGRg0KCUVuZCBGdW5jdGlvbg0KDQoJU3ViIERJDQoJCUZsYWdTZXQgMTANCglFbmQgU3ViDQoNCglTdWIgRUkNCgkJRmxhZ1JlcyAxMA0KCUVuZCBTdWINCjwvcHJlPjxiciAvPkFsbCA8YSBjbGFzcz0iZXh0ZXJuYWxsaW5rIiBocmVmPSJodHRwOi8vd3d3LmNwY3dpa2kuZXUvaW5kZXgucGhwL0xvY29tb3RpdmVfQkFTSUMjQUZURVJfLkUyLjgwLkI5dGltZV9kZWxheS5FMi44MC5CQS41Qi4yQy5FMi44MC5COXRpbWVyX251bWJlci5FMi44MC5CQS41RF9HT1NVQl8uRTIuODAuQjlsaW5lX251bWJlci5FMi44MC5CQSIgdGl0bGU9InRoZSBmdW5jdGlvbnMiIHRhcmdldD0iX2JsYW5rIj50aGUgZnVuY3Rpb25zPC9hPiBhcmUgaW5zcGlyZWQgYnkgc29tZSBpbm5vdmF0aXZlIChmb3IgdGhlIHRpbWUpIG5hbWVzYWtlcyBpbiBMb2NvbW90aXZlIGJhc2ljIGFzIHVzZWQgb24gdGhlIEFtc3RyYWQgQ1BDIG9mIHRoZSAxOTgwcy4gPGJyIC8+PGJyIC8+ZGQErM+dsnqebrSfXw9+UuH9VftQkw==" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="2068001F" />
	<input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="/wEWEQK48Y/sCgK4z/TSAwK5z/TSAwK+z/TSAwK/z/TSAwK8z/TSAwK9z/TSAwKiz/TSAwK3j57gBwLH5ta/BQLG5ta/BQLB5ta/BQLA5ta/BQLD5ta/BQLC5ta/BQLd5ta/BQL9yYWiCdNNwP1OlwjztYWMQL9UE+wgB4dn" />
</div>
		<script type="text/javascript">
<!--
__BaseName = "ctl00_CphMaster_";
__ConfirmMessage = "Are you sure you want to proceed?";
// -->
</script>
		<script type="text/javascript">
		<!--
			function __GetServerElementById(id) {
				return document.getElementById(__BaseName + id);
			}
			function __RequestConfirm() {
				return confirm(__ConfirmMessage);
			}
		// -->
		</script>
    
        <div id="HeaderDiv">
            <div style="float: right;">Welcome <a href="MMBasic.Language.html" class="systemlink" title="Select your language">Guest</a>, you are in: <select class="namespacedropdown" onchange="javascript:var sel = this.value; document.location = (sel != '' ? (sel + '.') : '') + 'Default.aspx';"><option value="">&lt;root&gt;</option><option value="Circuit Ideas">Circuit Ideas</option><option value="Colour MaxiMite 2 (CMM2)">Colour MaxiMite 2 (CMM2)</option><option value="GCB">GCB</option><option value="MicroMite ArmMite and MMX Hardware">MicroMite ArmMite and MMX Hardware</option><option selected="selected" value="MMBasic">MMBasic</option><option value="PIC ASM">PIC ASM</option><option value="Platform Agnostic">Platform Agnostic</option></select> &bull; <a href="MMBasic.Login27ea.html?Redirect=http%3a%2f%2ffruitoftheshed.com%2fHistory.aspx%3fNS%3dMMBasic%26Page%3dMMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores%26Revision%3d6" class="systemlink" title="Login">Login</a></div><h1>Fruit Of The Shed</h1>
        </div>
                   
        <div id="ContainerDiv">
                 
            <div id="SidebarDiv">
                <div id="SidebarHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="SidebarContentDiv">
                    <div style="float: right;"> </div><h3 class="separator">Navigation (MMBasic)<a class="headeranchor" id="Navigation_NAMESPACE_0" href="#Navigation_NAMESPACE_0" title="Link to this Section">&#0182;</a></h3><ul><li><b><a class="pagelink" href="MMBasic.MainPage.html" title="_MMBasic Code Library">Main Page</a></b></li><li><a class="pagelink" href="MainPage.html" title="Home Page">Main Page (root)</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.EggDrop-part-of-the-original-MMBasic-libraryc674.html" title="Random Page">Random Page</a></li><li><a class="systemlink" href="MMBasic.AllPages.html" title="All Pages">All Pages</a><br /> </li><li><a class="systemlink" href="Logina75d.html" title="Create a new Page">Create a new Page</a><br /></li></ul><br /><ul><li><a class="systemlink" href="Logine894.html" title="Administration">Administration</a></li><li><a class="systemlink" href="MMBasic.Upload.html" title="File Management">File Management</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="My Account">My Account</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="Create Account">Create Account</a><br /></li></ul><br /><small><b>Search the wiki</b></small><br /><br /><script type="text/javascript"><!--
function _DoSearch_SBf63524b4df3e46d58daced6fab3b588b() { document.location = 'MMBasic.Search.aspx?AllNamespaces=1&FilesAndAttachments=1&Query=' + encodeURI(document.getElementById('SBf63524b4df3e46d58daced6fab3b588b').value); }
// -->
</script><input class="txtsearchbox" type="text" id="SBf63524b4df3e46d58daced6fab3b588b" onkeydown="javascript:var keycode; if(window.event) keycode = event.keyCode; else keycode = event.which; if(keycode == 10 || keycode == 13) { _DoSearch_SBf63524b4df3e46d58daced6fab3b588b(); return false; }" /> <big><a href="#" onclick="javascript:_DoSearch_SBf63524b4df3e46d58daced6fab3b588b(); return false;">&raquo;</a></big><br /><br /><br />
                </div>
                <div id="SidebarFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>
            <div id="MainDiv">
                <div id="MainHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="PageInternalHeaderDiv"></div>
                

    <h1 class="pagetitlesystem">Page History: AFTER, EVERY, AT, REMAIN Flexible State Machine Timers using Semaphores.</h1>
    <p>Compare Page Revisions</p> 
    <select name="ctl00$CphMaster$lstRev1" id="ctl00_CphMaster_lstRev1">
	<option value="6">6</option>
	<option value="5">5</option>
	<option value="4">4</option>
	<option value="3">3</option>
	<option value="2">2</option>
	<option value="1">1</option>
	<option value="0">0</option>

</select>
    <select name="ctl00$CphMaster$lstRev2" id="ctl00_CphMaster_lstRev2">
	<option value="Current">Current</option>
	<option value="6">6</option>
	<option value="5">5</option>
	<option value="4">4</option>
	<option value="3">3</option>
	<option value="2">2</option>
	<option value="1">1</option>
	<option value="0">0</option>

</select>
    <input type="submit" name="ctl00$CphMaster$btnCompare" value="Compare" id="ctl00_CphMaster_btnCompare" />
    <br /><br />
    
    <table class="box" cellpadding="0" cellspacing="0"><tr><td><p style="text-align: center;"><b><a href="MMBasic.History36a7.html?Page=MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores&amp;Revision=00005">&laquo; Older Revision</a> - <a href="MMBasic.History0eb7.html?Page=MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores">Back to Page History</a> - <a href="MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores.html">Current Revision</a></b></p></td></tr></table><br /><h3 class="separator">Page Revision: 2020/04/12 10:02</h3><br />A common requirement is for sections of code to be executed to a schedule or after a period of time. The following uses an array of flags and counters to keep track of (in this case but easily tweak-able) 10 timers, with option for them to be single-shot or repeating. The timers can be stopped or temporarily disabled.  To check if a period has elapsed, simply check the flag and perform your desired action if it is set (you need to reset it as part of this). This is a key requirement for <a class="pagelink" target="_blank" href="Platform%20Agnostic.A-Brief-Introduction-to-State-Machine-Methodology.html" title="A Brief Introduction to State Machine Methodology...">State Machine Methodology.</a><br /><br />The Subs/Functions are inspired by the Locomotive Basic commands of the same names and make executing sections of code asynchronously a breeze. MMBasic provides four timers but they expect a sub program to be called each time and they have to be handled (i.e. if they are one-shot) by the called sub. The following code uses a single MMBasic timer but then expands this to practically unlimited timers and really easy to set one running. The main loop simply checks for the relevant flag and takes action (calls a Sub, changes the state of an output pin etc...) if it is set.<br /><br /><br /><b>After</b>  Set a semaphore after a period of time. E.g. After 30 seconds<br /><b>Every</b> Set a semaphore at the same period repeatedly. E.g. Every 10 seconds<br /><b>At</b> Set a semaphore at a specific DateTime. E.g. At 09/09/2019 05:25:30<br /><b>Remain</b> Return the remaining time (i.e. before it was due to set the semaphore) and optionally stop the timer.<br /><b>DI & EI</b> Temporarily Disable or Enable all timers.<br /><br /><br /><b>Pros:</b><br /><ul><li>Easy to configure a one-shot timer.</li><li>Easy to re-use timers for different sections of code.</li><li>Retrieve the remaining time on a timer and optionally stop it.</li><li>No need to worry about handling SETTICK - No dedicated Sub to handle an event - just do it inline when it is convenient.</li><li>Gives much greater scope for the number of timers.</li><li>Multiple ticks from the same counter give only a single event - No event "storms" for slow-running code.</li><li>Manageable program interruption - It is totally down to the program flow - nothing kicking off "behind your back".</li><li>No implicit priority to timers, it is down to how the flags get checked.<br /></li></ul><br /><b>Cons:</b><br /><ul><li>Timer resolution is not as good as SETTICK on slow systems - very small delays are likely to be inaccurate, e.g. waiting one second when the service period is 1000mS.<br /></li></ul><br />The following provides a core timer handler and three Subs to set repetitive or one-shot timers and a method to stop a timer (and return the remaining count before it was stopped).<br /><br /><b>Dependencies:</b><br /><ul><li><a class="pagelink" href="MMBasic.Bit-Manipulation-Functions.html" title="Bit Manipulation Functions">Bit Manipulation Functions</a>  Bits 0 - 9 in the Flags field correspond to timers 0-9... tweak as necessary. Bit 10 is the global timer disable bit (=1). In the disabled state, timers are not decremented and any time spent disabled will be effectively added to running timers. E.g. if a timer is due to expire after 10 seconds but spends five seconds disabled, the total delay will be 15 seconds. DI/EI should be used to stop the timers when some critical process is taking place to prevent state changes.</li><li>Three global variables are required, two integer arrays and a simple integer to hold the flags.</li><li><a class="pagelink" href="MMBasic.UnixTime-or-Epoch-Time.html" title="UnixTime or Epoch Time">UnixTime</a> required if you intend to use the At functionality<br /></li></ul><br /><b>Variable Descriptions:</b><br />TMRctr() maintains the count for a given timer<br />TMRini()holds the timer type and its initialization value.<br /><code>    - bits 0-61 store the initial value value<br />    - bits 63&62 store the format of the counter:<br />        0=disabled<br />        1=(actually 0x4000000000000000) indicates a one shot "AFTER x" type counter<br />        2=(actually 0x8000000000000000) indicates a repetitive "EVERY x" type counter<br /></code><br />As written below, it provides 10 timers which should be loads for just about any use, but this can be tweaked as you see fit.<br /><br />The CoreTMR needs to be set running with the SETTICK command - timer counter values are a multiple of the interval used here. Try not to be too aggressive with small/fast intervals but the larger the interval the greater the loss of resolution. Find something that works for you but remember to adjust your timer values accordingly e.g. if you want ticks 10 times a second, the setitick must be set to 100 - and the values used in AFTER & EVERY would need to reflect the increase in resolution -in the above example 1 second becomes 10 counts etc.<br /><br /><b>Example:</b><br /><pre>
Preamble&#58;
	Option Base 0

	Dim Integer TMRctr(9),TMRini(9)

	Flags=0
	
	SETTICK 1000,CoreTMR,4' service timers every second





Main&#58;
' example usage for the main loop
' gives the user 10 seconds to hit a key (using timer 1)
	Print "Quick Press a key!"
	
	After 10,1 ' 10 seconds using timer 1
	Every 1 ,2 ' count 1 second intervals using timer 2
	Every 2 ,3 ' count 2 second intervals using timer 3
	At "01/01/2020 00&#58;00&#58;00",4 'trigger flag 4 at this specific date &amp; time

	Do
		a$=Inkey$
		If FlagTest(2) Then FlagRes 2&#58;Print "x"' output an x while we wait
		If FlagTest(3) Then FlagRes 3&#58;Print "y"' output a y  while we wait
		If FlagTest(4) Then FlagRes 4&#58;Print "Happy New Year!"
	Loop Until FlagTest(1) or a$&lt;&gt;""

	x=Remain(1)' stop the timer and get the remaining time

	If FlagTest(1) Then ' the timer expired?
		Print "Too late!"

	Else ' otherwise someone pressed a key
		Print "that was close. There was only ";x;" seconds left!"

	EndIf

	DI
	For n=1 To 3&#58; x=Remain(n)&#58; Next
	EI
	
	End




' The subs
	SUB CoreTMR ' needs to run on a ticker at whatever interval is required - this is also the multiple of timer counts
		If FlagTest(10) Then Exit Sub
		Local Integer n,f,v
		For n=0 To 9
			f=TMRini(n) And &amp;hC000000000000000 ' extract the top 2 bits
			Select Case f
				Case 0,&amp;hC000000000000000 'disabled or invalid
					FlagRes(n)
				Case &amp;h4000000000000000' AFTER
					If TMRctr(n)&gt;0 then
						TMRctr(n)=TMRctr(n)-1
						If TMRctr(n)=0 Then FlagSet(n) ' indicate the timer has expired
					EndIf
				Case &amp;h8000000000000000' EVERY
					If TMRctr(n)&gt;0 then
						TMRctr(n)=TMRctr(n)-1
						If TMRctr(n)=0 Then
							FlagSet(n) ' indicate the timer has expired
							TMRctr(n)=TMRini(n) And &amp;h3FFFFFFFFFFFFFFF ' reset the timer
						EndIf
					EndIf
			End Select

		Next
	END SUB


	Sub After(Interval As Integer,Tmr As Integer)' starts a one-shot timer
		TMRini(Tmr)=Interval OR &amp;h4000000000000000&#58;TMRctr(Tmr)=Interval And &amp;h3FFFFFFFFFFFFFFF&#58;FlagRes(Tmr)
	End Sub

	Sub Every(Interval As Integer,Tmr As Integer)' starts a repetitive timer
		TMRini(Tmr)=Interval OR &amp;h8000000000000000&#58;TMRctr(Tmr)=Interval And &amp;h3FFFFFFFFFFFFFFF&#58;FlagRes(Tmr)
	End Sub

	Sub At(dt$,Tmr As Integer)' trigger at a specific date/time - assumes the core timer is running in seconds
		'dt$ must be a datetime formatted as  dd/mm/yyyy hh&#58;mm&#58;ss
		Local Integer x
		x=UnixTime(Now())-UnixTime(dt$)
		If x&lt;2 then
			FlagSet Tmr' if he difference is less than 2 seconds, trigger the alarm immediately
		Else
			After x,Tmr' otherwise set a one-shot for the difference
		EndIf
	End Sub

	Function Remain(Tmr As Integer, opt As Integer) As Integer' returns the remaining whole counts in the counter. 
		'if opt=0 (or not specified) the timer will be stopped without triggering the semaphore
		'if opt=1 then the timer is left running. This allows the remaining time to be queried without stopping the timer
		Remain=TMRctr(Tmr)
		If opt=0 Then TMRini(Tmr)=TMRini(Tmr) And &amp;h3FFFFFFFFFFFFFFF
	End Function

	Sub DI
		FlagSet 10
	End Sub

	Sub EI
		FlagRes 10
	End Sub
</pre><br />All <a class="externallink" href="http://www.cpcwiki.eu/index.php/Locomotive_BASIC#AFTER_.E2.80.B9time_delay.E2.80.BA.5B.2C.E2.80.B9timer_number.E2.80.BA.5D_GOSUB_.E2.80.B9line_number.E2.80.BA" title="the functions" target="_blank">the functions</a> are inspired by some innovative (for the time) namesakes in Locomotive basic as used on the Amstrad CPC of the 1980s. <br /><br />
    
    


                <div id="PageInternalFooterDiv"></div>
                <div id="MainFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>

        </div>
            
        <div id="FooterDiv">
             
        </div>

    </form>  
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.History.aspx?Page=MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores&Revision=6 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:36:33 GMT -->
</html>
