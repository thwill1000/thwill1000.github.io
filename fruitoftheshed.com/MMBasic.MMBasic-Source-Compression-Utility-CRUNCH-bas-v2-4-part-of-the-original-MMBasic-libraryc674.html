

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from fruitoftheshed.com/MMBasic.MMBasic-Source-Compression-Utility-CRUNCH-bas-v2-4-part-of-the-original-MMBasic-library.ashx?NS=MMBasic by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:51:11 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=8" /><title>
	MMBasic Source Compression Utility - Fruit Of The Shed
</title><script type="text/javascript" src="JS/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="JS/Scripts.js"></script>
<script type="text/javascript" src="JS/SearchHighlight.js"></script>
<link rel="stylesheet" media="print" href="Themes/Default/Print_Styles.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles%20-%20Copy.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles.css" type="text/css" />
<link rel="stylesheet" href="Themes/Editor.css" type="text/css" />
<link rel="search" href="searchf7b1.xml?OpenSearch=1" type="application/opensearchdescription+xml" title="Fruit Of The Shed - Search" /><script src="Themes/Default/Scripts.js" type="text/javascript"></script>
<link rel="shortcut icon" href="Themes/Default/Icon.ico" type="image/x-icon" />
</head>
<body>
    <form name="aspnetForm" method="post" action="http://fruitoftheshed.com/Default.aspx?Page=MMBasic-Source-Compression-Utility-CRUNCH-bas-v2-4-part-of-the-original-MMBasic-library&amp;NS=MMBasic" id="aspnetForm">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUJMTQ3NjA4MDI2D2QWAmYPZBYCAgEPZBYCAgkPZBYEAhsPDxYCHg1BbnRoZW1WaXNpYmxlaGRkAicPZBYCZg8WAh4LXyFJdGVtQ291bnQCARYCAgEPZBYCZg8VBOYBR2V0RmlsZS5hc3B4P0ZpbGU9Q1JVTkNILnppcCZhbXA7QXNTdHJlYW1BdHRhY2htZW50PTEmYW1wO1Byb3ZpZGVyPVNjcmV3VHVybi5XaWtpLkZpbGVzU3RvcmFnZVByb3ZpZGVyJmFtcDtJc1BhZ2VBdHRhY2htZW50PTEmYW1wO1BhZ2U9TU1CYXNpYy5NTUJhc2ljLVNvdXJjZS1Db21wcmVzc2lvbi1VdGlsaXR5LUNSVU5DSC1iYXMtdjItNC1wYXJ0LW9mLXRoZS1vcmlnaW5hbC1NTUJhc2ljLWxpYnJhcnkIRG93bmxvYWQKQ1JVTkNILnppcAkyMzMuNDQgS0JkZIFcTZ7BTeFMkbhj5wY05Oz+LajL" />
</div>

<script type="text/javascript">
//<![CDATA[
var Anthem_FormID = "aspnetForm";
//]]>
</script>
<script src="WebResource3c0c.axd?d=wu8PDPV1hmKciPrhUAi9NEjQUBbOefrIXCaRPwGH8Q5jrvPZFuGbKmycL3GXDKGD1_JZ083oQl1Kpd_P7rg1V93MtYOS3Vb-0Eztmu5VDCWQxc7l0&amp;t=636158881040000000" type="text/javascript"></script>
<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="CA0B0334" />
</div>
		<script type="text/javascript">
<!--
__BaseName = "ctl00_CphMaster_";
__ConfirmMessage = "Are you sure you want to proceed?";
// -->
</script>
		<script type="text/javascript">
		<!--
			function __GetServerElementById(id) {
				return document.getElementById(__BaseName + id);
			}
			function __RequestConfirm() {
				return confirm(__ConfirmMessage);
			}
		// -->
		</script>
    
        <div id="HeaderDiv">
            <div style="float: right;">Welcome <a href="MMBasic.Language.html" class="systemlink" title="Select your language">Guest</a>, you are in: <select class="namespacedropdown" onchange="javascript:var sel = this.value; document.location = (sel != '' ? (sel + '.') : '') + 'Default.aspx';"><option value="">&lt;root&gt;</option><option value="Circuit Ideas">Circuit Ideas</option><option value="Colour MaxiMite 2 (CMM2)">Colour MaxiMite 2 (CMM2)</option><option value="GCB">GCB</option><option value="MicroMite ArmMite and MMX Hardware">MicroMite ArmMite and MMX Hardware</option><option selected="selected" value="MMBasic">MMBasic</option><option value="PIC ASM">PIC ASM</option><option value="Platform Agnostic">Platform Agnostic</option></select> &bull; <a href="MMBasic.Login6fa3.html?Redirect=http%3a%2f%2ffruitoftheshed.com%2fDefault.aspx%3fPage%3dMMBasic-Source-Compression-Utility-CRUNCH-bas-v2-4-part-of-the-original-MMBasic-library%26NS%3dMMBasic" class="systemlink" title="Login">Login</a></div><h1>Fruit Of The Shed</h1>
        </div>
                   
        <div id="ContainerDiv">
                 
            <div id="SidebarDiv">
                <div id="SidebarHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="SidebarContentDiv">
                    <div style="float: right;"> </div><h3 class="separator">Navigation (MMBasic)<a class="headeranchor" id="Navigation_NAMESPACE_0" href="#Navigation_NAMESPACE_0" title="Link to this Section">&#0182;</a></h3><ul><li><b><a class="pagelink" href="MMBasic.MainPage.html" title="_MMBasic Code Library">Main Page</a></b></li><li><a class="pagelink" href="MainPage.html" title="Home Page">Main Page (root)</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.EggDrop-part-of-the-original-MMBasic-libraryc674.html" title="Random Page">Random Page</a></li><li><a class="systemlink" href="MMBasic.AllPages.html" title="All Pages">All Pages</a><br /> </li><li><a class="systemlink" href="Logina75d.html" title="Create a new Page">Create a new Page</a><br /></li></ul><br /><ul><li><a class="systemlink" href="Logine894.html" title="Administration">Administration</a></li><li><a class="systemlink" href="MMBasic.Upload.html" title="File Management">File Management</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="My Account">My Account</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="Create Account">Create Account</a><br /></li></ul><br /><small><b>Search the wiki</b></small><br /><br /><script type="text/javascript"><!--
function _DoSearch_SBf63524b4df3e46d58daced6fab3b588b() { document.location = 'MMBasic.Search.aspx?AllNamespaces=1&FilesAndAttachments=1&Query=' + encodeURI(document.getElementById('SBf63524b4df3e46d58daced6fab3b588b').value); }
// -->
</script><input class="txtsearchbox" type="text" id="SBf63524b4df3e46d58daced6fab3b588b" onkeydown="javascript:var keycode; if(window.event) keycode = event.keyCode; else keycode = event.which; if(keycode == 10 || keycode == 13) { _DoSearch_SBf63524b4df3e46d58daced6fab3b588b(); return false; }" /> <big><a href="#" onclick="javascript:_DoSearch_SBf63524b4df3e46d58daced6fab3b588b(); return false;">&raquo;</a></big><br /><br /><br />
                </div>
                <div id="SidebarFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>
            <div id="MainDiv">
                <div id="MainHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="PageInternalHeaderDiv"></div>
                

    <script type="text/javascript">
    <!--
        function __ShowAllTrail() {
            try {
                document.getElementById("BreadcrumbsDivMin").style["display"] = "none";
                document.getElementById("BreadcrumbsDivAll").style["display"] = "";
                __SetStatus("1");
            }
            catch(ex) { }
            return false;
        }
        function __HideTrail() {
            try {
                document.getElementById("BreadcrumbsDivMin").style["display"] = "";
                document.getElementById("BreadcrumbsDivAll").style["display"] = "none";
                __SetStatus("0");
            }
            catch(ex) { }
            return false;
        }
        
        function __SetStatus(open) {
            __CreateCookie("ScrewTurnWikiBCT", open, 365);
        }
        function __GetStatus() {
            var value = __ReadCookie("ScrewTurnWikiBCT");
            if(value) return value;
            else return "0";
        }

        function __InitBCT() {
        	if(__GetStatus() == "1") {
        		__ShowAllTrail();
        	}
        }

        var __attachmentsMenuJustShown = false;
        var __adminToolsMenuJustShown = false;
        var __ie7Mode = false;

        function __ToggleAttachmentsMenu(cx, cy) {
        	var element = document.getElementById("PageAttachmentsDiv");
        	if(element) {
        		if(element.style["display"] == "none") {
        			element.style["display"] = "";
        			var pos = __AbsolutePosition(element);
        			if(pos.left - cx > 0) {
        				__ie7Mode = true;
        				element.style["position"] = "absolute";
        				element.style["top"] = cy + "px";
        				element.style["left"] = (cx - pos.width) + "px";
        			}
        			else {
        				__RepositionDiv(document.getElementById("PageAttachmentsLink"), element);
        			}
        			__attachmentsMenuJustShown = true;
        		}
        	}
        	return false;
        }
        function __HideAttachmentsMenu() {
        	var element = document.getElementById("PageAttachmentsDiv");
        	if(element && !__attachmentsMenuJustShown) {
        		element.style["display"] = "none";
        		if (__ie7Mode) element.style["left"] = "10000px";
        	}
        	__attachmentsMenuJustShown = false;
        	return true; // Needed to enabled next clicks' action (file download)
        }

        function __ToggleAdminToolsMenu(cx, cy) {
        	var element = document.getElementById("AdminToolsDiv");
        	if(element) {
        		if(element.style["display"] == "none") {
        			element.style["display"] = "";
        			var pos = __AbsolutePosition(element);
        			if(pos.left - cx > 0) {
        				__ie7Mode = true;
        				element.style["position"] = "absolute";
        				element.style["top"] = cy + "px";
        				element.style["left"] = (cx - pos.width) + "px";
        			}
        			else {
        				__RepositionDiv(document.getElementById("AdminToolsLink"), element);
        			}
        			__adminToolsMenuJustShown = true;
        		}
        	}
        	return false;
        }
        function __HideAdminToolsMenu() {
        	var element = document.getElementById("AdminToolsDiv");
        	if(element && !__adminToolsMenuJustShown) {
        		element.style["display"] = "none";
        		if(__ie7Mode) element.style["left"] = "10000px";
        	}
        	__adminToolsMenuJustShown = false;
        	return true; // Needed to enable next clicks' action (admin tools)
        }

        function __HideAllMenus() {
        	__HideAttachmentsMenu();
        	__HideAdminToolsMenu();
        }

        document.body.onclick = __HideAllMenus;

        function __AbsolutePosition(obj) {
        	var pos = null;
        	if(obj != null) {
        		pos = new Object();
        		pos.top = obj.offsetTop;
        		pos.left = obj.offsetLeft;
        		pos.width = obj.offsetWidth;
        		pos.height = obj.offsetHeight;

        		obj = obj.offsetParent;
        		while(obj != null) {
        			pos.top += obj.offsetTop;
        			pos.left += obj.offsetLeft;
        			obj = obj.offsetParent;
        		}
        	}
        	return pos;
        }

        var __showTimer = null;
        var __hideTimer = null;

        function __ShowDropDown(e, divId, parent) {
           	// Set a timer
        	// On mouse out, cancel the timer and start a 2nd timer that hides the menu
        	// When the 1st timer elapses
        	//   show the drop-down
        	//   on menu mouseover, cancel the 2nd timer
        	//   on menu mouse out, hide the menu
        	__showTimer = setTimeout('__ShowDropDownForReal(' + e.clientX + ', ' + e.clientY + ', "' + divId + '", "' + parent.id + '");', 200);
        }

        function __ShowDropDownForReal(cx, cy, divId, parentId) {
        	var pos = __AbsolutePosition(document.getElementById(parentId));
        	var menu = document.getElementById(divId);

			// This is needed to trick IE7 which, for some reason,
			// does not position the drop-down correctly with the new Default theme
        	if(pos.left - cx > 30) {
        		menu.style["display"] = "";
        		menu.style["position"] = "absolute";
        		menu.style["top"] = cy + "px";
        		menu.style["left"] = (cx - 10) + "px";
        	}
        	else {
        		menu.style["display"] = "";
        		menu.style["position"] = "absolute";
        		menu.style["top"] = (pos.top + pos.height) + "px";
        		menu.style["left"] = pos.left + "px";
        	}
        	__showTimer = null;
        }

        function __HideDropDown(divId) {
        	if(__showTimer) clearTimeout(__showTimer);
        	__hideTimer = setTimeout('__HideDropDownForReal("' + divId + '");', 200);
        }

        function __HideDropDownForReal(divId) {
        	document.getElementById(divId).style["display"] = "none";
        	__hideTimer = null;
        }

        function __CancelHideTimer() {
        	if(__hideTimer) clearTimeout(__hideTimer);
        }
        
    // -->
    </script>

	<a id="PageTop"></a>
	
	<div id="PageHeaderDiv">
	
		<!-- Change this to PageToolbarDiv -->
		<div id="EditHistoryLinkDiv">
			<a id="DiscussLink" title="Discuss" href="MMBasic.MMBasic-Source-Compression-Utility-CRUNCH-bas-v2-4-part-of-the-original-MMBasic-library266d.html?Discuss=1">Discuss (0)</a>
			
			
			<a id="HistoryLink" title="View Page edit history" href="MMBasic.History0190.html?Page=MMBasic.MMBasic-Source-Compression-Utility-CRUNCH-bas-v2-4-part-of-the-original-MMBasic-library">History</a>
			<a id="PageAttachmentsLink" title="Attachments" href="#" onclick="javascript:return __ToggleAttachmentsMenu(event.clientX, event.clientY);">Attachments</a>
			
			
			
			
		</div>
		
		<h1 class="pagetitle">
			
			MMBasic Source Compression Utility
			
		</h1>
		
		<div id="PrintLinkDiv">
			<a id="PrintLink" href="MMBasic.Print0190.html?Page=MMBasic.MMBasic-Source-Compression-Utility-CRUNCH-bas-v2-4-part-of-the-original-MMBasic-library" title="Printer friendly version" target="_blank">Print</a>
		</div>
		
		<div id="RssLinkDiv">
			
		</div>
		
		<div id="EmailNotificationDiv">
			<span id="Anthem_ctl00_CphMaster_btnEmailNotification__"></span>
		</div>
		
		<div id="ctl00_CphMaster_pnlPageInfo">
	
			<div id="PageInfoDiv">
				<span id="ModificationSpan">
					Modified on 
					2019/02/23 08:53
				</span>
				<span id="AuthorSpan">
					 by 
					<a href="MMBasic.User6a4a.html?Username=admin">Administrator</a>
				</span>
				<span id="NavPathsSpan">
					
				</span>
				<span id="CategoriesSpan">
					Categorized as 
					<a href="MMBasic.AllPages554c.html?Cat=MMBasic.Memory" title="Memory">Memory</a>, <a href="MMBasic.AllPages0409.html?Cat=MMBasic.Program%20Management" title="Program Management">Program Management</a>, <a href="MMBasic.AllPages0f85.html?Cat=MMBasic._LIB%20Original%20MMBasic" title="_LIB Original MMBasic">_LIB Original MMBasic</a>
				</span>
				
				<span id="PageDiscussionSpan">
					
					
				</span>
			</div>
		
</div>
		
		<div id="f3ff1cd60-16ca-4421-9ec1-b6d7ea4fdafd" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('f3ff1cd60-16ca-4421-9ec1-b6d7ea4fdafd');"><a href="MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites.html" title="Ultra-Compact Logging with Flash Storage on small MicroMites">Ultra-Compact Logging with Flash Storage on small MicroMites</a></div><div id="f360e3412-c010-4abc-8751-6c4cec990ab0" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('f360e3412-c010-4abc-8751-6c4cec990ab0');"></div><div id="s1862cee6-47e0-4503-833a-c20d86cfda8a" style="display: none;" class="pageoutgoinglinksmenu" onmouseover="javascript:return __CancelHideTimer();" onmouseout="javascript:return __HideDropDown('s1862cee6-47e0-4503-833a-c20d86cfda8a');"><a href="MMBasic.Ultra-Compact-Logging-with-Flash-Storage-on-small-MicroMites.html" title="Ultra-Compact Logging with Flash Storage on small MicroMites">Ultra-Compact Logging with Flash Storage on small MicroMites</a></div><div id="BreadcrumbsDiv"><div id="BreadcrumbsDivMin"><a href="#" onclick="javascript:return __ShowAllTrail();" title="Click here to view the complete Breadcrumbs Trail">(10)</a> &raquo; <a href="MMBasic.MMBasic-code-pack-to-Read-and-Write-Winbond-Flash-Memories.html" title="MMBasic code-pack to Read and Write Winbond Flash Memories (MMBasic)" onmouseover="javascript:return __ShowDropDown(event, 's1862cee6-47e0-4503-833a-c20d86cfda8a', this);" id="lnks1862cee6-47e0-4503-833a-c20d86cfda8a" onmouseout="javascript:return __HideDropDown('s1862cee6-47e0-4503-833a-c20d86cfda8a');">MMBasic code-pack to Read and Write Winbond Flash Memories (MMBasic)</a> &raquo; <a href="MMBasic.MMBasic-Source-Code-Formatter-part-of-the-original-MMBasic-library.html" title="MMBasic Source Code Formatter (MMBasic)">MMBasic Source Code Formatter (MMBasic)</a> &raquo; <b><a href="MMBasic.MMBasic-Source-Compression-Utility-CRUNCH-bas-v2-4-part-of-the-original-MMBasic-library.html" title="MMBasic Source Compression Utility (MMBasic)">MMBasic Source Compression Utility (MMBasic)</a></b> </div><div id="BreadcrumbsDivAll" style="display: none;"><a href="#" onclick="javascript:return __HideTrail();" title="Click here to hide the Breadcrumbs Trail">[X]</a> &raquo; <a href="MMBasic.MaxMan-part-of-the-original-MMBasic-library.html" title="MaxMan (MMBasic)">MaxMan (MMBasic)</a> &raquo; <a href="MMBasic.Maze-bas-part-of-the-original-MMBasic-library.html" title="Maze.bas (MMBasic)">Maze.bas (MMBasic)</a> &raquo; <a href="MMBasic.Measuring-RMS-algorythm-using-MMBasic.html" title="Measuring RMS (algorythm) using MMBasic (MMBasic)">Measuring RMS (algorythm) using MMBasic (MMBasic)</a> &raquo; <a href="MMBasic.Micromite-eXtreme-Manual.html" title="Micromite eXtreme 5.4.05 Manual and Firmware (MMBasic)">Micromite eXtreme 5.4.05 Manual and Firmware (MMBasic)</a> &raquo; <a href="MMBasic.Midd-Function-to-replace-a-section-of-a-string-works-like-VB-statement-Mid.html" title="Midd$ Function to replace a section of a string, works like VB statement Mid$()= (MMBasic)">Midd$ Function to replace a section of a string, works like VB statement Mid$()= (MMBasic)</a> &raquo; <a href="MMBasic.MM-Event-part-of-the-original-MMBasic-library.html" title="MM_Event (MMBasic)">MM_Event (MMBasic)</a> &raquo; <a href="MMBasic.MMBasic-Create-Manipulate-Stack-Queue-or-List.html" title="MMBasic - Create/Manipulate Stack, Queue or List (MMBasic)">MMBasic - Create/Manipulate Stack, Queue or List (MMBasic)</a> &raquo; <a href="MMBasic.MMBasic-code-pack-to-Read-and-Write-Winbond-Flash-Memories.html" title="MMBasic code-pack to Read and Write Winbond Flash Memories (MMBasic)" onmouseover="javascript:return __ShowDropDown(event, 'f3ff1cd60-16ca-4421-9ec1-b6d7ea4fdafd', this);" id="lnkf3ff1cd60-16ca-4421-9ec1-b6d7ea4fdafd" onmouseout="javascript:return __HideDropDown('f3ff1cd60-16ca-4421-9ec1-b6d7ea4fdafd');">MMBasic code-pack to Read and Write Winbond Flash Memories (MMBasic)</a> &raquo; <a href="MMBasic.MMBasic-Source-Code-Formatter-part-of-the-original-MMBasic-library.html" title="MMBasic Source Code Formatter (MMBasic)">MMBasic Source Code Formatter (MMBasic)</a> &raquo; <b><a href="MMBasic.MMBasic-Source-Compression-Utility-CRUNCH-bas-v2-4-part-of-the-original-MMBasic-library.html" title="MMBasic Source Compression Utility (MMBasic)">MMBasic Source Compression Utility (MMBasic)</a></b> </div></div>
		
		
	
	</div>
	
	<div id="PageContentDiv">
		<h2 class="separator">This module is part of the original MMBasic library. It is reproduced here with kind permission of Hugh Buckle and Geoff Graham. Be aware it may reference functionality which has changed or is deprecated in the latest versions of MMBasic.<a class="headeranchor" id="This_module_is_part_of_the_original_MMBasic_library_It_is_reproduced_here_with_kind_permission_of_Hugh_Buckle_and_Geoff_Graham_Be_aware_it_may_reference_functionality_which_has_changed_or_is_deprecated_in_the_latest_versions_of_MMBasic_0" href="#This_module_is_part_of_the_original_MMBasic_library_It_is_reproduced_here_with_kind_permission_of_Hugh_Buckle_and_Geoff_Graham_Be_aware_it_may_reference_functionality_which_has_changed_or_is_deprecated_in_the_latest_versions_of_MMBasic_0" title="Link to this Section">&#0182;</a></h2><b>Note</b>: Any required file(s) are available in the attachments tab (top right).<br /><br />MMBasic Source Compression Utility CRUNCH.bas v2.4<br />Author: Hugh Buckle June 2013<br />Updated: Dec 2014 to v2.4<br /><br />This suite of programs takes an MMBasic program, reduces its size and increases its execution speed by:<br />- Eliminating all comments and blank lines<br />- Replacing all variables with 1 or 2 character names<br />- Removing indentation<br />- Optionally replacing label names with 1 or 2 characters<br />- Optionally replacing Subroutine and Function names with 1 or 2 characters<br />- Remove unnecessary # symbols and blanks<br />- Concatenating lines of code where possible.<br />The need for it was suggested by TZAdvantage on The Back Shed forum as he currently does this very tedious job manually.<br />Why would you want to Crunch a program? Well there could be several reasons:<br />- To speed up execution.<br />- To reduce the source size for an imbedded product.<br />- To disguise the techniques used. This is never going to be entirely successful as the persistent user can reverse engineer the code, given enough time and inclination. But it won’t be easy because the variable and label names will have been replaced with one or two character, unrelated names.<br />Unsupported functions:<br />- CRUNCH does not support programs with line numbers. Use MMEdit or NONUMBER.BAS in MMLib to remove line numbers before running CRUNCH.<br />- CRUNCH does not check the code for validity. Make sure your code runs before Crunching it and test it well after wards as there is no guarantee that the Crunch process is 100% accurate.<br />- CRUNCH v2.4 does not support MicroMite MMBasic 4.5 as it will create A and A$ as separate variables and it does not recognise the “%” and “!” variable suffixes.<br />There are three programs in the suite:<br />KEYWORDS.BAS which creates a couple of files of keywords which Crunch must not change: - RWord.CSV, a CSV file containing a sorted list of all of the MMBasic keywords and - RWords.txt, a list of short (1 and 2 character) alpha keywords which must not be used as substitute variable names. Input is one or more files containing the names of all the MMBasic commands, functions, obsolete commands, operators and system variables and their respective parameters. KeyWords only needs to be run when MMBasic is updated with additional Commands or Functions.<br />CRUNCH.BAS which performs the first few stages of the crunch process. It deletes all comments, blank lines and unnecessary blanks and #, if required. It identifies and marks every variable, Subroutine name, Function name and Label in the source for future substitution with a short name, writing the modified source to a temporary file. It then passes control to <br /><br /><h1 class="separator"> </h1>CRUNCHa.BAS Reads the marked up source, replaces the marked items with one- or two-character names, combines lines into multi-statement lines where possible and writes the resultant code to the output file. The short names in RWords.txt are not used as substitute names as they are MMBasic keywords (e.g. IF, TO, AS, ON, OR, PI, F1, F2, …).<br />Changes in v2.4 of the Crunch suite of programs.CRUNCH.BAS Fixed a problem whereby some keywords were not recognised in the source. Added a Testing switch /T to set the variable Testing to True (Default: False). This causes some additional messages to be printed and suppresses deletion of temporary files. Include the /T switch in Crunch.dat if required or on the command line. Changed the variable marker from “!” to “~” as it is less likely to be used anywhere in the source.<br /><br /><h1 class="separator"> </h1>KEYWORDS.BAS has been changed (it was called RWSRTMRG.BAS – a name which reflected how it worked, not what its purpose is) to make it easier to reliably update the list of keywords (reserved words) when MMBasic is enhanced. Up to v2.3, the command and function reserved word files contained only one reserved word per line. KeyWords v2.4 allows more than one word per line so that each line can contain the command or function and all of its parameters. So now Commands and Functions can appear in the same order as they do in the MMBasic Language Manual, one line per Command or Function making it easy to check that all changes have been incorporated. The files in this distribution are up to date with MMBasic v4.5. They are contained in: Cmd.txt (Commands), Funct.txt (Functions), ObsCmd.txt (Obsolete commands), Oper.txt (operators) and SysVar.txt (System variables). I have removed output file names and the NumberOfInputFlies parameter from the Implied Run Command for KEYWORDS.BAS and from the parameter data file (KEYWORDS.DAT). The program now sets the output file names (which are used by CRUNCH.BAS) and assumes that all file names in KEYWORDS.DAT are input files. It processes them one after the other. I have reduced the number of dots printed on the screen when KEYWORDS.BAS is sorting data and have removed them altogether when running in a DOS environment, because it all happens very quickly.<br />Running the programs<br /><br /><h1 class="separator"> </h1>KEYWORDS.BAS 2 methods:<br />i. Using the Implied Run Command Type KEYWORDS InputFilename_1&#0091;, InputFileName_2…&#0093; e.g. KEYWORDS Cmd.txt Funct.txt Oper.txt SysVar.txt ObsCmd.txt<br />ii. Create KEYWORDS.DAT containing one record with format: InputFilename1&#0091;,InputFileName2&#0093;&#0091;,InputFileName3&#0093;… e.g. Commands.txt, Functns.txt, Operands.txt, SysVars.txt, ObsCmnds.txt Then type KEYWORDS In both methods, file names may be separated with a comma or space. Extra commas and spaces are ignored.<br /><br /><h1 class="separator"> </h1>CRUNCH.BAS 2 methods:<br />i. Using the implied Run Command. Type CRUNCH InputSourceFileName<.BAS> OutputFileName<.BAS> </B> </F> </L> </P> </T> e.g. Crunch MyProg test<br />ii. Create CRUNCH.DAT containing a single record with format: InputSourceFileName<.bas> OutputFileName<.bas> </B> </F> </L> </P> </T> e.g. MyProg.bas test /L /P /F Then type CRUNCH<br />In both methods parameters may be separated by comma or space, but not mixed - use one or the other.<br />Switches: /B suppresses removal of unnecessary blanks and tabs in the code.<br />/F suppresses replacement of Function and Subroutine names.<br />/L suppresses replacement of Label names.<br />/M suppresses creation of multi-statement lines. Original multi-statement lines are retained.<br />/P pauses the listing at a pageful and awaits any key press before continuing.<br />/nnn sets the maximum output line length (max 255) (default 255). Note however that this length will be ignored for statements which are longer, e.g. Single-line IF and PRINT statements.<br />/T sets Testing=True within both Crunch.bas and CrunchA.bas (used for debugging).<br /><br />One or more switches may be included in any order after the OutputFileName. For safety, InputSourceFileName must not be the same as OutputFileName. If it is, then the user is prompted for a new output file name. If the output file name exists, the user is asked if it can be overwritten. If filenames do not have an extension, .BAS is assumed. CRUNCHa.BAS is not intended to be run separately. Control is passed to it by CRUNCH after creating a number of temporary files.<br /><br /><b>Testing Progress as of 8/12/2014</b><br /><ul><li>All 3 programs in the suite have been tested on in a Mono MM under MMBasic 4.5 and DOS MMBasic v4.5 under Windows 7</li><li>None have been tested in any other environment (as I don’t have access to them).<br /></li></ul><br /><b>Implementation Notes.</b><br />The biggest problem I had with Crunch was deciding how to identify variables. Labels, user defined Function and Subroutine names are easy as they always appear at the beginning of a line and each has its own strict format. Comments and stuff inside double quotes are also easily identified and eliminated, but variables... So I abandoned the idea of trying to identify variables directly and looked instead for MMBasic built-in Commands and Functions, comments, strings contained in double quotes and user defined function and subroutine names. All these are known or are easily identified. Everything left over which conforms to the rules for variable names must therefore be a variable. So the first thing to do is to create a list of built-in Commands and Functions and their parameters (such as OUTPUT, TO, THEN); there are currently more than 340 of them1. These need to be sorted in ASCII sequence so that they can be looked up quickly and efficiently in a table (array), however they all contain text so it had to be a text array. Whoa! Stop right there! A string array with over 340 elements? No way! It will take up far too much memory and there won't be room for program statements and other variables. So what to do? Fortunately TassyJim on The Back Shed forum had discussed the use of short strings (See topic: Short Strings). His solution was to PEEK and POKE in memory to reduce text space. I didn't want to do that as I thought it might make the result MMBasic version dependent but it did give me the idea of packing as many reserved words as possible in each element of an array and this reduced the size of the array from 340+ elements to 8. Each of the 8 elements contains a portion of the list in Comma Separated Variable (CSV) format and it is relatively quick and easy to find a reserved word using a two stage search; look at the first word in an element to see if it will be in there, and if it is then search through that element. Building RWord.CSV, the sorted list of reserved words, is the job of KEYWORDS.BAS, but more about that later. It currently uses one or more input files. Just specify the names in KEYWORDS.dat or on the implied run command line. <br /><br /><b>CRUNCH</b><br />There aren't as many as 340 Command names and Function names, there are a lot less than that, but if you add in all of the parameters that these built-in Commands and Functions carry with them, then there are around 340 "reserved words". Although these additional reserved words are only reserved in the context of the Command or Function they serve, in this version of CRUNCH, I have treated them all as reserved. For instance OUTPUT is a parameter of OPEN and it is quite valid to use it as a  program variable name. OUTPUT variable name is therefore not changed in this version.<br /><br />Having solved the problems of size and how to identify variables, the rest is relatively straight forward, if rather long-winded. First RWord.CSV is read into an array and input, output file names and switches found, either from CRUNCH.DAT or MM.CMDLine$. <br /><br />Next, if either labels or user defined function and subroutine names are to be left unchanged, it does a quick pass though the input file to build an array of the names. These will then be treated as if they were reserved words. This array must be sorted so it can be searched using a binary search and, of course, it is not known how big to dimension the array until the pass is complete so, as each name is found, it is counted and written to a temporary file. At the end of the pass the<br />array is dimensioned and loaded from the temporary file, sorting and removing any duplicates (which there shouldn't be) as they are read. Sorting is done by checking against others already in the array and slotting it in in ASCII sequence. <br /><br />Now the main task of finding variables can start. Each line of source code is read, comments and blank lines are discarded and variable candidates unearthed. These are checked against the list of MMBasic commands and Functions and against the Labels list, if it exists. If neither scores a hit, then they are variables. Each variable in the source code is enclosed in a VariableStartMark and VariableEndMark and the marked line of code written to a temporary file (CrunchC.tmp) to await a later stage where they will be replaced with a short name. The variables themselves are also written to a temporary file (CrunchV.tmp). <br /><br />There is likely to be a lot of duplication of variable names as you go line by line through the source code so, as each is found and before it is written to the temporary file, it is looked up in a stack to see if it has been found recently. If it has, then it is promoted up the stack so that the most prolific ones are retained on the stack as long as possible. If it hasn't it is added to the top of the stack and, if the stack is full, the one at the bottom is written to the temporary variable name file. This won't eliminate all duplicates, but it gets rid of a lot as variables tend to be gregarious. e.g. a=a+b <br /><br />Next each line is stripped of unnecessary characters. See the list under Unnecessary Characters towards the end of this document.<br /><br />If the code is required to be compressed into multi-statement lines then, before writing the code to CrunchC.tmp, existing multi-line statements are split into single lines so that when they are combined in CRUNCHa it easier to fill a record to the maximum size of 255 characters. Labels are marked so that they will always start on a new line. Singleline IF (SLIF) statements are not broken up into multiple lines so that the logic is preserved. So now we have a file of variable names, albeit with many duplicates, and a file of the source code with all the variables, labels and SLIFs marked and empty lines, comments and unnecessary spaces removed. The next stage is to bring these two together by sorting the variable list, removing duplicates, assigning a new short name to each and then substituting them in the marked source code. This is the point when Crunch runs out of memory so CRUNCH creates a parameter file and passes control to CRUNCHa.<br /><br /><b>CRUNCHa</b><br />CRUNCHa starts by reading the parameter file which gives it file names, counts, the characters which mark a variable and any relevant switches. It then reads the list of variables and creates a sorted array, dropping duplicates as it goes, by using the same slot-in method employed in CRUNCH for sorting the list of label and user-defined function/subroutine names. This array will be bigger than necessary as it is initially dimensioned to the number of variables written to the temporary file by CRUNCH. So to ensure there is enough memory for the rest of processing, it is written to file CrunchSV and then read back into an array of the final size. An earlier version just copied the array to another, but ran out of memory dimensioning the array copy when the source program being crunched had a lot of variables scattered through it, making the unsorted variable list (including duplicates) large. As the variable array is being built from the sorted file, a replacement one or two character name is added to each element, separated from its parent by a comma. Numeric and string variables each have their own sequence of replacement short names so the first numeric variable will be assigned A and the first string variable A$. Only alphabetic characters are used. Two characters should be more than enough as each type has a choice of 26x26=676 different short names available. There are, however certain one and two alpha "words" which are not allowed as variables (e.g. AS) which would change the action of the resultant code (e.g. Pi=10 doesn't change the value of a variable called Pi. When subsequently used it is still 3.14159) so, in this version of Crunch, they have not been used as replacement values. CrunchA gets these commands from RWords.txt which, like RWord.CSV, is created by KEYWORDS.<br /><br />So finally, CRUNCHa can read the marked temporary source file and replace each variable, so kindly marked for it by CRUNCH, with the new short name and concatenate lines where possible. See Concatenating lines below. Job done apart from KILLing the temporary files. When testing, the temporary files aren't killed.<br /><br /><b>Concatenating lines</b><br />By default, Crunch concatenates lines where possible and removes unnecessary characters to save space; each character removed saves one byte; each new-line replaced with a colon saves 3 bytes. When creating multi-statement lines, the following measures are taken into consideration:<br /><ul><li>Concatenated lines must not be greater than 255 characters long (or the line length specified in the /nnn switch). If /nnn is less than the length of a statement, then it is ignored for that statement.</li><li>Two lines may be concatenated placing a single colon between them, provided that:</li><li>The second line doesn't start with a label.</li><li>The second line can be completely contained within the line</li><li>A single line IF statement must not be concatenated with the next line as that could alter the result. However it can be added on to the preceding line (as long as the preceding line is not a single line IF statement). Consider:<br /><code>A = 4<br />IF A = 0 THEN PRINT "Hello" : PRINT "World"<br />Will print nothing. But:<br />A = 0<br />IF A = 0 THEN PRINT "Hello" : PRINT "World"</code><br />Will display:<br />Hello<br />World</li><li>A label must appear at the start of a new line.</li><li>A label doesn't need a colon or space between it and the following statement on the same line. e.g. the following is valid:<br /><code>label1:Print"Hello World"</code></li><li>The first colon on a line is given a space before it, unless it defines a label. This ensures that the identifier<br />preceding the colon isn't mistakenly interpreted as a label.</li><li>Parts of a command must not be split between lines. e.g. the following is invalid:<br /><code>SPRITE<br />MOVE n,x,y</code><br /></li></ul><br /><b>Unnecessary characters</b><br />The following characters are optional and are removed by Crunch, except when within a quoted string.<br /><ul><li>Blanks and tabs appearing before and after the following characters:  , ( ) ; = + - * / < > \ ^ % space tab.</li><li>Space and tab before and after a colon, except when it is the first colon on a line. If it is the first, then a space before it is not removed as this could cause the preceding identifier to be interpreted as a label.</li><li>Space and tab at the beginning and end of a line and before and after a quoted string.</li><li>A # symbol is optional and is removed except in the following commands and when within a quoted string:<br /><code>INPUT #nbr, list of variables<br />LINE INPUT #nbr, string-varaible$<br />PRINT #nbr, expression<br />WRITE &#0091;#nbr,&#0093; expression</code><br /></li></ul><br /><b>KEYWORDS</b><br />Returning now to the program that creates the CSV of reserved words. Geoff very kindly sent me the complete list of Command names and Function names in MMBasic. To this I added all of their parameters. These are contained in the .TXT files in this distribution (Cmd.txt, Funct.txt, Oper.txt, SysVar.txt and ObsCmd.txt). There isn't enough memory to be able to sort all of these reserved words in one go, so KEYWORDS reads in 200 at a time for DOS and 230 at a time for the Mono Maximite (Yes, surprisingly, the MMBasic has more memory available than DOS MMBasic), sorts them and writes them to a temporary file. At EOF all input files, KEYWORDS merges the temporary sorted files into one CSV file, with each CSV record being filled to its maximum of 255 characters. Currently they can all be fitted into 8 records. While writing RWord.csv, all 1 and 2 character alphabetic reserved words are counted and written to a separate temporary file. This file is then copied to RWords.txt, adding the count of records at the front so that CrunchA can dimension an array without having to read the whole file first.<br /><br /><b>Possible future enhancements</b><br />TZAdvantage on The Back Shed, who suggested the need for CRUNCH, would like to see a number of added features which are not in the Nov 2014 version.<br /><ul><li>Some variables are used more than others. To speed up the resultant code, the 26 most used variables should be assigned a single character short name.</li><li>Local variables in defined function and subroutine should have their own list of replacement short names. They can start again from A and A$ and will almost certainly be single character names.<br /></li></ul><br />I hope to work on these enhancements once the initial programs settle down.<br /><br />Hugh Buckle<br /><br /><b>Version History</b><br />v2.4 1/12/2014 Renamed RWSRTMRG.BAS to KEYWORDS.BAS and updated it to: - Allow multiple reserved words per line in input files, separated by comma. - Print an error message if a full stop appears in the input file except when part of a System Variable e.g. MM.VER. Output files are not written if one is found. - Remove output file names from Implied Run Command and from KEYWORDS.DAT - Reduce the number of progress dots while sorting and eliminate them under DOS - Remove any blanks from input files.<br />v2.3 11/6/2013 Added stats and progress dots. Added option to set output record length. Added /T switch to set "Testing=True" Fixed CrunchA to kill CrunchV.tmp on completion of processing. Fixed fault in identifying end of statement (failed to ignore colon inside text string).<br />v2.2 7/6/2013 Option to compress the file by creating multi-statement lines to max 255 characters. Remove al unnecessary # symbols.<br />v2.0 18/5/2013 Added option to remove all unnecessary spaces and tabs from crunched source.<br />v1.01 16/5/2013 Fix to CrunchA which ran out of memory sorting large list of variables.<br />v1.0 12/5/2013 Initial version released to The Back Shed forum .
	</div>
	
	
	
	<div id="PageAttachmentsDiv" style="position: absolute; left: 10000px;">
		<div id="Anthem_ctl00_CphMaster_attachmentViewer_rptItems__">
		<table id="AttachmentViewerTable" class="generic" cellpadding="0" cellspacing="0">
			<thead>
			<tr class="tableheader">
				<th>&nbsp;</th>
				<th>Name</th>
				<th>Size</th>
			</tr>
			</thead>
			<tbody>
	
		<tr class="tablerow">
			<td><img src="Images/File.png" alt="-" /></td>
			<td><a href='CRUNCHe06d.zip?File=CRUNCH.zip&amp;AsStreamAttachment=1&amp;Provider=ScrewTurn.Wiki.FilesStorageProvider&amp;IsPageAttachment=1&amp;Page=MMBasic.MMBasic-Source-Compression-Utility-CRUNCH-bas-v2-4-part-of-the-original-MMBasic-library' title="Download">CRUNCH.zip</a></td>
			<td>233.44 KB</td>
		</tr>
	
		</tbody>
		</table>
	</div>

    </div>
    
    <div id="AdminToolsDiv" style="position: absolute; left: 10000px;">
		
		
		
    </div>
    
    <script type="text/javascript">
    <!--
    	function __RepositionDiv(link, element) {
    		var absPos = __AbsolutePosition(link);
    		var elemAbsPos = __AbsolutePosition(element);

    		element.style["top"] = (absPos.top + absPos.height) + "px";
    		element.style["left"] = (absPos.left - (elemAbsPos.width - absPos.width)) + "px";
    		element.style["position"] = "absolute";
    	}

		// Hide attachments and admin tools divs
    	// This is needed because __RepositionDiv cannot calculate the width of the element when it's hidden
    	var __elem = document.getElementById("PageAttachmentsDiv");
    	if(document.getElementById("PageAttachmentsLink")) {
    		__RepositionDiv(document.getElementById("PageAttachmentsLink"), __elem);
    	}
    	__elem.style["display"] = "none";

    	__elem = document.getElementById("AdminToolsDiv");
    	if(document.getElementById("AdminToolsLink")) {
    		__RepositionDiv(document.getElementById("AdminToolsLink"), __elem);
    	}
    	__elem.style["display"] = "none";

    	__InitBCT();
    // -->
    </script>


                <div id="PageInternalFooterDiv"></div>
                <div id="MainFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>

        </div>
            
        <div id="FooterDiv">
             
        </div>

    </form>  
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.MMBasic-Source-Compression-Utility-CRUNCH-bas-v2-4-part-of-the-original-MMBasic-library.ashx?NS=MMBasic by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:51:11 GMT -->
</html>
