

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml">

<!-- Mirrored from fruitoftheshed.com/MMBasic.History.aspx?Page=MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores&Revision=2 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:36:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=8" /><title>
	Page History - Fruit Of The Shed
</title><script type="text/javascript" src="JS/jquery-1.4.2.min.js"></script>
<script type="text/javascript" src="JS/Scripts.js"></script>
<script type="text/javascript" src="JS/SearchHighlight.js"></script>
<link rel="stylesheet" media="print" href="Themes/Default/Print_Styles.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles%20-%20Copy.css" type="text/css" />
<link rel="stylesheet" media="screen" href="Themes/Default/Screen_Styles.css" type="text/css" />
<link rel="stylesheet" href="Themes/Editor.css" type="text/css" />
<link rel="search" href="searchf7b1.xml?OpenSearch=1" type="application/opensearchdescription+xml" title="Fruit Of The Shed - Search" /><script src="Themes/Default/Scripts.js" type="text/javascript"></script>
<link rel="shortcut icon" href="Themes/Default/Icon.ico" type="image/x-icon" />
</head>
<body>
    <form name="aspnetForm" method="post" action="http://fruitoftheshed.com/History.aspx?NS=MMBasic&amp;Page=MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores&amp;Revision=2" id="aspnetForm">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTEzMjI3OTE2NTkPZBYCZg9kFgICAQ9kFgICCQ9kFggCAQ8WAh4EVGV4dAVWUGFnZSBIaXN0b3J5OiBBRlRFUiwgRVZFUlksIEFULCBSRU1BSU4gRmxleGlibGUgU3RhdGUgTWFjaGluZSBUaW1lcnMgdXNpbmcgU2VtYXBob3Jlcy5kAgUPEGQQFQcBNgE1ATQBMwEyATEBMBUHATYBNQE0ATMBMgExATAUKwMHZ2dnZ2dnZ2RkAgcPEGQQFQgHQ3VycmVudAE2ATUBNAEzATIBMQEwFQgHQ3VycmVudAE2ATUBNAEzATIBMQEwFCsDCGdnZ2dnZ2dnZGQCCw8WAh8ABclXPHRhYmxlIGNsYXNzPSJib3giIGNlbGxwYWRkaW5nPSIwIiBjZWxsc3BhY2luZz0iMCI+PHRyPjx0ZD48cCBzdHlsZT0idGV4dC1hbGlnbjogY2VudGVyOyI+PGI+PGEgaHJlZj0iTU1CYXNpYy5IaXN0b3J5LmFzcHg/UGFnZT1NTUJhc2ljLkFGVEVSLUVWRVJZLVJFTUFJTi1GbGV4aWJsZS1TdGF0ZS1NYWNoaW5lLVRpbWVycy11c2luZy1TZW1hcGhvcmVzJmFtcDtSZXZpc2lvbj0wMDAwMSI+JmxhcXVvOyBPbGRlciBSZXZpc2lvbjwvYT4gLSA8YSBocmVmPSJNTUJhc2ljLkhpc3RvcnkuYXNweD9QYWdlPU1NQmFzaWMuQUZURVItRVZFUlktUkVNQUlOLUZsZXhpYmxlLVN0YXRlLU1hY2hpbmUtVGltZXJzLXVzaW5nLVNlbWFwaG9yZXMiPkJhY2sgdG8gUGFnZSBIaXN0b3J5PC9hPiAtIDxhIGhyZWY9Ik1NQmFzaWMuSGlzdG9yeS5hc3B4P1BhZ2U9TU1CYXNpYy5BRlRFUi1FVkVSWS1SRU1BSU4tRmxleGlibGUtU3RhdGUtTWFjaGluZS1UaW1lcnMtdXNpbmctU2VtYXBob3JlcyZhbXA7UmV2aXNpb249MDAwMDMiPk5ld2VyIFJldmlzaW9uICZyYXF1bzs8L2E+PC9iPjwvcD48L3RkPjwvdHI+PC90YWJsZT48YnIgLz48aDMgY2xhc3M9InNlcGFyYXRvciI+UGFnZSBSZXZpc2lvbjogMjAxOS8wNC8wOCAxMzozNDwvaDM+PGJyIC8+QSA8YSBjbGFzcz0iZXh0ZXJuYWxsaW5rIiBocmVmPSJodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9GaW5pdGUtc3RhdGVfbWFjaGluZSIgdGl0bGU9IlN0YXRlIE1hY2hpbmUiIHRhcmdldD0iX2JsYW5rIj5TdGF0ZSBNYWNoaW5lPC9hPiBpcyBhIG1hdGhlbWF0aWNhbCBjb25jZXB0IHdoZXJlYnkgYSBzeXN0ZW0gaXMgZHJpdmVuIGJ5IHN0aW11bGkgYW5kIGl0cyBzdGF0ZSBhbHRlcnMgYnkgcmVhY3RpbmcgdG8gdGhlbS4gVGhlIGNvbmRpdGlvbiBvZiB0aGUgc3RpbXVsaSBpbmRpY2F0ZXMgdGhlIHN0YXRlIG9mIHRoZSBzeXN0ZW0gYXQgYW55IHBvaW50IGluIHRpbWUuIDxiciAvPjxiciAvPkluIGNvbXB1dGluZywgc3RhdGUgbWFjaGluZSBtZXRob2RvbG9neSBpcyBlbXBsb3llZCB0byBnZXQgYXdheSBmcm9tIGhhdmluZyBhIHRyYWRpdGlvbmFsbHkgdGlnaHRseSBpbnRlcmxvY2tlZCBzeXN0ZW0gaW4gZmF2b3VyIG9mIG9uZSB0aGF0IGlzIG9ubHkgYWN0aXZlIHdoZW4gYSBzdGltdWx1cyBpcyByZWNlaXZlZDsgQ2hhbmdpbmcgaXRzICJzdGF0ZSIgZGVwZW5kaW5nIG9uIHRob3NlIHN0aW11bGkuIFN0aW11bGkgY291bGQgYmUgSS9PIHBpbnMsIGEgc3BlY2lmaWMgc3RyaW5nIG9yIG1vcmUgb2Z0ZW4sIGZsYWdzLiBTdWNoIHN5c3RlbXMgdGVuZCB0byBiZSBsb29zZS1jb3VwbGVkIHRvIGl0cyB0YXNrcyBhbmQgdGh1cyBlYXNpZXIgdG8gcHJvZ3JhbSBmb3IgbXVsdGlwbGUgYWN0aW9ucywgZWFjaCBiZWluZyBzZWxmIGNvbnRhaW5lZCBpbiBzdWItcHJvZ3JhbXMgYW5kIHRyaWdnZXJlZCBieSBpdHMgc3RpbXVsdXMuPGJyIC8+PGJyIC8+VGhpcyBpcyBhIG1ham9yIHN0ZXAgdG93YXJkcyBldmVudC1kcml2ZW4gcHJvZ3JhbW1pbmcuIEV2ZW50LWRyaXZlbiBwcm9jZXNzaW5nIGNhbiBwcm92aWRlIGFuIGFsbW9zdCBtdWx0aS10YXNraW5nIGFwcGVhcmFuY2UgaW4gbWljcm8tY29udHJvbGxlcnMgYXMgc2VjdGlvbnMgb2YgY29kZSBleGVjdXRlIGFzeW5jaHJvbm91c2x5IHRvIG90aGVycywgc2lnbmFsaW5nIGFuZCBpbnRlcmxvY2tpbmcgd2l0aCBvdGhlciBzdWItcHJvZ3JhbXMgYnkgc2V0dGluZyBvciBjbGVhcmluZyBmbGFncyAtIGEgcHJvY2VzcyBjYWxsZWQgInNlbWFwaG9yZSIuIEFsdGhvdWdoIGl0IGlzIGEgZmFpcmx5LWlzaCBtb2Rlcm4gYXBwcm9hY2ggKHJlYWxseSBzdGFydGVkIHRvIHRha2Ugb2ZmIGFyb3VuZCB0aGUgbWlkIDkwcykgdG8gd3JpdGluZyBnb29kIHByb2dyYW1zLCB0aGUgcHJvY2VzcyBvZiBzZW1hcGhvcmUgYnkgdHdlYWtpbmcgZmxhZ3MgZ29lcyBiYWNrIHRvIHRoZSBlYXJsaWVzdCBDUFVzLCB3aGVuIGFuIGFjdGlvbiB3b3VsZCBiZSB0YWtlbiBhcyBhIHJlc3VsdCBvZiBvbmUgcHJvY2VzcyBzaWduYWxpbmcgYSBzcGVjaWZpYyBzdGF0ZSB3aGljaCByZXN1bHRlZCBpbiBhbm90aGVyIHByb2Nlc3MgZG9pbmcgc29tZXRoaW5nIGFib3V0IGl0LiBBbGwgQ1BVcyBzdXBwb3J0IHNlbWFwaG9yZXMsIGlmIG9ubHkgd2l0aCBhIHplcm8gZmxhZyBvciBjYXJyeSBmbGFnIGluIHRoZSBzdGF0dXMgcmVnaXN0ZXIuIFRoaXMgd2FzIHdhcyBhIGdvb2Qgd2F5IHRvIHNpZ25hbCBmcm9tIGEgb25lIHNlY3Rpb24gb2YgY29kZSB0byBhbm90aGVyIHRoYXQgYSBkZWNpc2lvbiBuZWVkZWQgdG8gYmUgbWFkZS48YnIgLz48YnIgLz5Vc3VhbGx5LCB0aGUgbWFpbiBzZWN0aW9uIG9mIHRoZSBwcm9ncmFtIGdvZXMgcm91bmQgaW4gYSBsb29wIGFzIGJlZm9yZSBidXQgaW5zdGVhZCBvZiB0YWtpbmcgYWN0aW9ucyBhcyBwYXJ0IG9mIG9yIGluLWxpbmUgd2l0aCB0aGUgbWFpbiB0aHJlYWQsIGl0IGNoZWNrcyB0aGUgc3RhdGUgb2YgZmxhZ3Mgb3IgSS9PIGFuZCBsYXVuY2hlcyBvdGhlciBwcm9jZXNzZXMgdG8gZGVhbCB3aXRoIGl0IGFzIGFwcHJvcHJpYXRlIGUuZy4gd2hlbiBhIGdpdmVuIGZsYWcgYmVjb21lcyBzZXQgKG9yIHdoYXRldmVyIHlvdSB3YW50KS4gSW4gbW9kZXJuIGNvbXB1dGVyIGxhbmd1YWdlcywgdGhlICJtYWluIGxvb3AiIHdvdWxkIGJlIGEgZG9ybWFudCBzdGF0ZSBhbmQgdGhlIGV2ZW50IGhhbmRsZXIgd291bGQgd2FrZSB5b3VyIHByb2dyYW0gd2hlbiB0aGUgc3RhdGUgb2YgdGhlIHN0aW11bGkgY2hhbmdlZCAoeW91IGRvbid0IGhhdmUgdG8gZ2l2ZSB0aGUgQ1BVIHNvbWV0aGluZyB0byBkbyB3aGlsZSBpdCBpcyB3YWl0aW5nIGZvciBhIHN0YXRlIGNoYW5nZSkuIFRoaXMgbWFrZXMgYWxsIG9mIHRoZSByZXNvdXJjZXMgKHdoaWxlIHRoZSBDUFUgaXNuJ3QgYnVzeSkgYXZhaWxhYmxlIHRvIHRoZSBzeXN0ZW0gZm9yIG90aGVyIHRhc2tzLiBXaXRoIG1pY3JvLWNvbnRyb2xsZXJzIHlvdSBkb24ndCBvZnRlbiBoYXZlIGFuIE9wZXJhdGluZyBTeXN0ZW0gdG8gaGFuZGxlIHRoZSBDUFUgd2hlbiBpdCBpcyBpZGxlIC0geW91IGNvbnRyb2wgdGhlIENQVSBhdCBhIHZlcnkgbG93IGxldmVsLjxiciAvPjxiciAvPlN0YXRlLW1hY2hpbmUgY29kZSBhbHNvIG1ha2VzIGZvciBlYXNpbHkgcmVhZGFibGUgYW5kIG1vZGlmaWFibGUgcHJvZ3JhbXMgYXMgZWFjaCBhY3Rpb24gYmVjb21lcyBhIHRydWUgc3ViLXByb2dyYW0gYW5kIHlvdSBkb24ndCBoYXZlIHRvIHdvcnJ5IGFib3V0IGRpc3J1cHRpbmcgb3RoZXIgc2VjdGlvbnMgb2YgY29kZSBzbyBsb25nIGFzIGFueSBzdWIgcHJvZ3JhbSBoYW5kbGVzIGl0cyBpbnB1dCB2YWx1ZXMgYW5kIHByb3ZpZGVzIHRoZSBleHBlY3RlZCBvdXRwdXQgdmFsdWVzLiBGbGFncyBjYW4gYmUgc2V0IGJ5IGFueSBzZWN0aW9uIG9mIGNvZGUsIHRyaWdnZXJpbmcgYWN0aXZpdHkgZnJvbSBhbnl3aGVyZSBpbiB5b3VyIGNvZGUuIDxiciAvPjxiciAvPkVub3VnaCBpbnRyb2R1Y3Rpb24vZ2VuZXJhbGl6YXRpb24sIGRvd24gdG8gdGhlIG1lYXQgb2YgdGhpcyBhcnRpY2xlLi4uIEEga2V5IHJlcXVpcmVtZW50IG9mIGEgc3RhdGUgbWFjaGluZSBpcyBzZWN0aW9ucyBvZiBjb2RlIGJlaW5nIGV4ZWN1dGVkIHRvIGEgc2NoZWR1bGUgb3IgYWZ0ZXIgYSBwZXJpb2Qgb2YgdGltZS4gVGhlIGZvbGxvd2luZyB1c2VzIGFuIGFycmF5IG9mIGZsYWdzIGFuZCBjb3VudGVycyB0byBrZWVwIHRyYWNrIG9mIChpbiB0aGlzIGNhc2UgYnV0IGVhc2lseSB0d2Vhay1hYmxlKSAxMCB0aW1lcnMsICB3aXRoIG9wdGlvbiBmb3IgdGhlbSB0byBiZSBzaW5nbGUtc2hvdCBvciByZXBlYXRpbmcuIFRoZSB0aW1lcnMgY2FuIGJlIHN0b3BwZWQgb3IgdGVtcG9yYXJpbHkgZGlzYWJsZWQuIFRoZSBiZWxvdyBTdWJzL0Z1bmN0aW9ucyBhcmUgaW5zcGlyZWQgYnkgdGhlIExvY29tb3RpdmUgQmFzaWMgY29tbWFuZHMgb2YgdGhlIHNhbWUgbmFtZXMgYW5kIG1ha2UgZXhlY3V0aW5nIHNlY3Rpb25zIG9mIGNvZGUgYXN5bmNocm9ub3VzbHkgYSBicmVlemUuIE1NQmFzaWMgcHJvdmlkZXMgZm91ciB0aW1lcnMgYnV0IHRoZXkgZXhwZWN0IGEgc3ViIHByb2dyYW0gdG8gYmUgY2FsbGVkIGVhY2ggdGltZSBhbmQgdGhleSBoYXZlIHRvIGJlIGhhbmRsZWQgKGkuZS4gaWYgdGhleSBhcmUgb25lLXNob3QpIGJ5IHRoZSBjYWxsZWQgc3ViLiBUaGUgZm9sbG93aW5nIGNvZGUgdXNlcyBhIHNpbmdsZSBNTUJhc2ljIHRpbWVyIGJ1dCB0aGVuIGV4cGFuZHMgdGhpcyB0byBwcmFjdGljYWxseSB1bmxpbWl0ZWQgdGltZXJzIGFuZCByZWFsbHkgZWFzeSB0byBzZXQgb25lIHJ1bm5pbmcuIFRoZSBtYWluIGxvb3Agc2ltcGx5IGNoZWNrcyBmb3IgdGhlIHJlbGV2YW50IGZsYWcgYW5kIHRha2VzIGFjdGlvbiAoY2FsbHMgYSBTdWIsIGNoYW5nZXMgdGhlIHN0YXRlIG9mIGFuIG91dHB1dCBwaW4gZXRjLi4uKSBpZiBpdCBpcyBzZXQuPGJyIC8+PGJyIC8+PGI+UHJvczo8L2I+PGJyIC8+PHVsPjxsaT5FYXN5IHRvIGNvbmZpZ3VyZSBhIG9uZS1zaG90IHRpbWVyLjwvbGk+PGxpPkVhc3kgdG8gcmUtdXNlIHRpbWVycyBmb3IgZGlmZmVyZW50IHNlY3Rpb25zIG9mIGNvZGUuPC9saT48bGk+UmV0cmlldmUgdGhlIHJlbWFpbmluZyB0aW1lIG9uIGNhbmNlbGxpbmcgYSB0aW1lci48L2xpPjxsaT5ObyBuZWVkIHRvIHdvcnJ5IGFib3V0IGhhbmRsaW5nIFNFVFRJQ0sgLSBObyBkZWRpY2F0ZWQgU3ViIHRvIGhhbmRsZSBhbiBldmVudCAtIGp1c3QgZG8gaXQgaW5saW5lIHdoZW4gaXQgaXMgY29udmVuaWVudC48L2xpPjxsaT5HaXZlcyBtdWNoIGdyZWF0ZXIgc2NvcGUgZm9yIHRoZSBudW1iZXIgb2YgdGltZXJzLjwvbGk+PGxpPk11bHRpcGxlIHRpY2tzIG9mIHRoZSBzYW1lIGNvdW50ZXIgZ2l2ZSBvbmx5IGEgc2luZ2xlIGV2ZW50IC0gTm8gZXZlbnQgInN0b3JtcyIgZm9yIHNsb3ctcnVubmluZyBjb2RlLjwvbGk+PGxpPk1hbmFnZWFibGUgcHJvZ3JhbSBpbnRlcnJ1cHRpb24gLSBJdCBpcyB0b3RhbGx5IGRvd24gdG8gdGhlIHByb2dyYW0gZmxvdyAtIG5vdGhpbmcga2lja2luZyBvZmYgImJlaGluZCB5b3VyIGJhY2siLjwvbGk+PGxpPk5vIGltcGxpY2l0IHByaW9yaXR5IHRvIHRpbWVycywgaXQgaXMgZG93biB0byBob3cgdGhlIGZsYWdzIGdldCBjaGVja2VkLjxiciAvPjwvbGk+PC91bD48YnIgLz48Yj5Db25zOjwvYj48YnIgLz48dWw+PGxpPlRpbWVyIHJlc29sdXRpb24gaXMgbm90IGFzIGdvb2QgYXMgU0VUVElDSyBvbiBzbG93IHN5c3RlbXMgLSB2ZXJ5IHNtYWxsIGRlbGF5cyBhcmUgbGlrZWx5IHRvIGJlIGluYWNjdXJhdGUsIGUuZy4gd2FpdGluZyBvbmUgc2Vjb25kIHdoZW4gdGhlIHNlcnZpY2UgcGVyaW9kIGlzIDEwMDBtUy48YnIgLz48L2xpPjwvdWw+PGJyIC8+VGhlIGZvbGxvd2luZyBwcm92aWRlcyBhIGNvcmUgdGltZXIgaGFuZGxlciBhbmQgdGhyZWUgU3VicyB0byBzZXQgcmVwZXRpdGl2ZSBvciBvbmUtc2hvdCB0aW1lcnMgYW5kIGEgbWV0aG9kIHRvIHN0b3AgYSB0aW1lciAoYW5kIHJldHVybiB0aGUgcmVtYWluaW5nIGNvdW50IGJlZm9yZSBpdCB3YXMgc3RvcHBlZCkuPGJyIC8+PGJyIC8+PGI+RGVwZW5kZW5jaWVzOjwvYj48YnIgLz48dWw+PGxpPjxhIGNsYXNzPSJwYWdlbGluayIgaHJlZj0iTU1CYXNpYy5CaXQtTWFuaXB1bGF0aW9uLUZ1bmN0aW9ucy5hc2h4IiB0aXRsZT0iQml0IE1hbmlwdWxhdGlvbiBGdW5jdGlvbnMiPkJpdCBNYW5pcHVsYXRpb24gRnVuY3Rpb25zPC9hPiAgQml0cyAwIC0gOSBpbiB0aGUgRmxhZ3MgZmllbGQgY29ycmVzcG9uZCB0byB0aW1lcnMgMC05Li4uIHR3ZWFrIGFzIG5lY2Vzc2FyeS4gQml0IDEwIGlzIHRoZSBnbG9iYWwgdGltZXIgZGlzYWJsZSBiaXQgKD0xKS4gSW4gdGhlIGRpc2FibGVkIHN0YXRlLCB0aW1lcnMgYXJlIG5vdCBkZWNyZW1lbnRlZCBhbmQgYW55IHRpbWUgc3BlbnQgZGlzYWJsZWQgd2lsbCBiZSBlZmZlY3RpdmVseSBhZGRlZCB0byBydW5uaW5nIHRpbWVycy4gRS5nLiBpZiBhIHRpbWVyIGlzIGR1ZSB0byBleHBpcmUgYWZ0ZXIgMTAgc2Vjb25kcyBidXQgc3BlbmRzIGZpdmUgc2Vjb25kcyBkaXNhYmxlZCwgdGhlIHRvdGFsIGRlbGF5IHdpbGwgYmUgMTUgc2Vjb25kcy4gREkvRUkgc2hvdWxkIGJlIHVzZWQgdG8gc3RvcCB0aGUgdGltZXJzIHdoZW4gc29tZSBjcml0aWNhbCBwcm9jZXNzIGlzIHRha2luZyBwbGFjZSB0byBwcmV2ZW50IHN0YXRlIGNoYW5nZXMuPC9saT48bGk+VGhyZWUgZ2xvYmFsIHZhcmlhYmxlcyBhcmUgcmVxdWlyZWQsIHR3byBpbnRlZ2VyIGFycmF5cyBhbmQgYSBzaW1wbGUgaW50ZWdlciB0byBob2xkIHRoZSBmbGFncy48L2xpPjxsaT48YSBjbGFzcz0icGFnZWxpbmsiIGhyZWY9Ik1NQmFzaWMuVW5peFRpbWUtb3ItRXBvY2gtVGltZS5hc2h4IiB0aXRsZT0iVW5peFRpbWUgb3IgRXBvY2ggVGltZSI+VW5peFRpbWU8L2E+IHJlcXVpcmVkIGlmIHlvdSBpbnRlbmQgdG8gdXNlIHRoZSBBdCBmdW5jdGlvbmFsaXR5PGJyIC8+PC9saT48L3VsPjxiciAvPjxiPlZhcmlhYmxlIERlc2NyaXB0aW9uczo8L2I+PGJyIC8+VE1SY3RyKCkgbWFpbnRhaW5zIHRoZSBjb3VudCBmb3IgYSBnaXZlbiB0aW1lcjxiciAvPlRNUmluaSgpaG9sZHMgdGhlIHRpbWVyIHR5cGUgYW5kIGl0cyBpbml0aWFsaXphdGlvbiB2YWx1ZS48YnIgLz48Y29kZT4gICAgLSBiaXRzIDAtNjEgc3RvcmUgdGhlIGluaXRpYWwgdmFsdWUgdmFsdWU8YnIgLz4gICAgLSBiaXRzIDYzJjYyIHN0b3JlIHRoZSBmb3JtYXQgb2YgdGhlIGNvdW50ZXI6PGJyIC8+ICAgICAgICAwPWRpc2FibGVkPGJyIC8+ICAgICAgICAxPShhY3R1YWxseSAweDQwMDAwMDAwMDAwMDAwMDApIGluZGljYXRlcyBhIG9uZSBzaG90ICJBRlRFUiB4IiB0eXBlIGNvdW50ZXI8YnIgLz4gICAgICAgIDI9KGFjdHVhbGx5IDB4ODAwMDAwMDAwMDAwMDAwMCkgaW5kaWNhdGVzIGEgcmVwZXRpdGl2ZSAiRVZFUlkgeCIgdHlwZSBjb3VudGVyPGJyIC8+PC9jb2RlPjxiciAvPkFzIHdyaXR0ZW4gYmVsb3csIGl0IHByb3ZpZGVzIDEwIHRpbWVycyB3aGljaCBzaG91bGQgYmUgbG9hZHMgZm9yIGp1c3QgYWJvdXQgYW55IHVzZSwgYnV0IHRoaXMgY2FuIGJlIHR3ZWFrZWQgYXMgeW91IHNlZSBmaXQuPGJyIC8+PGJyIC8+VGhlIENvcmVUTVIgbmVlZHMgdG8gYmUgc2V0IHJ1bm5pbmcgd2l0aCB0aGUgU0VUVElDSyBjb21tYW5kIC0gdGltZXIgY291bnRlciB2YWx1ZXMgYXJlIGEgbXVsdGlwbGUgb2YgdGhlIGludGVydmFsIHVzZWQgaGVyZS4gVHJ5IG5vdCB0byBiZSB0b28gYWdncmVzc2l2ZSB3aXRoIHNtYWxsL2Zhc3QgaW50ZXJ2YWxzIGJ1dCB0aGUgbGFyZ2VyIHRoZSBpbnRlcnZhbCB0aGUgZ3JlYXRlciB0aGUgbG9zcyBvZiByZXNvbHV0aW9uLiBGaW5kIHNvbWV0aGluZyB0aGF0IHdvcmtzIGZvciB5b3UgYnV0IHJlbWVtYmVyIHRvIGFkanVzdCB5b3VyIHRpbWVyIHZhbHVlcyBhY2NvcmRpbmdseSBlLmcuIGlmIHlvdSB3YW50IHRpY2tzIDEwIHRpbWVzIGEgc2Vjb25kLCB0aGUgc2V0aXRpY2sgbXVzdCBiZSBzZXQgdG8gMTAwIC0gYW5kIHRoZSB2YWx1ZXMgdXNlZCBpbiBBRlRFUiAmIEVWRVJZIHdvdWxkIG5lZWQgdG8gcmVmbGVjdCB0aGUgaW5jcmVhc2UgaW4gcmVzb2x1dGlvbiAtaW4gdGhlIGFib3ZlIGV4YW1wbGUgMSBzZWNvbmQgYmVjb21lcyAxMCBjb3VudHMgZXRjLjxiciAvPjxiciAvPjxiPkV4YW1wbGU6PC9iPjxiciAvPjxwcmU+DQpQcmVhbWJsZSYjNTg7DQoJT3B0aW9uIEJhc2UgMA0KDQoJRGltIEludGVnZXIgVE1SY3RyKDkpLFRNUmluaSg5KQ0KDQoJRmxhZ3M9MA0KCQ0KCVNFVFRJQ0sgMTAwMCxDb3JlVE1SLDQnIHNlcnZpY2UgdGltZXJzIGV2ZXJ5IHNlY29uZA0KDQoNCg0KDQoNCk1haW4mIzU4Ow0KJyBleGFtcGxlIHVzYWdlIGZvciB0aGUgbWFpbiBsb29wDQonIGdpdmVzIHRoZSB1c2VyIDEwIHNlY29uZHMgdG8gaGl0IGEga2V5ICh1c2luZyB0aW1lciAxKQ0KCVByaW50ICJRdWljayBQcmVzcyBhIGtleSEiDQoJDQoJQWZ0ZXIgMTAsMSAnIDEwIHNlY29uZHMgdXNpbmcgdGltZXIgMQ0KCUV2ZXJ5IDEgLDIgJyBjb3VudCAxIHNlY29uZCBpbnRlcnZhbHMgdXNpbmcgdGltZXIgMg0KCUV2ZXJ5IDIgLDMgJyBjb3VudCAyIHNlY29uZCBpbnRlcnZhbHMgdXNpbmcgdGltZXIgMw0KCUF0ICIwMS8wMS8yMDIwIDAwJiM1ODswMCYjNTg7MDAiLDQgJ3RyaWdnZXIgZmxhZyA0IGF0IHRoaXMgc3BlY2lmaWMgZGF0ZSAmYW1wOyB0aW1lDQoNCglEbw0KCQlhJD1JbmtleSQNCgkJSWYgRmxhZ1Rlc3QoMikgVGhlbiBGbGFnUmVzIDImIzU4O1ByaW50ICJ4Iicgb3V0cHV0IGFuIHggd2hpbGUgd2Ugd2FpdA0KCQlJZiBGbGFnVGVzdCgzKSBUaGVuIEZsYWdSZXMgMyYjNTg7UHJpbnQgInkiJyBvdXRwdXQgYSB5ICB3aGlsZSB3ZSB3YWl0DQoJCUlmIEZsYWdUZXN0KDQpIFRoZW4gRmxhZ1JlcyA0JiM1ODtQcmludCAiSGFwcHkgTmV3IFllYXIhIg0KCUxvb3AgVW50aWwgRmxhZ1Rlc3QoMSkgb3IgYSQmbHQ7Jmd0OyIiDQoNCgl4PVJlbWFpbigxKScgc3RvcCB0aGUgdGltZXIgYW5kIGdldCB0aGUgcmVtYWluaW5nIHRpbWUNCg0KCUlmIEZsYWdUZXN0KDEpIFRoZW4gJyB0aGUgdGltZXIgZXhwaXJlZD8NCgkJUHJpbnQgIlRvbyBsYXRlISINCg0KCUVsc2UgJyBvdGhlcndpc2Ugc29tZW9uZSBwcmVzc2VkIGEga2V5DQoJCVByaW50ICJ0aGF0IHdhcyBjbG9zZS4gVGhlcmUgd2FzIG9ubHkgIjt4OyIgc2Vjb25kcyBsZWZ0ISINCg0KCUVuZElmDQoNCglESQ0KCUZvciBuPTEgVG8gMyYjNTg7IHg9UmVtYWluKG4pJiM1ODsgTmV4dA0KCUVJDQoJDQoJRW5kDQoNCg0KDQoNCicgVGhlIHN1YnMNCglTVUIgQ29yZVRNUiAnIG5lZWRzIHRvIHJ1biBvbiBhIHRpY2tlciBhdCB3aGF0ZXZlciBpbnRlcnZhbCBpcyByZXF1aXJlZCAtIHRoaXMgaXMgYWxzbyB0aGUgbXVsdGlwbGUgb2YgdGltZXIgY291bnRzDQoJCUlmIEZsYWdUZXN0KDEwKSBUaGVuIEV4aXQgU3ViDQoJCUxvY2FsIEludGVnZXIgbixmLHYNCgkJRm9yIG49MCBUbyA5DQoJCQlmPVRNUmluaShuKSBBbmQgJmFtcDtoQzAwMDAwMDAwMDAwMDAwMCAnIGV4dHJhY3QgdGhlIHRvcCAyIGJpdHMNCgkJCVNlbGVjdCBDYXNlIGYNCgkJCQlDYXNlIDAsJmFtcDtoQzAwMDAwMDAwMDAwMDAwMCAnZGlzYWJsZWQgb3IgaW52YWxpZA0KCQkJCQlGbGFnUmVzKG4pDQoJCQkJQ2FzZSAmYW1wO2g0MDAwMDAwMDAwMDAwMDAwJyBBRlRFUg0KCQkJCQlJZiBUTVJjdHIobikmZ3Q7MCB0aGVuDQoJCQkJCQlUTVJjdHIobik9VE1SY3RyKG4pLTENCgkJCQkJCUlmIFRNUmN0cihuKT0wIFRoZW4gRmxhZ1NldChuKSAnIGluZGljYXRlIHRoZSB0aW1lciBoYXMgZXhwaXJlZA0KCQkJCQlFbmRJZg0KCQkJCUNhc2UgJmFtcDtoODAwMDAwMDAwMDAwMDAwMCcgRVZFUlkNCgkJCQkJSWYgVE1SY3RyKG4pJmd0OzAgdGhlbg0KCQkJCQkJVE1SY3RyKG4pPVRNUmN0cihuKS0xDQoJCQkJCQlJZiBUTVJjdHIobik9MCBUaGVuDQoJCQkJCQkJRmxhZ1NldChuKSAnIGluZGljYXRlIHRoZSB0aW1lciBoYXMgZXhwaXJlZA0KCQkJCQkJCVRNUmN0cihuKT1UTVJpbmkobikgQW5kICZhbXA7aDNGRkZGRkZGRkZGRkZGRkYgJyByZXNldCB0aGUgdGltZXINCgkJCQkJCUVuZElmDQoJCQkJCUVuZElmDQoJCQlFbmQgU2VsZWN0DQoNCgkJTmV4dA0KCUVORCBTVUINCg0KDQoJU3ViIEFmdGVyKEludGVydmFsIEFzIEludGVnZXIsVG1yIEFzIEludGVnZXIpJyBzdGFydHMgYSBvbmUtc2hvdCB0aW1lcg0KCQlUTVJpbmkoVG1yKT1JbnRlcnZhbCBPUiAmYW1wO2g0MDAwMDAwMDAwMDAwMDAwJiM1ODtUTVJjdHIoVG1yKT1JbnRlcnZhbCBBbmQgJmFtcDtoM0ZGRkZGRkZGRkZGRkZGRiYjNTg7RmxhZ1JlcyhUbXIpDQoJRW5kIFN1Yg0KDQoJU3ViIEV2ZXJ5KEludGVydmFsIEFzIEludGVnZXIsVG1yIEFzIEludGVnZXIpJyBzdGFydHMgYSByZXBldGl0aXZlIHRpbWVyDQoJCVRNUmluaShUbXIpPUludGVydmFsIE9SICZhbXA7aDgwMDAwMDAwMDAwMDAwMDAmIzU4O1RNUmN0cihUbXIpPUludGVydmFsIEFuZCAmYW1wO2gzRkZGRkZGRkZGRkZGRkZGJiM1ODtGbGFnUmVzKFRtcikNCglFbmQgU3ViDQoNCglTdWIgQXQoZHQkLFRtciBBcyBJbnRlZ2VyKScgdHJpZ2dlciBhdCBhIHNwZWNpZmljIGRhdGUvdGltZSAtIGFzc3VtZXMgdGhlIGNvcmUgdGltZXIgaXMgcnVubmluZyBpbiBzZWNvbmRzDQoJCSdkdCQgbXVzdCBiZSBhIGRhdGV0aW1lIGZvcm1hdHRlZCBhcyAgZGQvbW0veXl5eSBoaCYjNTg7bW0mIzU4O3NzDQoJCUxvY2FsIEludGVnZXIgeA0KCQl4PVVuaXhUaW1lKE5vdygpKS1Vbml4VGltZShkdCQpDQoJCUlmIHgmbHQ7MiB0aGVuDQoJCQlGbGFnU2V0IFRtcicgaWYgaGUgZGlmZmVyZW5jZSBpcyBsZXNzIHRoYW4gMiBzZWNvbmRzLCB0cmlnZ2VyIHRoZSBhbGFybSBpbW1lZGlhdGVseQ0KCQlFbHNlDQoJCQlBZnRlciB4LFRtcicgb3RoZXJ3aXNlIHNldCBhIG9uZS1zaG90IGZvciB0aGUgZGlmZmVyZW5jZQ0KCQlFbmRJZg0KCUVuZCBTdWINCg0KCUZ1bmN0aW9uIFJlbWFpbihUbXIgQXMgSW50ZWdlcikgQXMgSW50ZWdlcicgc3RvcHMgYSB0aW1lciBhbmQgcmV0dXJucyB0aGUgcmVtYWluaW5nIHdob2xlIGNvdW50cyBpbiB0aGUgY291bnRlcg0KCQlUTVJpbmkoVG1yKT1UTVJpbmkoVG1yKSBBbmQgJmFtcDtoM0ZGRkZGRkZGRkZGRkZGRg0KCQlSZW1haW49VE1SY3RyKFRtcikNCglFbmQgRnVuY3Rpb24NCg0KCVN1YiBESQ0KCQlGbGFnU2V0IDEwDQoJRW5kIFN1Yg0KDQoJU3ViIEVJDQoJCUZsYWdSZXMgMTANCglFbmQgU3ViDQo8L3ByZT48YnIgLz5BbGwgPGEgY2xhc3M9ImV4dGVybmFsbGluayIgaHJlZj0iaHR0cDovL3d3dy5jcGN3aWtpLmV1L2luZGV4LnBocC9Mb2NvbW90aXZlX0JBU0lDI0FGVEVSXy5FMi44MC5COXRpbWVfZGVsYXkuRTIuODAuQkEuNUIuMkMuRTIuODAuQjl0aW1lcl9udW1iZXIuRTIuODAuQkEuNURfR09TVUJfLkUyLjgwLkI5bGluZV9udW1iZXIuRTIuODAuQkEiIHRpdGxlPSJ0aGUgZnVuY3Rpb25zIiB0YXJnZXQ9Il9ibGFuayI+dGhlIGZ1bmN0aW9uczwvYT4gYXJlIGluc3BpcmVkIGJ5IHNvbWUgaW5ub3ZhdGl2ZSAoZm9yIHRoZSB0aW1lKSBuYW1lc2FrZXMgaW4gTG9jb21vdGl2ZSBiYXNpYyBhcyB1c2VkIG9uIHRoZSBBbXN0cmFkIENQQyBvZiB0aGUgMTk4MHMuIDxiciAvPjxiciAvPmRkMYiW4MHAJ9P3GFKMKXkZLWV30k0=" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="2068001F" />
	<input type="hidden" name="__EVENTVALIDATION" id="__EVENTVALIDATION" value="/wEWEQKDoa/EDgK4z/TSAwK5z/TSAwK+z/TSAwK/z/TSAwK8z/TSAwK9z/TSAwKiz/TSAwK3j57gBwLH5ta/BQLG5ta/BQLB5ta/BQLA5ta/BQLD5ta/BQLC5ta/BQLd5ta/BQL9yYWiCYSbSsmGo7hjdkxKA42PuJ/VylNZ" />
</div>
		<script type="text/javascript">
<!--
__BaseName = "ctl00_CphMaster_";
__ConfirmMessage = "Are you sure you want to proceed?";
// -->
</script>
		<script type="text/javascript">
		<!--
			function __GetServerElementById(id) {
				return document.getElementById(__BaseName + id);
			}
			function __RequestConfirm() {
				return confirm(__ConfirmMessage);
			}
		// -->
		</script>
    
        <div id="HeaderDiv">
            <div style="float: right;">Welcome <a href="MMBasic.Language.html" class="systemlink" title="Select your language">Guest</a>, you are in: <select class="namespacedropdown" onchange="javascript:var sel = this.value; document.location = (sel != '' ? (sel + '.') : '') + 'Default.aspx';"><option value="">&lt;root&gt;</option><option value="Circuit Ideas">Circuit Ideas</option><option value="Colour MaxiMite 2 (CMM2)">Colour MaxiMite 2 (CMM2)</option><option value="GCB">GCB</option><option value="MicroMite ArmMite and MMX Hardware">MicroMite ArmMite and MMX Hardware</option><option selected="selected" value="MMBasic">MMBasic</option><option value="PIC ASM">PIC ASM</option><option value="Platform Agnostic">Platform Agnostic</option></select> &bull; <a href="MMBasic.Login9f7a.html?Redirect=http%3a%2f%2ffruitoftheshed.com%2fHistory.aspx%3fNS%3dMMBasic%26Page%3dMMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores%26Revision%3d2" class="systemlink" title="Login">Login</a></div><h1>Fruit Of The Shed</h1>
        </div>
                   
        <div id="ContainerDiv">
                 
            <div id="SidebarDiv">
                <div id="SidebarHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="SidebarContentDiv">
                    <div style="float: right;"> </div><h3 class="separator">Navigation (MMBasic)<a class="headeranchor" id="Navigation_NAMESPACE_0" href="#Navigation_NAMESPACE_0" title="Link to this Section">&#0182;</a></h3><ul><li><b><a class="pagelink" href="MMBasic.MainPage.html" title="_MMBasic Code Library">Main Page</a></b></li><li><a class="pagelink" href="MainPage.html" title="Home Page">Main Page (root)</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.EggDrop-part-of-the-original-MMBasic-libraryc674.html" title="Random Page">Random Page</a></li><li><a class="systemlink" href="MMBasic.AllPages.html" title="All Pages">All Pages</a><br /> </li><li><a class="systemlink" href="Logina75d.html" title="Create a new Page">Create a new Page</a><br /></li></ul><br /><ul><li><a class="systemlink" href="Logine894.html" title="Administration">Administration</a></li><li><a class="systemlink" href="MMBasic.Upload.html" title="File Management">File Management</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="My Account">My Account</a><br /></li></ul><br /><ul><li><a class="systemlink" href="MMBasic.Register.html" title="Create Account">Create Account</a><br /></li></ul><br /><small><b>Search the wiki</b></small><br /><br /><script type="text/javascript"><!--
function _DoSearch_SBf63524b4df3e46d58daced6fab3b588b() { document.location = 'MMBasic.Search.aspx?AllNamespaces=1&FilesAndAttachments=1&Query=' + encodeURI(document.getElementById('SBf63524b4df3e46d58daced6fab3b588b').value); }
// -->
</script><input class="txtsearchbox" type="text" id="SBf63524b4df3e46d58daced6fab3b588b" onkeydown="javascript:var keycode; if(window.event) keycode = event.keyCode; else keycode = event.which; if(keycode == 10 || keycode == 13) { _DoSearch_SBf63524b4df3e46d58daced6fab3b588b(); return false; }" /> <big><a href="#" onclick="javascript:_DoSearch_SBf63524b4df3e46d58daced6fab3b588b(); return false;">&raquo;</a></big><br /><br /><br />
                </div>
                <div id="SidebarFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>
            <div id="MainDiv">
                <div id="MainHeaderDiv">
                    <!-- Used for layout purposes only -->
                </div>
                <div id="PageInternalHeaderDiv"></div>
                

    <h1 class="pagetitlesystem">Page History: AFTER, EVERY, AT, REMAIN Flexible State Machine Timers using Semaphores.</h1>
    <p>Compare Page Revisions</p> 
    <select name="ctl00$CphMaster$lstRev1" id="ctl00_CphMaster_lstRev1">
	<option value="6">6</option>
	<option value="5">5</option>
	<option value="4">4</option>
	<option value="3">3</option>
	<option value="2">2</option>
	<option value="1">1</option>
	<option value="0">0</option>

</select>
    <select name="ctl00$CphMaster$lstRev2" id="ctl00_CphMaster_lstRev2">
	<option value="Current">Current</option>
	<option value="6">6</option>
	<option value="5">5</option>
	<option value="4">4</option>
	<option value="3">3</option>
	<option value="2">2</option>
	<option value="1">1</option>
	<option value="0">0</option>

</select>
    <input type="submit" name="ctl00$CphMaster$btnCompare" value="Compare" id="ctl00_CphMaster_btnCompare" />
    <br /><br />
    
    <table class="box" cellpadding="0" cellspacing="0"><tr><td><p style="text-align: center;"><b><a href="MMBasic.Historye201.html?Page=MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores&amp;Revision=00001">&laquo; Older Revision</a> - <a href="MMBasic.History0eb7.html?Page=MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores">Back to Page History</a> - <a href="MMBasic.Historyb007.html?Page=MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores&amp;Revision=00003">Newer Revision &raquo;</a></b></p></td></tr></table><br /><h3 class="separator">Page Revision: 2019/04/08 13:34</h3><br />A <a class="externallink" href="https://en.wikipedia.org/wiki/Finite-state_machine" title="State Machine" target="_blank">State Machine</a> is a mathematical concept whereby a system is driven by stimuli and its state alters by reacting to them. The condition of the stimuli indicates the state of the system at any point in time. <br /><br />In computing, state machine methodology is employed to get away from having a traditionally tightly interlocked system in favour of one that is only active when a stimulus is received; Changing its "state" depending on those stimuli. Stimuli could be I/O pins, a specific string or more often, flags. Such systems tend to be loose-coupled to its tasks and thus easier to program for multiple actions, each being self contained in sub-programs and triggered by its stimulus.<br /><br />This is a major step towards event-driven programming. Event-driven processing can provide an almost multi-tasking appearance in micro-controllers as sections of code execute asynchronously to others, signaling and interlocking with other sub-programs by setting or clearing flags - a process called "semaphore". Although it is a fairly-ish modern approach (really started to take off around the mid 90s) to writing good programs, the process of semaphore by tweaking flags goes back to the earliest CPUs, when an action would be taken as a result of one process signaling a specific state which resulted in another process doing something about it. All CPUs support semaphores, if only with a zero flag or carry flag in the status register. This was was a good way to signal from a one section of code to another that a decision needed to be made.<br /><br />Usually, the main section of the program goes round in a loop as before but instead of taking actions as part of or in-line with the main thread, it checks the state of flags or I/O and launches other processes to deal with it as appropriate e.g. when a given flag becomes set (or whatever you want). In modern computer languages, the "main loop" would be a dormant state and the event handler would wake your program when the state of the stimuli changed (you don't have to give the CPU something to do while it is waiting for a state change). This makes all of the resources (while the CPU isn't busy) available to the system for other tasks. With micro-controllers you don't often have an Operating System to handle the CPU when it is idle - you control the CPU at a very low level.<br /><br />State-machine code also makes for easily readable and modifiable programs as each action becomes a true sub-program and you don't have to worry about disrupting other sections of code so long as any sub program handles its input values and provides the expected output values. Flags can be set by any section of code, triggering activity from anywhere in your code. <br /><br />Enough introduction/generalization, down to the meat of this article... A key requirement of a state machine is sections of code being executed to a schedule or after a period of time. The following uses an array of flags and counters to keep track of (in this case but easily tweak-able) 10 timers,  with option for them to be single-shot or repeating. The timers can be stopped or temporarily disabled. The below Subs/Functions are inspired by the Locomotive Basic commands of the same names and make executing sections of code asynchronously a breeze. MMBasic provides four timers but they expect a sub program to be called each time and they have to be handled (i.e. if they are one-shot) by the called sub. The following code uses a single MMBasic timer but then expands this to practically unlimited timers and really easy to set one running. The main loop simply checks for the relevant flag and takes action (calls a Sub, changes the state of an output pin etc...) if it is set.<br /><br /><b>Pros:</b><br /><ul><li>Easy to configure a one-shot timer.</li><li>Easy to re-use timers for different sections of code.</li><li>Retrieve the remaining time on cancelling a timer.</li><li>No need to worry about handling SETTICK - No dedicated Sub to handle an event - just do it inline when it is convenient.</li><li>Gives much greater scope for the number of timers.</li><li>Multiple ticks of the same counter give only a single event - No event "storms" for slow-running code.</li><li>Manageable program interruption - It is totally down to the program flow - nothing kicking off "behind your back".</li><li>No implicit priority to timers, it is down to how the flags get checked.<br /></li></ul><br /><b>Cons:</b><br /><ul><li>Timer resolution is not as good as SETTICK on slow systems - very small delays are likely to be inaccurate, e.g. waiting one second when the service period is 1000mS.<br /></li></ul><br />The following provides a core timer handler and three Subs to set repetitive or one-shot timers and a method to stop a timer (and return the remaining count before it was stopped).<br /><br /><b>Dependencies:</b><br /><ul><li><a class="pagelink" href="MMBasic.Bit-Manipulation-Functions.html" title="Bit Manipulation Functions">Bit Manipulation Functions</a>  Bits 0 - 9 in the Flags field correspond to timers 0-9... tweak as necessary. Bit 10 is the global timer disable bit (=1). In the disabled state, timers are not decremented and any time spent disabled will be effectively added to running timers. E.g. if a timer is due to expire after 10 seconds but spends five seconds disabled, the total delay will be 15 seconds. DI/EI should be used to stop the timers when some critical process is taking place to prevent state changes.</li><li>Three global variables are required, two integer arrays and a simple integer to hold the flags.</li><li><a class="pagelink" href="MMBasic.UnixTime-or-Epoch-Time.html" title="UnixTime or Epoch Time">UnixTime</a> required if you intend to use the At functionality<br /></li></ul><br /><b>Variable Descriptions:</b><br />TMRctr() maintains the count for a given timer<br />TMRini()holds the timer type and its initialization value.<br /><code>    - bits 0-61 store the initial value value<br />    - bits 63&62 store the format of the counter:<br />        0=disabled<br />        1=(actually 0x4000000000000000) indicates a one shot "AFTER x" type counter<br />        2=(actually 0x8000000000000000) indicates a repetitive "EVERY x" type counter<br /></code><br />As written below, it provides 10 timers which should be loads for just about any use, but this can be tweaked as you see fit.<br /><br />The CoreTMR needs to be set running with the SETTICK command - timer counter values are a multiple of the interval used here. Try not to be too aggressive with small/fast intervals but the larger the interval the greater the loss of resolution. Find something that works for you but remember to adjust your timer values accordingly e.g. if you want ticks 10 times a second, the setitick must be set to 100 - and the values used in AFTER & EVERY would need to reflect the increase in resolution -in the above example 1 second becomes 10 counts etc.<br /><br /><b>Example:</b><br /><pre>
Preamble&#58;
	Option Base 0

	Dim Integer TMRctr(9),TMRini(9)

	Flags=0
	
	SETTICK 1000,CoreTMR,4' service timers every second





Main&#58;
' example usage for the main loop
' gives the user 10 seconds to hit a key (using timer 1)
	Print "Quick Press a key!"
	
	After 10,1 ' 10 seconds using timer 1
	Every 1 ,2 ' count 1 second intervals using timer 2
	Every 2 ,3 ' count 2 second intervals using timer 3
	At "01/01/2020 00&#58;00&#58;00",4 'trigger flag 4 at this specific date &amp; time

	Do
		a$=Inkey$
		If FlagTest(2) Then FlagRes 2&#58;Print "x"' output an x while we wait
		If FlagTest(3) Then FlagRes 3&#58;Print "y"' output a y  while we wait
		If FlagTest(4) Then FlagRes 4&#58;Print "Happy New Year!"
	Loop Until FlagTest(1) or a$&lt;&gt;""

	x=Remain(1)' stop the timer and get the remaining time

	If FlagTest(1) Then ' the timer expired?
		Print "Too late!"

	Else ' otherwise someone pressed a key
		Print "that was close. There was only ";x;" seconds left!"

	EndIf

	DI
	For n=1 To 3&#58; x=Remain(n)&#58; Next
	EI
	
	End




' The subs
	SUB CoreTMR ' needs to run on a ticker at whatever interval is required - this is also the multiple of timer counts
		If FlagTest(10) Then Exit Sub
		Local Integer n,f,v
		For n=0 To 9
			f=TMRini(n) And &amp;hC000000000000000 ' extract the top 2 bits
			Select Case f
				Case 0,&amp;hC000000000000000 'disabled or invalid
					FlagRes(n)
				Case &amp;h4000000000000000' AFTER
					If TMRctr(n)&gt;0 then
						TMRctr(n)=TMRctr(n)-1
						If TMRctr(n)=0 Then FlagSet(n) ' indicate the timer has expired
					EndIf
				Case &amp;h8000000000000000' EVERY
					If TMRctr(n)&gt;0 then
						TMRctr(n)=TMRctr(n)-1
						If TMRctr(n)=0 Then
							FlagSet(n) ' indicate the timer has expired
							TMRctr(n)=TMRini(n) And &amp;h3FFFFFFFFFFFFFFF ' reset the timer
						EndIf
					EndIf
			End Select

		Next
	END SUB


	Sub After(Interval As Integer,Tmr As Integer)' starts a one-shot timer
		TMRini(Tmr)=Interval OR &amp;h4000000000000000&#58;TMRctr(Tmr)=Interval And &amp;h3FFFFFFFFFFFFFFF&#58;FlagRes(Tmr)
	End Sub

	Sub Every(Interval As Integer,Tmr As Integer)' starts a repetitive timer
		TMRini(Tmr)=Interval OR &amp;h8000000000000000&#58;TMRctr(Tmr)=Interval And &amp;h3FFFFFFFFFFFFFFF&#58;FlagRes(Tmr)
	End Sub

	Sub At(dt$,Tmr As Integer)' trigger at a specific date/time - assumes the core timer is running in seconds
		'dt$ must be a datetime formatted as  dd/mm/yyyy hh&#58;mm&#58;ss
		Local Integer x
		x=UnixTime(Now())-UnixTime(dt$)
		If x&lt;2 then
			FlagSet Tmr' if he difference is less than 2 seconds, trigger the alarm immediately
		Else
			After x,Tmr' otherwise set a one-shot for the difference
		EndIf
	End Sub

	Function Remain(Tmr As Integer) As Integer' stops a timer and returns the remaining whole counts in the counter
		TMRini(Tmr)=TMRini(Tmr) And &amp;h3FFFFFFFFFFFFFFF
		Remain=TMRctr(Tmr)
	End Function

	Sub DI
		FlagSet 10
	End Sub

	Sub EI
		FlagRes 10
	End Sub
</pre><br />All <a class="externallink" href="http://www.cpcwiki.eu/index.php/Locomotive_BASIC#AFTER_.E2.80.B9time_delay.E2.80.BA.5B.2C.E2.80.B9timer_number.E2.80.BA.5D_GOSUB_.E2.80.B9line_number.E2.80.BA" title="the functions" target="_blank">the functions</a> are inspired by some innovative (for the time) namesakes in Locomotive basic as used on the Amstrad CPC of the 1980s. <br /><br />
    
    


                <div id="PageInternalFooterDiv"></div>
                <div id="MainFooterDiv">
                    <!-- Used for layout purposes only -->
                </div>
            </div>

        </div>
            
        <div id="FooterDiv">
             
        </div>

    </form>  
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.History.aspx?Page=MMBasic.AFTER-EVERY-REMAIN-Flexible-State-Machine-Timers-using-Semaphores&Revision=2 by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:36:37 GMT -->
</html>
