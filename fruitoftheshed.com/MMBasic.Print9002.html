

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" >

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.GPS-simulator-part-of-the-original-MMBasic-library by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:16:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><title>
	GPS simulator - Fruit Of The Shed
</title><link rel="stylesheet" type="text/css" href="Themes/Print.css" /></head>
<body>
    <form name="frmPrint" method="post" action="http://fruitoftheshed.com/Print.aspx?NS=MMBasic&amp;Page=MMBasic.GPS-simulator-part-of-the-original-MMBasic-library" id="frmPrint">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTIwMDg4Njc4MjcPZBYCAgEPZBYCAgEPFgIeBFRleHQFlSs8aDEgY2xhc3M9InBhZ2V0aXRsZSI+R1BTIHNpbXVsYXRvcjwvaDE+PHNtYWxsPk1vZGlmaWVkIG9uIDIwMTYvMTIvMjMgMjM6MjkgYnkgQWRtaW5pc3RyYXRvciAmbWRhc2g7IENhdGVnb3JpemVkIGFzOiBEYXRlcywgVGltZSBhbmQgQ2xvY2tzLCBFbmNvZGUgYW5kIERlY29kZSwgR1BTLCBNYXRocywgU3RyaW5ncywgX0xJQiBPcmlnaW5hbCBNTUJhc2ljPC9zbWFsbD48YnIgLz48YnIgLz48aDIgY2xhc3M9InNlcGFyYXRvciI+VGhpcyBtb2R1bGUgaXMgcGFydCBvZiB0aGUgb3JpZ2luYWwgTU1CYXNpYyBsaWJyYXJ5LiBJdCBpcyByZXByb2R1Y2VkIGhlcmUgd2l0aCBraW5kIHBlcm1pc3Npb24gb2YgSHVnaCBCdWNrbGUgYW5kIEdlb2ZmIEdyYWhhbS4gQmUgYXdhcmUgaXQgbWF5IHJlZmVyZW5jZSBmdW5jdGlvbmFsaXR5IHdoaWNoIGhhcyBjaGFuZ2VkIG9yIGlzIGRlcHJlY2F0ZWQgaW4gdGhlIGxhdGVzdCB2ZXJzaW9ucyBvZiBNTUJhc2ljLjxhIGNsYXNzPSJoZWFkZXJhbmNob3IiIGlkPSJUaGlzX21vZHVsZV9pc19wYXJ0X29mX3RoZV9vcmlnaW5hbF9NTUJhc2ljX2xpYnJhcnlfSXRfaXNfcmVwcm9kdWNlZF9oZXJlX3dpdGhfa2luZF9wZXJtaXNzaW9uX29mX0h1Z2hfQnVja2xlX2FuZF9HZW9mZl9HcmFoYW1fQmVfYXdhcmVfaXRfbWF5X3JlZmVyZW5jZV9mdW5jdGlvbmFsaXR5X3doaWNoX2hhc19jaGFuZ2VkX29yX2lzX2RlcHJlY2F0ZWRfaW5fdGhlX2xhdGVzdF92ZXJzaW9uc19vZl9NTUJhc2ljXzAiIGhyZWY9IiNUaGlzX21vZHVsZV9pc19wYXJ0X29mX3RoZV9vcmlnaW5hbF9NTUJhc2ljX2xpYnJhcnlfSXRfaXNfcmVwcm9kdWNlZF9oZXJlX3dpdGhfa2luZF9wZXJtaXNzaW9uX29mX0h1Z2hfQnVja2xlX2FuZF9HZW9mZl9HcmFoYW1fQmVfYXdhcmVfaXRfbWF5X3JlZmVyZW5jZV9mdW5jdGlvbmFsaXR5X3doaWNoX2hhc19jaGFuZ2VkX29yX2lzX2RlcHJlY2F0ZWRfaW5fdGhlX2xhdGVzdF92ZXJzaW9uc19vZl9NTUJhc2ljXzAiIHRpdGxlPSJMaW5rIHRvIHRoaXMgU2VjdGlvbiI+JiMwMTgyOzwvYT48L2gyPjxiPk5vdGU8L2I+OiBBbnkgcmVxdWlyZWQgZmlsZShzKSBhcmUgYXZhaWxhYmxlIGluIHRoZSBhdHRhY2htZW50cyB0YWIgKHRvcCByaWdodCkuPGJyIC8+PGJyIC8+VGhpcyBpcyBuaWNlIC0geW91IG5lZWQgdG8gdGVzdCB0aGUgR1BTIGlucHV0IHRvIHlvdXIgcHJvamVjdCBidXQgdGhlIEdQUyBtb2R1bGUgbm90IGFycml2ZWQgeWV0IChvciBzdXNwZWN0KT8gVGhpcyB3aWxsIGRyaXZlIGl0IGZvciB5b3UuPGJyIC8+PGJyIC8+PGJyIC8+PGI+R1BTLVNJTS5CQVM8L2I+PGJyIC8+PHByZT4NCicgR1BTIFNpbXVsYXRvciAoR2VvZmYgR3JhaGFtLCBTZXB0IDIwMTMpDQoNCicgQ29uZmlndXJhdGlvbiBzZXR0aW5ncw0KQ29tUG9ydCQgPSAiQ09NMSYjNTg7NDgwMCINClNlY29uZHNUb0dldExvY2sgPSAxMA0KU3BlZWRJbktub3RzID0gNQ0KDQpDbHMNClByaW50DQpQcmludCAiR1BTIFNpbXVsYXRvciAoR2VvZmYgR3JhaGFtLCBTZXB0IDIwMTMpIg0KUHJpbnQgIlNpbXVsYXRlcyBhbiBFTS00MDggR1BTIG1vZHVsZSBtYWRlIGJ5IEdsb2JhbFNhdCBUZWNobm9sb2d5LiINClByaW50DQpQcmludCAiT3V0cHV0IGlzIGF0ICIgTWlkJChDb21Qb3J0JCw2KSAiIGJhdWQgb24gSS9PIHBpbiAxNiAoQ09NMSYjNTg7IFR4IHBpbikiDQpQcmludCAiVGhlIG91dHB1dCB3aWxsIHNpbXVsYXRlIHRoZSBzdGFydHVwIHdpdGgiIFNlY29uZHNUb0dldExvY2sgIiBzZWNvbmRzIHRvIGdldCBhIg0KUHJpbnQgImxvY2suICBJdCB3aWxsIHRoZW4gc2ltdWxhdGUgdHJhdmVsbGluZyBlYXN0IGF0IiBTcGVlZEluS25vdHMgIiBrbm90cy4iDQpMb29wQmFjayYjNTg7DQpJZiBsb24gJmx0OyZndDsgMCBUaGVuIENsb3NlICYjMzU7MQ0KUHJpbnQNClByaW50ICJQcmVzcyBhbnkga2V5IHRvIHN0YXJ0IGZvbGxvd2VkIGJ5IGFueSBrZXkgdG8gc3RvcC4iDQoNCicgd2FpdCBmb3IgdGhlIGtleSBwcmVzcw0KRG8gJiM1ODsgTG9vcCBXaGlsZSBJbmtleSQgPSAiIg0KDQonIGluaXRpYWxpc2UNCnQkID0gVGltZSQNCnNlYyA9IDANCmxhdCA9IDMxMjguMTIzNA0KbG9uID0gMTE2MDAuMTIzNA0KDQpPcGVuIENvbVBvcnQkIEFzICYjMzU7MQ0KDQonIG91dHB1dCB0aGUgc3RhcnR1cCBtZXNzYWdlcyB0eXBpY2FsbHkgcHJvZHVjZWQgYnkgdGhlIEVNLTQwOA0KUHJpbnRUb0dQUyAiJFBTUkZUWFQsVmVyc2lvbiYjNTg7R1NXMy4yLjRfMy4xLjAwLjEyLVNESzAwM1AxLjAwYSINClByaW50VG9HUFMgIiRQU1JGVFhULFZlcnNpb24yJiM1ODtGLUdQUy0wMy0wNzAxMzAxIg0KUHJpbnRUb0dQUyAiJFBTUkZUWFQsV0FBUyBFbmFibGUiDQpQcmludFRvR1BTICIkUFNSRlRYVCxUT1cmIzU4OyAgMCINClByaW50VG9HUFMgIiRQU1JGVFhULFdLJiM1ODsgICAxMzk5Ig0KUHJpbnRUb0dQUyAiJFBTUkZUWFQsUE9TJiM1ODsgIDYzNzgxMzcgMCAwIg0KUHJpbnRUb0dQUyAiJFBTUkZUWFQsQ0xLJiM1ODsgIDk2MjUwIg0KUHJpbnRUb0dQUyAiJFBTUkZUWFQsQ0hOTCYjNTg7IDEyIg0KUHJpbnRUb0dQUyAiJFBTUkZUWFQsQmF1ZCByYXRlJiM1ODsgIiArIE1pZCQoQ29tUG9ydCQsNikNCg0KJyBub3cgcHJldGVuZCB0aGF0IHdlIGFyZSBzZWFyY2hpbmcgdG8gZ2V0IGEgZml4IG9uIHRoZSBzYXRlbGxpdGVzDQpEbw0KICBEbyAmIzU4OyBMb29wIFdoaWxlIHQkID0gVGltZSQNCiAgdCQgPSBUaW1lJA0KICBzZWMgPSBzZWMgKyAxDQogIElmIElua2V5JCAmbHQ7Jmd0OyAiIiBUaGVuIEdvVG8gTG9vcEJhY2sNCiAgU2VuZEdHQSAiViINCiAgU2VuZEdTQSAiViINCiAgU2VuZFJNQyAiViINCiAgSWYgc2VjIE1vZCA1ID0gMCBUaGVuIFNlbmRHU1YgIlYiDQogIElmIElua2V5JCAmbHQ7Jmd0OyAiIiBUaGVuIEdvVG8gTG9vcEJhY2sNCkxvb3AgV2hpbGUgc2VjICZsdDsgMjANCg0KJyBub3cgcHJldGVuZCB0aGF0IHdlIGhhdmUgYSBmaXggYW5kIGFyZSBtb3ZpbmcgZWFzdA0KRG8NCiAgRG8gJiM1ODsgTG9vcCBXaGlsZSB0JCA9IFRpbWUkDQogIHQkID0gVGltZSQNCiAgc2VjID0gc2VjICsgMQ0KICBJZiBJbmtleSQgJmx0OyZndDsgIiIgVGhlbiBHb1RvIExvb3BCYWNrDQogIFNlbmRHR0EgIkEiLCBsYXQsIGxvbg0KICBTZW5kR1NBICJBIg0KICBTZW5kUk1DICJBIiwgbGF0LCBsb24NCiAgSWYgc2VjIE1vZCA1ID0gMCBUaGVuIFNlbmRHU1YgIkEiDQogIGxvbiA9IGxvbiArIFNwZWVkSW5Lbm90cy8zNjAwCQknIHRoaXMgc2ltdWxhdGVzIG1vdmVtZW50IGVhc3QNCiAgSWYgSW5rZXkkICZsdDsmZ3Q7ICIiIFRoZW4gR29UbyBMb29wQmFjaw0KTG9vcA0KDQoNCicgb3V0cHV0IHRoZSBOTUVBIFJNQyBtZXNzYWdlDQpTdWIgU2VuZFJNQyBzdGF0dXMkLCBsYXQsIGxvbg0KICBMb2NhbCBtc2ckLCB0aW0kLCBkYXQkDQogIHRpbSQgPSBUaW1lJA0KICB0aW0kID0gTGVmdCQodGltJCwgMikgKyBNaWQkKHRpbSQsIDQsIDIpICsgUmlnaHQkKHRpbSQsIDIpICsgIi4wMDAiDQogIGRhdCQgPSBEYXRlJA0KICBkYXQkID0gTGVmdCQoZGF0JCwgMikgKyBNaWQkKGRhdCQsIDQsIDIpICsgUmlnaHQkKGRhdCQsIDIpDQogIG1zZyQgPSAiR1BSTUMsIiArIHRpbSQgKyAiLCIgKyBzdGF0dXMkICsgIiwiICsgRm9ybWF0JChsYXQsICIlMDkuNGYiKSArICIsUywiDQogIG1zZyQgPSBtc2ckICsgRm9ybWF0JChsb24sICIlMDEwLjRmIikNCiAgSWYgc3RhdHVzJCA9ICJWIiBUaGVuDQogICAgbXNnJCA9IG1zZyQgKyAiLEUsMC4wMCw5MCwiICsgZGF0JCArICIsLCINCiAgRWxzZQ0KICAgIG1zZyQgPSBtc2ckICsgIixFLCIgKyBGb3JtYXQkKFNwZWVkSW5Lbm90cywgIiUwNC4yZiIpICsgIiw5MCwiICsgZGF0JCArICIsLCINCiAgRW5kSWYNCiAgU2VuZFRvR1BTIG1zZyQNCkVuZCBTdWINCg0KJyBvdXRwdXQgdGhlIEdTViBtZXNzYWdlDQpTdWIgU2VuZEdTViBzdGF0dXMkDQogIElmIHN0YXR1cyQgPSAiViIgVGhlbg0KICAgIFNlbmRUb0dQUyAiR1BHU1YsMywxLDEyLDIwLDAwLDAwMCw0MywxMCwwMCwwMDAsLDMxLDAwLDAwMCwsMjcsMDAsMDAwLCINCiAgICBTZW5kVG9HUFMgIkdQR1NWLDMsMiwxMiwxOSwwMCwwMDAsLDA3LDAwLDAwMCwsMDQsMDAsMDAwLCwyNCwwMCwwMDAsIg0KICAgIFNlbmRUb0dQUyAiR1BHU1YsMywzLDEyLDE2LDAwLDAwMCwsMjgsMDAsMDAwLCwyNiwwMCwwMDAsLDI5LDAwLDAwMCwiDQogIEVsc2UNCiAgICBTZW5kVG9HUFMgIkdQR1NWLDMsMSwxMiwxMSw3NSwzMjQsMzYsMDEsNTksMTQ2LDI3LDMyLDU4LDE2MSwzNCwyMCw1NiwyMDksMzAiDQogICAgU2VuZFRvR1BTICJHUEdTViwzLDIsMTIsMjMsNTIsMzAxLDQwLDI1LDQyLDEwMSwsMTMsMjMsMzExLDIzLDE3LDE5LDIzNywyMyINCiAgICBTZW5kVG9HUFMgIkdQR1NWLDMsMywxMiwzMSwxMiwxMzYsLDE5LDA4LDM1OCwxMywxNCwwNiwxMzYsLDI3LDA1LDM1MCwiDQogIEVuZElmDQpFbmQgU3ViDQoNCicgb3V0cHV0IHRoZSBHR0EgbWVzc2FnZQ0KU3ViIFNlbmRHR0Egc3RhdHVzJCwgbGF0LCBsb24NCiAgTG9jYWwgbXNnJCwgdGltJA0KICB0aW0kID0gVGltZSQNCiAgdGltJCA9IExlZnQkKHRpbSQsIDIpICsgTWlkJCh0aW0kLCA0LCAyKSArIFJpZ2h0JCh0aW0kLCAyKSArICIuMDAwIg0KICBtc2ckID0gIkdQR0dBLCIgKyB0aW0kDQogIElmIHN0YXR1cyQgPSAiViIgVGhlbg0KICAgICAgIG1zZyQgPSBtc2ckICsgIiwsLCwsMCwwMCwsLE0sMC4wLE0sLDAwMDAiDQogIEVsc2UNCiAgICBtc2ckID0gbXNnJCArICIsIiArIEZvcm1hdCQobGF0LCAiJTA5LjRmIikgKyAiLFMsIiArIEZvcm1hdCQobG9uLCAiJTAxMC40ZiIpDQogICAgbXNnJCA9IG1zZyQgKyAiLEUsMSwwNSwzLjQsMjUuMCxNLC0yOS4zLE0sLDAwMDAiDQogIEVuZElmDQogIFNlbmRUb0dQUyBtc2ckDQpFbmQgU3ViDQoNCicgb3V0cHV0IHRoZSBHU0EgbWVzc2FnZQ0KU3ViIFNlbmRHU0Egc3RhdHVzJA0KICBJZiBzdGF0dXMkID0gIlYiIFRoZW4NCiAgICBTZW5kVG9HUFMgIkdQR1NBLEEsMSwsLCwsLCwsLCwsLCwsLCINCiAgRWxzZQ0KICAgIFNlbmRUb0dQUyAiR1BHU0EsQSwzLDIzLDIwLDEzLDExLDMyLCwsLCwsLCw0LjcsMy40LDMuNCINCiAgRW5kSWYNCkVuZCBTdWINCg0KJyB0YWtlIGEgbWVzc2FnZSBhbmQgYWRkIHRoZSBjaGVja3N1bSBhbmQgb3V0cHV0DQpTdWIgU2VuZFRvR1BTIG1zZyQNCiAgTG9jYWwgY3MsIG0kLCBpDQogIEZvciBpID0gMSBUbyBMZW4obXNnJCkNCiAgICBjcyA9IChjcyBYb3IgQXNjKE1pZCQobXNnJCwgaSwgMSkpKSBBbmQgJmFtcDtoRkYNCiAgTmV4dCBpDQogIG0kID0gSGV4JChjcykNCiAgSWYgTGVuKG0kKSA9IDEgVGhlbiBtJCA9ICIwIiArIG0kDQogIFByaW50VG9HUFMgIiQiICsgbXNnJCArICImIzQyOyIgKyBtJA0KRW5kIFN1Yg0KDQonIHByaW50IHRoZSBtZXNzYWdlIHRvIHRoZSBDT00gcG9ydCBhbmQgdGhlIHNjcmVlbg0KU3ViIFByaW50VG9HUFMgbXNnJA0KICBQcmludCAmIzM1OzEsIG1zZyQNCiAgUHJpbnQgbXNnJA0KRW5kIFN1Yg0KDQoNCjwvcHJlPmRkLEzeifFTaEf+aOY6qSGcQ76Kd7Q=" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="03CF0AB7" />
</div>
        <h1 class="pagetitle">GPS simulator</h1><small>Modified on 2016/12/23 23:29 by Administrator &mdash; Categorized as: Dates, Time and Clocks, Encode and Decode, GPS, Maths, Strings, _LIB Original MMBasic</small><br /><br /><h2 class="separator">This module is part of the original MMBasic library. It is reproduced here with kind permission of Hugh Buckle and Geoff Graham. Be aware it may reference functionality which has changed or is deprecated in the latest versions of MMBasic.<a class="headeranchor" id="This_module_is_part_of_the_original_MMBasic_library_It_is_reproduced_here_with_kind_permission_of_Hugh_Buckle_and_Geoff_Graham_Be_aware_it_may_reference_functionality_which_has_changed_or_is_deprecated_in_the_latest_versions_of_MMBasic_0" href="#This_module_is_part_of_the_original_MMBasic_library_It_is_reproduced_here_with_kind_permission_of_Hugh_Buckle_and_Geoff_Graham_Be_aware_it_may_reference_functionality_which_has_changed_or_is_deprecated_in_the_latest_versions_of_MMBasic_0" title="Link to this Section">&#0182;</a></h2><b>Note</b>: Any required file(s) are available in the attachments tab (top right).<br /><br />This is nice - you need to test the GPS input to your project but the GPS module not arrived yet (or suspect)? This will drive it for you.<br /><br /><br /><b>GPS-SIM.BAS</b><br /><pre>
' GPS Simulator (Geoff Graham, Sept 2013)

' Configuration settings
ComPort$ = "COM1&#58;4800"
SecondsToGetLock = 10
SpeedInKnots = 5

Cls
Print
Print "GPS Simulator (Geoff Graham, Sept 2013)"
Print "Simulates an EM-408 GPS module made by GlobalSat Technology."
Print
Print "Output is at " Mid$(ComPort$,6) " baud on I/O pin 16 (COM1&#58; Tx pin)"
Print "The output will simulate the startup with" SecondsToGetLock " seconds to get a"
Print "lock.  It will then simulate travelling east at" SpeedInKnots " knots."
LoopBack&#58;
If lon &lt;&gt; 0 Then Close &#35;1
Print
Print "Press any key to start followed by any key to stop."

' wait for the key press
Do &#58; Loop While Inkey$ = ""

' initialise
t$ = Time$
sec = 0
lat = 3128.1234
lon = 11600.1234

Open ComPort$ As &#35;1

' output the startup messages typically produced by the EM-408
PrintToGPS "$PSRFTXT,Version&#58;GSW3.2.4_3.1.00.12-SDK003P1.00a"
PrintToGPS "$PSRFTXT,Version2&#58;F-GPS-03-0701301"
PrintToGPS "$PSRFTXT,WAAS Enable"
PrintToGPS "$PSRFTXT,TOW&#58;  0"
PrintToGPS "$PSRFTXT,WK&#58;   1399"
PrintToGPS "$PSRFTXT,POS&#58;  6378137 0 0"
PrintToGPS "$PSRFTXT,CLK&#58;  96250"
PrintToGPS "$PSRFTXT,CHNL&#58; 12"
PrintToGPS "$PSRFTXT,Baud rate&#58; " + Mid$(ComPort$,6)

' now pretend that we are searching to get a fix on the satellites
Do
  Do &#58; Loop While t$ = Time$
  t$ = Time$
  sec = sec + 1
  If Inkey$ &lt;&gt; "" Then GoTo LoopBack
  SendGGA "V"
  SendGSA "V"
  SendRMC "V"
  If sec Mod 5 = 0 Then SendGSV "V"
  If Inkey$ &lt;&gt; "" Then GoTo LoopBack
Loop While sec &lt; 20

' now pretend that we have a fix and are moving east
Do
  Do &#58; Loop While t$ = Time$
  t$ = Time$
  sec = sec + 1
  If Inkey$ &lt;&gt; "" Then GoTo LoopBack
  SendGGA "A", lat, lon
  SendGSA "A"
  SendRMC "A", lat, lon
  If sec Mod 5 = 0 Then SendGSV "A"
  lon = lon + SpeedInKnots/3600		' this simulates movement east
  If Inkey$ &lt;&gt; "" Then GoTo LoopBack
Loop


' output the NMEA RMC message
Sub SendRMC status$, lat, lon
  Local msg$, tim$, dat$
  tim$ = Time$
  tim$ = Left$(tim$, 2) + Mid$(tim$, 4, 2) + Right$(tim$, 2) + ".000"
  dat$ = Date$
  dat$ = Left$(dat$, 2) + Mid$(dat$, 4, 2) + Right$(dat$, 2)
  msg$ = "GPRMC," + tim$ + "," + status$ + "," + Format$(lat, "%09.4f") + ",S,"
  msg$ = msg$ + Format$(lon, "%010.4f")
  If status$ = "V" Then
    msg$ = msg$ + ",E,0.00,90," + dat$ + ",,"
  Else
    msg$ = msg$ + ",E," + Format$(SpeedInKnots, "%04.2f") + ",90," + dat$ + ",,"
  EndIf
  SendToGPS msg$
End Sub

' output the GSV message
Sub SendGSV status$
  If status$ = "V" Then
    SendToGPS "GPGSV,3,1,12,20,00,000,43,10,00,000,,31,00,000,,27,00,000,"
    SendToGPS "GPGSV,3,2,12,19,00,000,,07,00,000,,04,00,000,,24,00,000,"
    SendToGPS "GPGSV,3,3,12,16,00,000,,28,00,000,,26,00,000,,29,00,000,"
  Else
    SendToGPS "GPGSV,3,1,12,11,75,324,36,01,59,146,27,32,58,161,34,20,56,209,30"
    SendToGPS "GPGSV,3,2,12,23,52,301,40,25,42,101,,13,23,311,23,17,19,237,23"
    SendToGPS "GPGSV,3,3,12,31,12,136,,19,08,358,13,14,06,136,,27,05,350,"
  EndIf
End Sub

' output the GGA message
Sub SendGGA status$, lat, lon
  Local msg$, tim$
  tim$ = Time$
  tim$ = Left$(tim$, 2) + Mid$(tim$, 4, 2) + Right$(tim$, 2) + ".000"
  msg$ = "GPGGA," + tim$
  If status$ = "V" Then
       msg$ = msg$ + ",,,,,0,00,,,M,0.0,M,,0000"
  Else
    msg$ = msg$ + "," + Format$(lat, "%09.4f") + ",S," + Format$(lon, "%010.4f")
    msg$ = msg$ + ",E,1,05,3.4,25.0,M,-29.3,M,,0000"
  EndIf
  SendToGPS msg$
End Sub

' output the GSA message
Sub SendGSA status$
  If status$ = "V" Then
    SendToGPS "GPGSA,A,1,,,,,,,,,,,,,,,"
  Else
    SendToGPS "GPGSA,A,3,23,20,13,11,32,,,,,,,,4.7,3.4,3.4"
  EndIf
End Sub

' take a message and add the checksum and output
Sub SendToGPS msg$
  Local cs, m$, i
  For i = 1 To Len(msg$)
    cs = (cs Xor Asc(Mid$(msg$, i, 1))) And &amp;hFF
  Next i
  m$ = Hex$(cs)
  If Len(m$) = 1 Then m$ = "0" + m$
  PrintToGPS "$" + msg$ + "&#42;" + m$
End Sub

' print the message to the COM port and the screen
Sub PrintToGPS msg$
  Print &#35;1, msg$
  Print msg$
End Sub


</pre>
    </form>
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.GPS-simulator-part-of-the-original-MMBasic-library by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:16:42 GMT -->
</html>
