

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" >

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Sign-Extend-an-Integer by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:23:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><title>
	Sign Extend an Integer - Fruit Of The Shed
</title><link rel="stylesheet" type="text/css" href="Themes/Print.css" /></head>
<body>
    <form name="frmPrint" method="post" action="http://fruitoftheshed.com/Print.aspx?NS=MMBasic&amp;Page=MMBasic.Sign-Extend-an-Integer" id="frmPrint">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTIwMDg4Njc4MjcPZBYCAgEPZBYCAgEPFgIeBFRleHQFgxo8aDEgY2xhc3M9InBhZ2V0aXRsZSI+U2lnbiBFeHRlbmQgYW4gSW50ZWdlcjwvaDE+PHNtYWxsPk1vZGlmaWVkIG9uIDIwMTgvMDIvMDEgMTI6NTkgYnkgQ2FwdGFpbkJvaW5nICZtZGFzaDsgQ2F0ZWdvcml6ZWQgYXM6IENvbnRyb2wsIEVsZWN0cm9uaWNzLCBFbmNvZGUgYW5kIERlY29kZSwgSGFyZHdhcmUsIGkyYywgTWF0aHM8L3NtYWxsPjxiciAvPjxiciAvPk9mdGVuIHRpbWVzIGEgdmFsdWUgc3RvcmVkIHNvbWV3aGVyZSBtYXkgbm90IGJlIHRoZSBzYW1lIHdpZHRoIGFzIGFuIE1NQmFzaWMgSW50ZWdlciB2YXJpYWJsZSwgYmVpbmcgY29tbW9ubHkgOCwgOSBvciAxNiBiaXRzIHdpZGUuIEZvciBleGFtcGxlLCB0aGUgdGVtcGVyYXR1cmUgcmVnaXN0ZXIgKCZIMTEpIG9mIHRoZSBwb3B1bGFyIERTMzIzMSBSVEMgY2hpcCBpcyBhIHR3bydzLWNvbXBsaW1lbnQgYnl0ZS4gUmVhZGluZyAodGhlb3JldGljYWxseSkgKzEyNyB0byAtMTI4Qy48YnIgLz48YnIgLz5JZiB0aGlzIG51bWJlciBpcyBwbGFjZWQgZGlyZWN0bHkgaW4gYW4gaW50ZWdlciB2YXJpYWJsZSB3aXRob3V0IHNpZ24gZXh0ZW5kaW5nIGJpdCA3IHRocm91Z2ggdG8gdGhlIGVuZCBvZiB0aGUgaW50ZWdlciAoYml0IDYzKSB0aGUgdGVtcGVyYXR1cmUgd2lsbCBiZSBpbmNvcnJlY3QgaWYgbmVnYXRpdmUgLSBpdCB3aWxsIHJlYWQgb3ZlciAxMjhDLiBJdCBpcyBuZWNlc3NhcnkgdG8gZXh0ZW5kIGJpdCA3IG9mIHRoZSByZWdpc3RlciB0aHJvdWdoIHRoZSByZW1haW5pbmcgNTYgYml0cyB0byBvYnRhaW4gYSB0cnVlIDY0LWJpdCBpbnRlZ2VyIHZhbHVlIG9mIHRoZSByZWFkaW5nIHRoYXQgd2lsbCBwbGF5IG5pY2VseSB3aXRoIGludGVnZXIgbWF0aHMuLi4gT2YgY291cnNlIHRoaXMgaXNuJ3QgbmVjZXNzYXJ5IGlmIHlvdSBhcmUgbm90IGV4cGVjdGluZyBzdWItemVybyB0ZW1wZXJhdHVyZXMgYW5kIGFyZSBPSyB3aXRoIHRha2luZyB0aGUgY2hhbmNlLjxiciAvPjxiciAvPlRoZSBmb2xsb3dpbmcgZnVuY3Rpb24gd2lsbCByZXR1cm4gYSB2YWx1ZSBzaWduLWV4dGVuZGVkIGZyb20gYW55IGdpdmVuIGJpdC4gVGhlcmUgaXMgbm8gZXJyb3IgY2hlY2tpbmcgLSBpZiB5b3UgZmVlZCBpdCBydWJiaXNoIG9yIHRyeSB0byBjcmFzaCBpdCB5b3UnbGwgcHJvYmFibHkgc3VjY2VlZC48YnIgLz48YnIgLz48Yj5TeW50YXg6PC9iPjxiciAvPj1TZ25YKEJpdCxWYWx1ZSk8YnIgLz48YnIgLz48Yj5FeGFtcGxlczo8L2I+IChiZXR0ZXIgdW5kZXJzdG9vZCBsb29raW5nIGF0IHRoZSBiaW5hcnkpPGJyIC8+PGNvZGU+UHJpbnQgQmluJChTZ25YKDcsJmg3ZiksNjQpPC9jb2RlPjxiciAvPjxwcmU+PGJyIC8+MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMTExMTExMTxiciAvPiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXiAgICAgICAgYml0IDc8YnIgLz48L3ByZT48YnIgLz48Y29kZT5QcmludCBCaW4kKFNnblgoNywmaDhmKSw2NCk8L2NvZGU+PGJyIC8+PHByZT48YnIgLz4xMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTEwMDAxMTExPGJyIC8+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBeICAgICAgICBiaXQgNzxiciAvPjwvcHJlPjxiciAvPkNvbnNpZGVyIHRoZSBmb2xsb3dpbmc6PGJyIC8+PGNvZGU+PGJyIC8+UlRDIEdldFJlZyAxNyx4PGJyIC8+PC9jb2RlPjxiciAvPkhlcmUgeCBjb250YWlucyB0aGUgOC1iaXQsIHR3bydzIGNvbXBsaW1lbnQgdmFsdWUgZm9yIHRoZSB0ZW1wZXJhdHVyZSBidXQgYXMgdGhlIHJlbWFpbmluZyAodG9wKSA1NiBiaXRzIG9mIHggYXJlIHplcm8sIHRoZSB2YWx1ZSB3aWxsIGFsd2F5cyBiZSB0cmVhdGVkIGFzIHBvc2l0aXZlIGJ5IE1NQmFzaWMuIEltYWdpbmUgdGhlIHZhbHVlIHJlYWQgd2FzIDI1NCAoJmhGRSksIHdoaWNoIGlzIC0yIGRlZ3JlZXMgKGJpdCA3IGlzIHNldCkuIFdoZW4gYXNzaWduZWQgdG8gdGhlIHZhcmlhYmxlIHgsIGl0IHdpbGwgYmUgdHJlYXRlZCBhcyB0aGUgYWJzb2x1dGUgdmFsdWUgb2YgdGhlIHJlZ2lzdGVyIC0gcG9zaXRpdmUgMjU0IChiaXQgNjMgaXMgMCA9IHBvc2l0aXZlLCBhbmQgYWxsIHRoZSBiaXRzIGluIGJldHdlZW4pLiA8YnIgLz48YnIgLz48Y29kZT5QcmludCBCaW4kKHgsNjQpPGJyIC8+MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAxMTExMTExMDwvY29kZT48YnIgLz48YnIgLz5UbyBjb3JyZWN0IHRoaXMsIHRoZSBzaWduIG9mIHRoZSByZWdpc3RlciB2YWx1ZSAoYml0IDcpIG5lZWRzIHRvIGJlIGV4dGVuZGVkIHRocm91Z2ggKGNvcGllZC10bykgdGhlIHJlbWFpbmluZyA1NiBiaXRzIHVwIHRvIGJpdCA2MyB3aGljaCB0aGVuIG1ha2VzIHRoZSBpbnRlZ2VyIHZhcmlhYmxlIHggaG9sZCB0aGUgZXF1aXZhbGVudCA2NCBiaXQgdmVyc2lvbiBvZiB0aGUgdmFsdWU6PGJyIC8+PGNvZGU+PGJyIC8+eD1TZ25YKDcseCk8YnIgLz48YnIgLz5QcmludCBCaW4kKHgsNjQpPGJyIC8+MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMDxiciAvPjxiciAvPlByaW50IHg8YnIgLz4tMjwvY29kZT48YnIgLz48YnIgLz48YnIgLz5BcyBhbm90aGVyIGV4YW1wbGUsIGlmIGEgdmFsdWUgcmVhZCBpcyA5IGJpdHMgKG1heWJlIGZyb20gc2VyaWFsIGNvbW1zKSB3aGljaCBpcyB0byBiZSBpbnRlcnByZXRlZCBhcyB0d28ncyBjb21wbGltZW50IDggYml0cyBmb3IgdGhlIHZhbHVlIHBsdXMgc2lnbiBiaXQsIHNpbXBseSBleHRlbmQgYml0IDksIG9yIGZvciBhIHRyYWRpdGlvbmFsIDE2IGJpdCBzaWduZWQgaW50ZWdlciwgZXh0ZW5kIGJpdCAxNS4gVGhlIGZ1bmN0aW9uIHdpbGwgdGFrZSBhbnkgYml0IGFzIHRoZSBzaWduIGFuZCByZXR1cm4gYSBjb3JyZWN0bHkgZm9ybWF0dGVkIDggYnl0ZSBNTWJhc2ljIGludGVnZXIuPGJyIC8+PGJyIC8+PGI+Q29kZTo8L2I+PGJyIC8+PHByZT4NCglGdW5jdGlvbiBTZ25YKGIgQXMgSW50ZWdlcix2IEFzIEludGVnZXIpIEFzIEludGVnZXInIHNpZ24gZXh0ZW5kIGJpdCBiIG9mIHZhbHVlIHYNCgkJSWYgdiBBbmQgMl5iIFRoZW4gJ2V4dGVuZCAxDQoJCQlTZ25YPXYgT3IgKC0xICZsdDsmbHQ7IChiKzEpKQ0KCQlFbHNlICdleHRlbmQgMA0KCQkJU2duWD0gdiBBbmQgKCgyXihiKzEpKS0xKQ0KCQlFbmRJZg0KCUVuZCBGdW5jdGlvbg0KPC9wcmU+PGJyIC8+ZGS/Fy6W5g7OfCNzxJXCzlKw6ljoUg==" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="03CF0AB7" />
</div>
        <h1 class="pagetitle">Sign Extend an Integer</h1><small>Modified on 2018/02/01 12:59 by CaptainBoing &mdash; Categorized as: Control, Electronics, Encode and Decode, Hardware, i2c, Maths</small><br /><br />Often times a value stored somewhere may not be the same width as an MMBasic Integer variable, being commonly 8, 9 or 16 bits wide. For example, the temperature register (&H11) of the popular DS3231 RTC chip is a two's-compliment byte. Reading (theoretically) +127 to -128C.<br /><br />If this number is placed directly in an integer variable without sign extending bit 7 through to the end of the integer (bit 63) the temperature will be incorrect if negative - it will read over 128C. It is necessary to extend bit 7 of the register through the remaining 56 bits to obtain a true 64-bit integer value of the reading that will play nicely with integer maths... Of course this isn't necessary if you are not expecting sub-zero temperatures and are OK with taking the chance.<br /><br />The following function will return a value sign-extended from any given bit. There is no error checking - if you feed it rubbish or try to crash it you'll probably succeed.<br /><br /><b>Syntax:</b><br />=SgnX(Bit,Value)<br /><br /><b>Examples:</b> (better understood looking at the binary)<br /><code>Print Bin$(SgnX(7,&h7f),64)</code><br /><pre><br />0000000000000000000000000000000000000000000000000000000001111111<br />                                                        ^        bit 7<br /></pre><br /><code>Print Bin$(SgnX(7,&h8f),64)</code><br /><pre><br />1111111111111111111111111111111111111111111111111111111110001111<br />                                                        ^        bit 7<br /></pre><br />Consider the following:<br /><code><br />RTC GetReg 17,x<br /></code><br />Here x contains the 8-bit, two's compliment value for the temperature but as the remaining (top) 56 bits of x are zero, the value will always be treated as positive by MMBasic. Imagine the value read was 254 (&hFE), which is -2 degrees (bit 7 is set). When assigned to the variable x, it will be treated as the absolute value of the register - positive 254 (bit 63 is 0 = positive, and all the bits in between). <br /><br /><code>Print Bin$(x,64)<br />0000000000000000000000000000000000000000000000000000000011111110</code><br /><br />To correct this, the sign of the register value (bit 7) needs to be extended through (copied-to) the remaining 56 bits up to bit 63 which then makes the integer variable x hold the equivalent 64 bit version of the value:<br /><code><br />x=SgnX(7,x)<br /><br />Print Bin$(x,64)<br />1111111111111111111111111111111111111111111111111111111111111110<br /><br />Print x<br />-2</code><br /><br /><br />As another example, if a value read is 9 bits (maybe from serial comms) which is to be interpreted as two's compliment 8 bits for the value plus sign bit, simply extend bit 9, or for a traditional 16 bit signed integer, extend bit 15. The function will take any bit as the sign and return a correctly formatted 8 byte MMbasic integer.<br /><br /><b>Code:</b><br /><pre>
	Function SgnX(b As Integer,v As Integer) As Integer' sign extend bit b of value v
		If v And 2^b Then 'extend 1
			SgnX=v Or (-1 &lt;&lt; (b+1))
		Else 'extend 0
			SgnX= v And ((2^(b+1))-1)
		EndIf
	End Function
</pre><br />
    </form>
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.Sign-Extend-an-Integer by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:23:42 GMT -->
</html>
