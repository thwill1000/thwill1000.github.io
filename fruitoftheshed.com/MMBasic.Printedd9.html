

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html dir="ltr" xmlns="http://www.w3.org/1999/xhtml" >

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.ESP8266-Module-with-HTTP-API by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:16:22 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head><title>
	ESP8266 WiFi Module with multi-session HTTP API (pure MMBasic) - Fruit Of The Shed
</title><link rel="stylesheet" type="text/css" href="Themes/Print.css" /></head>
<body>
    <form name="frmPrint" method="post" action="http://fruitoftheshed.com/Print.aspx?NS=MMBasic&amp;Page=MMBasic.ESP8266-Module-with-HTTP-API" id="frmPrint">
<div>
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwULLTIwMDg4Njc4MjcPZBYCAgEPZBYCAgEPFgIeBFRleHQFn2Q8aDEgY2xhc3M9InBhZ2V0aXRsZSI+RVNQODI2NiBXaUZpIE1vZHVsZSB3aXRoIG11bHRpLXNlc3Npb24gSFRUUCBBUEkgKHB1cmUgTU1CYXNpYyk8L2gxPjxzbWFsbD5Nb2RpZmllZCBvbiAyMDE2LzEyLzIzIDIzOjMxIGJ5IENhcHRhaW5Cb2luZyAmbWRhc2g7IENhdGVnb3JpemVkIGFzOiBOZXR3b3JrLCBXaWZpPC9zbWFsbD48YnIgLz48YnIgLz5UaGlzIGlzIGEgY29tcGxldGUgRVNQODI2NiBtb2R1bGUgdGhhdCB3aWxsIGNvbm5lY3QgdG8gdGhlIFdpRmkgb2YgeW91ciBjaG9pY2UgYW5kIHRoZW4gYWNjZXB0IGNvbm5lY3Rpb24gaW5ib3VuZC4gTm8gQ0Z1bmN0aW9ucyBvciBhbnl0aGluZywgcHVyZWx5IGhhbmRsaW5nIGEgc2VyaWFsIHBvcnQgYW5kIGNob3BwaW5nIHVwIHdoYXRldmVyIGNvbWVzIHRocm91Z2guIEl0IHdvcmtzIHJlYWxseSB3ZWxsIGFuZCBpcyBmYXN0LiBJdCBoYW5kbGVzIG11bHRpcGxlIGluYm91bmQgY29ubmVjdGlvbnMgLSB1cCB0byBmaXZlIGF0IGEgdGltZS4gSXQgbG9va3MgbGlrZSBhIGJpZyBkZWFsIGJ1dCBhIGxvdCBvZiBpdCBpcyBzaW1wbHkgZnVuY3Rpb25zIHRvIG1ha2Ugc3RyaW5nIGhhbmRsaW5nIGVhc2llciAoYXQgdGhlIGJvdHRvbSkuPGJyIC8+PGJyIC8+VGhpcyBtaWdodCBiZSBmb3IgYSBNaWNyb01pdGUgYmFzZWQgd2ViIHNlcnZlciBvciB0byBhbGxvdyB5b3UgdG8gc2V0IHRoZSBNaWNyb01pdGUgZG9pbmcgdGhpbmdzLiBIZXJlIEkgZG9uJ3Qgd3JpdGUgYmFjayBIVE1MIChBUEkgZG9lc24ndCByZXF1aXJlIGl0KSBidXQgeW91IGNvdWxkIGp1c3QgYXMgZWFzaWx5LCB5b3UgY291bGQgYXNrIGZvciBzdGF0dXMgb24gYml0cywgYW5hbG9ndWUgaW5wdXRzLiBZb3UgY291bGQgc2VuZCBJbnN0cnVjdGlvbnMgZm9yIHF1aXRlIGNvbXBsZXggYWN0aXZpdGllcywgeW91ciBpbWFnaW5hdGlvbiBpcyB0aGUgbGltaXQuPGJyIC8+PGJyIC8+VGhpcyBpcyBhbiBleHRyYWN0ICh3aXRoIGNoYW5nZXMpIGZyb20gbXkgU01TIEdhdGV3YXkuIEkgY29ubmVjdCBpbiB3aXRoIGEgd2ViIHBhZ2UgYW5kIGlzc3VlIGNvbW1hbmRzIHZpYSB0aGlzIGNvbGxlY3Rpb24gdG8gc2VuZCB0ZXh0IG1lc3NhZ2UgZnJvbSBteSB3ZWJzaXRlLiBUaGlzIGJpdCB3b3JrcyBwZXJmZWN0LCBhbGwgdGhlIHRpbWUuLi4gKHRoZSBNNTkwIEdTTSBtb2R1bGUgaXMgbW9yZSB0ZW1wZXJhbWVudGFsIGFuZCBJIGhhdmUgc29tZSB3b3JrIHRvIGRvIGJlZm9yZSBJIGNhbiBwdWJsaXNoIHRoYXQgYml0KS48YnIgLz48YnIgLz5UaGlzIGlzIGVub3VnaCB0byBnZXQgeW91IGdvaW5nLCB5b3UgaGF2ZSB0byBwaWNrIHRoZSBib25lcyBhcGFydCBvZiB0aGUgbWFpbiBsb29wIGFuZCB1bmRlcnN0YW5kIHdoYXQgaXMgaGFwcGVuaW5nIGJ1dCBpdCBpcyBtYWlubHkganVzdCBkZXRlY3RpbmcgdGhlIGluYm91bmQgY29ubmVjdGlvbiBhbmQgdGhlbiB1c2luZyBzdHJpbmcgc2xpY2luZyB0byBwaWNrIGFwYXJ0IHRoZSBIVFRQIHJlcXVlc3QgdG8gc2VlIHdoYXQgaXMgYmVpbmcgYXNrZWQgZm9yLjxiciAvPjxiciAvPkhlcmUncyBhIGxvYWQgb2YgbGlua3MgSSB1c2VkIHdoZW4gSSB3YXMgZ2V0dGluZyB0aGlzIHdvcmtpbmcuIFJlc2VhcmNoIGxvYWRzITxiciAvPjxiciAvPjxhIGNsYXNzPSJleHRlcm5hbGxpbmsiIGhyZWY9Imh0dHBzOi8vYWxzZWxlY3Ryby53b3JkcHJlc3MuY29tLzIwMTUvMDUvMTMvd2lmaS1tb2R1bGUtZXNwODI2Ni0yLXRjcC1jbGllbnQtc2VydmVyLW1vZGUvIiB0aXRsZT0iaHR0cHM6Ly9hbHNlbGVjdHJvLndvcmRwcmVzcy5jb20vMjAxNS8wNS8xMy93aWZpLW1vZHVsZS1lc3A4MjY2LTItdGNwLWNsaWVudC1zZXJ2ZXItbW9kZS8iIHRhcmdldD0iX2JsYW5rIj5odHRwczovL2Fsc2VsZWN0cm8ud29yZHByZXNzLmNvbS8yMDE1LzA1LzEzL3dpZmktbW9kdWxlLWVzcDgyNjYtMi10Y3AtY2xpZW50LXNlcnZlci1tb2RlLzwvYT48YnIgLz48YSBjbGFzcz0iZXh0ZXJuYWxsaW5rIiBocmVmPSJodHRwczovL3d3dy5zcGFya2Z1bi5jb20vcHJvZHVjdHMvMTM2NzgiIHRpdGxlPSJodHRwczovL3d3dy5zcGFya2Z1bi5jb20vcHJvZHVjdHMvMTM2NzgiIHRhcmdldD0iX2JsYW5rIj5odHRwczovL3d3dy5zcGFya2Z1bi5jb20vcHJvZHVjdHMvMTM2Nzg8L2E+PGJyIC8+PGEgY2xhc3M9ImV4dGVybmFsbGluayIgaHJlZj0iaHR0cDovL3d3dy5pbnN0cnVjdGFibGVzLmNvbS9pZC9Vc2luZy10aGUtRVNQODI2Ni1tb2R1bGUvIiB0aXRsZT0iaHR0cDovL3d3dy5pbnN0cnVjdGFibGVzLmNvbS9pZC9Vc2luZy10aGUtRVNQODI2Ni1tb2R1bGUvIiB0YXJnZXQ9Il9ibGFuayI+aHR0cDovL3d3dy5pbnN0cnVjdGFibGVzLmNvbS9pZC9Vc2luZy10aGUtRVNQODI2Ni1tb2R1bGUvPC9hPjxiciAvPjxhIGNsYXNzPSJleHRlcm5hbGxpbmsiIGhyZWY9Imh0dHA6Ly93d3cuaW5zdHJ1Y3RhYmxlcy5jb20vaWQvVXNpbmctdGhlLUVTUDgyNjYtbW9kdWxlL3N0ZXAzL0NvbmZpZ3VyaW5nLXRoZS04MjY2LU1vZHVsZS8iIHRpdGxlPSJodHRwOi8vd3d3Lmluc3RydWN0YWJsZXMuY29tL2lkL1VzaW5nLXRoZS1FU1A4MjY2LW1vZHVsZS9zdGVwMy9Db25maWd1cmluZy10aGUtODI2Ni1Nb2R1bGUvIiB0YXJnZXQ9Il9ibGFuayI+aHR0cDovL3d3dy5pbnN0cnVjdGFibGVzLmNvbS9pZC9Vc2luZy10aGUtRVNQODI2Ni1tb2R1bGUvc3RlcDMvQ29uZmlndXJpbmctdGhlLTgyNjYtTW9kdWxlLzwvYT48YnIgLz48YSBjbGFzcz0iZXh0ZXJuYWxsaW5rIiBocmVmPSJodHRwOi8vd3d3Lmluc3RydWN0YWJsZXMuY29tL2lkL0hvdy10by1CdWlsZC1hLUVTUDgyNjYtV2ViLVNlcnZlci9zdGVwNy9SZXN1bHRzLyIgdGl0bGU9Imh0dHA6Ly93d3cuaW5zdHJ1Y3RhYmxlcy5jb20vaWQvSG93LXRvLUJ1aWxkLWEtRVNQODI2Ni1XZWItU2VydmVyL3N0ZXA3L1Jlc3VsdHMvIiB0YXJnZXQ9Il9ibGFuayI+aHR0cDovL3d3dy5pbnN0cnVjdGFibGVzLmNvbS9pZC9Ib3ctdG8tQnVpbGQtYS1FU1A4MjY2LVdlYi1TZXJ2ZXIvc3RlcDcvUmVzdWx0cy88L2E+PGJyIC8+PGEgY2xhc3M9ImV4dGVybmFsbGluayIgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL2VzcDgyNjYvZXNwODI2Ni13aWtpL3dpa2kiIHRpdGxlPSJodHRwczovL2dpdGh1Yi5jb20vZXNwODI2Ni9lc3A4MjY2LXdpa2kvd2lraSIgdGFyZ2V0PSJfYmxhbmsiPmh0dHBzOi8vZ2l0aHViLmNvbS9lc3A4MjY2L2VzcDgyNjYtd2lraS93aWtpPC9hPjxiciAvPjxhIGNsYXNzPSJleHRlcm5hbGxpbmsiIGhyZWY9Imh0dHA6Ly93d3cuZXNwODI2Ni5jb20vIiB0aXRsZT0iaHR0cDovL3d3dy5lc3A4MjY2LmNvbS8iIHRhcmdldD0iX2JsYW5rIj5odHRwOi8vd3d3LmVzcDgyNjYuY29tLzwvYT48YnIgLz48YSBjbGFzcz0iZXh0ZXJuYWxsaW5rIiBocmVmPSJodHRwOi8vZG9taW5pY20uY29tL2VzcDgyNjYtc2VuZC1yZWNlaXZlLWRhdGEvIiB0aXRsZT0iaHR0cDovL2RvbWluaWNtLmNvbS9lc3A4MjY2LXNlbmQtcmVjZWl2ZS1kYXRhLyIgdGFyZ2V0PSJfYmxhbmsiPmh0dHA6Ly9kb21pbmljbS5jb20vZXNwODI2Ni1zZW5kLXJlY2VpdmUtZGF0YS88L2E+PGJyIC8+PGEgY2xhc3M9ImV4dGVybmFsbGluayIgaHJlZj0iaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1hcWp4LTg1X2h3ZyIgdGl0bGU9Imh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9YXFqeC04NV9od2ciIHRhcmdldD0iX2JsYW5rIj5odHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PWFxangtODVfaHdnPC9hPjxiciAvPjxhIGNsYXNzPSJleHRlcm5hbGxpbmsiIGhyZWY9Imh0dHBzOi8vY2RuLnNwYXJrZnVuLmNvbS9kYXRhc2hlZXRzL1dpcmVsZXNzL1dpRmkvQ29tbWFuZCUyMERvYy5wZGYiIHRpdGxlPSJodHRwczovL2Nkbi5zcGFya2Z1bi5jb20vZGF0YXNoZWV0cy9XaXJlbGVzcy9XaUZpL0NvbW1hbmQlMjBEb2MucGRmIiB0YXJnZXQ9Il9ibGFuayI+aHR0cHM6Ly9jZG4uc3BhcmtmdW4uY29tL2RhdGFzaGVldHMvV2lyZWxlc3MvV2lGaS9Db21tYW5kJTIwRG9jLnBkZjwvYT48YnIgLz48YSBjbGFzcz0iZXh0ZXJuYWxsaW5rIiBocmVmPSJodHRwOi8vNDFqLmNvbS9ibG9nLzIwMTUvMDEvZXNwODI2Ni1jbGllbnQtbW9kZS1jb25uZWN0LXJlbW90ZS1ob3N0LXNpbXBsZS1leGFtcGxlLyIgdGl0bGU9Imh0dHA6Ly80MWouY29tL2Jsb2cvMjAxNS8wMS9lc3A4MjY2LWNsaWVudC1tb2RlLWNvbm5lY3QtcmVtb3RlLWhvc3Qtc2ltcGxlLWV4YW1wbGUvIiB0YXJnZXQ9Il9ibGFuayI+aHR0cDovLzQxai5jb20vYmxvZy8yMDE1LzAxL2VzcDgyNjYtY2xpZW50LW1vZGUtY29ubmVjdC1yZW1vdGUtaG9zdC1zaW1wbGUtZXhhbXBsZS88L2E+PGJyIC8+PGJyIC8+PGJyIC8+RW5qb3k8YnIgLz48YnIgLz48YnIgLz48cHJlPg0KDQonDQonRVNQODI2NiBNb2R1bGUuIEFuZHJldyBIZW5kZXJzb24uIE9jdG9iZXIgMjAxNg0KJw0KDQonUHJlYW1ibGUNCglPUFRJT04gQkFTRSAwDQoNCglDT05TVCBMQU49Mg0KDQoNCidTL1cgSW5pdA0KCURJTSBTVFJJTkcgQSQsQiQsRCQNCglESU0gU1RSSU5HIExOQnVmJA0KCURJTSBTVFJJTkcgTEFOUnhMTiQsTEFOVHhMTiQsVENociQgTEVOR1RIIDENCglESU0gSU5URUdFUiBDLFosVE9GZyxDaGFuLENvbm4oNCksUGluZ1RNUixQaW5nQ3RyLFJMMVRNUiBMQU5mDQoJRElNIEZMT0FUIHgNCg0KCSdTdGFydGluZyBXTEFOIEludGVyZmFjZQ0KDQoJT3BlbiAiQ09NMiYjNTg7OTYwMCwxMDI0IiBBcyAmIzM1O0xBTg0KDQoJRVNQODI2NlJlc2V0DQoNCg0KTWFpbiYjNTg7DQoNCg0KDQogICAgICAgICcgZG9uJ3QgZG8gdGhpcyBldmVyeSB0aW1lIHRocm91Z2ggdGhlIGxvb3AsIHNldCBhIHRpbWVyIGZvciBubyBtb3JlIHRoYW4gNjBzZWNvbmQgaW50ZXJ2YWxzICYjMTIzOw0KICAgICAgICAnVGVzdCBJbnRlcm5ldCBjb25uZWN0aXZpdHkgLSB5b3UnbGwgaGF2ZSB0byBoYW5kbGUgd2hhdCB0byBkbyBpZiB0aGlzIGlzIGJyb2tlbiwgdGhlcmUncyBub3RoaW5nIGhlcmUgZm9yIGl0Lg0KCUEkPUVTUDgyNjZFeGVjJCgiQVQrUElORz0iK1BBLDQwMDAsMCkgICAnIFBBPVBpbmcgYWRkcmVzcy4gdHJ5IHRvIGJlIG5pY2UgaGVyZSBhbmQgc2V0IHRoaXMgdG8gYSBETlMgc2VydmVyIGZyb20geW91ciBJU1AgZS5nLiAxMDAsMjAwLDExMSwyMjIgb3Igd3d3LmJiYy5jby51ayBvciBzb21ldGhpbmcgdGhhdCB3b24ndCBtaW5kIHlvdSBwaW5naW5nIHRoZW0NCglJRiBBJD0iT0siIFRIRU4NCgkJJ2dvb2QNCgkJJy4uLg0KCUVMU0UNCgkJJ2ludGVybmV0IGRvd24NCiAgICAgICAgICAgICAgICAnLi4uDQoJRU5EIElGDQogICAgICAgICYjMTI1Ow0KDQoNCg0KDQoNCgknV2ViIEFQSSBwYXJzaW5nDQoNCglMQU5SeExOJD1HZXRJTyQoTEFOLDEpDQoJSUYgTEFOUnhMTiQ9IiIgT1IgTEFOUnhMTiQ9IlQvTyIgVEhFTiBHT1RPIE1haW4gJyBub3RoaW5nIHdhaXRpbmcgb24gdGhlIGlucHV0DQoNCglJRiBNSUQkKExBTlJ4TE4kLDIsOCk9IixDT05ORUNUIiBUSEVOICcgRVNQODI2NiBwcm92aWRlcyB0aGUgY29ubmVjdCBhcyBhbiBpbmRpY2F0aW9uIG9mIEhUVFAgaW5wdXQNCgkJQ2hhbj1WQUwoTEFOUnhMTiQpDQoJCUlGIENoYW4mZ3Q7PTAgQU5EIENoYW4mbHQ7PTQgVEhFTg0KCQkJQ29ubihDaGFuKT0xIA0KICAgICAgICAgICAgICAgICAgICAgICAgUFJJTlQgIkluYm91bmQgY29ubmVjdCBjaGFubmVsICIrU1RSJChDaGFuKQ0KCQkJJ0luYm91bmQgY29ubmVjdCBjaGFubmVsIG9uICBjaGFubmVsIDAgLSA1DQoJCQlHT1RPIElQRVhJVA0KCQlFTkQgSUYNCglFTkQgSUYNCg0KCUlGIE1JRCQoTEFOUnhMTiQsMiw3KT0iLENMT1NFRCIgVEhFTiAnIEVTUDgyNjYgcHJvdmlkZXMgdGhlIGNsb3NlZCBhcyBhbiBpbmRpY2F0aW9uIG9mIEhUVFAgY2hhbm5lbCBjbG9zaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIGVpdGhlciBjb3ogaXQgd2FzIGV4cGxpY2l0IG9yIGl0IHRpbWVkIG91dA0KCQlDaGFuPVZBTChMQU5SeExOJCkNCgkJSUYgQ2hhbiZndDs9MCBBTkQgQ2hhbiZsdDs9NCBUSEVODQoJCQlJRiBDb25uKENoYW4pPTAgVEhFTiBBJD0iIEFibm9ybWFsbHkgIiBFTFNFIEEkPSIiDQoJCQlQUklOVCAiQ2xvc2VkIGNoYW5uZWwgIitTVFIkKENoYW4pICsgQSQNCgkJCUNvbm4oQ2hhbik9MA0KCQkJR09UTyBJUEVYSVQNCgkJRU5EIElGDQoJRU5EIElGDQoNCglJRiBMRUZUJChMQU5SeExOJCw1KT0iK0lQRCwiIFRIRU4NCgkJQ2hhbj1WQUwoTUlEJChMQU5SeExOJCw2LDEpKQ0KCQlJRiBDaGFuJmd0OzQgVEhFTiBHT1RPIElQRGVyckVYSVQNCgkJSUYgQ29ubihDaGFuKSZsdDsmZ3Q7MSBUSEVOIEdPVE8gSVBEZXJyRVhJVCAnY2hhbm5lbCBub3Qgb3Blbg0KDQoJCXo9SU5TVFIoTEFOUnhMTiQsIiYjNTg7R0VUIC8mbHQ7bXkgcGFnZSwgZS5nLiBpbmRleC5odG0mZ3Q7IikgJyArSVBELDAsbm5uJiM1ODtHRVQgL2luZGV4Lmh0bSBIVFRQLzEuMQ0KDQoJCWRvJiM1ODthJD1HZXRJTyQoTEFOLDIpJiM1ODtsb29wIHVudGlsIGEkPSJDb25uZWN0aW9uJiM1ODsgS2VlcC1BbGl2ZSIgJyBlbXB0eSB0aGUgcmVzdCBvZiB0aGUgZW52ZWxvcGUsIHRoaXMgc3RyaW5nIGlzIHRoZSBsYXN0IHBhcnQgb2YgYW4gSFRUUCBjb25uZWN0aW9uIGhlYWRlcg0KDQoJCUlGIHo9Jmd0OzggQU5EIFombHQ7PTExIFRIRU4gJyBjaGVja2luZyBmb3IgdGhlIHBvc2l0aW9uIG9mIHRoZSBhcmd1bWVudHMgaW4gdGhlIHN0cmluZyAtIHlvdXIgbWlsZWFnZSB3aWxsIHZhcnkuLi4gc2ltcGxlIHNhbml0eSBjaGVjaw0KCQkJYiQ9TUlEJChMQU5SeExOJCx6KzEzKQ0KCQkJej1JTlNUUihiJCwiIEhUVFAvIikNCgkJCUlGIHombHQ7MjEgVEhFTiBHT1RPIElQRGVyckVYSVQgJy4uLiBhbmQgYWdhaW4NCgkJCWIkPUxFRlQkKGIkLHotMSkgJyByZW1vdmUgdGhlIEhUVFAgYml0DQoJCQliJD1SZXBsYWNlJChiJCwiKyIsIiAiKScgKyB0byBzcGFjZXMNCgkJCWFyZ3M9U3BsaXQoYiQsIj8iKSAnICBzcGxpdCB0aGUgcmVxdWVzdCBhcmd1bWVudHMgb3V0DQoJCQlJRiBhcmdzICZsdDszIFRIRU4gR09UTyBJUERlcnJFWElUICcgeW91ciBhcmd1bWVudHMgbWlnaHQgdmFyeSAtIEkgaGF2ZSB0d28sIHRoZSBoZWFkZXIgKyB0d28gYXJndW1lbnRzID0gMyBzdHJpbmdzIGZyb20gdGhlIHNwaWx0DQoJCQkNCgkJCUZPUiBuPTIgVE8gYXJncyAnYXJncz0xIGlzIGEgZHVtbXkNCgkJCQlTRUxFQ1QgQ0FTRSBMRUZUJCh1Y2FzZSQoU1AkKG4pKSw0KSAnIGNoZWNrIGZvciB0aGUgbmFtZSBvZiB0aGUgYXJndW1lbnQgaGVyZSBhbmQgYXNzaWduIHRoZSB2YWx1ZSB0byBhIHZhcmlhYmxlDQoJCQkJCUNBU0UgIlZBUjE9Ig0KCQkJCQkJdmFyMSQ9TFRyaW0kKFJUcmltJChNSUQkKHNwJChuKSw1KSkpDQoJCQkJCUNBU0UgIlZBUjI9Ig0KCQkJCQkJdmFyMiQ9TFRyaW0kKFJUcmltJChNSUQkKHNwJChuKSw1KSkpDQoJCQkJRU5EIFNFTEVDVA0KCQkJTkVYVA0KCQkJSUYgdmFyMSQ9IiIgT1IgdmFyMiQ9IiIgVEhFTiBHT1RPIElQRGVyckVYSVQgJyBkb24ndCBhbGxvdyBlbXB0eSB2YWx1ZXMgLSB5b3VyIG1pbGVhZ2UgbWF5IHZhcnkNCgkJCUVSQVNFIFNQJA0KCQkJTXNnJD1VUkxEZWNvZGUkKE1zZyQpDQoNCiAgICAgICAgICAgICAgICAnIG90aGVyIGFwaSBjYWxscyBnbyBoZXJlLCBJIG9ubHkgaGF2ZSBvbmUgaW4gdGhpcyBhcHBsaWNhdGlvbg0KDQoNCgkJRU5EIElGDQoNCgkJR09UTyBJUERlcnJFWElUICdkZWZhdWx0IGFjdGlvbiBJRiB3ZSBkb24ndCBmaW5kIGFuIEFQSSBjYWxsDQoNCglFTkQgSUYNCg0KDQoJR09UTyBJUEVYSVQNCklQRGVyckVYSVQmIzU4Ow0KCUIkPSJFUlJPUiYjNTg7IE1hbGZvcm1lZCByZXF1ZXN0ICYjMTIzOyIrTEFOUnhMTiQrIiYjMTI1OyINCklQT0tFWElUJiM1ODsNCg0KCVBSSU5UICYjMzU7TEFOLCJBVCtDSVBTRU5ERVg9IitTVFIkKENoYW4pKyIsMjU1IiAnIHNlbmQgb3VyIHJlc3BvbnNlIGJhY2sgdG8gdGhlIHJlcXVlc3Rvcg0KCVBBVVNFIDEwMA0KDQoJUFJJTlQmIzM1O0xBTixCJCsiXDAiDQoJUEFVU0UgMTAwDQoNCglQUklOVCYjMzU7TEFOLCJBVCtDSVBDTE9TRT0iK1NUUiQoQ2hhbikgJyB0aGVuIGNsb3NlIHRoZSBjaGFubmVsIG5pY2VseQ0KCUNvbm4oQ2hhbik9MA0KDQpJUEVYSVQmIzU4Ow0KDQoJR09UTyBNYWluDQoNCglFTkQNCg0KDQonJiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7IEVTUDgyNjYgV2lGaSBNb2RlbSBTVUJzeXMgJiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7LQ0KDQoJU1VCIEVTUDgyNjZSZXNldA0KCQlMT0NBTCBTVFJJTkcgQSQNCgkJTE9DQUwgSU5URUdFUiBODQoNCgkJUFVMU0UgTEFOUlNULDEwICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIHdoYXRldmVyIHBpbiB5b3UgaGF2ZSBjb25uZWN0ZWQgdG8gdGhlIHJlc2V0IG9mIHRoZSBFU1A4MjY2DQoJCVBBVVNFIDQwMA0KDQoJCUxBTkV4ZWMgIkFURTAiLDIsMA0KCQlMQU5FeGVjICJBVCtDV0FVVE9DT05OPTAiLDIsMCAgICAgICAgICAgICAgICAgICcgdHVybiBvZmYgYXV0b2Nvbm5lY3Qgd2hpbGUgd2UgaW5pdGlhbGlzZQ0KCQlMQU5FeGVjICJBVCtDV01PREU9MSIsMiwwDQoJCUxBTkV4ZWMgIkFUK0NXUUFQIiw0LDAgICAgICAgICAgICAgICAgICAgICAgICAgJyBkaXNjb25uZWN0IGFueSBleGlzdGluZyBXaUZpIGNvbm5lY3Rpb25zDQoJCUxBTkV4ZWMgIkFUK1JGVkREIiwyLDANCgkJTEFORXhlYyAiQVQrQ1dKQVA9IitBUCsiLCIrUFcsMTAsMSAgICAgICAgICAgICAnIEFQPSBuYW1lIG9mIHRoZSBuZXR3b3JrIHlvdSB3YW50IHRvIGpvaW4gZS5nLiB5b3VyIFdJRkkgU1NJRCAtIGFuZCBQVz0gaXQncyBwYXNzd29yZA0KCQlMQU5FeGVjICJBVCtDSVBTVEE9IitJUCsiLCIrR1crIiwiK01TLDIsMCAgICAgICcgdGhlIElQIGFuZCBHYXRld2F5IGFkZHJlc3MgZm9yIHN0YXRpYyBJUCBhZGRyZXNzZXMsIHJlbSB0aGlzIGxpbmUgZm9yIGEgc3RhdGljIElQDQoJCUxBTkV4ZWMgIkFUK0NJRlNSIiwyLDANCgkJTEFORXhlYyAiQVQrQ1dBVVRPQ09OTj0xIiwyLDAgICAgICAgICAgICAgICAgICAnIHR1cm4gYXV0b2Nvbm5lY3QgYmFjayBvbiBzbyBpZiB0aGUgV2lGaSBkcm9wcywgdGhlIEVTUDgyNjYgd2lsbCBzZWxmIG5lZ290aWF0ZSB0byBnZXQgaXQgYmFjaw0KCQlMQU5FeGVjICJBVCtDSVBNVVg9MSIsMiwwDQoJCUxBTkV4ZWMgIkFUK0NJUFNFUlZFUj0xLDE5MDkwIiwyLDAgICAgICAgICAgICAgJyB0dXJuIG9uIHRoZSBzZXJ2ZXIgd2l0aCB0aGUgcG9ydCB5b3Ugd2FudCB5b3VyIEFQSSB0byBsaXN0ZW4gb24sIG5vcm1hbGx5IEhUVFAgaXMgODAgb3Igc29tZXRpbWVzIDgwODAsIGhlcmUgSSBsaXN0ZW4gb24gMTkwOTAuLi4geW91IGNhbiB1c2UgYW55dGhpbmcgZnJvbSAxIC0gNjU1MzYgYnV0IGFzIGEgZ3VpZGVsaW5lOyBhdm9pZCBhbnl0aGluZyBiZWxvdyAxMDAwIGlmIHlvdSBhcmUgbm90IHVzaW5nIDgwDQoNCgkJTEFOVHhMTiQ9IiImIzU4O0xBTlJ4TE4kPSIiICAgICAgICAgICAgICAgICAgICAgICAgJyBidWZmZXJzIGZvciByZWNlaXZlIGFuZCB0cmFuc21pdA0KDQoJCUZPUiBOPTAgVE8gNCYjNTg7Q29ubihOKT0wJiM1ODtORVhUICAgICAgICAgICAgICAgICAgICAnIGNsZWFyIHRoZSBjaGFubmVsIGNvbm5lY3Rpb24gZmxhZ3MNCg0KCUVORCBTVUINCg0KDQoNCg0KCVNVQiBMQU5FeGVjKENNJCxULFN1cHByZXNzKSAndGVtcCAtIHdpbGwgZ28gd2hlbiB3ZSBoYXZlIGJldHRlciBoYW5kbGluZyBvZiB0aGUgc3RhcnR1cA0KCQlMT0NBTCBTVFJJTkcgQSQNCgkJQSQ9RVNQODI2NkV4ZWMkKENNJCxULFN1cHByZXNzKQ0KCQlJRiBTdXBwcmVzcyZsdDsyIFRIRU4gQ0xvZyBBJCwwDQoJRU5EIFNVQg0KDQoJRlVOQ1RJT04gRVNQODI2NkV4ZWMkKENvbSQsVGltZU91dCxPYmYpDQoJCUxPQ0FMIFNUUklORyBBJCBMRU5HVEggMSxMTiQNCgkJTE9DQUwgSU5URUdFUiBDDQoNCgkJUFJJTlQgJiMzNTtMQU4sQ29tJA0KDQoJCURPDQoJCQlMTiQ9R2V0SU8kKExBTixUaW1lT3V0KQ0KCQkJSUYgTE4kPSJUL08iIFRIRU4gRVNQODI2NkV4ZWMkPSJUL08iJiM1ODtFWElUIERPDQoJCQlJRiBMTiQmbHQ7Jmd0OyIiIFRIRU4NCgkJCQlJRiBPYmYmbHQ7MiBUSEVOIENMb2cgIiYjOTE7IitMTiQrIiYjOTM7IiwwDQoJCQkJSUYgTE4kPSJPSyIgT1IgTE4kPSImZ3Q7IiBPUiBMTiQ9IlNFTkQgT0siIFRIRU4gRVNQODI2NkV4ZWMkPUxOJCYjNTg7RVhJVCBETw0KCQkJCUlGIElOU1RSKExOJCwiRVJST1IiKSBUSEVOIEVTUDgyNjZFeGVjJD0iRVJST1IgJiM5MTsiK0xOQnVmJCsiJiM5MzsiJiM1ODtFWElUIERPDQoJCQlFTkQgSUYNCgkJTE9PUA0KDQoJRU5EIEZVTkNUSU9ODQoNCg0KJyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7JiM0NTsmIzQ1OyYjNDU7DQoNCg0KCUZVTkNUSU9OIEdldElPJChpbyxUaW1lT3V0KQ0KCQlMT0NBTCBTVFJJTkcgYSQsYiQNCgkJTE9DQUwgSU5URUdFUiBjDQoNCgkJU3RhcnRUT1RpbWVyIFRpbWVPdXQNCgkJRE8NCgkJCUlGIFRPRmc9MSBUSEVOIEdldElPJD0iVC9PIiYjNTg7RVhJVCBETw0KCQkJSUYgTE9DKCYjMzU7aW8pJmx0OyZndDswIFRIRU4NCgkJCQlBJD1JTlBVVCQoMSwmIzM1O2lvKSYjNTg7Qz1BU0MoQSQpDQoJCQkJU0VMRUNUIENBU0UgQw0KCQkJCQlDQVNFIDEzDQoJCQkJCQlHZXRJTyQ9YiQmIzU4O0VYSVQgRE8NCgkJCQkJQ0FTRSAwIFRPIDMxDQoJCQkJCUNBU0UgRUxTRQ0KCQkJCQkJSUYgTEVOKGIkKStMRU4oYSQpJmx0OzI1NSBUSEVOIGIkPWIkK2EkIEVMU0UgYiQ9YSQNCgkJCQlFTkQgU0VMRUNUDQoJCQlFTkQgSUYNCgkJTE9PUA0KCQlDbGVhclRPVGltZXINCglFTkQgRlVOQ1RJT04NCg0KDQoJU1VCIEZsdXNoSU8oc3RyZWFtKQ0KCQlMT0NBTCBTVFJJTkcgQSQNCgkJRE8gV0hJTEUgTE9DKCYjMzU7c3RyZWFtKSZsdDsmZ3Q7MA0KCQkJUEFVU0UgNTAmIzU4O0EkPUlOUFVUJChMT0MoJiMzNTtzdHJlYW0pLCYjMzU7c3RyZWFtKSYjNTg7UEFVU0UgNTANCgkJTE9PUA0KCUVORCBTVUINCg0KDQoNCglGVU5DVElPTiBSZXBsYWNlJChhJCxiJCxjJCkNCgkJTE9DQUwgSU5URUdFUiB6DQoJCUxPQ0FMIFNUUklORyB4JCx5JA0KCQl6PTENCgkJRE8NCgkJCXo9SU5TVFIoeixhJCxiJCkNCgkJCUlGIHo9MCBUSEVOIEVYSVQgRE8NCgkJCXgkPUxFRlQkKGEkLHotMSkmIzU4O3kkPU1JRCQoYSQseitMRU4oYiQpKSYjNTg7YSQ9eCQrYyQreSQmIzU4O3o9TEVOKHgkKStMRU4oYyQpDQoJCUxPT1ANCgkJUmVwbGFjZSQ9YSQNCglFTkQgRlVOQ1RJT04NCg0KDQoJRlVOQ1RJT04gVVJMRGVjb2RlJChhJCkNCgkJTE9DQUwgSU5URUdFUiB6DQoJCUxPQ0FMIFNUUklORyBiJCxjJA0KCQl6PTENCgkJRE8NCgkJCXo9SU5TVFIoeixhJCwiJSIpDQoJCQlJRiB6PTAgT1Igej1MRU4oYSQpIFRIRU4gRVhJVCBETw0KCQkJYiQ9TUlEJChhJCx6LDMpJiM1ODtjJD1DSFIkKFZBTCgiJmFtcDtoIitNSUQkKGIkLDIpKSkmIzU4O2EkPVJlcGxhY2UkKGEkLGIkLGMkKQ0KCQlMT09QDQoJCVVSTERlY29kZSQ9YSQNCglFTkQgRlVOQ1RJT04NCg0KDQoJRlVOQ1RJT04gTFRyaW0kKGEkKQ0KCQlMT0NBTCBJTlRFR0VSIG0NCgkJRk9SIG09MSBUTyBMRU4oYSQpDQoJCQlJRiBub3QoTUlEJChhJCxtLDEpPSIgIiBPUiBNSUQkKGEkLG0sMSk9Q0hSJCg5KSkgVEhFTiBMVHJpbSQ9TUlEJChhJCxtKSYjNTg7RVhJVCBGVU5DVElPTg0KCQlORVhUDQoJCUxUcmltJD0iIg0KCUVORCBGVU5DVElPTg0KDQoNCglGVU5DVElPTiBSVHJpbSQoYSQpDQoJCUxPQ0FMIElOVEVHRVIgbg0KCQlGT1Igbj1MRU4oYSQpIFRPIDEgU1RFUCAtMQ0KCQkJSUYgbm90KE1JRCQoYSQsbiwxKT0iICIgT1IgTUlEJChhJCxuLDEpPUNIUiQoOSkpIFRIRU4gUlRyaW0kPUxFRlQkKGEkLG4pJiM1ODtFWElUIEZVTkNUSU9ODQoJCU5FWFQNCgkJUlRyaW0kPSIiDQoJRU5EIEZVTkNUSU9ODQoNCg0KCUZVTkNUSU9OIFNwbGl0KGEkLGIkKQ0KCQlMT0NBTCBJTlRFR0VSIHosbixtDQoJCU9OIEVSUk9SIFNLSVANCgkJRVJBU0UgU1AkDQoJCXo9MSYjNTg7bj0wDQoJCURPDQoJCQl6PUlOU1RSKHosYSQsYiQpDQoJCQlJRiB6PTAgVEhFTg0KCQkJCUlGIG49MCBUSEVODQoJCQkJCURJTSBTUCQoMSkmIzU4O1NQJCgxKT1hJCYjNTg7U3BsaXQ9MSYjNTg7RVhJVCBGVU5DVElPTg0KCQkJCUVMU0UNCgkJCQkJRVhJVCBETw0KCQkJCUVORCBJRg0KCQkJRUxTRQ0KCQkJCW49bisxJiM1ODt6PXorTEVOKGIkKQ0KCQkJRU5EIElGDQoJCUxPT1ANCg0KCQltPW4rMSYjNTg7bj0xDQoJCURJTSBTUCQobSkNCgkJRE8NCgkJCXo9SU5TVFIoMSxhJCxiJCkNCgkJCUlGIHo9MCBUSEVODQoJCQkJU1AkKG0pPWEkJiM1ODtFWElUIERPDQoJCQlFTFNFDQoJCQkJU1AkKG4pPUxFRlQkKGEkLHotMSkmIzU4O2EkPU1JRCQoYSQseitMRU4oYiQpKSYjNTg7bj1uKzENCgkJCUVORCBJRg0KCQlMT09QDQoJCVNwbGl0PW0NCglFTkQgRlVOQ1RJT04NCg0KDQo8L3ByZT5kZM9i2IjO0387Bv3MFM5ouEvUNLnK" />
</div>

<div>

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="03CF0AB7" />
</div>
        <h1 class="pagetitle">ESP8266 WiFi Module with multi-session HTTP API (pure MMBasic)</h1><small>Modified on 2016/12/23 23:31 by CaptainBoing &mdash; Categorized as: Network, Wifi</small><br /><br />This is a complete ESP8266 module that will connect to the WiFi of your choice and then accept connection inbound. No CFunctions or anything, purely handling a serial port and chopping up whatever comes through. It works really well and is fast. It handles multiple inbound connections - up to five at a time. It looks like a big deal but a lot of it is simply functions to make string handling easier (at the bottom).<br /><br />This might be for a MicroMite based web server or to allow you to set the MicroMite doing things. Here I don't write back HTML (API doesn't require it) but you could just as easily, you could ask for status on bits, analogue inputs. You could send Instructions for quite complex activities, your imagination is the limit.<br /><br />This is an extract (with changes) from my SMS Gateway. I connect in with a web page and issue commands via this collection to send text message from my website. This bit works perfect, all the time... (the M590 GSM module is more temperamental and I have some work to do before I can publish that bit).<br /><br />This is enough to get you going, you have to pick the bones apart of the main loop and understand what is happening but it is mainly just detecting the inbound connection and then using string slicing to pick apart the HTTP request to see what is being asked for.<br /><br />Here's a load of links I used when I was getting this working. Research loads!<br /><br /><a class="externallink" href="https://alselectro.wordpress.com/2015/05/13/wifi-module-esp8266-2-tcp-client-server-mode/" title="https://alselectro.wordpress.com/2015/05/13/wifi-module-esp8266-2-tcp-client-server-mode/" target="_blank">https://alselectro.wordpress.com/2015/05/13/wifi-module-esp8266-2-tcp-client-server-mode/</a><br /><a class="externallink" href="https://www.sparkfun.com/products/13678" title="https://www.sparkfun.com/products/13678" target="_blank">https://www.sparkfun.com/products/13678</a><br /><a class="externallink" href="http://www.instructables.com/id/Using-the-ESP8266-module/" title="http://www.instructables.com/id/Using-the-ESP8266-module/" target="_blank">http://www.instructables.com/id/Using-the-ESP8266-module/</a><br /><a class="externallink" href="http://www.instructables.com/id/Using-the-ESP8266-module/step3/Configuring-the-8266-Module/" title="http://www.instructables.com/id/Using-the-ESP8266-module/step3/Configuring-the-8266-Module/" target="_blank">http://www.instructables.com/id/Using-the-ESP8266-module/step3/Configuring-the-8266-Module/</a><br /><a class="externallink" href="http://www.instructables.com/id/How-to-Build-a-ESP8266-Web-Server/step7/Results/" title="http://www.instructables.com/id/How-to-Build-a-ESP8266-Web-Server/step7/Results/" target="_blank">http://www.instructables.com/id/How-to-Build-a-ESP8266-Web-Server/step7/Results/</a><br /><a class="externallink" href="https://github.com/esp8266/esp8266-wiki/wiki" title="https://github.com/esp8266/esp8266-wiki/wiki" target="_blank">https://github.com/esp8266/esp8266-wiki/wiki</a><br /><a class="externallink" href="http://www.esp8266.com/" title="http://www.esp8266.com/" target="_blank">http://www.esp8266.com/</a><br /><a class="externallink" href="http://dominicm.com/esp8266-send-receive-data/" title="http://dominicm.com/esp8266-send-receive-data/" target="_blank">http://dominicm.com/esp8266-send-receive-data/</a><br /><a class="externallink" href="https://www.youtube.com/watch?v=aqjx-85_hwg" title="https://www.youtube.com/watch?v=aqjx-85_hwg" target="_blank">https://www.youtube.com/watch?v=aqjx-85_hwg</a><br /><a class="externallink" href="https://cdn.sparkfun.com/datasheets/Wireless/WiFi/Command Doc.pdf" title="https://cdn.sparkfun.com/datasheets/Wireless/WiFi/Command%20Doc.pdf" target="_blank">https://cdn.sparkfun.com/datasheets/Wireless/WiFi/Command%20Doc.pdf</a><br /><a class="externallink" href="http://41j.com/blog/2015/01/esp8266-client-mode-connect-remote-host-simple-example/" title="http://41j.com/blog/2015/01/esp8266-client-mode-connect-remote-host-simple-example/" target="_blank">http://41j.com/blog/2015/01/esp8266-client-mode-connect-remote-host-simple-example/</a><br /><br /><br />Enjoy<br /><br /><br /><pre>

'
'ESP8266 Module. Andrew Henderson. October 2016
'

'Preamble
	OPTION BASE 0

	CONST LAN=2


'S/W Init
	DIM STRING A$,B$,D$
	DIM STRING LNBuf$
	DIM STRING LANRxLN$,LANTxLN$,TChr$ LENGTH 1
	DIM INTEGER C,Z,TOFg,Chan,Conn(4),PingTMR,PingCtr,RL1TMR LANf
	DIM FLOAT x

	'Starting WLAN Interface

	Open "COM2&#58;9600,1024" As &#35;LAN

	ESP8266Reset


Main&#58;



        ' don't do this every time through the loop, set a timer for no more than 60second intervals &#123;
        'Test Internet connectivity - you'll have to handle what to do if this is broken, there's nothing here for it.
	A$=ESP8266Exec$("AT+PING="+PA,4000,0)   ' PA=Ping address. try to be nice here and set this to a DNS server from your ISP e.g. 100,200,111,222 or www.bbc.co.uk or something that won't mind you pinging them
	IF A$="OK" THEN
		'good
		'...
	ELSE
		'internet down
                '...
	END IF
        &#125;





	'Web API parsing

	LANRxLN$=GetIO$(LAN,1)
	IF LANRxLN$="" OR LANRxLN$="T/O" THEN GOTO Main ' nothing waiting on the input

	IF MID$(LANRxLN$,2,8)=",CONNECT" THEN ' ESP8266 provides the connect as an indication of HTTP input
		Chan=VAL(LANRxLN$)
		IF Chan&gt;=0 AND Chan&lt;=4 THEN
			Conn(Chan)=1 
                        PRINT "Inbound connect channel "+STR$(Chan)
			'Inbound connect channel on  channel 0 - 5
			GOTO IPEXIT
		END IF
	END IF

	IF MID$(LANRxLN$,2,7)=",CLOSED" THEN ' ESP8266 provides the closed as an indication of HTTP channel closing
                                             ' either coz it was explicit or it timed out
		Chan=VAL(LANRxLN$)
		IF Chan&gt;=0 AND Chan&lt;=4 THEN
			IF Conn(Chan)=0 THEN A$=" Abnormally " ELSE A$=""
			PRINT "Closed channel "+STR$(Chan) + A$
			Conn(Chan)=0
			GOTO IPEXIT
		END IF
	END IF

	IF LEFT$(LANRxLN$,5)="+IPD," THEN
		Chan=VAL(MID$(LANRxLN$,6,1))
		IF Chan&gt;4 THEN GOTO IPDerrEXIT
		IF Conn(Chan)&lt;&gt;1 THEN GOTO IPDerrEXIT 'channel not open

		z=INSTR(LANRxLN$,"&#58;GET /&lt;my page, e.g. index.htm&gt;") ' +IPD,0,nnn&#58;GET /index.htm HTTP/1.1

		do&#58;a$=GetIO$(LAN,2)&#58;loop until a$="Connection&#58; Keep-Alive" ' empty the rest of the envelope, this string is the last part of an HTTP connection header

		IF z=&gt;8 AND Z&lt;=11 THEN ' checking for the position of the arguments in the string - your mileage will vary... simple sanity check
			b$=MID$(LANRxLN$,z+13)
			z=INSTR(b$," HTTP/")
			IF z&lt;21 THEN GOTO IPDerrEXIT '... and again
			b$=LEFT$(b$,z-1) ' remove the HTTP bit
			b$=Replace$(b$,"+"," ")' + to spaces
			args=Split(b$,"?") '  split the request arguments out
			IF args &lt;3 THEN GOTO IPDerrEXIT ' your arguments might vary - I have two, the header + two arguments = 3 strings from the spilt
			
			FOR n=2 TO args 'args=1 is a dummy
				SELECT CASE LEFT$(ucase$(SP$(n)),4) ' check for the name of the argument here and assign the value to a variable
					CASE "VAR1="
						var1$=LTrim$(RTrim$(MID$(sp$(n),5)))
					CASE "VAR2="
						var2$=LTrim$(RTrim$(MID$(sp$(n),5)))
				END SELECT
			NEXT
			IF var1$="" OR var2$="" THEN GOTO IPDerrEXIT ' don't allow empty values - your mileage may vary
			ERASE SP$
			Msg$=URLDecode$(Msg$)

                ' other api calls go here, I only have one in this application


		END IF

		GOTO IPDerrEXIT 'default action IF we don't find an API call

	END IF


	GOTO IPEXIT
IPDerrEXIT&#58;
	B$="ERROR&#58; Malformed request &#123;"+LANRxLN$+"&#125;"
IPOKEXIT&#58;

	PRINT &#35;LAN,"AT+CIPSENDEX="+STR$(Chan)+",255" ' send our response back to the requestor
	PAUSE 100

	PRINT&#35;LAN,B$+"\0"
	PAUSE 100

	PRINT&#35;LAN,"AT+CIPCLOSE="+STR$(Chan) ' then close the channel nicely
	Conn(Chan)=0

IPEXIT&#58;

	GOTO Main

	END


'&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45; ESP8266 WiFi Modem SUBsys &#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;-

	SUB ESP8266Reset
		LOCAL STRING A$
		LOCAL INTEGER N

		PULSE LANRST,10                                ' whatever pin you have connected to the reset of the ESP8266
		PAUSE 400

		LANExec "ATE0",2,0
		LANExec "AT+CWAUTOCONN=0",2,0                  ' turn off autoconnect while we initialise
		LANExec "AT+CWMODE=1",2,0
		LANExec "AT+CWQAP",4,0                         ' disconnect any existing WiFi connections
		LANExec "AT+RFVDD",2,0
		LANExec "AT+CWJAP="+AP+","+PW,10,1             ' AP= name of the network you want to join e.g. your WIFI SSID - and PW= it's password
		LANExec "AT+CIPSTA="+IP+","+GW+","+MS,2,0      ' the IP and Gateway address for static IP addresses, rem this line for a static IP
		LANExec "AT+CIFSR",2,0
		LANExec "AT+CWAUTOCONN=1",2,0                  ' turn autoconnect back on so if the WiFi drops, the ESP8266 will self negotiate to get it back
		LANExec "AT+CIPMUX=1",2,0
		LANExec "AT+CIPSERVER=1,19090",2,0             ' turn on the server with the port you want your API to listen on, normally HTTP is 80 or sometimes 8080, here I listen on 19090... you can use anything from 1 - 65536 but as a guideline; avoid anything below 1000 if you are not using 80

		LANTxLN$=""&#58;LANRxLN$=""                        ' buffers for receive and transmit

		FOR N=0 TO 4&#58;Conn(N)=0&#58;NEXT                    ' clear the channel connection flags

	END SUB




	SUB LANExec(CM$,T,Suppress) 'temp - will go when we have better handling of the startup
		LOCAL STRING A$
		A$=ESP8266Exec$(CM$,T,Suppress)
		IF Suppress&lt;2 THEN CLog A$,0
	END SUB

	FUNCTION ESP8266Exec$(Com$,TimeOut,Obf)
		LOCAL STRING A$ LENGTH 1,LN$
		LOCAL INTEGER C

		PRINT &#35;LAN,Com$

		DO
			LN$=GetIO$(LAN,TimeOut)
			IF LN$="T/O" THEN ESP8266Exec$="T/O"&#58;EXIT DO
			IF LN$&lt;&gt;"" THEN
				IF Obf&lt;2 THEN CLog "&#91;"+LN$+"&#93;",0
				IF LN$="OK" OR LN$="&gt;" OR LN$="SEND OK" THEN ESP8266Exec$=LN$&#58;EXIT DO
				IF INSTR(LN$,"ERROR") THEN ESP8266Exec$="ERROR &#91;"+LNBuf$+"&#93;"&#58;EXIT DO
			END IF
		LOOP

	END FUNCTION


'&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;


	FUNCTION GetIO$(io,TimeOut)
		LOCAL STRING a$,b$
		LOCAL INTEGER c

		StartTOTimer TimeOut
		DO
			IF TOFg=1 THEN GetIO$="T/O"&#58;EXIT DO
			IF LOC(&#35;io)&lt;&gt;0 THEN
				A$=INPUT$(1,&#35;io)&#58;C=ASC(A$)
				SELECT CASE C
					CASE 13
						GetIO$=b$&#58;EXIT DO
					CASE 0 TO 31
					CASE ELSE
						IF LEN(b$)+LEN(a$)&lt;255 THEN b$=b$+a$ ELSE b$=a$
				END SELECT
			END IF
		LOOP
		ClearTOTimer
	END FUNCTION


	SUB FlushIO(stream)
		LOCAL STRING A$
		DO WHILE LOC(&#35;stream)&lt;&gt;0
			PAUSE 50&#58;A$=INPUT$(LOC(&#35;stream),&#35;stream)&#58;PAUSE 50
		LOOP
	END SUB



	FUNCTION Replace$(a$,b$,c$)
		LOCAL INTEGER z
		LOCAL STRING x$,y$
		z=1
		DO
			z=INSTR(z,a$,b$)
			IF z=0 THEN EXIT DO
			x$=LEFT$(a$,z-1)&#58;y$=MID$(a$,z+LEN(b$))&#58;a$=x$+c$+y$&#58;z=LEN(x$)+LEN(c$)
		LOOP
		Replace$=a$
	END FUNCTION


	FUNCTION URLDecode$(a$)
		LOCAL INTEGER z
		LOCAL STRING b$,c$
		z=1
		DO
			z=INSTR(z,a$,"%")
			IF z=0 OR z=LEN(a$) THEN EXIT DO
			b$=MID$(a$,z,3)&#58;c$=CHR$(VAL("&amp;h"+MID$(b$,2)))&#58;a$=Replace$(a$,b$,c$)
		LOOP
		URLDecode$=a$
	END FUNCTION


	FUNCTION LTrim$(a$)
		LOCAL INTEGER m
		FOR m=1 TO LEN(a$)
			IF not(MID$(a$,m,1)=" " OR MID$(a$,m,1)=CHR$(9)) THEN LTrim$=MID$(a$,m)&#58;EXIT FUNCTION
		NEXT
		LTrim$=""
	END FUNCTION


	FUNCTION RTrim$(a$)
		LOCAL INTEGER n
		FOR n=LEN(a$) TO 1 STEP -1
			IF not(MID$(a$,n,1)=" " OR MID$(a$,n,1)=CHR$(9)) THEN RTrim$=LEFT$(a$,n)&#58;EXIT FUNCTION
		NEXT
		RTrim$=""
	END FUNCTION


	FUNCTION Split(a$,b$)
		LOCAL INTEGER z,n,m
		ON ERROR SKIP
		ERASE SP$
		z=1&#58;n=0
		DO
			z=INSTR(z,a$,b$)
			IF z=0 THEN
				IF n=0 THEN
					DIM SP$(1)&#58;SP$(1)=a$&#58;Split=1&#58;EXIT FUNCTION
				ELSE
					EXIT DO
				END IF
			ELSE
				n=n+1&#58;z=z+LEN(b$)
			END IF
		LOOP

		m=n+1&#58;n=1
		DIM SP$(m)
		DO
			z=INSTR(1,a$,b$)
			IF z=0 THEN
				SP$(m)=a$&#58;EXIT DO
			ELSE
				SP$(n)=LEFT$(a$,z-1)&#58;a$=MID$(a$,z+LEN(b$))&#58;n=n+1
			END IF
		LOOP
		Split=m
	END FUNCTION


</pre>
    </form>
</body>

<!-- Mirrored from fruitoftheshed.com/MMBasic.Print.aspx?Page=MMBasic.ESP8266-Module-with-HTTP-API by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 09 Feb 2022 12:16:22 GMT -->
</html>
